<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Mathieu Pauly @ Arolla" />
  <title>Cours Java 8 AL ESGI</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
  <link rel="stylesheet" href="pandoc.css" type="text/css" />
</head>
<body>
<div id="header">
<h1 class="title">Cours Java 8 AL ESGI</h1>
<h2 class="author">Mathieu Pauly @ Arolla</h2>
<h3 class="date">Première rédaction mars 2017 (dernière mise à jour : 11/09/2019)</h3>
</div>
<div id="TOC">
<ul>
<li><a href="#introduction-à-java"><span class="toc-section-number">1</span> Introduction à Java</a><ul>
<li><a href="#premier-programme"><span class="toc-section-number">1.1</span> Premier programme</a></li>
<li><a href="#types-et-méthodes-basiques"><span class="toc-section-number">1.2</span> Types et méthodes basiques</a><ul>
<li><a href="#type-int"><span class="toc-section-number">1.2.1</span> Type int</a></li>
<li><a href="#type-double-et-printf"><span class="toc-section-number">1.2.2</span> Type double et printf</a></li>
<li><a href="#tableau-et-boucle-for"><span class="toc-section-number">1.2.3</span> Tableau et boucle for</a></li>
<li><a href="#type-string"><span class="toc-section-number">1.2.4</span> Type String</a></li>
<li><a href="#if"><span class="toc-section-number">1.2.5</span> If</a></li>
</ul></li>
<li><a href="#notation-binaire-exercice"><span class="toc-section-number">1.3</span> Notation binaire : exercice</a><ul>
<li><a href="#correction"><span class="toc-section-number">1.3.1</span> Correction</a></li>
</ul></li>
<li><a href="#java-8-api"><span class="toc-section-number">1.4</span> Java 8 API</a></li>
<li><a href="#unité-de-compilation"><span class="toc-section-number">1.5</span> Unité de compilation</a></li>
<li><a href="#logarithme-et-exponentiation-exercice"><span class="toc-section-number">1.6</span> Logarithme et exponentiation : exercice</a></li>
<li><a href="#logarithme-base-2-en-java"><span class="toc-section-number">1.7</span> Logarithme base 2 en Java</a></li>
<li><a href="#visibilité-un-tour-dhorizon"><span class="toc-section-number">1.8</span> Visibilité : un tour d'horizon</a></li>
<li><a href="#visibilité-dans-le-contexte-de-lencapsulation"><span class="toc-section-number">1.9</span> Visibilité dans le contexte de l'encapsulation</a></li>
<li><a href="#visibilité-dans-un-contexte-de-packages-multiples"><span class="toc-section-number">1.10</span> Visibilité dans un contexte de packages multiples</a></li>
<li><a href="#visibilité-dans-le-contexte-de-lhéritage"><span class="toc-section-number">1.11</span> Visibilité dans le contexte de l'héritage</a></li>
<li><a href="#visibilité-résumé"><span class="toc-section-number">1.12</span> Visibilité : résumé</a></li>
<li><a href="#conversion"><span class="toc-section-number">1.13</span> Conversion</a></li>
<li><a href="#tableau"><span class="toc-section-number">1.14</span> Tableau</a></li>
<li><a href="#list-et-arraylist"><span class="toc-section-number">1.15</span> List et ArrayList</a></li>
<li><a href="#stringbuilder"><span class="toc-section-number">1.16</span> StringBuilder</a></li>
<li><a href="#premier-objet"><span class="toc-section-number">1.17</span> Premier objet</a><ul>
<li><a href="#plus-grand-commun-diviseur-exercice"><span class="toc-section-number">1.17.1</span> Plus grand commun diviseur : exercice</a></li>
<li><a href="#méthode-récursive-et-statique"><span class="toc-section-number">1.17.2</span> Méthode récursive et statique</a></li>
<li><a href="#objet"><span class="toc-section-number">1.17.3</span> Objet</a></li>
<li><a href="#champ-de-classe"><span class="toc-section-number">1.17.4</span> Champ de classe</a></li>
<li><a href="#constructeur-par-défaut"><span class="toc-section-number">1.17.5</span> Constructeur par défaut</a></li>
<li><a href="#constructeur-sans-paramètre"><span class="toc-section-number">1.17.6</span> Constructeur sans paramètre</a></li>
<li><a href="#constructeur-avec-2-paramètres"><span class="toc-section-number">1.17.7</span> Constructeur avec 2 paramètres</a></li>
<li><a href="#référence-interne"><span class="toc-section-number">1.17.8</span> Référence interne</a></li>
<li><a href="#premier-objet-correction"><span class="toc-section-number">1.17.9</span> Premier objet : correction</a></li>
</ul></li>
<li><a href="#priorité-des-opérateurs"><span class="toc-section-number">1.18</span> Priorité des opérateurs</a><ul>
<li><a href="#exercice-opérateurs"><span class="toc-section-number">1.18.1</span> Exercice opérateurs</a></li>
</ul></li>
<li><a href="#package"><span class="toc-section-number">1.19</span> Package</a><ul>
<li><a href="#exercice"><span class="toc-section-number">1.19.1</span> Exercice</a></li>
</ul></li>
<li><a href="#nombres-rationels"><span class="toc-section-number">1.20</span> Nombres rationels</a><ul>
<li><a href="#exercice-1"><span class="toc-section-number">1.20.1</span> Exercice 1</a></li>
<li><a href="#invariant-et-bug"><span class="toc-section-number">1.20.2</span> Invariant et bug</a></li>
<li><a href="#exercice-2"><span class="toc-section-number">1.20.3</span> Exercice 2</a></li>
<li><a href="#exercice-3"><span class="toc-section-number">1.20.4</span> Exercice 3</a></li>
<li><a href="#exercice-4"><span class="toc-section-number">1.20.5</span> Exercice 4</a></li>
<li><a href="#exercice-5"><span class="toc-section-number">1.20.6</span> Exercice 5</a></li>
<li><a href="#exercice-6"><span class="toc-section-number">1.20.7</span> Exercice 6</a></li>
<li><a href="#exercice-7"><span class="toc-section-number">1.20.8</span> Exercice 7</a></li>
<li><a href="#exercice-8"><span class="toc-section-number">1.20.9</span> Exercice 8</a></li>
<li><a href="#exercice-9"><span class="toc-section-number">1.20.10</span> Exercice 9</a></li>
<li><a href="#exercice-10"><span class="toc-section-number">1.20.11</span> Exercice 10</a></li>
<li><a href="#exercice-11"><span class="toc-section-number">1.20.12</span> Exercice 11</a></li>
<li><a href="#exercice-12"><span class="toc-section-number">1.20.13</span> Exercice 12</a></li>
<li><a href="#exercice-13"><span class="toc-section-number">1.20.14</span> Exercice 13</a></li>
<li><a href="#exercice-14"><span class="toc-section-number">1.20.15</span> Exercice 14</a></li>
<li><a href="#exercice-15"><span class="toc-section-number">1.20.16</span> Exercice 15</a></li>
<li><a href="#exercice-16"><span class="toc-section-number">1.20.17</span> Exercice 16</a></li>
<li><a href="#exercice-17"><span class="toc-section-number">1.20.18</span> Exercice 17</a></li>
<li><a href="#exercice-18"><span class="toc-section-number">1.20.19</span> Exercice 18</a></li>
<li><a href="#correction-1"><span class="toc-section-number">1.20.20</span> Correction</a></li>
</ul></li>
<li><a href="#héritage"><span class="toc-section-number">1.21</span> Héritage</a><ul>
<li><a href="#affectations"><span class="toc-section-number">1.21.1</span> Affectations</a></li>
<li><a href="#constructeur-super"><span class="toc-section-number">1.21.2</span> Constructeur super</a></li>
<li><a href="#redéfinition"><span class="toc-section-number">1.21.3</span> Redéfinition</a></li>
<li><a href="#périmètre-et-air"><span class="toc-section-number">1.21.4</span> Périmètre et air</a></li>
<li><a href="#exercice-19"><span class="toc-section-number">1.21.5</span> Exercice</a></li>
<li><a href="#style-objet"><span class="toc-section-number">1.21.6</span> Style objet</a></li>
<li><a href="#exercice-20"><span class="toc-section-number">1.21.7</span> Exercice</a></li>
<li><a href="#correction-2"><span class="toc-section-number">1.21.8</span> Correction</a></li>
<li><a href="#exercice-21"><span class="toc-section-number">1.21.9</span> Exercice</a></li>
<li><a href="#correction-3"><span class="toc-section-number">1.21.10</span> Correction</a></li>
</ul></li>
<li><a href="#résumé"><span class="toc-section-number">1.22</span> Résumé</a><ul>
<li><a href="#quelle-est-la-signature-de-la-fonction-main"><span class="toc-section-number">1.22.1</span> Quelle est la signature de la fonction main ?</a></li>
<li><a href="#quelle-est-la-différence-entre-et-equals"><span class="toc-section-number">1.22.2</span> Quelle est la différence entre == et equals ?</a></li>
<li><a href="#quelle-est-la-syntaxe-pour-convertir-un-double-en-int"><span class="toc-section-number">1.22.3</span> Quelle est la syntaxe pour convertir un double en int ?</a></li>
<li><a href="#comment-déclarer-et-initialiser-un-tableau-de-int-de-taille-3"><span class="toc-section-number">1.22.4</span> Comment déclarer et initialiser un tableau de int de taille 3 ?</a></li>
<li><a href="#quels-sont-les-4-modificateurs-de-visibilités-et-leur-signification"><span class="toc-section-number">1.22.5</span> Quels sont les 4 modificateurs de visibilités et leur signification ?</a></li>
<li><a href="#quelle-classe-définit-une-liste-dynamique"><span class="toc-section-number">1.22.6</span> Quelle classe définit une liste dynamique ?</a></li>
<li><a href="#quelle-classe-doit-on-utiliser-quand-on-concatène-beaucoup-de-chaînes-de-caractères-dans-une-boucle"><span class="toc-section-number">1.22.7</span> Quelle classe doit-on utiliser quand on concatène beaucoup de chaînes de caractères dans une boucle ?</a></li>
<li><a href="#quelle-méthode-java-permet-de-générer-un-nombre-double-aléatoire"><span class="toc-section-number">1.22.8</span> Quelle méthode Java permet de générer un nombre (double) aléatoire ?</a></li>
<li><a href="#quelle-est-la-différence-entre-une-méthode-statique-static-et-une-méthode-non-statique"><span class="toc-section-number">1.22.9</span> Quelle est la différence entre une méthode statique (static) et une méthode non statique ?</a></li>
<li><a href="#quest-ce-que-la-surcharge-overloading"><span class="toc-section-number">1.22.10</span> Qu'est-ce que la surcharge (overloading) ?</a></li>
<li><a href="#quest-ce-que-la-redéfinition-ou-overriding"><span class="toc-section-number">1.22.11</span> Qu'est-ce que la redéfinition ou (overriding) ?</a></li>
<li><a href="#expliquer-ce-quest-le-constructeur-par-défaut"><span class="toc-section-number">1.22.12</span> Expliquer ce qu'est le constructeur par défaut ?</a></li>
<li><a href="#à-quoi-correspond-le-mot-clé-this"><span class="toc-section-number">1.22.13</span> À quoi correspond le mot-clé &quot;this&quot; ?</a></li>
<li><a href="#comment-récupérer-la-longueur-dun-tableau"><span class="toc-section-number">1.22.14</span> Comment récupérer la longueur d'un tableau ?</a></li>
<li><a href="#comment-récupérer-la-longueur-dune-liste-dynamique"><span class="toc-section-number">1.22.15</span> Comment récupérer la longueur d'une liste dynamique ?</a></li>
<li><a href="#quelle-est-la-syntaxe-dun-switch"><span class="toc-section-number">1.22.16</span> Quelle est la syntaxe d'un switch ?</a></li>
<li><a href="#quelle-est-la-valeur-par-défaut-pour-un-int"><span class="toc-section-number">1.22.17</span> Quelle est la valeur par défaut pour un int ?</a></li>
<li><a href="#quelle-est-la-valeur-par-défaut-pour-un-boolean"><span class="toc-section-number">1.22.18</span> Quelle est la valeur par défaut pour un boolean ?</a></li>
<li><a href="#quelle-est-la-valeur-par-défaut-pour-une-string"><span class="toc-section-number">1.22.19</span> Quelle est la valeur par défaut pour une String ?</a></li>
<li><a href="#quelle-est-la-valeur-par-défaut-pour-un-object"><span class="toc-section-number">1.22.20</span> Quelle est la valeur par défaut pour un Object ?</a></li>
<li><a href="#quelle-méthode-permet-de-scinder-une-chaîne-de-caractère"><span class="toc-section-number">1.22.21</span> Quelle méthode permet de scinder une chaîne de caractère ?</a></li>
<li><a href="#quelle-est-la-syntaxe-pour-appeler-une-méthode-dinstance"><span class="toc-section-number">1.22.22</span> Quelle est la syntaxe pour appeler une méthode d'instance ?</a></li>
<li><a href="#quelle-est-la-syntaxe-pour-référencer-un-champ-dinstance"><span class="toc-section-number">1.22.23</span> Quelle est la syntaxe pour référencer un champ d'instance ?</a></li>
<li><a href="#etant-donné-class-animal-et-class-dog-extends-animal-lesquelles-de-ces-affectations-compilent"><span class="toc-section-number">1.22.24</span> Etant donné &quot;class Animal {}&quot; et &quot;class Dog extends Animal {}&quot;, lesquelles de ces affectations compilent :</a></li>
<li><a href="#etant-donné-une-super-classe-animal-qui-définit-uniquement-le-constructeur-animalstring-name-quelle-définition-du-constructeur-dog-compilent-telles"><span class="toc-section-number">1.22.25</span> Etant donné une super classe Animal qui définit uniquement le constructeur Animal(String name), quelle définition du constructeur Dog compilent t'elles ?</a></li>
<li><a href="#quelles-règles-sappliquent-pour-la-redéfinition-de-méthode"><span class="toc-section-number">1.22.26</span> Quelles règles s'appliquent pour la redéfinition de méthode ?</a></li>
</ul></li>
<li><a href="#correction-evaluation-1"><span class="toc-section-number">1.23</span> Correction Evaluation 1</a><ul>
<li><a href="#exercice-1-1"><span class="toc-section-number">1.23.1</span> Exercice 1</a></li>
<li><a href="#exercice-2-1"><span class="toc-section-number">1.23.2</span> Exercice 2</a></li>
</ul></li>
<li><a href="#hashmap"><span class="toc-section-number">1.24</span> HashMap</a><ul>
<li><a href="#exercice-compter-les-mots"><span class="toc-section-number">1.24.1</span> Exercice : compter les mots</a></li>
<li><a href="#exercice-hashcode-et-equals"><span class="toc-section-number">1.24.2</span> Exercice : hashCode et equals</a></li>
<li><a href="#exercice-lettre-anonyme"><span class="toc-section-number">1.24.3</span> Exercice : lettre anonyme</a></li>
<li><a href="#correction-compter-les-mots"><span class="toc-section-number">1.24.4</span> Correction : compter les mots</a></li>
<li><a href="#correction-hashcode-et-equals"><span class="toc-section-number">1.24.5</span> Correction : hashCode et equals</a></li>
<li><a href="#correction-lettre-anonyme"><span class="toc-section-number">1.24.6</span> Correction : lettre anonyme</a></li>
</ul></li>
<li><a href="#autoboxing"><span class="toc-section-number">1.25</span> Autoboxing</a></li>
</ul></li>
<li><a href="#les-collections"><span class="toc-section-number">2</span> Les collections</a><ul>
<li><a href="#exercice-22"><span class="toc-section-number">2.1</span> Exercice</a></li>
<li><a href="#exercice-23"><span class="toc-section-number">2.2</span> Exercice</a></li>
<li><a href="#exercice-24"><span class="toc-section-number">2.3</span> Exercice</a></li>
<li><a href="#exercice-25"><span class="toc-section-number">2.4</span> Exercice</a></li>
<li><a href="#exercice-26"><span class="toc-section-number">2.5</span> Exercice</a></li>
<li><a href="#exercice-27"><span class="toc-section-number">2.6</span> Exercice</a></li>
<li><a href="#exercice-28"><span class="toc-section-number">2.7</span> Exercice</a></li>
<li><a href="#exercice-29"><span class="toc-section-number">2.8</span> Exercice</a></li>
<li><a href="#exercice-30"><span class="toc-section-number">2.9</span> Exercice</a></li>
<li><a href="#exercice-31"><span class="toc-section-number">2.10</span> Exercice</a></li>
<li><a href="#exercice-32"><span class="toc-section-number">2.11</span> Exercice</a></li>
<li><a href="#exercice-33"><span class="toc-section-number">2.12</span> Exercice</a></li>
<li><a href="#classe-mère"><span class="toc-section-number">2.13</span> Classe mère</a></li>
<li><a href="#exercice-34"><span class="toc-section-number">2.14</span> Exercice</a></li>
<li><a href="#exercice-35"><span class="toc-section-number">2.15</span> Exercice</a></li>
<li><a href="#exercice-36"><span class="toc-section-number">2.16</span> Exercice</a></li>
<li><a href="#exercice-37"><span class="toc-section-number">2.17</span> Exercice</a></li>
<li><a href="#exercice-38"><span class="toc-section-number">2.18</span> Exercice</a></li>
<li><a href="#exercice-39"><span class="toc-section-number">2.19</span> Exercice</a><ul>
<li><a href="#exercice-40"><span class="toc-section-number">2.19.1</span> Exercice</a></li>
<li><a href="#exercice-41"><span class="toc-section-number">2.19.2</span> Exercice</a></li>
<li><a href="#exercice-42"><span class="toc-section-number">2.19.3</span> Exercice</a></li>
<li><a href="#exercice-43"><span class="toc-section-number">2.19.4</span> Exercice</a></li>
<li><a href="#exercice-44"><span class="toc-section-number">2.19.5</span> Exercice</a></li>
</ul></li>
<li><a href="#list-les-pièges"><span class="toc-section-number">2.20</span> List : les pièges</a><ul>
<li><a href="#surcharges-de-remove"><span class="toc-section-number">2.20.1</span> Surcharges de remove</a></li>
<li><a href="#modifications-concurrentes"><span class="toc-section-number">2.20.2</span> Modifications concurrentes</a></li>
</ul></li>
<li><a href="#les-séquence-déléments-stream"><span class="toc-section-number">2.21</span> Les séquence d'éléments (Stream)</a></li>
</ul></li>
<li><a href="#les-flux"><span class="toc-section-number">3</span> Les Flux</a><ul>
<li><a href="#flux-de-caractères"><span class="toc-section-number">3.1</span> Flux de caractères</a><ul>
<li><a href="#lire-un-caractère-à-partir-dun-fichier"><span class="toc-section-number">3.1.1</span> Lire un caractère à partir d'un fichier</a></li>
<li><a href="#écrire-un-caractère-dans-un-fichier"><span class="toc-section-number">3.1.2</span> Écrire un caractère dans un fichier</a></li>
<li><a href="#exercice-1-2"><span class="toc-section-number">3.1.3</span> Exercice 1</a></li>
<li><a href="#exercice-2-2"><span class="toc-section-number">3.1.4</span> Exercice 2</a></li>
<li><a href="#exercice-3-1"><span class="toc-section-number">3.1.5</span> Exercice 3</a></li>
<li><a href="#corrections"><span class="toc-section-number">3.1.6</span> Corrections</a></li>
</ul></li>
<li><a href="#flux-doctets"><span class="toc-section-number">3.2</span> Flux d'octets</a><ul>
<li><a href="#lecture"><span class="toc-section-number">3.2.1</span> Lecture</a></li>
<li><a href="#écriture"><span class="toc-section-number">3.2.2</span> Écriture</a></li>
<li><a href="#lecture-et-écriture"><span class="toc-section-number">3.2.3</span> Lecture et écriture</a></li>
<li><a href="#exercice-4-1"><span class="toc-section-number">3.2.4</span> Exercice 4</a></li>
<li><a href="#exercice-5-1"><span class="toc-section-number">3.2.5</span> Exercice 5</a></li>
<li><a href="#corrections-1"><span class="toc-section-number">3.2.6</span> Corrections</a></li>
<li><a href="#résumé-1"><span class="toc-section-number">3.2.7</span> Résumé</a></li>
</ul></li>
<li><a href="#file-et-path"><span class="toc-section-number">3.3</span> File et Path</a><ul>
<li><a href="#chemin-constant"><span class="toc-section-number">3.3.1</span> Chemin constant</a></li>
<li><a href="#exercice-6-1"><span class="toc-section-number">3.3.2</span> Exercice 6</a></li>
<li><a href="#composer-et-décomposer-un-chemin"><span class="toc-section-number">3.3.3</span> Composer et décomposer un chemin</a></li>
<li><a href="#exercice-7-1"><span class="toc-section-number">3.3.4</span> Exercice 7</a></li>
<li><a href="#lister-et-créer-un-répertoire"><span class="toc-section-number">3.3.5</span> Lister et créer un répertoire</a></li>
<li><a href="#corrections-2"><span class="toc-section-number">3.3.6</span> Corrections</a></li>
</ul></li>
<li><a href="#flux-orienté-ligne"><span class="toc-section-number">3.4</span> Flux orienté ligne</a><ul>
<li><a href="#bufferedreader"><span class="toc-section-number">3.4.1</span> BufferedReader</a></li>
<li><a href="#exercice8"><span class="toc-section-number">3.4.2</span> Exercice 8</a></li>
<li><a href="#bufferedwriter"><span class="toc-section-number">3.4.3</span> BufferedWriter</a></li>
<li><a href="#exercice-9-1"><span class="toc-section-number">3.4.4</span> Exercice 9</a></li>
<li><a href="#exercice-10-1"><span class="toc-section-number">3.4.5</span> Exercice 10</a></li>
<li><a href="#reader-et-writer"><span class="toc-section-number">3.4.6</span> Reader et Writer</a></li>
<li><a href="#inputstream-et-outputstream"><span class="toc-section-number">3.4.7</span> InputStream et OutputStream</a></li>
<li><a href="#inputstream-outputstream-reader-et-writer"><span class="toc-section-number">3.4.8</span> InputStream, OutputStream, Reader et Writer</a></li>
<li><a href="#exercice-11-1"><span class="toc-section-number">3.4.9</span> Exercice 11</a></li>
<li><a href="#exercice-12-1"><span class="toc-section-number">3.4.10</span> Exercice 12</a></li>
<li><a href="#corrections-3"><span class="toc-section-number">3.4.11</span> Corrections</a></li>
<li><a href="#sources"><span class="toc-section-number">3.4.12</span> Sources</a></li>
</ul></li>
</ul></li>
<li><a href="#les-exceptions"><span class="toc-section-number">4</span> Les exceptions</a><ul>
<li><a href="#throw-et-throws"><span class="toc-section-number">4.1</span> Throw et throws</a></li>
<li><a href="#try-et-catch"><span class="toc-section-number">4.2</span> Try et Catch</a></li>
<li><a href="#bloc-et-portée"><span class="toc-section-number">4.3</span> Bloc et portée</a></li>
<li><a href="#exceptions-maisons"><span class="toc-section-number">4.4</span> Exceptions maisons</a></li>
<li><a href="#multicatch"><span class="toc-section-number">4.5</span> Multicatch</a></li>
<li><a href="#chaînage"><span class="toc-section-number">4.6</span>  Chaînage</a></li>
<li><a href="#quelques-exceptions-communes"><span class="toc-section-number">4.7</span> Quelques exceptions communes</a><ul>
<li><a href="#nullpointerexception"><span class="toc-section-number">4.7.1</span> NullPointerException</a></li>
<li><a href="#arrayindexoutofboundsexception"><span class="toc-section-number">4.7.2</span> ArrayIndexOutOfBoundsException</a></li>
<li><a href="#illegalargumentexception"><span class="toc-section-number">4.7.3</span> IllegalArgumentException</a></li>
<li><a href="#stackoverflowerror"><span class="toc-section-number">4.7.4</span> StackOverflowError</a></li>
</ul></li>
<li><a href="#intérêt-des-exceptions"><span class="toc-section-number">4.8</span> Intérêt des exceptions</a></li>
<li><a href="#catégories-dexceptions"><span class="toc-section-number">4.9</span> Catégories d'exceptions</a></li>
<li><a href="#exercice-1-3"><span class="toc-section-number">4.10</span> Exercice 1</a></li>
<li><a href="#exercice-2-3"><span class="toc-section-number">4.11</span> Exercice 2</a></li>
<li><a href="#exercice-3-2"><span class="toc-section-number">4.12</span> Exercice 3</a></li>
<li><a href="#exercice-4-2"><span class="toc-section-number">4.13</span> Exercice 4</a></li>
<li><a href="#exercice-5-2"><span class="toc-section-number">4.14</span> Exercice 5</a></li>
<li><a href="#finally"><span class="toc-section-number">4.15</span> Finally</a></li>
<li><a href="#try-with"><span class="toc-section-number">4.16</span> Try with</a></li>
</ul></li>
<li><a href="#les-generics"><span class="toc-section-number">5</span> Les Generics</a><ul>
<li><a href="#algorithme"><span class="toc-section-number">5.1</span> Algorithme</a><ul>
<li><a href="#exercice-1-4"><span class="toc-section-number">5.1.1</span> Exercice 1</a></li>
<li><a href="#exercice-2-4"><span class="toc-section-number">5.1.2</span> Exercice 2</a></li>
<li><a href="#exercice-3-3"><span class="toc-section-number">5.1.3</span> Exercice 3</a></li>
<li><a href="#exercice-4-3"><span class="toc-section-number">5.1.4</span> Exercice 4</a></li>
<li><a href="#exercice-5-3"><span class="toc-section-number">5.1.5</span> Exercice 5</a></li>
</ul></li>
<li><a href="#paramètre-de-valeur"><span class="toc-section-number">5.2</span> Paramètre de valeur</a></li>
<li><a href="#paramètre-de-type"><span class="toc-section-number">5.3</span> Paramètre de type</a></li>
<li><a href="#exercice-6-2"><span class="toc-section-number">5.4</span> Exercice 6</a></li>
<li><a href="#exercice-7-2"><span class="toc-section-number">5.5</span> Exercice 7</a></li>
<li><a href="#exercice-8-1"><span class="toc-section-number">5.6</span> Exercice 8</a></li>
<li><a href="#exercice-9-2"><span class="toc-section-number">5.7</span> Exercice 9</a></li>
<li><a href="#exercice-10-2"><span class="toc-section-number">5.8</span> Exercice 10</a></li>
<li><a href="#exercice-11-2"><span class="toc-section-number">5.9</span> Exercice 11</a></li>
<li><a href="#exercice-12-2"><span class="toc-section-number">5.10</span> Exercice 12</a></li>
<li><a href="#tableaux"><span class="toc-section-number">5.11</span> Tableaux</a></li>
<li><a href="#generics-java-5"><span class="toc-section-number">5.12</span> Generics Java 5</a></li>
<li><a href="#bornes"><span class="toc-section-number">5.13</span> Bornes</a></li>
<li><a href="#wildcard"><span class="toc-section-number">5.14</span> Wildcard</a></li>
<li><a href="#exercice-13-1"><span class="toc-section-number">5.15</span> Exercice 13</a></li>
<li><a href="#exercice-14-1"><span class="toc-section-number">5.16</span> Exercice 14</a></li>
<li><a href="#exercice-15-1"><span class="toc-section-number">5.17</span> Exercice 15</a></li>
<li><a href="#exercice-16-1"><span class="toc-section-number">5.18</span>  Exercice 16</a></li>
<li><a href="#exercice-17-1"><span class="toc-section-number">5.19</span> Exercice 17</a></li>
<li><a href="#correction-exercices"><span class="toc-section-number">5.20</span> Correction exercices</a><ul>
<li><a href="#exercice1"><span class="toc-section-number">5.20.1</span> Exercice 1</a></li>
<li><a href="#exercice2"><span class="toc-section-number">5.20.2</span> Exercice 2</a></li>
<li><a href="#exercice-3-4"><span class="toc-section-number">5.20.3</span> Exercice 3</a></li>
<li><a href="#exercice4"><span class="toc-section-number">5.20.4</span> Exercice 4</a></li>
<li><a href="#exercice-5-4"><span class="toc-section-number">5.20.5</span> Exercice 5</a></li>
<li><a href="#exercice-6-3"><span class="toc-section-number">5.20.6</span> Exercice 6</a></li>
<li><a href="#exercice-7-3"><span class="toc-section-number">5.20.7</span> Exercice 7</a></li>
<li><a href="#exercice-8-2"><span class="toc-section-number">5.20.8</span> Exercice 8</a></li>
<li><a href="#exercice-9-3"><span class="toc-section-number">5.20.9</span> Exercice 9</a></li>
<li><a href="#exercice-10-3"><span class="toc-section-number">5.20.10</span> Exercice 10</a></li>
<li><a href="#exercice-11-3"><span class="toc-section-number">5.20.11</span> Exercice 11</a></li>
<li><a href="#exercice-12-3"><span class="toc-section-number">5.20.12</span> Exercice 12</a></li>
<li><a href="#exercice-13-2"><span class="toc-section-number">5.20.13</span> Exercice 13</a></li>
</ul></li>
<li><a href="#exercice-15-2"><span class="toc-section-number">5.21</span> Exercice 15</a></li>
<li><a href="#exercice-16-2"><span class="toc-section-number">5.22</span> Exercice 16</a></li>
<li><a href="#exercice-17-2"><span class="toc-section-number">5.23</span> Exercice 17</a></li>
</ul></li>
<li><a href="#les-fils-dexécutions"><span class="toc-section-number">6</span> Les fils d'exécutions</a><ul>
<li><a href="#classe-anonyme"><span class="toc-section-number">6.1</span> Classe anonyme</a></li>
<li><a href="#exercice-1-5"><span class="toc-section-number">6.2</span> Exercice 1</a></li>
<li><a href="#correction-1-1"><span class="toc-section-number">6.3</span> Correction 1</a></li>
<li><a href="#exercice-2-5"><span class="toc-section-number">6.4</span> Exercice 2</a></li>
<li><a href="#correction2"><span class="toc-section-number">6.5</span> Correction 2</a></li>
<li><a href="#exercice3"><span class="toc-section-number">6.6</span> Exercice 3</a></li>
<li><a href="#correction-3-1"><span class="toc-section-number">6.7</span> Correction 3</a></li>
<li><a href="#exercice-4-4"><span class="toc-section-number">6.8</span> Exercice 4</a></li>
<li><a href="#correction-4-1"><span class="toc-section-number">6.9</span> Correction 4</a></li>
<li><a href="#exercice-5-5"><span class="toc-section-number">6.10</span> Exercice 5</a></li>
<li><a href="#correction-5-1"><span class="toc-section-number">6.11</span> Correction 5</a></li>
<li><a href="#exercice-6-4"><span class="toc-section-number">6.12</span> Exercice 6</a></li>
<li><a href="#correction-6"><span class="toc-section-number">6.13</span> Correction 6</a></li>
<li><a href="#exercice-7-4"><span class="toc-section-number">6.14</span> Exercice 7</a></li>
<li><a href="#exercice-8-3"><span class="toc-section-number">6.15</span> Exercice 8</a></li>
<li><a href="#correction-8"><span class="toc-section-number">6.16</span>  Correction 8</a></li>
<li><a href="#exercice-9-4"><span class="toc-section-number">6.17</span> Exercice 9</a></li>
<li><a href="#correction-9"><span class="toc-section-number">6.18</span> Correction 9</a></li>
<li><a href="#exercice-10-4"><span class="toc-section-number">6.19</span> Exercice 10</a></li>
<li><a href="#correction-10"><span class="toc-section-number">6.20</span> Correction 10</a></li>
<li><a href="#exercice-11-4"><span class="toc-section-number">6.21</span> Exercice 11</a></li>
<li><a href="#correction-12"><span class="toc-section-number">6.22</span> Correction 12</a></li>
<li><a href="#synchronisation"><span class="toc-section-number">6.23</span> Synchronisation</a></li>
<li><a href="#dîner-des-philosophes-13"><span class="toc-section-number">6.24</span> Dîner des philosophes (13)</a></li>
<li><a href="#correction-13"><span class="toc-section-number">6.25</span> Correction (13)</a></li>
<li><a href="#exercice-14-2"><span class="toc-section-number">6.26</span> Exercice 14</a></li>
<li><a href="#correction-14"><span class="toc-section-number">6.27</span> Correction 14</a></li>
<li><a href="#plus-de-verrous"><span class="toc-section-number">6.28</span>  Plus de verrous</a></li>
<li><a href="#exercice-15-3"><span class="toc-section-number">6.29</span> Exercice 15</a></li>
<li><a href="#correction-15"><span class="toc-section-number">6.30</span> Correction 15</a></li>
<li><a href="#concurrence-et-parallèlisme"><span class="toc-section-number">6.31</span> Concurrence et parallèlisme</a></li>
</ul></li>
<li><a href="#programation-modulaire"><span class="toc-section-number">7</span> Programation modulaire</a><ul>
<li><a href="#espace-de-nommage"><span class="toc-section-number">7.1</span> Espace de nommage</a></li>
<li><a href="#espace-de-contrôle"><span class="toc-section-number">7.2</span> Espace de contrôle</a></li>
<li><a href="#archive-java-jar"><span class="toc-section-number">7.3</span> Archive Java (JAR)</a></li>
<li><a href="#chargeur-de-classe"><span class="toc-section-number">7.4</span> Chargeur de classe</a></li>
<li><a href="#exercice-45"><span class="toc-section-number">7.5</span> Exercice</a></li>
<li><a href="#correction-7"><span class="toc-section-number">7.6</span> Correction</a></li>
<li><a href="#exercice-46"><span class="toc-section-number">7.7</span> Exercice</a></li>
<li><a href="#correction-11"><span class="toc-section-number">7.8</span> Correction</a></li>
<li><a href="#exercice-47"><span class="toc-section-number">7.9</span> Exercice</a></li>
<li><a href="#correction-16"><span class="toc-section-number">7.10</span> Correction</a></li>
<li><a href="#exercice-48"><span class="toc-section-number">7.11</span> Exercice</a></li>
<li><a href="#correction-17"><span class="toc-section-number">7.12</span> Correction</a></li>
<li><a href="#exercice-49"><span class="toc-section-number">7.13</span> Exercice</a></li>
<li><a href="#correction-18"><span class="toc-section-number">7.14</span> Correction</a></li>
<li><a href="#exercice-50"><span class="toc-section-number">7.15</span> Exercice</a></li>
<li><a href="#correction-19"><span class="toc-section-number">7.16</span>  Correction</a></li>
<li><a href="#exercice-51"><span class="toc-section-number">7.17</span> Exercice</a></li>
<li><a href="#correction-20"><span class="toc-section-number">7.18</span> Correction</a></li>
<li><a href="#exercice-52"><span class="toc-section-number">7.19</span> Exercice</a></li>
<li><a href="#correction-21"><span class="toc-section-number">7.20</span> Correction</a></li>
</ul></li>
<li><a href="#annexes-et-précis"><span class="toc-section-number">8</span> Annexes et précis</a><ul>
<li><a href="#florilège-à-ne-pas-écrire"><span class="toc-section-number">8.1</span> Florilège à ne pas écrire</a><ul>
<li><a href="#pas-de-méthode-statique-abstraite-dans-une-interface"><span class="toc-section-number">8.1.1</span> Pas de méthode statique abstraite dans une interface</a></li>
<li><a href="#pas-de-function"><span class="toc-section-number">8.1.2</span> Pas de function</a></li>
<li><a href="#pas-de-return-avec-parenthèses"><span class="toc-section-number">8.1.3</span> Pas de return avec parenthèses</a></li>
<li><a href="#pas-de-switch-sans-parenthèses"><span class="toc-section-number">8.1.4</span> Pas de switch sans parenthèses</a></li>
<li><a href="#pas-de-duplication"><span class="toc-section-number">8.1.5</span> Pas de duplication</a></li>
<li><a href="#pas-de-cast-entre-type-primitif-et-référence"><span class="toc-section-number">8.1.6</span> Pas de cast entre type primitif et référence</a></li>
<li><a href="#pas-de-méthode-dans-une-méthode"><span class="toc-section-number">8.1.7</span> Pas de méthode dans une méthode</a></li>
<li><a href="#faute-de-frappe-et-confusion"><span class="toc-section-number">8.1.8</span> Faute de frappe et confusion</a></li>
</ul></li>
<li><a href="#valeur-par-défaut"><span class="toc-section-number">8.2</span> Valeur par défaut</a><ul>
<li><a href="#opérateur"><span class="toc-section-number">8.2.1</span> Opérateur ==</a></li>
<li><a href="#types-primitifs"><span class="toc-section-number">8.2.2</span> Types primitifs</a></li>
<li><a href="#décalage-de-bits"><span class="toc-section-number">8.2.3</span> Décalage de bits</a></li>
</ul></li>
<li><a href="#références"><span class="toc-section-number">8.3</span> Références</a></li>
</ul></li>
</ul>
</div>
<h1 id="introduction-à-java"><span class="header-section-number">1</span> Introduction à Java</h1>
<p>Dans ce chapitre, nous verrons comment écrire, compiler et exécuter un programme Java. Nous apprendrons à récupérer les arguments (<code>String[] args</code>) à la ligne de commande et afficher un résultats sur la sortie standard (System.out). Les notions porterons sur l'écriture de petits algorithmes en style procédural puis orientés objets. Nous utiliserons les structures de contrôle fréquentes (if, for) ainsi que les types (int, String, etc.) et outils communs (ArrayList, StringBuilder) de l'API Java standard.</p>
<p>Nous survolerons :</p>
<ul>
<li>la visibilité</li>
<li>les conversions</li>
<li>les tableaux</li>
<li>les collections</li>
<li>les objets</li>
<li>les opérateurs</li>
<li>l'héritage et le lien avec l'affectations</li>
<li>la surcharge</li>
</ul>
<h2 id="premier-programme"><span class="header-section-number">1.1</span> Premier programme</h2>
<p>Créez un dossier <code>hello-world</code>. Dans ce dossier éditez un fichier <code>Main.java</code> :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> Main {
  <span class="dt">void</span> <span class="fu">main</span>() {
  }
}</code></pre></div>
<p>Pour compiler le programme, il faut installer le JDK.</p>
<p>Dans un terminal, tapez :</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">javac</span> -version</code></pre></div>
<p>Si vous avez une erreur, il faut finaliser l'installation.</p>
<p>Pour lancer un programme, il faut que celui-ci soit référencé dans le <code>PATH</code>. Il s'agit d'une variable d'environnement. Elle est définie sur Windows et Linux. Cette variable liste un ensemble de chemins séparés par des points-virgules. Par exemple :</p>
<pre><code>C:\WINDOWS\system32;C:\WINDOWS</code></pre>
<p>Il faut faire en sorte que cela ressemble à :</p>
<pre><code>C:\WINDOWS\system32;C:\WINDOWS;C:\Program Files\Java\jdk1.8.0\bin</code></pre>
<p>https://www.java.com/fr/download/help/path.xml.</p>
<p>Examinez le <code>PATH</code> :</p>
<pre><code>echo %PATH%</code></pre>
<p>Contient-il le chemin d'installation du compilateur ? Il est typiquement installé dans le répertoire : <code>C:\Program Files\Java\jdk1.8.0\bin</code> (ou plus généralement dans <code>%ProgramFiles%\Java\jdk1.8.0\bin</code>).</p>
<p>Allez dans les variables d'environnements de l'utilisateur. Si <code>PATH</code> n'existe pas ajoutez une variable nommée <code>PATH</code> valant <code>C:\Program Files\Java\jdk1.8.0\bin</code>. Si elle existe, modifiez la valeur pour ressembler au <code>PATH</code> attendu (cf. plus haut).</p>
<p>https://docs.oracle.com/javase/8/docs/technotes/guides/install/windows_jdk_install.html</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">javac</span> -version</code></pre></div>
<p>Si l'installation est bien finalisée vous devriez voir s'afficher : <code>javac 1.8.0_121</code>.</p>
<p>Naviguez dans le dossier de votre code source :</p>
<pre><code>cd hello-world</code></pre>
<p>Compilez le programme :</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">javac</span> Main.java</code></pre></div>
<p>Le compilateur a créé un nouveau fichier : <code>Main.class</code>.</p>
<p>Lancez le programme :</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">java</span> Main</code></pre></div>
<p>Le message d'erreur est le suivant :</p>
<pre><code>Erreur : la méthode principale est introuvable dans la classe Main,
définissez la méthode principale comme suit :
   public static void main(String[] args)
ou une classe d&#39;applications JavaFX doit étendre javafx.application.Application</code></pre>
<p>Corrigez le programme <code>Main.java</code>. Relancez la compilation (<code>javac Main.java</code>). Relancez l'exécution (<code>java Main</code>).</p>
<p>Vous venez de créer votre premier programme Java ! Mais il ne fait pas grand chose.</p>
<p>Ajoutez une instruction à la méthode <code>main()</code> :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> Main {
  <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Hello world!&quot;</span>);
  }
}</code></pre></div>
<p>Compilez avec <code>javac</code>, lancez avec <code>java</code>.</p>
<p>Vous devriez voir le message suivant s'afficher :</p>
<pre><code>Hello world!</code></pre>
<p>La classe la plus petite que l'on peut compiler (commande : <code>javac C.java</code>) est :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> C {}</code></pre></div>
<p>Le programme le plus petit que l'on peut exécuter (commande <code>java P</code>) est :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> P {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {}
}</code></pre></div>
<h2 id="types-et-méthodes-basiques"><span class="header-section-number">1.2</span> Types et méthodes basiques</h2>
<h3 id="type-int"><span class="header-section-number">1.2.1</span> Type int</h3>
<p>De combien de personne a augmenté la population française entre 1905 et 2005 ?</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> Population {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        <span class="dt">int</span> population1905 = 41_050_<span class="dv">000</span>;
        <span class="dt">int</span> population2005 = 61_182_<span class="dv">000</span>;

        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(population2005 - population1905); <span class="co">// 20132000</span>
    }
}</code></pre></div>
<p>La population a donc augmenté de 2 013 2000 personnes.</p>
<h3 id="type-double-et-printf"><span class="header-section-number">1.2.2</span> Type double et printf</h3>
<p>Quel est l'accroissement relatif de la population entre 1905 et 2005 ? L'accroissement relatif entre A et B est B/A - 1.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> BugAccroissementPopulation {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        <span class="dt">int</span> population1905 = 41_050_<span class="dv">000</span>;
        <span class="dt">int</span> population2005 = 61_182_<span class="dv">000</span>;

        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(population2005 / population1905 - <span class="dv">1</span>); <span class="co">// 0</span>
    }
}</code></pre></div>
<p>Il y a un bug. L'expression <code>population2005 / population1905 - 1</code> est évaluée à 0. Pour comprendre l'erreur, il faut comprendre l'ordre d'évaluation des opérations ainsi que la sémantique de la division sur des <code>int</code>.</p>
<p>Dans l'expression <code>population2005 / population1905 - 1</code>, la division est prioritaire. Ainsi, ou bien <code>population2005 / population1905</code> a un problème ou bien <code>x - 1</code> a un problème (avec <code>int x = population2005 / population1905</code>).</p>
<p>Évaluons donc avec un debugger, l'expression <code>population2005 / population1905</code>. Le résultat est 1 !</p>
<p>En fait la division pour les int est une division entière. La solution est d'effectuer une division flottante :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> AccroissementPopulation {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        <span class="dt">double</span> population1905 = 41_050_<span class="dv">000</span>;
        <span class="dt">double</span> population2005 = 61_182_<span class="dv">000</span>;

        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(population2005 / population1905 - <span class="dv">1</span>); <span class="co">// 0.4904263093788064</span>
    }
}</code></pre></div>
<p>Afficher l'accroissement en pourcentage sans virgule.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> AccroissementPopulation {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        <span class="dt">double</span> population1905 = 41_050_<span class="dv">000</span>;
        <span class="dt">double</span> population2005 = 61_182_<span class="dv">000</span>;

        <span class="dt">double</span> accroissement = population2005 / population1905 - <span class="dv">1</span>; <span class="co">// 0.4904263093788064</span>

        <span class="dt">int</span> pourcentage = (<span class="dt">int</span>) (accroissement * <span class="dv">100</span>);

        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(pourcentage + <span class="st">&quot;%&quot;</span>); <span class="co">// 49%</span>
    }
}</code></pre></div>
<p>En java, le type int est représenté sur 32 bits. Le nombre d'entiers représentables est 2^32 - 1. Calculons ce nombre :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> MaxInteger {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="bu">Math</span>.<span class="fu">pow</span>(<span class="dv">2</span>, <span class="dv">32</span>) - <span class="dv">1</span>); <span class="co">// 4.294967295E9</span>
    }
}</code></pre></div>
<p>La méthode statique <code>Math.pow(double a, double b)</code> retourne la valeur du premier argument élevé à la puissance du deuxième argument.</p>
<p>Affichons le résultat formaté selon la localisation par défaut.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> PrintfMaxInteger {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        <span class="bu">System</span>.<span class="fu">out.printf</span>(<span class="st">&quot;</span><span class="sc">%f%n</span><span class="st">&quot;</span>, <span class="bu">Math</span>.<span class="fu">pow</span>(<span class="dv">2</span>, <span class="dv">32</span>) - <span class="dv">1</span>); <span class="co">// 4294967295,000000</span>
    }
}</code></pre></div>
<p>On peut donc représenter 4 294 967 295 entiers avec le type int en Java.</p>
<p>La chaîne <code>&quot;%f%n&quot;</code> spécifie le format d'affichage. La conversion <code>%f</code> formate un double et <code>%n</code> affiche un retour à la ligne.</p>
<p>La syntaxe générale d'un format est :</p>
<p><code>%[argument_index$][flags][width][.precision]conversion</code></p>
<p>https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/util/Formatter.html#syntax</p>
<h3 id="tableau-et-boucle-for"><span class="header-section-number">1.2.3</span> Tableau et boucle for</h3>
<p>Faire la somme des pays de l'union européenne en 2016.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> PopulationTotaleEurope {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        <span class="dt">int</span>[] populationsPays = <span class="kw">new</span> <span class="dt">int</span>[]{82_162_<span class="dv">000</span>, 66_661_<span class="dv">621</span>, 65_341_<span class="dv">183</span>, 60_665_<span class="dv">551</span>, 46_438_<span class="dv">422</span>, 37_967_<span class="dv">209</span>, 19_760_<span class="dv">314</span>,
                16_979_<span class="dv">120</span>, 11_289_<span class="dv">853</span>, 10_793_<span class="dv">526</span>, 10_553_<span class="dv">853</span>, 10_341_<span class="dv">330</span>, 9_851_<span class="dv">017</span>, 9_830_<span class="dv">485</span>, 8_700_<span class="dv">471</span>, 7_153_<span class="dv">784</span>,
                5_659_<span class="dv">715</span>, 5_707_<span class="dv">251</span>, 5_426_<span class="dv">252</span>, 4_658_<span class="dv">530</span>, 4_190_<span class="dv">669</span>, 2_888_<span class="dv">558</span>, 2_064_<span class="dv">188</span>, 1_968_<span class="dv">957</span>, 1_315_<span class="dv">944</span>,
                848_<span class="dv">319</span>, 576_<span class="dv">249</span>, 434_<span class="dv">403</span>, 510_056_<span class="dv">011</span>, 78_741_<span class="dv">053</span>, 8_325_<span class="dv">194</span>, 7_076_<span class="dv">372</span>, 5_165_<span class="dv">802</span>, 3_830_<span class="dv">911</span>,
                3_553_<span class="dv">056</span>, 2_886_<span class="dv">026</span>, 2_071_<span class="dv">278</span>, 1_771_<span class="dv">604</span>, 622_<span class="dv">218</span>, 332_<span class="dv">529</span>};

        <span class="dt">int</span> totalPopulation = <span class="dv">0</span>;
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; populationsPays.<span class="fu">length</span>; i++) {
            totalPopulation += populationsPays[i];
        }

        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(totalPopulation); <span class="co">// 1134660828</span>
    }
}</code></pre></div>
<p>Voici une autre syntaxe pour les tableaux dont le type des éléments est inférable.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span>[] populationsPays = {82_162_<span class="dv">000</span>, 66_661_<span class="dv">621</span>, 65_341_<span class="dv">183</span>};</code></pre></div>
<p>On peut aussi simplifier la notation de la boucle for car l'indice <code>i</code> ne sert qu'à accéder à un élément du tableau :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span> totalPopulation = <span class="dv">0</span>;
<span class="kw">for</span> (<span class="dt">int</span> population : populationsPays) {
    totalPopulation += population;
}</code></pre></div>
<h3 id="type-string"><span class="header-section-number">1.2.4</span> Type String</h3>
<p>Afficher un message qui affiche &quot;Welcome John!&quot; quand l'argument à la ligne de commande est &quot;John&quot;.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> Welcome {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        <span class="bu">String</span> name = args[<span class="dv">0</span>];
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Welcome &quot;</span> + name + <span class="st">&quot;!&quot;</span>);
    }
}</code></pre></div>
<p>Dans un terminal :</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash">$ <span class="ex">java</span> Welcome John
<span class="ex">Welcome</span> John!</code></pre></div>
<h3 id="if"><span class="header-section-number">1.2.5</span> If</h3>
<p>Contrairement au langage C ou à JavaScript, en Java l'exécution conditionnelle <code>if</code> n'accepte qu'une condition de type booléenne :</p>
<p>Ainsi l'instruction suivante est valide avec <code>args</code> de type <code>String[]</code> :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">if</span> (args[<span class="dv">0</span>] == <span class="kw">null</span>) {} <span class="co">// OK</span></code></pre></div>
<p>Mais celle-ci ne l'est pas :</p>
<pre><code>if (args[0]) {} // incompatible types: java.lang.String cannot be converted to boolean</code></pre>
<h2 id="notation-binaire-exercice"><span class="header-section-number">1.3</span> Notation binaire : exercice</h2>
<p>Créez un dossier <code>binary-format</code>. Créez-y un fichier <code>Main.java</code>.</p>
<p>A chaque étape, vous devez effectuer tout le cycle d'édition, de compilation et d'exécution. N'attendez pas l'étape 3 avant de tester votre programme.</p>
<ol style="list-style-type: decimal">
<li>Ecrivez un programme qui affiche <code>&quot;0&quot;</code>. Utilisez <code>System.out.println(String)</code>.</li>
<li>Modifiez ce programme pour qu'il affiche <code>&quot;1&quot;</code> si l'argument au programme est la chaîne de caractères <code>&quot;1&quot;</code>. Utilisez l'opérateur d'égalité <code>==</code> puis la méthode <code>String.equals(String)</code>. Pour lancer un programme Java avec un argument (ici <code>1</code>) exécutez : <code>java Main 1</code>.</li>
<li>Modifiez ce programme pour qu'il affiche <code>0</code> si le nombre passé en paramètre est pair et <code>1</code> sinon. Utilisez l'opérateur modulo <code>%</code>. Essayez aussi d'utiliser l'opérateur de conjonction binaire <code>&amp;</code>.</li>
<li>Modifiez ce programme pour préfixer (quand le nombre est supérieur ou égal à <code>2</code>) <code>0</code> si la moitié du nombre passé en paramètre est pair, <code>1</code> sinon. Utilisez l'opérateur de concaténation de <code>String</code> <code>+</code>. On aura donc :</li>
</ol>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="ex">java</span> Main 1
<span class="ex">1</span>
$ <span class="ex">java</span> Main 0
<span class="ex">0</span>
$ <span class="ex">java</span> Main 2
<span class="ex">10</span>
$ <span class="ex">java</span> Main 3
<span class="ex">11</span>
$ <span class="ex">java</span> Main 4
<span class="ex">00</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Modifiez ce programme pour que l'argument passé en argument soit entré en notation binaire plutôt qu'en format décimal. Ne pas afficher l'argument tel quel. Utilisez <code>Integer.parseInt(int, int)</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="ex">java</span> Main 11
<span class="ex">11</span>
$ <span class="ex">java</span> Main 110
<span class="ex">10</span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>Modifiez ce programme pour afficher la décomposition binaire pour n'importe quel nombre en utilisant la notation Java 7. Utilisez l'opérateur d'affectation combiné à la concaténation <code>+=</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="ex">java</span> Main 1111
<span class="ex">0B1111</span>
$ <span class="ex">java</span> Main 10000000
<span class="ex">0B10000000</span></code></pre></div>
<ol start="7" style="list-style-type: decimal">
<li>Remplacez l'opérateur d'affectation-concaténation <code>+=</code> par un <code>StringBuilder.append(String)</code>.</li>
</ol>
<h3 id="correction"><span class="header-section-number">1.3.1</span> Correction</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> fr.arolla.java8esgi.binarynotation;</span>

<span class="kw">public</span> <span class="kw">class</span> Main {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        <span class="kw">if</span> (args.<span class="fu">length</span> == <span class="dv">0</span>) {
            <span class="bu">System</span>.<span class="fu">err</span>.<span class="fu">println</span>(<span class="st">&quot;erreur&quot;</span>);
            <span class="bu">System</span>.<span class="fu">exit</span>(<span class="dv">1</span>);
        }

        <span class="bu">String</span> arg = args[<span class="dv">0</span>];
        <span class="dt">int</span> n = <span class="bu">Integer</span>.<span class="fu">parseInt</span>(arg);
        <span class="dt">int</span> i = <span class="dv">0</span>;
        <span class="bu">String</span>[] bits = <span class="kw">new</span> <span class="bu">String</span>[<span class="dv">4</span>];
        <span class="kw">while</span> (n &gt;= <span class="dv">0</span>) {
            <span class="kw">if</span> (n % <span class="dv">2</span> == <span class="dv">0</span>) {
                bits[i] = <span class="st">&quot;0&quot;</span>;
            } <span class="kw">else</span> {
                bits[i] = <span class="st">&quot;1&quot;</span>;
            }
            i++;
            n = n / <span class="dv">2</span>;
            <span class="kw">if</span> (n == <span class="dv">0</span>) {
                <span class="kw">break</span>;
            }
        }
        <span class="kw">for</span> (<span class="dt">int</span> j = i - <span class="dv">1</span>; j &gt;= <span class="dv">0</span>; j--) {
            <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">print</span>(bits[j]);
        }
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>();
    }
}</code></pre></div>
<p>Pour éviter d'afficher (print) plusieurs fois chaque bit, on peut accumuler dans une chaîne de caractère ce qu'il y a à afficher. On pourra ainsi n'effectuer qu'une seule entrée/sortie (I/O).</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">String</span> binary = <span class="st">&quot;&quot;</span>;
<span class="kw">for</span> (<span class="dt">int</span> j = i - <span class="dv">1</span>; j &gt;= <span class="dv">0</span>; j--) {
    <span class="bu">String</span> bit = bits[j];
    binary += bit;
}
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(binary);</code></pre></div>
<p>L'opérateur de concaténation-affectation <code>binary += bit;</code> est équivalent à <code>binary = binary + bit;</code>.</p>
<p>Notez que la comparaison de chaîne de caractère avec l'opérateur <code>==</code> ne donne pas de bons résultats. <em>Parfois</em> le code suivant affiche <code>OK</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">String</span> argument = <span class="bu">String</span>.<span class="fu">valueOf</span>(<span class="dv">1</span>);
<span class="kw">if</span> (argument == <span class="st">&quot;1&quot;</span>) {
    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;OK&quot;</span>);
}</code></pre></div>
<p>L'égalité des chaînes de caractères est basée sur la comparaison des valeurs et non pas des références.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">String</span> = <span class="bu">String</span>.<span class="fu">valueOf</span>(<span class="dv">1</span>);
<span class="kw">if</span> (argument.<span class="fu">equals</span>(<span class="st">&quot;1&quot;</span>)) {
    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;OK&quot;</span>);
}</code></pre></div>
<p>L'opérateur qui calcule le reste de la division entière est noté : <code>%</code>. Un invariant important de la division Euclidienne peut être exprimé ainsi en Java :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">d * (x / d) + (x % d) == x</code></pre></div>
<p>Attention cependant, même si l'on ne fait pas explicitement une division, calculer le reste d'une division par zéro est interdit :</p>
<pre><code>int r = 2 % 0;
// java.lang.ArithmeticException: / by zero</code></pre>
<p>On a également utilisé l'opérateur <code>&amp;</code> conjonction binaire. Cet opérateur réalise un &quot;et&quot; binaire sur chaque bit des deux opérandes.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span> r1 = <span class="dv">9</span> % <span class="dv">2</span>; <span class="co">// 1</span>
<span class="dt">int</span> r2 = <span class="dv">9</span> &amp; <span class="dv">1</span>; <span class="co">// 1</span></code></pre></div>
<h2 id="java-8-api"><span class="header-section-number">1.4</span> Java 8 API</h2>
<p>La <a href="https://docs.oracle.com/javase/8/docs/api/">bibliothèque standard de programmation de Java</a> est riche.</p>
<p>Nous avons vu jusqu'ici les méthodes suivantes :</p>
<ul>
<li><code>int Integer.parseInt(String s) throws NumberFormatException</code></li>
<li><code>String String.valueOf(int i)</code></li>
<li><code>String Integer.toString(int i)</code></li>
<li><code>String String.format(Locale l, String format, Object... args)</code></li>
<li><code>String Arrays.toString(Object[] a)</code></li>
<li><code>void System.exit(int status)</code></li>
<li>...</li>
</ul>
<p>Et des classes incontournables de <code>java.lang</code> :</p>
<ul>
<li><code>String</code></li>
<li><code>Integer</code></li>
<li><code>System</code></li>
<li><code>Math</code></li>
<li><code>ArrayIndexOutOfBoundsException</code></li>
<li>...</li>
</ul>
<p>Prenez l'habitude de lire la documentation de référence.</p>
<h2 id="unité-de-compilation"><span class="header-section-number">1.5</span> Unité de compilation</h2>
<p>Le code source d'une classe est stockée dans un fichier. Le fichier constitue l'unité de compilation.</p>
<p>Bien qu'il soit légal de nommer une classe package-private (c-à-d. non <code>public</code>) différemment du fichier, ce n'est pas recommandé.</p>
<p>Par exemple :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="co">// fichier &quot;A.java&quot;</span>
<span class="kw">class</span> B {} <span class="co">// non standard mais compilera</span></code></pre></div>
<p>La convention est d'avoir une classe par fichier (relation un-pour-un).</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="co">// fichier &quot;Foo.java&quot;</span>
<span class="kw">class</span> Foo {}

<span class="co">// fichier &quot;Bar.java&quot;</span>
<span class="kw">class</span> Bar {}</code></pre></div>
<p>Éviter :</p>
<pre><code>// fichier &quot;nom_de_classe.java&quot;
class NomDeClasse {} // nom différent</code></pre>
<p>En revanche, dès que l'on que la classe définie devient publique, le fichier doit correspondre à la classe :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="co">// fichier &quot;Foo.java&quot;</span>
<span class="kw">public</span> <span class="kw">class</span> BarBar {}</code></pre></div>
<pre><code>$ javac Foo.java
Foo.java:1: error: class BarBar is public, should be declared in a file named BarBar.java
public class Bar {}
       ^
1 error</code></pre>
<p>Enfin il est possible de définir plusieurs classes par fichier. Une seule d'entre elles peut-être publique.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="co">// fichier &quot;Main.java&quot;</span>
<span class="kw">public</span> <span class="kw">class</span> Main {}
<span class="kw">class</span> Foo {}
<span class="kw">class</span> Bar {}</code></pre></div>
<p>Mais l'exemple suivant ne compile pas car il y a 2 classes publiques :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="co">// fichier &quot;Main.java&quot;</span>
<span class="kw">public</span> <span class="kw">class</span> Main {}
<span class="kw">public</span> <span class="kw">class</span> Foo {}
<span class="kw">class</span> Bar {}</code></pre></div>
<h2 id="logarithme-et-exponentiation-exercice"><span class="header-section-number">1.6</span> Logarithme et exponentiation : exercice</h2>
<p>Dans l'algorithme précédent, nous avons fixé la taille du tableau en dur.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">String</span>[] bits = <span class="kw">new</span> <span class="bu">String</span>[<span class="dv">4</span>];</code></pre></div>
<p>Si on cherche à calculer la représentation binaire de 16 (<code>0B1_0000</code>).</p>
<p>Le programme crash :</p>
<pre><code>Exception in thread &quot;main&quot; java.lang.ArrayIndexOutOfBoundsException: 4
    at fr.arolla.java8esgi.binaryformat.Main.main(Main.java:18)</code></pre>
<p>On a dépassé les bornes du tableau. On va donc chercher à calculer la taille minimale du tableau nécessaire pour stocker la représentation binaire d'un nombre entier.</p>
<p>Pour trouver la formule qui nous donnerait la taille en fonction du nombre que l'on cherche à représenter en binaire, on peut noter que :</p>
<p><span class="math inline"><em>m</em> = 2<sup><em>s</em></sup> − 1</span></p>
<p>avec <span class="math inline"><em>m</em></span> le nombre maximum que l'on peut représenter avec un tableau de taille <span class="math inline"><em>s</em></span>.</p>
<p>En passant cette équation au logarithme et en ajustant un peu, on peut noter que :</p>
<p><span class="math inline"><em>s</em> = <em>l</em><em>n</em><sub>2</sub>(<em>n</em>)+1</span></p>
<p>avec <span class="math inline"><em>n</em></span> le nombre que l'on chercher à représenter et <span class="math inline"><em>s</em></span> (pour &quot;size&quot;) le nombre de bits nécessaires.</p>
<p>Pourtant, en Java il n'existe pas de fonction standard pour <span class="math inline"><em>l</em><em>n</em><sub>2</sub></span>.</p>
<p>Il faudra donc l'implémenter en notant la relation suivante :</p>
<p><span class="math inline"><em>l</em><em>n</em><sub>2</sub>(<em>x</em>)=<em>l</em><em>n</em>(<em>x</em>)/<em>l</em><em>n</em>(2)</span></p>
<h2 id="logarithme-base-2-en-java"><span class="header-section-number">1.7</span> Logarithme base 2 en Java</h2>
<p>On définit une méthode <code>log2</code>, dans notre classe <code>Main</code> :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Main {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        <span class="co">// ...</span>
    }
    
    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">int</span> <span class="fu">log2</span>(<span class="dt">int</span> n) {
        <span class="dt">double</span> ln = <span class="bu">Math</span>.<span class="fu">log</span>(n);
        <span class="dt">double</span> ln2 = <span class="bu">Math</span>.<span class="fu">log</span>(<span class="dv">2</span>);

        <span class="kw">return</span> (<span class="dt">int</span>) (ln / ln2);
    }
}</code></pre></div>
<p>On peut ainsi modifier notre méthode <code>main</code> de la façon suivante :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">String</span>[] bits = <span class="kw">new</span> <span class="bu">String</span>[<span class="fu">log2</span>(n) + <span class="dv">1</span>];</code></pre></div>
<h2 id="visibilité-un-tour-dhorizon"><span class="header-section-number">1.8</span> Visibilité : un tour d'horizon</h2>
<p>Faisons une métaphore temporaire.</p>
<p>Une classe contient des méthodes. Un package contient des classes. Petite généralisation : les classes et les packages sont des boîtes ; les méthodes et classes sont des éléments. On peut donc dire qu'une boîte contient des éléments.</p>
<p>Un élément d'une boîte peut être public. Cela signifie qu'il sera visible par une autre boîte. Si un élément d'une boîte est privé, une autre boîte n'y aura pas accès.</p>
<pre><code>    A                B
|-------|        |-------|
|  +X&lt;--|--------|       |
|-------|        |-------|

    C                D
|-------|        |-------|
|  -Y   |        |       |
|-------|        |-------|</code></pre>
<p>Revenons maintenant à Java.</p>
<p>Il y a 4 modificateurs de visibilité (pour seulement 3 mots-clés) :</p>
<ul>
<li><code>private</code></li>
<li><code>public</code></li>
<li><code>protected</code></li>
<li>par défaut : package-protected</li>
</ul>
<p>Ces modificateurs s'appliquent pour les déclarations contenues par une classe (c'est à dire les champs, méthodes et classes imbriquées).</p>
<p>Par exemple, on peut appliquer les 4 modificateurs au champ <code>a</code>, a la méthode getA() ainsi qu'à la classe <code>Bar</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> Foo {
    <span class="kw">private</span> <span class="dt">int</span> a;
    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">getA</span>() { <span class="kw">return</span> a; }
    <span class="kw">private</span> <span class="kw">class</span> Bar {}
}</code></pre></div>
<p>Pour les déclarations de plus haut niveau (c'est à dire défini directement dans un package et non pas à l'intérieur d'une classe) il existe seulement deux niveaux de visibilité :</p>
<ul>
<li>public</li>
<li>package-protected</li>
</ul>
<p>Les classes <code>Foo</code> et <code>Bar</code> exemples de déclarations de haut niveau mais <code>Nested</code> n'en n'est pas une :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> a;</span>

<span class="kw">public</span> <span class="kw">class</span> Foo {
}

<span class="kw">class</span> Bar {
    <span class="kw">class</span> Nested {}
}</code></pre></div>
<h2 id="visibilité-dans-le-contexte-de-lencapsulation"><span class="header-section-number">1.9</span> Visibilité dans le contexte de l'encapsulation</h2>
<p>Pour simplifier, un symbole (par exemple un champ ou méthode) déclarée dans une classe peut-être ou bien public ou bien private.</p>
<p>Un champ ou méthode déclaré privé n'est visible qu'à l'intérieur de la classe. Les méthodes qui ne sont appelées que par d'autres classes devraient être privées.</p>
<p>Un champ ou méthode déclaré publique est tout le temps visible, pour peu que la classe qui la défini soit visible.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> Constant {
    <span class="kw">private</span> <span class="dt">int</span> literal;
    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">getValue</span>() {
        <span class="kw">return</span> literal;
    }
}</code></pre></div>
<p>Ainsi, une autre classe aura accès à <code>getValue()</code> car cette méthode est <code>public</code> mais pas à <code>literal</code> car ce champ est <code>privé</code>.</p>
<p>Donc le code suivant ne compilera pas :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> Evaluator {
    <span class="dt">void</span> <span class="fu">evaluateConstant</span>(Constant c) {
        <span class="dt">int</span> literal = c.<span class="fu">literal</span>; <span class="co">// erreur</span>
        <span class="dt">int</span> value = c.<span class="fu">getValue</span>(); <span class="co">// OK</span>
    }
}</code></pre></div>
<p>Du point de vue de la classe <code>Evaluator</code> tout se passe comme si la classe <code>Constant</code> était définie comme suit :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> Constant {
    <span class="co">// c&#39;est à dire sans la déclaration : int literal </span>
    
    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">getValue</span>() {
        <span class="kw">return</span> literal;
    }
}</code></pre></div>
<h2 id="visibilité-dans-un-contexte-de-packages-multiples"><span class="header-section-number">1.10</span> Visibilité dans un contexte de packages multiples</h2>
<p>Pour accéder à une classe à partir d'un autre package, la visibilité doit être au minimum package-protected.</p>
<p>Syntaxe : un champ ou méthode sans modificateur de visibilité est dit <em>package-protected</em>. Il n'est visible que dans le même <code>package</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> a;</span>

<span class="kw">public</span> <span class="kw">class</span> Public {
}

<span class="kw">class</span> Private { <span class="co">// visible uniquement dans le paquetage</span>
}

<span class="kw">package</span><span class="im"> b;</span>

<span class="kw">import</span><span class="im"> a.Public;</span>

<span class="kw">class</span> Bravo {
    { 
        Public ok; <span class="co">// OK</span>
        Private nope; <span class="co">// erreur</span>
    }
}</code></pre></div>
<h2 id="visibilité-dans-le-contexte-de-lhéritage"><span class="header-section-number">1.11</span> Visibilité dans le contexte de l'héritage</h2>
<p>Pour permettre à un symbole d'être vu en dehors du package sans pour autant être public, on peut ouvrir l'accès aux sous-classe à l'aide du modificateur protected.</p>
<p>Par exemple,</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> alpha;</span>

<span class="kw">public</span> <span class="kw">class</span> Base {
    <span class="kw">protected</span> <span class="dt">int</span> x;
}

<span class="kw">class</span> Beta {
    <span class="dt">void</span> <span class="fu">f</span>(Base b) {
        <span class="dt">int</span> value = b.<span class="fu">x</span>; <span class="co">// OK car Beta dans le même package que Base</span>
    }
}

<span class="kw">package</span><span class="im"> beta;</span>

<span class="kw">import</span><span class="im"> alpha.Base;</span>

<span class="kw">class</span> Derived <span class="kw">extends</span> Base {
    <span class="dt">void</span> <span class="fu">foo</span>() {
        <span class="dt">int</span> value = x; <span class="co">// OK car Derived est une sous-classe de Base</span>
    }
}

<span class="kw">class</span> Sibling {
    <span class="dt">void</span> <span class="fu">bar</span>(Base b) {
        <span class="dt">int</span> value = b.<span class="fu">x</span>; <span class="co">// erreur</span>
    }
}</code></pre></div>
<h2 id="visibilité-résumé"><span class="header-section-number">1.12</span> Visibilité : résumé</h2>
<table>
<thead>
<tr class="header">
<th>visibilité</th>
<th>champ ou méthode</th>
<th>classe</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>private</td>
<td>non visible par une autre classe</td>
<td>-</td>
</tr>
<tr class="even">
<td>package</td>
<td>non visible par un autre package</td>
<td>idem</td>
</tr>
<tr class="odd">
<td>protected</td>
<td>visible dans le package et les sous-classes</td>
<td>-</td>
</tr>
<tr class="even">
<td>public</td>
<td>visible partout</td>
<td>visible partout</td>
</tr>
</tbody>
</table>
<p>Pour les membres d'une classe :</p>
<table>
<thead>
<tr class="header">
<th>visibilité</th>
<th>sites autorisés</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>public</td>
<td>tout</td>
</tr>
<tr class="even">
<td>protected</td>
<td>la classe, le package et les dérivées</td>
</tr>
<tr class="odd">
<td>package-protected</td>
<td>la classe et le package</td>
</tr>
<tr class="even">
<td>private</td>
<td>la classe seulement</td>
</tr>
</tbody>
</table>
<p>Pour les classes d'un package :</p>
<table>
<thead>
<tr class="header">
<th>visibilité</th>
<th>sites autorisés</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>public</td>
<td>tout</td>
</tr>
<tr class="even">
<td>package-protected</td>
<td>le package</td>
</tr>
</tbody>
</table>
<h2 id="conversion"><span class="header-section-number">1.13</span> Conversion</h2>
<p>Java autorise la conversion implicite de type dès lors qu'il n'y a pas de perte d'information.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span> salary = 35_<span class="dv">000</span>;
<span class="dt">double</span> amount = salary;</code></pre></div>
<p>En revanche, il interdit cette conversion avec perte :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">double</span> amount = 2_<span class="dv">000</span>;
<span class="dt">int</span> salary = amount; <span class="co">// incompatible types</span></code></pre></div>
<p>Pour forcer la conversion, il faut indiquer au compilateur <code>javac</code> que l'on sait ce que l'on fait en castant une expression dans un type plus spécifique.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">double</span> amount = 2_<span class="dv">000</span>;
<span class="dt">int</span> salary = (<span class="dt">int</span>) amount;</code></pre></div>
<h2 id="tableau"><span class="header-section-number">1.14</span> Tableau</h2>
<p>Le type <code>String[]</code> est un tableau de <code>String</code>. Une variable de type tableau référence un objet. Une fois l’objet créé, sa longueur ne change jamais. C'est pour cela que l'on devait calculer sa taille en amont avec <code>log2(int)</code>.</p>
<p>Les indices de tableaux commencent à zéro.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">String</span>[] strings = <span class="kw">new</span> <span class="bu">String</span>[<span class="dv">2</span>];

<span class="bu">String</span> premier = strings[<span class="dv">0</span>];
<span class="bu">String</span> dernier = strings[strings.<span class="fu">length</span> - <span class="dv">1</span>];</code></pre></div>
<h2 id="list-et-arraylist"><span class="header-section-number">1.15</span> List et ArrayList</h2>
<p>L'utilisation de tableaux est fastidieuse et facilite l'introduction de bug. Pour éviter cela on peut utiliser une structure de données plus sophistiquée : <code>ArrayList</code>. C'est une classe qui définit un tableau dynamique (c.à.d. peut changer de taille).</p>
<p>On pourra donc écrire :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">List</span>&lt;<span class="bu">String</span>&gt; bits = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;&gt;();
bits.<span class="fu">add</span>(<span class="st">&quot;0&quot;</span>);
bits.<span class="fu">add</span>(<span class="st">&quot;1&quot;</span>);
<span class="bu">Collections</span>.<span class="fu">reverse</span>(bits);
<span class="kw">for</span> (<span class="bu">String</span> bit : bits) {
    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">print</span>(bit);
}</code></pre></div>
<p>Précision : le type (connu à la compilation) de <code>bits</code> est <code>List&lt;String&gt;</code>. La syntaxe <code>List&lt;String&gt;</code>, <code>List&lt;Integer&gt;</code>, <code>Set&lt;Object&gt;</code>, etc. désigne un type paramétré par un autre type.</p>
<p>L'instruction :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">List</span>&lt;<span class="bu">String</span>&gt; bits = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;&gt;();</code></pre></div>
<p>est équivalente à :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">List</span>&lt;<span class="bu">String</span>&gt; bits = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;<span class="bu">String</span>&gt;();</code></pre></div>
<p>Nous verrons cela en détail dans un autre cours.</p>
<h2 id="stringbuilder"><span class="header-section-number">1.16</span> StringBuilder</h2>
<p>Concaténer avec <code>+</code> dans une boucle peut-être très long (ici, <span class="math inline"><em>t</em> &lt; 1<em>s</em></span>) et consommer beaucoup de mémoire.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">String</span> output = <span class="st">&quot;&quot;</span>;
<span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; 10_<span class="dv">000</span>; i++) {
    <span class="dt">int</span> n = (<span class="dt">int</span>) (<span class="bu">Math</span>.<span class="fu">random</span>() * <span class="bu">Integer</span>.<span class="fu">MAX_VALUE</span>);
    <span class="bu">String</span> s = <span class="bu">String</span>.<span class="fu">valueOf</span>(n);

    output += s;
}
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(output);</code></pre></div>
<p>On préférera donc l'utilisation de <code>StringBuilder</code> qui ne créé par une nouvelle chaîne de caractère à chaque itération contrairement à l'opérateur <code>+</code>.</p>
<p>Préférer <code>StringBuilder</code> pour éviter de très long temps de traitements (ici, <span class="math inline"><em>t</em> &lt; 50<em>m</em><em>s</em></span>) :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">StringBuilder</span> output = <span class="kw">new</span> <span class="bu">StringBuilder</span>();
<span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; 10_<span class="dv">000</span>; i++) {
    <span class="dt">int</span> n = (<span class="dt">int</span>) (<span class="bu">Math</span>.<span class="fu">random</span>() * <span class="bu">Integer</span>.<span class="fu">MAX_VALUE</span>);
    <span class="bu">String</span> s = <span class="bu">String</span>.<span class="fu">valueOf</span>(n);

    output.<span class="fu">append</span>(s);
}
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(output);</code></pre></div>
<p>On pourra astucieusement améliorer notre implémentation d'affichage du nombre binaire :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">StringBuilder</span> buffer = <span class="kw">new</span> <span class="bu">StringBuilder</span>();
<span class="kw">for</span> (<span class="dt">int</span> j = i - <span class="dv">1</span>; j &gt;= <span class="dv">0</span>; j--) {
    <span class="bu">String</span> bit = bits[j];
    buffer.<span class="fu">append</span>(bit);
}
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(buffer);</code></pre></div>
<h2 id="premier-objet"><span class="header-section-number">1.17</span> Premier objet</h2>
<h3 id="plus-grand-commun-diviseur-exercice"><span class="header-section-number">1.17.1</span> Plus grand commun diviseur : exercice</h3>
<p>Le <span class="math inline"><em>P</em><em>G</em><em>C</em><em>D</em></span> de 2 nombres <span class="math inline"><em>a</em></span> et <span class="math inline"><em>b</em></span> est le plus grand entier tel que <span class="math inline"><em>P</em><em>G</em><em>C</em><em>D</em></span> divise <span class="math inline"><em>a</em></span> et <span class="math inline"><em>b</em></span>. (en anglais, on note GCD pour &quot;Greatest Common Divisor&quot;).</p>
<p>Propriété : <span class="math inline"><em>G</em><em>C</em><em>D</em>(<em>a</em>, <em>b</em>)=<em>G</em><em>C</em><em>D</em>(<em>b</em>, <em>r</em>)</span> avec <span class="math inline"><em>r</em></span> le reste de la division de <span class="math inline"><em>a</em></span> par <span class="math inline"><em>b</em></span>.</p>
<p>De cette propriété, nous en tirons directement l'algorithme :</p>
<pre><code>pgcd de a et b vaut :
- a, si b égale zéro
- pgcd de b et du reste de la division de a par b, sinon</code></pre>
<p>L'exercice consiste à implémenter cet algorithme pour calculer le PGCD de 16 et 28.</p>
<pre><code>$ java Gcd 16 28
4</code></pre>
<h3 id="méthode-récursive-et-statique"><span class="header-section-number">1.17.2</span> Méthode récursive et statique</h3>
<p>Implémenter l'algorithme avec le prototype suivant :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">static</span> <span class="dt">int</span> <span class="fu">computeGcd</span>(<span class="dt">int</span> a, <span class="dt">int</span> b) {
    <span class="co">// TODO</span>
}</code></pre></div>
<h3 id="objet"><span class="header-section-number">1.17.3</span> Objet</h3>
<p>Modifier le programme de sorte qu'il instancie un objet de classe Gcd :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> fr.arolla.java8esgi.gcd;</span>

<span class="kw">public</span> <span class="kw">class</span> Gcd {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        <span class="kw">if</span> (args.<span class="fu">length</span> != <span class="dv">2</span>) {
            <span class="bu">System</span>.<span class="fu">err</span>.<span class="fu">println</span>(<span class="st">&quot;2 arguments attendus : &lt;a&gt; &lt;b&gt;&quot;</span>);
            <span class="bu">System</span>.<span class="fu">exit</span>(<span class="dv">1</span>);
        }
        Gcd gcd = <span class="kw">new</span> <span class="fu">Gcd</span>(<span class="bu">Integer</span>.<span class="fu">parseInt</span>(args[<span class="dv">0</span>]), <span class="bu">Integer</span>.<span class="fu">parseInt</span>(args[<span class="dv">1</span>]));
        <span class="dt">int</span> divisor = gcd.<span class="fu">computeGcd</span>();

        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(divisor);
    }
    <span class="co">// ...</span>
}</code></pre></div>
<p>Cette surcharge de la méthode <code>computeGcd(int, int)</code> ne définit pas de paramètre et n'est pas statique.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span> <span class="fu">computeGcd</span>();</code></pre></div>
<h3 id="champ-de-classe"><span class="header-section-number">1.17.4</span> Champ de classe</h3>
<p>Pour cela, on peut définir et initialiser 2 champs de classe :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> Gcd {
    <span class="co">// ...</span>
    <span class="dt">int</span> a = <span class="dv">16</span>;
    <span class="dt">int</span> b = <span class="dv">28</span>;
}</code></pre></div>
<p>On pourra aussi simplement déclarer les champs (sans les initialiser) :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> Gcd {
    <span class="co">// ...</span>
    <span class="dt">int</span> a;
    <span class="dt">int</span> b;
}</code></pre></div>
<h3 id="constructeur-par-défaut"><span class="header-section-number">1.17.5</span> Constructeur par défaut</h3>
<p>On peut invoquer un constructeur sans paramètre sans le définir explicitement :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Gcd {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        Gcd calculator = <span class="kw">new</span> <span class="fu">Gcd</span>();
    }
    
    <span class="co">// 0 constructeur =&gt; constructeur par défaut</span>
}</code></pre></div>
<h3 id="constructeur-sans-paramètre"><span class="header-section-number">1.17.6</span> Constructeur sans paramètre</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Gcd {
    <span class="fu">Gcd</span>() {
        a = <span class="dv">16</span>;
        b = <span class="dv">28</span>;
    }
}</code></pre></div>
<h3 id="constructeur-avec-2-paramètres"><span class="header-section-number">1.17.7</span> Constructeur avec 2 paramètres</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="fu">Gcd</span>(<span class="dt">int</span> a, <span class="dt">int</span> b) {
    <span class="kw">this</span>.<span class="fu">a</span> = a;
    <span class="kw">this</span>.<span class="fu">b</span> = b;
}</code></pre></div>
<p>En définissant un constructeur, on perd le constructeur par défaut. Si on veut pouvoir instancier la classe sans argument, il faut définir explicitement un constructeur sans paramètre.</p>
<h3 id="référence-interne"><span class="header-section-number">1.17.8</span> Référence interne</h3>
<p>La variable <code>this</code> référence l'objet receveur ou objet courant.</p>
<h3 id="premier-objet-correction"><span class="header-section-number">1.17.9</span> Premier objet : correction</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> fr.arolla.java8esgi.gcd;</span>

<span class="kw">public</span> <span class="kw">class</span> Gcd {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        <span class="kw">if</span> (args.<span class="fu">length</span> != <span class="dv">2</span>) {
            <span class="bu">System</span>.<span class="fu">err</span>.<span class="fu">println</span>(<span class="st">&quot;2 arguments attendus : &lt;a&gt; &lt;b&gt;&quot;</span>);
            <span class="bu">System</span>.<span class="fu">exit</span>(<span class="dv">1</span>);
        }
        Gcd gcd = <span class="kw">new</span> <span class="fu">Gcd</span>(<span class="bu">Integer</span>.<span class="fu">parseInt</span>(args[<span class="dv">0</span>]), <span class="bu">Integer</span>.<span class="fu">parseInt</span>(args[<span class="dv">1</span>]));
        <span class="dt">int</span> divisor = gcd.<span class="fu">computeGcd</span>();

        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(divisor);
    }
    
    <span class="kw">private</span> <span class="dt">int</span> a;
    <span class="kw">private</span> <span class="dt">int</span> b;
    
    <span class="kw">public</span> <span class="fu">Gcd</span>(<span class="dt">int</span> a, <span class="dt">int</span> b) {
        <span class="kw">this</span>.<span class="fu">a</span> = a;
        <span class="kw">this</span>.<span class="fu">b</span> = b;
    }
    
    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">computeGcd</span>() {
        <span class="kw">return</span> <span class="fu">computeGcd</span>(a, b);
    }
    
    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">int</span> <span class="fu">computeGcd</span>(<span class="dt">int</span> a, <span class="dt">int</span> b) {
        <span class="kw">if</span> (b == <span class="dv">0</span>) {
            <span class="kw">return</span> a;
        }
        <span class="kw">return</span> <span class="fu">computeGcd</span>(b, a % b);
    }
}</code></pre></div>
<p>Comment être raisonnablement sûr que l'algorithme computeGcd est bien implémenté ?</p>
<p>On peut intégrer une post-condition de la méthode à vérifier. On peut transposer un raisonnement par l'absurde en Java :</p>
<p>La méthode <code>computeGcd()</code> calcule le plus grand nombre qui divise à la fois <code>a</code> et <code>b</code>. Donc si on trouve un nombre plus grand que le résultat retourné qui divise <code>a</code> et <code>b</code> alors c'est que ce résultat est faux.</p>
<p>On crée une méthode <code>findGreaterDivisor()</code> qui cherche en brute-force un diviseur commun (pas forcément le plus grand - noter le &quot;greater&quot; et pas &quot;greatest&quot;) et on l'intègre dans une instruction assert.</p>
<p>Le <code>assert</code> (et son contenu) ne sera exécuté que si l'option <code>-ea</code> (ou <code>-enableassertions</code>) est spécifiée au programme <code>java</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
    <span class="kw">if</span> (args.<span class="fu">length</span> != <span class="dv">2</span>) {
        <span class="bu">System</span>.<span class="fu">err</span>.<span class="fu">println</span>(<span class="st">&quot;2 arguments attendus : &lt;a&gt; &lt;b&gt;&quot;</span>);
        <span class="bu">System</span>.<span class="fu">exit</span>(<span class="dv">1</span>);
    }
    <span class="dt">int</span> a = <span class="bu">Integer</span>.<span class="fu">parseInt</span>(args[<span class="dv">0</span>]);
    <span class="dt">int</span> b = <span class="bu">Integer</span>.<span class="fu">parseInt</span>(args[<span class="dv">1</span>]);
    Gcd gcd = <span class="kw">new</span> <span class="fu">Gcd</span>(a, b);
    <span class="dt">int</span> divisor = gcd.<span class="fu">computeGcd</span>();

    assert divisor == <span class="fu">findGreaterDivisor</span>(divisor, a, b) : 
        <span class="bu">String</span><span class="fu">.format</span>(<span class="st">&quot;Diviseur trouvé (</span><span class="sc">%d</span><span class="st">) plus grand que le PGCD (</span><span class="sc">%d</span><span class="st">)&quot;</span>, 
            <span class="fu">findGreaterDivisor</span>(divisor, a, b), divisor);
    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(divisor);
}

<span class="kw">private</span> <span class="dt">static</span> <span class="dt">int</span> <span class="fu">findGreaterDivisor</span>(<span class="dt">int</span> divisor, <span class="dt">int</span> a, <span class="dt">int</span> b) {
    <span class="kw">for</span> (<span class="dt">int</span> potentialDivisor = divisor + <span class="dv">1</span>;
            potentialDivisor &lt;= <span class="bu">Math</span>.<span class="fu">max</span>(a, b) - <span class="dv">1</span>;
            potentialDivisor++) {
        <span class="kw">if</span> (a % potentialDivisor == <span class="dv">0</span> &amp;&amp; b % potentialDivisor == <span class="dv">0</span>) {
            <span class="kw">return</span> potentialDivisor;
        }
    }
    <span class="kw">return</span> divisor;
}</code></pre></div>
<h2 id="priorité-des-opérateurs"><span class="header-section-number">1.18</span> Priorité des opérateurs</h2>
<p>Dans l'expression <code>a % potentialDivisor == 0 &amp;&amp; b % potentialDivisor == 0</code>, comment sont combinés les opérandes et opérateurs ?</p>
<p>Simplifions :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">a % potentialDivisor == <span class="dv">0</span></code></pre></div>
<p><code>%</code> et <code>==</code> sont des opérateurs binaires. On peut donc se poser la question suivante : doit-on évaluer le <code>%</code> ou bien <code>==</code> en premier ?</p>
<p>La réponse est simple : l'opérateur <code>%</code> est plus prioritaire que <code>==</code>.</p>
<p>Ainsi,</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">a % potentialDivisor == <span class="dv">0</span></code></pre></div>
<p>est équivalent à faire le modulo en premier (signifié par les parenthèses) :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">(a % potentialDivisor) == <span class="dv">0</span></code></pre></div>
<p>Reprenons l'expression complète : <code>a % potentialDivisor == 0 &amp;&amp; b % potentialDivisor == 0</code>. Maintenant, il faut savoir classer par priorité non seulement <code>%</code> et <code>==</code> mais aussi <code>&amp;&amp;</code>.</p>
<p>Voici le classement de ces trois opérateurs :</p>
<ol style="list-style-type: decimal">
<li><code>%</code></li>
<li><code>==</code></li>
<li><code>&amp;&amp;</code></li>
</ol>
<p>Donc on groupera en premier les <code>%</code> (en met des parenthèses autour) :</p>
<p><code>(a % potentialDivisor) == 0 &amp;&amp; (b % potentialDivisor) == 0</code></p>
<p>Puis on groupera autour des <code>==</code> :</p>
<p><code>((a % potentialDivisor) == 0) &amp;&amp; ((b % potentialDivisor) == 0)</code></p>
<p>Et enfin autour du <code>&amp;&amp;</code>, mais inutile de l'écrire ici (pas d'expression englobante).</p>
<p>Le groupage avec les parenthèses est équivalent. On peut écrire les deux formes. La forme avec parenthèses dans notre cas rend explicite la priorité des opérateurs. De manière général, on évite les parenthèses de &quot;confort&quot;. Mais attention aux expressions trop compliquées !</p>
<p>Il arrive que deux opérateurs aient la même priorité. Par exemple :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dv">1</span> + <span class="dv">2</span> - <span class="dv">3</span></code></pre></div>
<p>Comme l'opérateur <code>+</code> et <code>-</code> ont la même priorité, on groupe les opérations de gauche à droite.</p>
<p>On aura donc :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">(<span class="dv">1</span> + <span class="dv">2</span>) - <span class="dv">3</span></code></pre></div>
<p>Voici un tableau général (mais incomplet) des priorités :</p>
<ol style="list-style-type: decimal">
<li><code>expr++</code> <code>expr--</code> (postfix)</li>
<li><code>++expr</code> <code>--expr</code> <code>+expr</code> <code>-expr</code> <code>~</code> <code>!</code> (unaire)</li>
<li><code>*</code> <code>/</code> <code>%</code> (multiplicatif)</li>
<li><code>+</code> <code>-</code> (additif)</li>
<li><code>&lt;</code> <code>&gt;</code> <code>&lt;=</code> <code>&gt;=</code> <code>instanceof</code> (relationel)</li>
<li><code>==</code> <code>!=</code> (égalité)</li>
<li><code>&amp;&amp;</code> (et logique)</li>
<li><code>||</code> (ou logique)</li>
<li><code>?</code> <code>:</code> (ternaire)</li>
<li><code>=</code> <code>+=</code> <code>-=</code> <code>*=</code> (affectation)</li>
</ol>
<p>Voici quelques moyens mémotechniques pour retenir l'idée des priorités.</p>
<p>Comme en mathématique usuelle, la multiplication l'emporte sur l'addition. Le pendant de la multiplication côté logique est le &quot;et logique&quot; qui l'emporte sur le &quot;ou logique&quot;.</p>
<p>Maintenant mettons nous dans la peau de James Gosling (principal) créateur de Java. Analysons ce qu'il se serait passé si les priorités de certains opérateurs étaient inversés.</p>
<p>Pourquoi le <code>==</code> est plus prioritaire que le <code>&amp;&amp;</code> ? Parce que la forme <code>a==b &amp;&amp; c==d</code> est plus courante que <code>a&amp;&amp;b == c&amp;&amp;d</code> (qu'on écrira donc <code>(a &amp;&amp; b) == (c &amp;&amp; d)</code>).</p>
<p>Mais pourquoi <code>&lt;</code> est plus prioritaire que <code>==</code> ? Parce que la forme <code>a&lt;b == c&lt;d</code> est plus courante que <code>a==b &lt; c==d</code> (qui n'est pas correcte du point de vue typage).</p>
<p>Enfin pourquoi l'opérateur ternaire est-il plus prioritaire que l'opérateur d'affectation ? Parce que la forme x = ok?1:2 est un idiome de programmation alors que (si l'affectation &gt; ternaire) <code>ok=true ? 1 : 2</code> (qu'on serait obligé de coder : <code>(ok = true) ? 1 : 2</code>) est à éviter bien que légal.</p>
<p>Il faut noter que la règle de lecture de gauche à droite (l'associativité) n'est pas valable pour les affectations. Quand il y a plusieurs affectations, on associe de <em>droite</em> à gauche (l'inverse du cas usuel).</p>
<p>Ainsi,</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dv">1</span> * <span class="dv">2</span> / <span class="dv">3</span> % <span class="dv">4</span></code></pre></div>
<p>s'associe de gauche à droite :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">((<span class="dv">1</span> * <span class="dv">2</span>) / <span class="dv">3</span>) % <span class="dv">4</span></code></pre></div>
<p>Mais pour les affectations :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">x = y += z</code></pre></div>
<p>Se lira</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">x = (y += z)</code></pre></div>
<h3 id="exercice-opérateurs"><span class="header-section-number">1.18.1</span> Exercice opérateurs</h3>
<ol style="list-style-type: decimal">
<li>Placer les parenthèses en fonction de la priorité.</li>
<li>Qu'affiche l'instruction <code>println()</code> ?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span> x;
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(x = <span class="kw">true</span> &amp;&amp; <span class="dv">1</span> &lt; <span class="dv">2</span> || <span class="dv">3</span> == <span class="dv">4</span> ? <span class="dv">1</span> : <span class="dv">2</span>);</code></pre></div>
<h2 id="package"><span class="header-section-number">1.19</span> Package</h2>
<p>Le package est une structure dans laquelle on regroupe des classes. Il définit un espace de nom ainsi qu'une zone de contrôle d'accès.</p>
<p>Pour déclarer qu'une classe appartient à un package, l'unité de compilation (c'est à dire le fichier) commence par l'instruction :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> nom.de.package;</span></code></pre></div>
<p>Les noms de package suivent une convention : des mots en minuscule séparés par des points. Il est recommandé de nommer un package selon le sens inverse de nom de domaine qui possède le code source.</p>
<p>Ainsi on aura <code>com.sun</code> qui correspond au nom de domaine <code>sun.com</code>.</p>
<p>Pour utiliser une classe d'un autre package, on doit l'importer.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> com.example.alpha;</span> <span class="co">// file Alpha.java</span>

<span class="kw">public</span> <span class="kw">class</span> Alpha {}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> com.example.beta;</span> <span class="co">// file Beta.java</span>

<span class="kw">class</span> Beta {
    Alpha a; <span class="co">// erreur</span>
}</code></pre></div>
<p>L'unité de compilation qui défini Beta doit importer explicitement Alpha en utilisant son nom qualifié (nom de package + nom de classe).</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> com.example.beta;</span>

<span class="kw">import</span><span class="im"> com.example.alpha.Alpha;</span>

<span class="kw">class</span> Beta {
    Alpha a; <span class="co">// OK</span>
}</code></pre></div>
<p>On regroupera les classes d'un même package dans le même dossier. On utilisera l'arborescence du système de fichier pour encoder un nom de package. Ainsi, les classes du package <code>com.example.alpha</code> seront placé dans le dossier <code>com/example/alpha</code>.</p>
<p>Un package est donc représenté comme une annotation d'une unité de compilation. Il n'existe pas de fichier de package.</p>
<p>Contrairement ce qu'on pourrait penser, le package n'est pas une structure hierarchique. Par exemple, le package <code>java.nio</code> n'est pas le parent du package <code>java.nio.charset</code>. Ainsi <code>java.nio.charset</code> ne bénéficie aucunement des classes de <code>java.nio</code>. On peut seulement dire que <code>java.nio</code> et <code>java.nio.charset</code> sont des package différents.</p>
<h3 id="exercice"><span class="header-section-number">1.19.1</span> Exercice</h3>
<p>La classe <code>Gcd</code> est codée dans une seule unité de compilation.</p>
<ol style="list-style-type: decimal">
<li>Diviser la classe <code>Gcd</code> en une classe <code>main()</code> et une classe contenant <code>computeGcd()</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="co">// file Gcd.java</span>
<span class="kw">class</span> Gcd {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {}
    <span class="dt">static</span> <span class="fu">computeGcd</span>(<span class="dt">int</span> n) {}
}</code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Créer deux classes dans la même unité de compilation.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="co">// file GcdMain.java</span>
<span class="kw">class</span> GcdMain {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {}
}

<span class="kw">class</span> Gcd {
    <span class="dt">static</span> <span class="fu">computeGcd</span>(<span class="dt">int</span> n) {}
}</code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Placer les deux classes deux unités de compilation.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="co">// file GcdMain.java</span>
<span class="kw">class</span> GcdMain {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {}
}

<span class="co">// file Gcd.java</span>
<span class="kw">class</span> Gcd {
    <span class="dt">static</span> <span class="fu">computeGcd</span>(<span class="dt">int</span> n) {}
}</code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Placer les deux unités de compilation dans deux packages distincts.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> main;</span> <span class="co">// main/GcdMain.java</span>

<span class="kw">import</span><span class="im"> gcd.Gcd;</span>

<span class="kw">class</span> GcdMain {
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> gcd;</span> <span class="co">// gcd/Gcd.java</span>

<span class="kw">public</span> <span class="kw">class</span> Gcd {
}</code></pre></div>
<h2 id="nombres-rationels"><span class="header-section-number">1.20</span> Nombres rationels</h2>
<p>Dans la suite d'exercices qui suit nous allons développer un calculateur symbolique de nombres rationnels. Un nombre rationnel est défini par un ratio (ou quotient) de 2 entiers naturels. L'avantage de cette représentation est qu'elle est précise et que l'on peut inspecter le programme plus facilement. En revanche, ce modèle risque d'être moins rapide que les calculs flottant directement implémentés sur les processeurs.</p>
<p>On peut combiner 2 nombres rationnels en effectuant leur somme, leur différence, leur produit ou le quotient. Voici comment effectuer de telles combinaisons :</p>
<p><span class="math inline"><em>n</em>1/<em>d</em>1 + <em>n</em>2/<em>d</em>2 = (<em>n</em>1 × <em>d</em>2 + <em>n</em>2 × <em>d</em>1)/(<em>d</em>1 × <em>d</em>2)</span></p>
<p><span class="math inline"><em>n</em>1/<em>d</em>1 − <em>n</em>2/<em>d</em>2 = (<em>n</em>1 × <em>d</em>2 − <em>n</em>2 × <em>d</em>1)/(<em>d</em>1 × <em>d</em>2)</span></p>
<p><span class="math inline"><em>n</em>1/<em>d</em>1 × <em>n</em>2/<em>d</em>2 = (<em>n</em>1 × <em>n</em>2)/(<em>d</em>1 × <em>d</em>2)</span></p>
<p><span class="math inline">(<em>n</em>1/<em>d</em>1)/(<em>n</em>2/<em>d</em>2)=(<em>n</em>1 × <em>d</em>2)/(<em>d</em>1 × <em>n</em>2)</span></p>
<p><span class="math inline">(<em>n</em>1/<em>d</em>1)=(<em>n</em>2/<em>d</em>2)≡(<em>n</em>1 × <em>d</em>2)=(<em>d</em>1 × <em>n</em>2)</span></p>
<h3 id="exercice-1"><span class="header-section-number">1.20.1</span> Exercice 1</h3>
<p>Ecrire un programme qui prend en arguments 4 nombres (n1, d1, n2, d2) et affiche la somme : <span class="math inline"><em>n</em>1/<em>d</em>1 + <em>n</em>2/<em>d</em>2</span>. Exemple :</p>
<pre><code>$ java Rational 1 4 2 8
16/32</code></pre>
<p>Ici <code>1 4</code> se lit <span class="math inline">1/4</span> et <code>2 8</code> se lit <span class="math inline">2/8</span>.</p>
<ol style="list-style-type: decimal">
<li>Ecrire une méthode et une seule, le <code>main(String[])</code> qui affiche la somme des 2 nombres rationels encodés sous 4 arguments.</li>
<li>Introduire 2 champs de classe (numérateur et dénominateur) et un constructeur qui les initialise.</li>
<li>Extraire le code qui calculait la somme dans une nouvelle méthode <code>add</code> qui prend en entrée 2 paramètres de type <code>Rational</code> et retourne un <code>Rational</code>.</li>
</ol>
<p>Dans la méthode <code>main(String[] args)</code>, après le calcul vous pouvez afficher avec :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(sum.<span class="fu">numerator</span> + <span class="st">&quot;/&quot;</span> + sum.<span class="fu">denominator</span>);</code></pre></div>
<p>Puis vous pouvez extraire le code : <code>sum.numerator + &quot;/&quot; + sum.denominator</code> dans une nouvelle méthode <code>show()</code>. Voilà un exemple d'usage :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Rational left = ...
Rational right = ...
Rational sum = <span class="fu">add</span>(left, right);
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(sum.<span class="fu">show</span>());</code></pre></div>
<p>Renommer <code>show()</code> en <code>toString()</code> pour avoir :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Rational {
    <span class="co">// ...</span>
    
    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span>() {
        <span class="co">// ...</span>
    }
}</code></pre></div>
<p>Enfin, à l'affichage, supprimer l'appel à la méthode <code>toString()</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Rational sum = ...
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(sum);</code></pre></div>
<p>On vient de redéfinir la méthode <code>toString()</code> qui est définie sur la super-classe de toutes les classes Java : <code>Object</code>.</p>
<ol style="list-style-type: decimal">
<li>Tout en conservant l'annotation <code>@Override</code>, essayer de supprimer le <code>public</code> du <code>toString()</code>.</li>
<li>Essayer de renommer la méthode <code>toString()</code>.</li>
<li>Regarder l'implémentation de la méthode <code>PrintStream.println(Object)</code>.</li>
</ol>
<h3 id="invariant-et-bug"><span class="header-section-number">1.20.2</span> Invariant et bug</h3>
<p>Tester le programme avec d'autres valeurs. Créer plusieurs configurations de lancement dans votre IDE pour cela (run configurations).</p>
<p>Trouver des invariants à l'opération <code>+</code>. Par exemple, <code>0 + 1/2 = 1/2 + 0 = 1/2</code>. De manière générale : <code>0 + n/d = n/d + 0 = n/d</code>.</p>
<p>Si vous cassez un invariant vous savez que vous avez un bug.</p>
<h3 id="exercice-2"><span class="header-section-number">1.20.3</span> Exercice 2</h3>
<p>Modifier le format d'entrée au programme. Exemple :</p>
<pre><code>$ java Rational 1/4 2/8
16/32</code></pre>
<p>Utiliser <code>String.split(String regex)</code>. Voir https://docs.oracle.com/javase/8/docs/api/java/lang/String.html#split-java.lang.String-</p>
<h3 id="exercice-3"><span class="header-section-number">1.20.4</span> Exercice 3</h3>
<p>Modifier le format d'entrée au programme. Exemple :</p>
<pre><code>$ java Rational 1/4 + 2/8
16/32</code></pre>
<h3 id="exercice-4"><span class="header-section-number">1.20.5</span> Exercice 4</h3>
<p>Afficher la forme canonique du nombre rationel. Exemple :</p>
<pre><code>$ java Rational 1/4 + 2/8
1/2</code></pre>
<p>Indice : utiliser le PGCD pour cela.</p>
<h3 id="exercice-5"><span class="header-section-number">1.20.6</span> Exercice 5</h3>
<p>Traiter la différence de nombres rationels. Exemple :</p>
<pre><code>$ java Rational 1/4 - 2/8
0/1</code></pre>
<h3 id="exercice-6"><span class="header-section-number">1.20.7</span> Exercice 6</h3>
<p>Simplifier la sortie quand le résultat est zéro. Exemple :</p>
<pre><code>$ java Rational 1/4 - 2/8
0</code></pre>
<h3 id="exercice-7"><span class="header-section-number">1.20.8</span> Exercice 7</h3>
<p>Traiter les nombres négatifs. À la construction de l'objet, normaliser les signes. Afficher un moins seulement devant le numérateur uniquement si le nombre rationel est négatif. Exemple :</p>
<pre><code>$ java Rational 1/3 - 2/3
-1/3</code></pre>
<h3 id="exercice-8"><span class="header-section-number">1.20.9</span> Exercice 8</h3>
<p>Calculer le produit de 2 nombres rationels. Exemple :</p>
<pre><code>$ java Rational 1/4 * 1/2
1/8</code></pre>
<ol style="list-style-type: decimal">
<li>Vérifier que le nombre d'arguments est exactement 3.</li>
<li>Protéger l'argument <code>*</code> avec des guillemets simple '*' <a href="https://www.gnu.org/software/bash/manual/html_node/Filename-Expansion.html#Filename-Expansion">l'expansion des noms de fichiers du shell</a>.</li>
</ol>
<h3 id="exercice-9"><span class="header-section-number">1.20.10</span> Exercice 9</h3>
<p>Calculer le ratio de 2 nombres rationels. Exemple :</p>
<pre><code>$ java Rational 2/3 / 1/3
2/1</code></pre>
<h3 id="exercice-10"><span class="header-section-number">1.20.11</span> Exercice 10</h3>
<p>Simplifier la sortie quand le dénominateur est 1. Exemple :</p>
<pre><code>$ java Rational 2/3 / 1/3
2/1</code></pre>
<h3 id="exercice-11"><span class="header-section-number">1.20.12</span> Exercice 11</h3>
<p>Tester l'égalité de 2 nombres rationels. Exemple :</p>
<pre><code>$ java Rational 1/4 == 2/8
true</code></pre>
<h3 id="exercice-12"><span class="header-section-number">1.20.13</span> Exercice 12</h3>
<p>Gérer la réduction (c.à.d. la forme canonique) de la fraction au moment ou le numérateur et le dénominateur sont calculés. Observer ce qui change dans le programme. Puis gérer la réduction dans une méthode dédiée (statique puis non statique).</p>
<h3 id="exercice-13"><span class="header-section-number">1.20.14</span> Exercice 13</h3>
<p>Modifier les méthodes d'addition, soustraction, multiplication et division de sorte qu'elles ne prennent plus qu'un paramètre plutôt que deux. Par exemple :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Rational {
    Rational <span class="fu">add</span>(Rational b) {
        <span class="co">// ...</span>
    }
}</code></pre></div>
<p>Il faut remplacer l'ancien paramètre <code>a</code> par l'objet receveur de la méthode.</p>
<h3 id="exercice-14"><span class="header-section-number">1.20.15</span> Exercice 14</h3>
<p>Créer une classe <code>IntegerNumber</code> qui étend <code>RationalNumber</code>. Tester son comportement avec un nouveau <code>main(String[])</code>.</p>
<h3 id="exercice-15"><span class="header-section-number">1.20.16</span> Exercice 15</h3>
<p>Brancher cette classe lorsque le dénominateur est 1. Observer les changements avant de revenir en arrière.</p>
<p>Par exemple :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Rational {
    Rational <span class="fu">sum</span>(Rational b) {
        <span class="dt">int</span> sumDenuminator = ...
        <span class="kw">if</span> (sumDenuminator == <span class="dv">1</span>) {
            <span class="kw">return</span> <span class="kw">new</span> <span class="fu">IntegerRational</span>(sumNumerator);
        }
        <span class="co">// ...</span>
    }
}</code></pre></div>
<h3 id="exercice-16"><span class="header-section-number">1.20.17</span> Exercice 16</h3>
<p>Introduire une méthode statique fabriquant selon que le dénominateur est 1 ou pas un RationalNumber ou un IntegerNumber.</p>
<h3 id="exercice-17"><span class="header-section-number">1.20.18</span> Exercice 17</h3>
<p>Redéfinir la méthode <code>toString()</code> de <code>IntegerNumber</code> pour n'afficher que le numérateur.</p>
<h3 id="exercice-18"><span class="header-section-number">1.20.19</span> Exercice 18</h3>
<p>En suivant le même chemin, introduire une sous-classe <code>ZeroNumber</code>. Quelles méthodes peuvent-être redéfinies ?</p>
<h3 id="correction-1"><span class="header-section-number">1.20.20</span> Correction</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> fr.arolla.java8esgi.rational;</span>

<span class="kw">public</span> <span class="kw">class</span> Rational {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        <span class="kw">if</span> (args.<span class="fu">length</span> != <span class="dv">3</span>) {
            <span class="bu">System</span>.<span class="fu">err</span>.<span class="fu">println</span>(<span class="bu">String</span>.<span class="fu">join</span>(<span class="st">&quot; &quot;</span>, args));
            <span class="bu">System</span>.<span class="fu">err</span>.<span class="fu">println</span>(<span class="st">&quot;Usage: &lt;n1&gt;/&lt;d1&gt; &lt;operator&gt; &lt;n2&gt;/&lt;d2&gt;&quot;</span>);
            <span class="bu">System</span>.<span class="fu">err</span>.<span class="fu">println</span>(<span class="st">&quot;Available operators: + - x / ==&quot;</span>);
            <span class="bu">System</span>.<span class="fu">exit</span>(<span class="dv">1</span>);
        }
        Rational left = <span class="fu">parseRational</span>(args[<span class="dv">0</span>]);
        Rational right = <span class="fu">parseRational</span>(args[<span class="dv">2</span>]);
        <span class="bu">String</span> operator = args[<span class="dv">1</span>];

        <span class="bu">Object</span> result = <span class="kw">null</span>;
        <span class="kw">switch</span> (operator) {
            <span class="kw">case</span> <span class="st">&quot;+&quot;</span>:
                result = left.<span class="fu">add</span>(right);
                <span class="kw">break</span>;
            <span class="kw">case</span> <span class="st">&quot;-&quot;</span>:
                result = left.<span class="fu">substract</span>(right);
                <span class="kw">break</span>;
            <span class="kw">case</span> <span class="st">&quot;x&quot;</span>:
                result = left.<span class="fu">multiply</span>(right);
                <span class="kw">break</span>;
            <span class="kw">case</span> <span class="st">&quot;/&quot;</span>:
                result = left.<span class="fu">divide</span>(right);
                <span class="kw">break</span>;
            <span class="kw">case</span> <span class="st">&quot;==&quot;</span>:
                result = left.<span class="fu">isEqualTo</span>(right);
                <span class="kw">break</span>;
            <span class="kw">default</span>:
                <span class="bu">System</span>.<span class="fu">err</span>.<span class="fu">println</span>(<span class="st">&quot;Unknown operator: &quot;</span> + operator);
                <span class="bu">System</span>.<span class="fu">exit</span>(<span class="dv">2</span>);
        }

        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(result);
    }

    <span class="kw">private</span> <span class="dt">static</span> Rational <span class="fu">parseRational</span>(<span class="bu">String</span> arg) {
        <span class="bu">String</span>[] tokens = arg.<span class="fu">split</span>(<span class="st">&quot;/&quot;</span>);
        <span class="dt">int</span> numerator = <span class="bu">Integer</span>.<span class="fu">parseInt</span>(tokens[<span class="dv">0</span>]);
        <span class="dt">int</span> denominator = <span class="bu">Integer</span>.<span class="fu">parseInt</span>(tokens[<span class="dv">1</span>]);
        <span class="kw">return</span> <span class="fu">createRational</span>(numerator, denominator);
    }

    <span class="kw">private</span> <span class="dt">static</span> Rational <span class="fu">createRational</span>(<span class="dt">int</span> numerator, <span class="dt">int</span> denominator) {
        <span class="dt">int</span> gcd = Gcd.<span class="fu">computeGcd</span>(numerator, denominator);
        <span class="dt">int</span> canonicalNumerator = numerator / gcd;
        <span class="dt">int</span> canonicalDenominator = denominator / gcd;

        <span class="dt">int</span> normalizedNumerator;
        <span class="dt">int</span> normalizedDenominator;
        <span class="kw">if</span> (canonicalNumerator * canonicalDenominator &lt; <span class="dv">0</span>) {
            normalizedNumerator = -<span class="bu">Math</span>.<span class="fu">abs</span>(canonicalNumerator);
            normalizedDenominator = <span class="bu">Math</span>.<span class="fu">abs</span>(canonicalDenominator);
        } <span class="kw">else</span> {
            normalizedNumerator = canonicalNumerator;
            normalizedDenominator = canonicalDenominator;
        }
        <span class="kw">if</span> (normalizedNumerator == <span class="dv">0</span>) {
            <span class="kw">return</span> <span class="kw">new</span> <span class="fu">ZeroNumber</span>();
        }
        <span class="kw">if</span> (normalizedDenominator == <span class="dv">1</span>) {
            <span class="kw">return</span> <span class="kw">new</span> <span class="fu">IntegerNumber</span>(normalizedNumerator);
        }
        <span class="kw">return</span> <span class="kw">new</span> <span class="fu">Rational</span>(normalizedNumerator, normalizedDenominator);
    }

    <span class="kw">private</span> <span class="dt">final</span> <span class="dt">int</span> numerator;
    <span class="kw">private</span> <span class="dt">final</span> <span class="dt">int</span> denominator;

    <span class="kw">public</span> <span class="fu">Rational</span>(<span class="dt">int</span> numerator, <span class="dt">int</span> denominator) {
        <span class="kw">this</span>.<span class="fu">numerator</span> = numerator;
        <span class="kw">this</span>.<span class="fu">denominator</span> = denominator;
    }

    <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">isEqualTo</span>(Rational right) {
        <span class="kw">return</span> <span class="fu">areEqual</span>(<span class="kw">this</span>, right);
    }

    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">boolean</span> <span class="fu">areEqual</span>(Rational left, Rational right) {
        <span class="kw">return</span> (left.<span class="fu">numerator</span> * right.<span class="fu">denominator</span>) == (left.<span class="fu">denominator</span> * right.<span class="fu">numerator</span>);
    }

    <span class="kw">public</span> Rational <span class="fu">divide</span>(Rational right) {
        <span class="kw">return</span> <span class="fu">divide</span>(<span class="kw">this</span>, right);
    }

    <span class="kw">private</span> <span class="dt">static</span> Rational <span class="fu">divide</span>(Rational left, Rational right) {
        <span class="dt">int</span> resultNumerator = left.<span class="fu">numerator</span> * right.<span class="fu">denominator</span>;
        <span class="dt">int</span> resultDenominator = left.<span class="fu">denominator</span> * right.<span class="fu">numerator</span>;
        <span class="kw">return</span> <span class="fu">createRational</span>(resultNumerator, resultDenominator);
    }

    <span class="kw">public</span> Rational <span class="fu">multiply</span>(Rational right) {
        <span class="kw">return</span> <span class="fu">multiply</span>(<span class="kw">this</span>, right);
    }

    <span class="kw">private</span> <span class="dt">static</span> Rational <span class="fu">multiply</span>(Rational left, Rational right) {
        <span class="dt">int</span> resultNumerator = left.<span class="fu">numerator</span> * right.<span class="fu">numerator</span>;
        <span class="dt">int</span> resultDenominator = left.<span class="fu">denominator</span> * right.<span class="fu">denominator</span>;
        <span class="kw">return</span> <span class="fu">createRational</span>(resultNumerator, resultDenominator);
    }

    <span class="kw">public</span> Rational <span class="fu">substract</span>(Rational right) {
        <span class="kw">return</span> <span class="fu">substract</span>(<span class="kw">this</span>, right);
    }

    <span class="kw">private</span> <span class="dt">static</span> Rational <span class="fu">substract</span>(Rational left, Rational right) {
        <span class="dt">int</span> resultNumerator = left.<span class="fu">numerator</span> * right.<span class="fu">denominator</span> - right.<span class="fu">numerator</span> * left.<span class="fu">denominator</span>;
        <span class="dt">int</span> resultDenominator = left.<span class="fu">denominator</span> * right.<span class="fu">denominator</span>;
        <span class="kw">return</span> <span class="fu">createRational</span>(resultNumerator, resultDenominator);
    }

    <span class="kw">public</span> Rational <span class="fu">add</span>(Rational right) {
        <span class="kw">return</span> <span class="fu">add</span>(<span class="kw">this</span>, right);
    }

    <span class="kw">private</span> <span class="dt">static</span> Rational <span class="fu">add</span>(Rational left, Rational right) {
        <span class="dt">int</span> resultNumerator = left.<span class="fu">numerator</span> * right.<span class="fu">denominator</span> + right.<span class="fu">numerator</span> * left.<span class="fu">denominator</span>;
        <span class="dt">int</span> resultDenominator = left.<span class="fu">denominator</span> * right.<span class="fu">denominator</span>;
        <span class="kw">return</span> <span class="fu">createRational</span>(resultNumerator, resultDenominator);
    }

    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">getNumerator</span>() {
        <span class="kw">return</span> numerator;
    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span>() {
        <span class="kw">return</span> numerator + <span class="st">&quot;/&quot;</span> + denominator;
    }
}

<span class="kw">class</span> IntegerNumber <span class="kw">extends</span> Rational {

    <span class="kw">public</span> <span class="fu">IntegerNumber</span>(<span class="dt">int</span> numerator) {
        <span class="kw">super</span>(numerator, <span class="dv">1</span>);
    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span>() {
        <span class="kw">return</span> <span class="st">&quot;&quot;</span> + <span class="fu">getNumerator</span>();
    }
}

<span class="kw">class</span> ZeroNumber <span class="kw">extends</span> IntegerNumber {
    <span class="kw">public</span> <span class="fu">ZeroNumber</span>() {
        <span class="kw">super</span>(<span class="dv">0</span>);
    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span>() {
        <span class="kw">return</span> <span class="st">&quot;0&quot;</span>;
    }
}</code></pre></div>
<h2 id="héritage"><span class="header-section-number">1.21</span> Héritage</h2>
<p>En Java, <code>extends</code> signale une relation d'héritage entre 2 classes. On dit que la classe fille hérite de la classe mère. La classe mère est dite &quot;générique&quot;. La classe fille est dite &quot;spécifique&quot;.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> Person {
    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">getDescription</span>() {
        <span class="kw">return</span> <span class="st">&quot;Je suis une personne.&quot;</span>;
    }
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> Employee <span class="kw">extends</span> Person {
    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">getDescription</span>() {
        <span class="kw">return</span> <span class="st">&quot;Je suis un employé.&quot;</span>;
    }
}</code></pre></div>
<h3 id="affectations"><span class="header-section-number">1.21.1</span> Affectations</h3>
<p>Le type de la <code>lvalue</code> (pour &quot;left-value&quot;) est, dans ces 2 exemples, identique au type effectivement instancié.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Person p = <span class="kw">new</span> <span class="fu">Person</span>();
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(p.<span class="fu">getDescription</span>());
<span class="co">// Je suis une personne.</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Employee e = <span class="kw">new</span> <span class="fu">Employee</span>();
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(e.<span class="fu">getDescription</span>());
<span class="co">// Je suis un employé.</span></code></pre></div>
<p>L'affectation d'un objet d'un type à une référence d'un super-type est toujours légale.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Person p = <span class="kw">new</span> <span class="fu">Employee</span>();
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(p.<span class="fu">getDescription</span>());</code></pre></div>
<p>L'affectation d'un objet d'un type à une référence d'un sous-type nécessite une conversion.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Person p = <span class="kw">new</span> <span class="fu">Employee</span>();
Employee e = (Employee) p; <span class="co">// cast</span>
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(e.<span class="fu">getDescription</span>());</code></pre></div>
<p>En revanche, l'opération de conversion échoue parfois. Le cas échéant, une exception est levée à l'exécution : <code>ClassCastException</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Person p = <span class="kw">new</span> <span class="fu">Person</span>();
Employee e = (Employee) p;
<span class="co">// Person cannot be cast to Employee</span></code></pre></div>
<p>Un objet déclaré <code>String</code> ne peut jamais (même en y mettant du nôtre), être à l'exécution de type <code>Person</code>. La classe <code>Person</code> n'hérite pas de <code>String</code>.</p>
<p>Par conséquent, le code ci-dessous ne compile pas car la conversion n'est pas permise :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">String</span> s = <span class="st">&quot;hello&quot;</span>;
Person p = (Person) s;
<span class="co">// incompatible types</span>
<span class="co">// String cannot be converted to Person</span></code></pre></div>
<h3 id="constructeur-super"><span class="header-section-number">1.21.2</span> Constructeur super</h3>
<p>Etant donné la super classe :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> RationalNumber {
    <span class="kw">private</span> <span class="dt">int</span> numerator;
    <span class="kw">private</span> <span class="dt">int</span> denominator;

    <span class="kw">public</span> <span class="fu">RationalNumber</span>(<span class="dt">int</span> numerator, <span class="dt">int</span> denominator) {
        <span class="kw">this</span>.<span class="fu">numerator</span> = numerator;
        <span class="kw">this</span>.<span class="fu">denominator</span> = denominator;
    }
    ...
}</code></pre></div>
<p>Ecrire cette sous classe :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> IntegerNumber <span class="kw">extends</span> RationalNumber {
}</code></pre></div>
<p>Donne l'erreur de compilation suivante :</p>
<pre><code>constructor RationalNumber in class RationalNumber cannot be applied to given types;
  required: int,int
  found: no arguments
  reason: actual and formal argument lists differ in length</code></pre>
<p>Une classe qui ne définit pas de constructeur explicitement comme <code>IntegerNumber</code>, définit implicitement un constructeur par défaut. Tout constructeur doit appeler le constructeur de sa classe mère. Ici le constructeur par défaut de <code>IntegerNumber</code> appelle implicitement le constructeur par défaut de <code>RationalNumber</code>. Or il n'existe pas de constructeur par défaut pour <code>RationalNumber</code> puisque l'on en a définit un explicitement.</p>
<p>La solution consiste à créer un constructeur qui appelle le constructeur de la super-classe avec le mot clé <code>super</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> IntegerNumber <span class="kw">extends</span> RationalNumber {
    <span class="kw">public</span> <span class="fu">IntegerNumber</span>(<span class="dt">int</span> numerator) {
        <span class="kw">super</span>(numerator, <span class="dv">1</span>);
    }
}</code></pre></div>
<h3 id="redéfinition"><span class="header-section-number">1.21.3</span> Redéfinition</h3>
<p>Pour redéfinir une méthode dans une classe fille il est de bon ton d'utiliser l'annotation <code>@Override</code>. <code>@Override</code> n'est pas obligatoire pour des raisons de rétro-compatibilité avec Java 1.4 qui n'avait pas le concept d'annotation. Cette annotation s'applique aux méthodes uniquement (d'autres annotations peuvent s'appliquer aux classes, champs, paramètre, etc.).</p>
<p>Toute erreur de saisie dans le nom de la méthode ou bien dans les types des paramètres sera détectée par le compilateur si le but était de redéfinir la méthode.</p>
<p>Par exemple la classe mère définit la méthode <code>show()</code> :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> RationalNumber {
    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">show</span>() {
        <span class="kw">return</span> <span class="kw">this</span>.<span class="fu">numerator</span> + <span class="st">&quot;/&quot;</span> + <span class="kw">this</span>.<span class="fu">denominator</span>;
    }
    ...
}</code></pre></div>
<p>On a l'intention de redéfinir la méthode <code>show()</code> dans la classe fille. Or ici on s'est trompé et on l'a nommé <code>display</code> (et la classe mère ne définit pas de méthode <code>display()</code>).</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> IntegerNumber <span class="kw">extends</span> RationalNumber {
    ...

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">display</span>() {
        <span class="kw">return</span> <span class="st">&quot;&quot;</span> + numerator;
    }
}</code></pre></div>
<p>Le message du compilateur ressemble à ceci :</p>
<pre><code>method does not override or implement a method from a supertype</code></pre>
<p>De la même manière si on nomme correctement la méthode mais qu'on change les paramètres formels on obtiendra une erreur de compilation :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="at">@Override</span>
<span class="kw">public</span> <span class="bu">String</span> <span class="fu">show</span>(<span class="dt">boolean</span> newLine) {
    <span class="kw">return</span> <span class="st">&quot;&quot;</span> + numerator + (newLine ? <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span> : <span class="st">&quot;&quot;</span>);
}</code></pre></div>
<h3 id="périmètre-et-air"><span class="header-section-number">1.21.4</span> Périmètre et air</h3>
<p>Voici un exemple de code procédural :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Geometry {

    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="fu">area</span>(<span class="kw">new</span> <span class="fu">Circle</span>(<span class="dv">10</span>)));
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="fu">area</span>(<span class="kw">new</span> <span class="bu">Rectangle</span>(<span class="dv">3</span>, <span class="dv">4</span>)));
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="fu">area</span>(<span class="kw">new</span> <span class="fu">Square</span>(<span class="dv">5</span>)));
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="fu">area</span>(<span class="st">&quot;hello&quot;</span>)); <span class="co">// IllegalArgumentException</span>
    }

    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">double</span> <span class="fu">area</span>(<span class="bu">Object</span> shape) {
        <span class="kw">if</span> (shape <span class="kw">instanceof</span> Circle) {
            Circle circle = (Circle) shape;
            <span class="kw">return</span> circle.<span class="fu">radius</span> * circle.<span class="fu">radius</span> * <span class="bu">Math</span>.<span class="fu">PI</span>;
        }
        <span class="kw">if</span> (shape <span class="kw">instanceof</span> <span class="bu">Rectangle</span>) {
            <span class="bu">Rectangle</span> circle = (<span class="bu">Rectangle</span>) shape;
            <span class="kw">return</span> circle.<span class="fu">width</span> * circle.<span class="fu">height</span>;
        }
        <span class="kw">if</span> (shape <span class="kw">instanceof</span> Square) {
            Square circle = (Square) shape;
            <span class="kw">return</span> circle.<span class="fu">side</span> * circle.<span class="fu">side</span>;
        }
        <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">IllegalArgumentException</span>(<span class="st">&quot;Unknown shape: &quot;</span> + shape.<span class="fu">getClass</span>());
    }

    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">double</span> <span class="fu">perimeter</span>(<span class="bu">Object</span> shape) {
        <span class="kw">if</span> (shape <span class="kw">instanceof</span> Circle) {
            Circle circle = (Circle) shape;
            <span class="kw">return</span> <span class="dv">2</span> * circle.<span class="fu">radius</span> * <span class="bu">Math</span>.<span class="fu">PI</span>;
        }
        <span class="kw">if</span> (shape <span class="kw">instanceof</span> <span class="bu">Rectangle</span>) {
            <span class="bu">Rectangle</span> circle = (<span class="bu">Rectangle</span>) shape;
            <span class="kw">return</span> <span class="dv">2</span> * circle.<span class="fu">width</span> + <span class="dv">2</span> * circle.<span class="fu">height</span>;
        }
        <span class="kw">if</span> (shape <span class="kw">instanceof</span> Square) {
            Square circle = (Square) shape;
            <span class="kw">return</span> <span class="dv">4</span> * circle.<span class="fu">side</span>;
        }
        <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">IllegalArgumentException</span>(<span class="st">&quot;Unknown shape: &quot;</span> + shape.<span class="fu">getClass</span>());
    }
}</code></pre></div>
<h3 id="exercice-19"><span class="header-section-number">1.21.5</span> Exercice</h3>
<ol style="list-style-type: decimal">
<li>Ecrire une méthode <code>main(String[])</code> qui teste le calcul du périmètre d'un rectangle.</li>
<li>Coder la classe Rectangle.</li>
<li>Ecrire et tester les classes pour le carré et le cercle.</li>
<li>Tester le calcul de l'air pour les 3 types de formes.</li>
</ol>
<h3 id="style-objet"><span class="header-section-number">1.21.6</span> Style objet</h3>
<p>Pour traiter de manière uniforme une variété d'objets de types potentiellement différents, Java fournit le concept d'interface. C'est une sorte de classe abstraite qui fournit seulement un contrat. Le contrat doit être satisfait par le fournisseur et par le consommateur. Le fournisseur du contrat correspond à la classe qui implémente l'interface. Le consommateur correspond à la classe qui invoque une méthode de l'interface en question.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">interface</span> <span class="bu">Shape</span> {
    <span class="dt">double</span> <span class="fu">area</span>();
    <span class="dt">double</span> <span class="fu">perimeter</span>();
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Circle <span class="kw">implements</span> <span class="bu">Shape</span> {
    <span class="kw">private</span> <span class="dt">final</span> <span class="dt">double</span> radius;

    <span class="kw">public</span> <span class="fu">Circle</span>(<span class="dt">double</span> radius) {
        <span class="kw">this</span>.<span class="fu">radius</span> = radius;
    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="dt">double</span> <span class="fu">area</span>() {
        <span class="kw">return</span> radius * radius * <span class="bu">Math</span>.<span class="fu">PI</span>;
    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="dt">double</span> <span class="fu">perimeter</span>() {
        <span class="kw">return</span> <span class="dv">2</span> * <span class="bu">Math</span>.<span class="fu">PI</span> * radius;
    }
}</code></pre></div>
<h3 id="exercice-20"><span class="header-section-number">1.21.7</span> Exercice</h3>
<p>Dans cet exercice, on va réécrire le code procédural de <code>Geometry</code> dans un style objet. Il faut pour cela créer un nouveau projet (pour ne pas faire de conflit avec les classes Circle, Rectangle et Square de l'exercice précédant). La classe Geometry définissait les 2 méthodes perimeter et area. Ces 2 méthodes supportaient les 3 types de formes. Dans cet exercice, chaque classe de forme (c-à-d. Circle, Rectangle et Square) définira ces 2 méthodes. On aura donc au total 3 définitions pour le périmètre et 3 définitions pour l'aire.</p>
<ol style="list-style-type: decimal">
<li>Tester et expérimenter dans un <code>main(String[])</code> le calcul du périmètre d'un cercle.</li>
<li>Tester le calcul de l'aire pour le cercle.</li>
<li>Ecrire et tester la classe pour le carré (périmètre et air).</li>
<li>Ecrire et tester la classe pour le rectangle (idem).</li>
</ol>
<p>L'avantage de cette solution est que l'on peut facilement ajouter de nouvelles formes sans modifier le code existant.</p>
<h3 id="correction-2"><span class="header-section-number">1.21.8</span> Correction</h3>
<p>On code chaque classe dans son propre fichier.</p>
<p>Dans Geometry.java :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Geometry {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="kw">new</span> <span class="fu">Circle</span>(<span class="dv">10</span>).<span class="fu">area</span>());
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="kw">new</span> <span class="bu">Rectangle</span>(<span class="dv">3</span>, <span class="dv">4</span>).<span class="fu">area</span>());
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="kw">new</span> <span class="fu">Square</span>(<span class="dv">5</span>).<span class="fu">area</span>());
    }
}</code></pre></div>
<p>Dans Shape.java, on définit l'interface commune à toute les formes :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">interface</span> <span class="bu">Shape</span> {
    <span class="dt">double</span> <span class="fu">area</span>();

    <span class="dt">double</span> <span class="fu">perimeter</span>();
}</code></pre></div>
<p>Puis on code dans Circle.java uniquement le comportement relatif aux cercles :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Circle <span class="kw">implements</span> <span class="bu">Shape</span> {
    <span class="kw">private</span> <span class="dt">final</span> <span class="dt">double</span> radius;

    <span class="kw">public</span> <span class="fu">Circle</span>(<span class="dt">double</span> radius) {
        <span class="kw">this</span>.<span class="fu">radius</span> = radius;
    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="dt">double</span> <span class="fu">area</span>() {
        <span class="kw">return</span> radius * radius * <span class="bu">Math</span>.<span class="fu">PI</span>;
    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="dt">double</span> <span class="fu">perimeter</span>() {
        <span class="kw">return</span> <span class="dv">2</span> * <span class="bu">Math</span>.<span class="fu">PI</span> * radius;
    }

}</code></pre></div>
<p>Idem pour Rectangle.java :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">
<span class="kw">public</span> <span class="kw">class</span> <span class="bu">Rectangle</span> <span class="kw">implements</span> <span class="bu">Shape</span> {
    <span class="kw">private</span> <span class="dt">final</span> <span class="dt">double</span> width;
    <span class="kw">private</span> <span class="dt">final</span> <span class="dt">double</span> height;

    <span class="kw">public</span> <span class="bu">Rectangle</span>(<span class="dt">double</span> width, <span class="dt">double</span> height) {
        <span class="kw">this</span>.<span class="fu">width</span> = width;
        <span class="kw">this</span>.<span class="fu">height</span> = height;
    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="dt">double</span> <span class="fu">area</span>() {
        <span class="kw">return</span> width * height;
    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="dt">double</span> <span class="fu">perimeter</span>() {
        <span class="kw">return</span> <span class="dv">2</span> * width + <span class="dv">2</span> * height;
    }

}</code></pre></div>
<p>Idem pour Square.java :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Square <span class="kw">implements</span> <span class="bu">Shape</span> {
    <span class="kw">private</span> <span class="dt">final</span> <span class="dt">double</span> side;

    <span class="kw">public</span> <span class="fu">Square</span>(<span class="dt">double</span> side) {
        <span class="kw">this</span>.<span class="fu">side</span> = side;
    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="dt">double</span> <span class="fu">area</span>() {
        <span class="kw">return</span> side * side;
    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="dt">double</span> <span class="fu">perimeter</span>() {
        <span class="kw">return</span> <span class="dv">4</span> * side;
    }
}</code></pre></div>
<p>On dit que <code>area</code>, <code>perimeter</code> sont des méthodes <em>polymorphes</em>.</p>
<h3 id="exercice-21"><span class="header-section-number">1.21.9</span> Exercice</h3>
<p>Modifier la méthode <code>main(String[])</code> de sorte de prendre :</p>
<ul>
<li>l'opération (perimeter ou area) en premier argument ;</li>
<li>type de la forme (Circle, Rectangle, Circle) en deuxième argument ;</li>
<li>les arguments particuliers à chaque forme dès le troisième argument.</li>
</ul>
<p>Voici deux exemples d'usage :</p>
<pre class="shell"><code>$ java Geometry perimeter Circle 10
62.83
$ java Geometry area Rectangle 2 3
6</code></pre>
<h3 id="correction-3"><span class="header-section-number">1.21.10</span> Correction</h3>
<p>En pseudo code Java :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
    <span class="bu">Shape</span> s;
    <span class="kw">switch</span> (args[<span class="dv">1</span>]) {
        <span class="kw">case</span> <span class="st">&quot;Circle&quot;</span>:
            s = <span class="kw">new</span> <span class="fu">Circle</span>(<span class="fu">parseDouble</span>(args[<span class="dv">2</span>]));
            <span class="kw">break</span>;
        <span class="kw">case</span> <span class="st">&quot;Rectangle&quot;</span>:
            s = <span class="kw">new</span> <span class="bu">Rectangle</span>(<span class="fu">parseDouble</span>(args[<span class="dv">2</span>]), <span class="fu">parseDouble</span>(args[<span class="dv">3</span>]));
            <span class="kw">break</span>;
        <span class="kw">default</span>:
            s = <span class="kw">null</span>;
    }

    <span class="dt">double</span> r;
    <span class="kw">switch</span> (args[<span class="dv">0</span>])
        <span class="kw">case</span> <span class="st">&quot;perimeter&quot;</span>:
            r = s.<span class="fu">perimeter</span>();
            <span class="kw">break</span>;
        <span class="kw">case</span> <span class="st">&quot;Rectangle&quot;</span>:
            r = s.<span class="fu">area</span>();
            <span class="kw">break</span>;
        <span class="kw">default</span>:
            r = <span class="dv">0</span>;
    }

    <span class="fu">println</span>(r);
}</code></pre></div>
<p>En mettant au propre</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
    <span class="bu">Shape</span> s = <span class="fu">parse</span>(args);

    <span class="dt">double</span> r;
    <span class="kw">switch</span> (args[<span class="dv">0</span>])
        <span class="kw">case</span> <span class="st">&quot;perimeter&quot;</span>:
            r = s.<span class="fu">perimeter</span>();
            <span class="kw">break</span>;
        <span class="kw">case</span> <span class="st">&quot;Rectangle&quot;</span>:
            r = s.<span class="fu">area</span>();
            <span class="kw">break</span>;
        <span class="kw">default</span>:
            r = <span class="dv">0</span>;
    }

    <span class="fu">println</span>(r);
}

<span class="bu">Shape</span> <span class="fu">parse</span>(<span class="bu">String</span>[] args) {
    <span class="kw">switch</span> (args[<span class="dv">1</span>]) {
        <span class="kw">case</span> <span class="st">&quot;Circle&quot;</span>:
            <span class="kw">return</span> <span class="kw">new</span> <span class="fu">Circle</span>(<span class="fu">parseDouble</span>(args[<span class="dv">2</span>]));
        <span class="kw">case</span> <span class="st">&quot;Rectangle&quot;</span>:
            <span class="kw">return</span> <span class="kw">new</span> <span class="bu">Rectangle</span>(<span class="fu">parseDouble</span>(args[<span class="dv">2</span>]), <span class="fu">parseDouble</span>(args[<span class="dv">3</span>]));
        <span class="kw">default</span>:
            <span class="kw">return</span> <span class="kw">null</span>;
    }
}</code></pre></div>
<h2 id="résumé"><span class="header-section-number">1.22</span> Résumé</h2>
<h3 id="quelle-est-la-signature-de-la-fonction-main"><span class="header-section-number">1.22.1</span> Quelle est la signature de la fonction main ?</h3>
<p>La signature d'une fonction comprend le nom de la méthode et les types de ses paramètres formels.</p>
<blockquote>
<p>Definition: Two of the components of a method declaration comprise the method signature—the method's name and the parameter types.</p>
</blockquote>
<p>http://docs.oracle.com/javase/tutorial/java/javaOO/methods.html</p>
<p>Ainsi la signature est :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="fu">main</span>(<span class="bu">String</span>[])</code></pre></div>
<p>La méthode <code>main(String[] args)</code> doit être <code>public</code>, <code>static</code> et de type <code>void</code> pouvoir être exécutée par la machine virtuelle Java.</p>
<h3 id="quelle-est-la-différence-entre-et-equals"><span class="header-section-number">1.22.2</span> Quelle est la différence entre == et equals ?</h3>
<p>Premièrement <code>==</code> est un opérateur alors que <code>Object.equals(Object)</code> est une méthode.</p>
<p>L'opérateur <code>==</code> évalue si 2 références sont égales. Ainsi</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">new</span> <span class="bu">Object</span>() == <span class="kw">new</span> <span class="bu">Object</span>() <span class="co">// false</span></code></pre></div>
<p>Ceci puisque les adresses mémoire (a.k.a. référence) des 2 objets sont différentes.</p>
<p>Mais</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">Object</span> a = <span class="kw">new</span> <span class="bu">Object</span>();
<span class="bu">Object</span> b = a;
a == a; <span class="co">// true</span>
a == b <span class="co">// true</span></code></pre></div>
<p>La méthode <code>Object.equals(Object obj)</code> doit être implémentée par les sous-classes pour définir comment elle sont égales en valeur c'est à dire en contenu. Par défaut (sur la classe <code>Object</code>), <code>equals</code> est implémentée avec la plus discriminante des relations entre objets : l'égalité des références (c.à.d. avec l'opérateur <code>==</code>).</p>
<p>La classe <code>String</code> redéfinit la méthode <code>equals</code> de sorte que 2 objets différents mais contenant la même chaîne de caractères soient considérés comme égaux :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">String</span> a = <span class="kw">new</span> <span class="bu">String</span>(<span class="st">&quot;hello&quot;</span>);
<span class="bu">String</span> b = <span class="kw">new</span> <span class="bu">String</span>(<span class="st">&quot;hello&quot;</span>);
a.<span class="fu">equals</span>(b); <span class="co">// true</span>
a == b; <span class="co">// false</span></code></pre></div>
<p>https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#equals-java.lang.Object-</p>
<p>Les types primitifs n'étant par définition pas des types références ne peuvent pas être comparés avec <code>equals</code>. Ce n'est pas problématique puisque dans ce cas l'opérateur <code>==</code> considère la valeur et non pas l'adresse des variables à comparer.</p>
<h3 id="quelle-est-la-syntaxe-pour-convertir-un-double-en-int"><span class="header-section-number">1.22.3</span> Quelle est la syntaxe pour convertir un double en int ?</h3>
<p>La conversion de type autrement appelée <code>cast</code> a la syntaxe suivante :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span> i = (<span class="dt">int</span>) <span class="fl">1.</span>0d;</code></pre></div>
<p>On pourra également utiliser des méthodes :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span> i = <span class="bu">Double</span>.<span class="fu">valueOf</span>(<span class="fl">1.</span>0d).<span class="fu">intValue</span>();</code></pre></div>
<p>Il existe des méthodes similaires pour restreindre n'importe quel nombre à un type <code>byte</code>, <code>short</code>, <code>int</code>, <code>long</code>, <code>float</code>, <code>double</code>.</p>
<p>https://docs.oracle.com/javase/8/docs/api/java/lang/Number.html</p>
<h3 id="comment-déclarer-et-initialiser-un-tableau-de-int-de-taille-3"><span class="header-section-number">1.22.4</span> Comment déclarer et initialiser un tableau de int de taille 3 ?</h3>
<p>Pour instancier un tableau, on utilise l'opérateur <code>new</code> suivi du type des élements puis de sa taille.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span>[] array = <span class="kw">new</span> <span class="dt">int</span>[<span class="dv">3</span>];</code></pre></div>
<p>Ceci alloue la mémoire nécessaire sur le tas (&quot;heap&quot;). Le tableau contient la valeur par défaut du type stocké (ici la valeur par défaut de int est 0).</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(array.<span class="fu">length</span>); <span class="co">// 3</span>
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(array[<span class="dv">0</span>]); <span class="co">// 0</span>
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(array[<span class="dv">1</span>]); <span class="co">// 0</span>
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(array[<span class="dv">2</span>]); <span class="co">// 0</span></code></pre></div>
<p>En revanche, un tableau de 1 booléen pourra être défini comme ceci :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">boolean</span> [] array = <span class="kw">new</span> <span class="dt">boolean</span>[<span class="dv">1</span>];</code></pre></div>
<p>Il contiendra par défaut uniquement des false (valeur par défaut de boolean).</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(array[<span class="dv">0</span>]); <span class="co">// false</span></code></pre></div>
<p>On peut également utiliser un initialisateur de tableau :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">double</span>[] array = <span class="kw">new</span> <span class="dt">double</span>[]{<span class="fl">1.0</span>, <span class="fl">2.0</span>};
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(array.<span class="fu">length</span>); <span class="co">// 2</span>
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(array[<span class="dv">0</span>]); <span class="co">// 1.0</span>
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(array[<span class="dv">1</span>]); <span class="co">// 2.0</span></code></pre></div>
<p>Exemple d'initialisation d'un tableau d'objets :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">Object</span>[] array = <span class="kw">new</span> <span class="bu">Object</span>[]{<span class="kw">null</span>, <span class="kw">new</span> <span class="bu">Object</span>(), <span class="st">&quot;hello&quot;</span>};
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(array.<span class="fu">length</span>); <span class="co">// 3</span>
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(array[<span class="dv">0</span>]); <span class="co">// null</span>
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(array[<span class="dv">1</span>]); <span class="co">// java.lang.Object@32a1bec0</span>
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(array[<span class="dv">2</span>]); <span class="co">// hello</span></code></pre></div>
<p>On peut également omettre le type du tableau si on peut déduire le type des éléments :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">double</span>[] d = {<span class="fl">1.0</span>, <span class="bu">Double</span>.<span class="fu">NaN</span>};
<span class="bu">String</span>[] s = {<span class="st">&quot;&quot;</span>, <span class="kw">null</span>};
<span class="bu">Object</span>[] o = {<span class="kw">new</span> <span class="bu">Object</span>(), <span class="kw">null</span>};</code></pre></div>
<h3 id="quels-sont-les-4-modificateurs-de-visibilités-et-leur-signification"><span class="header-section-number">1.22.5</span> Quels sont les 4 modificateurs de visibilités et leur signification ?</h3>
<p>Une méthode (resp. un champ) <code>private</code> n'est visible que dans sa classe.</p>
<p>Une méthode (un champ) <code>public</code> est visible par toutes les classes qui on accès à la classe qui la définit.</p>
<p>Une méthode (un champ) <code>protected</code> est visible par sa classe ainsi que toutes ses sous-classes et par toutes les classes du même package.</p>
<p>Une méthode (un champ) <code>package-protected</code> est visible uniquement par les classes du même package. Noter qu'il n'y a pas de mot-clé du langage pour cette dernière visibilité. L'absence d'indication de portée indique que la méthode est package-protected.</p>
<p>Une classe peut-être ou bien <code>public</code> ou bien <code>package-protected</code>.</p>
<p>Une classe <code>public</code> est visible au delà de son package. Une classe <code>package-protected</code> ne peut être utilisée que dans son package.</p>
<h3 id="quelle-classe-définit-une-liste-dynamique"><span class="header-section-number">1.22.6</span> Quelle classe définit une liste dynamique ?</h3>
<p>La classe <code>ArrayList</code> implémente une liste dynamique (sa taille peut varier pendant l'exécution). Cette classe implémente l'interface <code>List</code>. Il existe d'autres implémentations de liste dynamique : <code>ArrayList</code> et <code>LinkedList</code>.</p>
<p>Contrairement à <code>ArrayList</code> qui utilise un tableau, la classe <code>LinkedList</code> utilise une liste chaînée.</p>
<p>On peut stocker n'importe quel type référence dans une <code>ArrayList</code>. C'est à dire, une ArrayList (ou plus généralement une <code>Collection</code>) ne peut pas stocker de valeur de type primitif). Concrètement une ArrayList ne pourra pas stocker des <code>int</code>.</p>
<p>En revanche, elle supporte le stockage de <code>null</code>. ArrayList ne supporte pas le multithreading.</p>
<p>On ne peut pas modifier la liste quand on la parcourt :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">ArrayList</span>&lt;<span class="bu">Object</span>&gt; list = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;&gt;();
list.<span class="fu">add</span>(<span class="st">&quot;hello&quot;</span>);
<span class="kw">for</span> (<span class="bu">Object</span> element : list) {
    list.<span class="fu">remove</span>(<span class="st">&quot;hello&quot;</span>); <span class="co">// java.util.ConcurrentModificationException</span>
}</code></pre></div>
<p>https://docs.oracle.com/javase/8/docs/api/java/util/ArrayList.html</p>
<p>https://docs.oracle.com/javase/8/docs/api/java/util/List.html</p>
<h3 id="quelle-classe-doit-on-utiliser-quand-on-concatène-beaucoup-de-chaînes-de-caractères-dans-une-boucle"><span class="header-section-number">1.22.7</span> Quelle classe doit-on utiliser quand on concatène beaucoup de chaînes de caractères dans une boucle ?</h3>
<p>Il est recommendé d'utiliser <code>StringBuilder</code>. Voici un exemple d'utilisation :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">ArrayList</span>&lt;<span class="bu">Object</span>&gt; list = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;&gt;();
list.<span class="fu">add</span>(<span class="st">&quot;hello&quot;</span>); <span class="co">// imaginons plutôt une très longue liste</span>

<span class="bu">StringBuilder</span> buffer = <span class="kw">new</span> <span class="bu">StringBuilder</span>();
<span class="kw">for</span> (<span class="bu">Object</span> element : list) {
    buffer.<span class="fu">append</span>(element.<span class="fu">toString</span>());
}
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(buffer.<span class="fu">toString</span>());</code></pre></div>
<p>Un <code>StringBuilder</code> représente une séquence mutable de caractère. Cette classe implémente <code>CharSequence</code> qui représente une chaîne de caractère (String en est une implémentation). Elle implémente également <code>Appendable</code> qui représente une séquence sur laquelle on peut ajouter un nouveau caractère ou une autre séquence (concaténation).</p>
<p>Il existe une autre implémentation de <code>Appendable</code> qui supporte le multithreading : <code>StringBuffer</code>.</p>
<p>https://docs.oracle.com/javase/8/docs/api/java/lang/StringBuilder.html</p>
<p>https://docs.oracle.com/javase/8/docs/api/java/lang/StringBuffer.html</p>
<h3 id="quelle-méthode-java-permet-de-générer-un-nombre-double-aléatoire"><span class="header-section-number">1.22.8</span> Quelle méthode Java permet de générer un nombre (double) aléatoire ?</h3>
<p>Le moyen le plus simple est d'utiliser <code>java.util.Math.random()</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="bu">Math</span>.<span class="fu">random</span>()); <span class="co">// un nombre entre 0 et 1</span>
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="bu">Math</span>.<span class="fu">random</span>() * <span class="dv">100</span>); <span class="co">// un nombre entre 0 et 100</span>
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="dv">1000</span> + <span class="bu">Math</span>.<span class="fu">random</span>() * <span class="dv">100</span>); <span class="co">// un nombre entre 1000 et 1100</span></code></pre></div>
<p>https://docs.oracle.com/javase/8/docs/api/java/lang/Math.html#random--</p>
<h3 id="quelle-est-la-différence-entre-une-méthode-statique-static-et-une-méthode-non-statique"><span class="header-section-number">1.22.9</span> Quelle est la différence entre une méthode statique (static) et une méthode non statique ?</h3>
<p>Un champ ou une méthode <code>static</code> existe indépendamment d'une quelconque instance de classe. Tous les champs <code>static</code> existent avant qu'on n'instancie leur classe. Il n'existe qu'une seule copie d'un champ statique quelque soit le nombre d'instances créées. En d'autres termes : les champs statiques peuvent être partagés par toutes les instances. Les méthodes, variable, classes imbriquées dans une classes et les bloc d'initalisation peuvent être déclarés <code>static</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> Dog {
  <span class="kw">private</span> <span class="dt">static</span> <span class="dt">int</span> count;
  <span class="kw">private</span> <span class="bu">String</span> name;
  <span class="kw">public</span> <span class="fu">Dog</span>(<span class="bu">String</span> name) {
    <span class="kw">this</span>.<span class="fu">name</span> = name;
    count++;
  }
  <span class="kw">public</span> <span class="bu">String</span> <span class="fu">getName</span>() {
    <span class="kw">return</span> name;
  }
  <span class="kw">public</span> <span class="dt">static</span> <span class="dt">int</span> <span class="fu">getNumberOfDogs</span>() {
    <span class="kw">return</span> count;
  }
}</code></pre></div>
<p>Un champ ou une méthode non statique n'existe que sur des instances de sa classe.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Dog fizz = <span class="kw">new</span> <span class="fu">Dog</span>(<span class="st">&quot;fizz&quot;</span>);
Dog buzz = <span class="kw">new</span> <span class="fu">Dog</span>(<span class="st">&quot;buzz&quot;</span>);
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(fizz.<span class="fu">getName</span>()); <span class="co">// &quot;fizz&quot;</span>
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(buff.<span class="fu">getName</span>()); <span class="co">// &quot;buzz&quot;</span>
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(Dog.<span class="fu">getNumberOfDogs</span>()); <span class="co">// 2</span></code></pre></div>
<h3 id="quest-ce-que-la-surcharge-overloading"><span class="header-section-number">1.22.10</span> Qu'est-ce que la surcharge (overloading) ?</h3>
<p>Une surcharge de méthode est une autre méthode qui a le même nom mais une signature différente. Ainsi la méthode <code>doStuff(int)</code> surcharge la méthode <code>doStuff()</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">void</span> <span class="fu">doStuff</span>() {}
<span class="kw">public</span> <span class="dt">void</span> <span class="fu">doStuff</span>(<span class="dt">int</span> x) {}</code></pre></div>
<p>Surcharger c'est donner le même nom à des choses différentes.</p>
<p>D'ailleurs Henri Poincaré, un grand mathématicien du début du XXe siècle aurait dit :</p>
<blockquote>
<p>la mathématique est l’art de donner le même nom à des choses différentes.</p>
</blockquote>
<h3 id="quest-ce-que-la-redéfinition-ou-overriding"><span class="header-section-number">1.22.11</span> Qu'est-ce que la redéfinition ou (overriding) ?</h3>
<p>Chaque classe qui hérite d'une autre classe peut redéfinir les méthodes non <code>private</code> ou non <code>final</code> de sa super-classe.</p>
<p>Le bénéfice consiste à redéfinir le comportement qui est spécifique à la sous-classe.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Animal {
  <span class="kw">public</span> <span class="dt">void</span> <span class="fu">printHello</span>() {
    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;hello&quot;</span>);
  }
}
<span class="kw">public</span> <span class="kw">class</span> Cat <span class="kw">extends</span> Animal {
  <span class="at">@Override</span> <span class="co">// fortement conseillé mais pas obligatoire</span>
  <span class="kw">public</span> <span class="bu">String</span> <span class="fu">printHello</span>() {
    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Meouw&quot;</span>);
  }
}</code></pre></div>
<p>On appelle pompeusement <em>polymorphisme</em>, la capacité d'une classe à avoir comportement différent de sa classe mère (ou classe de base, ou super-classe).</p>
<h3 id="expliquer-ce-quest-le-constructeur-par-défaut"><span class="header-section-number">1.22.12</span> Expliquer ce qu'est le constructeur par défaut ?</h3>
<p>Le constructeur par défaut est créé implictement par le compilateur lorsque (et uniquement) la classe n'en définit pas un. Ce constructeur ne prend aucun argument et est <code>public</code>.</p>
<p>Ainsi la classe <code>class Dog {}</code> définit implicitement un constructeur vide et sans paramètre. On pourra ainsi instancier la classe comme ceci : <code>new Dog()</code>.</p>
<h3 id="à-quoi-correspond-le-mot-clé-this"><span class="header-section-number">1.22.13</span> À quoi correspond le mot-clé &quot;this&quot; ?</h3>
<p>La variable <code>this</code> est une référence à l'objet en cours.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> Cat {
  <span class="kw">private</span> <span class="bu">String</span> name;
  <span class="kw">public</span> <span class="fu">Cat</span>(<span class="bu">String</span> name) {
    <span class="kw">this</span>.<span class="fu">name</span> = name;
  }
  <span class="at">@Override</span>
  <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">equals</span>(<span class="bu">Object</span> o) {
    Cat other = (Cat) o;
    <span class="bu">System</span>.<span class="fu">err</span>.<span class="fu">println</span>(<span class="kw">this</span>);
    <span class="kw">return</span> <span class="kw">this</span>.<span class="fu">name</span>.<span class="fu">equals</span>(o.<span class="fu">name</span>);
  }
  <span class="at">@Override</span>
  <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span>() {
    <span class="kw">return</span> name;
  }
}

Cat rope = <span class="kw">new</span> <span class="fu">Cat</span>(<span class="st">&quot;rope&quot;</span>);
Cat barrel = <span class="kw">new</span> <span class="fu">Cat</span>(<span class="st">&quot;barrel&quot;</span>);
rope.<span class="fu">equals</span>(barrel); <span class="co">// println(&quot;rope&quot;)</span>
barrel.<span class="fu">equals</span>(rope); <span class="co">// println(&quot;barrel&quot;)</span></code></pre></div>
<h3 id="comment-récupérer-la-longueur-dun-tableau"><span class="header-section-number">1.22.14</span> Comment récupérer la longueur d'un tableau ?</h3>
<p>La longueur d'un tableau est stockée dans un champ <code>length</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">double</span>[] array = <span class="kw">new</span> <span class="dt">double</span>[]{<span class="fl">1.0</span>, <span class="fl">2.0</span>};
<span class="dt">int</span> lastIndex = array.<span class="fu">length</span> - <span class="dv">1</span>; <span class="co">// 1</span>
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(array[lastIndex]); <span class="co">// 2.0</span></code></pre></div>
<h3 id="comment-récupérer-la-longueur-dune-liste-dynamique"><span class="header-section-number">1.22.15</span> Comment récupérer la longueur d'une liste dynamique ?</h3>
<p>La longueur d'une <code>List</code> se calcule dynamiquement à l'aide de la méthode <code>size()</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="bu">Arrays</span>.<span class="fu">asList</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>).<span class="fu">size</span>()); <span class="co">// 3</span></code></pre></div>
<h3 id="quelle-est-la-syntaxe-dun-switch"><span class="header-section-number">1.22.16</span> Quelle est la syntaxe d'un switch ?</h3>
<p>Voici un exemple de switch sur un int :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">switch</span> (<span class="dv">100</span> % <span class="dv">2</span>) {
    <span class="kw">case</span> <span class="dv">0</span>:
        <span class="co">// n&#39;importe quelle suite d&#39;instruction</span>
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;0&quot;</span>);
        <span class="kw">break</span>; <span class="co">// optionel</span>
    <span class="kw">case</span> <span class="dv">1</span>:
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;1&quot;</span>);
        <span class="kw">break</span>;
    <span class="kw">default</span>: <span class="co">// optionel</span>
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Don&#39;t know...&quot;</span>);
}</code></pre></div>
<h3 id="quelle-est-la-valeur-par-défaut-pour-un-int"><span class="header-section-number">1.22.17</span> Quelle est la valeur par défaut pour un int ?</h3>
<p>La valeur pour tous les type primitifs numériques est <code>0</code> (<code>0.0</code> pour les <code>double</code> et <code>float</code>).</p>
<p>La valeur <code>null</code> est la valeur par défaut des type références (les objets).</p>
<h3 id="quelle-est-la-valeur-par-défaut-pour-un-boolean"><span class="header-section-number">1.22.18</span> Quelle est la valeur par défaut pour un boolean ?</h3>
<p><code>false</code></p>
<h3 id="quelle-est-la-valeur-par-défaut-pour-une-string"><span class="header-section-number">1.22.19</span> Quelle est la valeur par défaut pour une String ?</h3>
<p>Comme <code>String</code> est un type référence (objet) sa valeur par défaut est : <code>null</code>.</p>
<h3 id="quelle-est-la-valeur-par-défaut-pour-un-object"><span class="header-section-number">1.22.20</span> Quelle est la valeur par défaut pour un Object ?</h3>
<p>Pas de surprise, la valeur par défaut est <code>null</code>. <em>Attention</em> ce n'est pas <code>NULL</code> ni <code>0</code> comme en C.</p>
<h3 id="quelle-méthode-permet-de-scinder-une-chaîne-de-caractère"><span class="header-section-number">1.22.21</span> Quelle méthode permet de scinder une chaîne de caractère ?</h3>
<p>On peut utiliser <code>String.split(String)</code>.</p>
<p>Le paramètre de <code>split</code> est une expression rationnelle (regular expression a.k.a. &quot;regex&quot; ou &quot;regexp&quot;).</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">String</span>[] split = <span class="st">&quot;a b</span><span class="sc">\t</span><span class="st">c</span><span class="sc">\n</span><span class="st">d&quot;</span>.<span class="fu">split</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">s&quot;</span>);
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="bu">Arrays</span>.<span class="fu">toString</span>(split)); <span class="co">// [a, b, c, d]</span></code></pre></div>
<p>Voici un exemple avec une expression rationnelle plus compliquée :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">String</span>[] split = <span class="st">&quot;1a2!3 4&quot;</span>.<span class="fu">split</span>(<span class="st">&quot;[^0-9]&quot;</span>);
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="bu">Arrays</span>.<span class="fu">toString</span>(split)); <span class="co">// [1, 2, 3, 4]</span></code></pre></div>
<p>https://docs.oracle.com/javase/8/docs/api/java/lang/String.html#split-java.lang.String-</p>
<p>https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html#sum</p>
<h3 id="quelle-est-la-syntaxe-pour-appeler-une-méthode-dinstance"><span class="header-section-number">1.22.22</span> Quelle est la syntaxe pour appeler une méthode d'instance ?</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Foo myObject = <span class="kw">new</span> <span class="fu">Foo</span>();
myObject.<span class="fu">myMethod</span>();</code></pre></div>
<p>À la 2e ligne, <code>myObject</code> est l'objet receveur de la méthode <code>myMethod</code>.</p>
<h3 id="quelle-est-la-syntaxe-pour-référencer-un-champ-dinstance"><span class="header-section-number">1.22.23</span> Quelle est la syntaxe pour référencer un champ d'instance ?</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Bar myObject = <span class="kw">new</span> <span class="fu">Bar</span>();
<span class="dt">int</span> value = myObject.<span class="fu">myField</span>;</code></pre></div>
<h3 id="etant-donné-class-animal-et-class-dog-extends-animal-lesquelles-de-ces-affectations-compilent"><span class="header-section-number">1.22.24</span> Etant donné &quot;class Animal {}&quot; et &quot;class Dog extends Animal {}&quot;, lesquelles de ces affectations compilent :</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> Animal {}
<span class="kw">class</span> Dog <span class="kw">extends</span> Animal {}</code></pre></div>
<p>Voici les résultats :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Animal a = <span class="kw">new</span> <span class="fu">Animal</span>(); <span class="co">// OK</span>
Dog d = <span class="kw">new</span> <span class="fu">Dog</span>(); <span class="co">// OK</span>
Dog d = <span class="kw">new</span> <span class="fu">Animal</span>(); <span class="co">// fail!</span>
Animal a = <span class="kw">new</span> <span class="fu">Dog</span>(); <span class="co">// OK</span></code></pre></div>
<h3 id="etant-donné-une-super-classe-animal-qui-définit-uniquement-le-constructeur-animalstring-name-quelle-définition-du-constructeur-dog-compilent-telles"><span class="header-section-number">1.22.25</span> Etant donné une super classe Animal qui définit uniquement le constructeur Animal(String name), quelle définition du constructeur Dog compilent t'elles ?</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="fu">Dog</span>() {} <span class="co">// fail!</span>
<span class="fu">Dog</span>() { <span class="kw">super</span>(); } <span class="co">// fail!</span>
<span class="fu">Dog</span>() { <span class="kw">super</span>(<span class="st">&quot;I&#39;m a dog!&quot;</span>); } <span class="co">// OK</span>
<span class="fu">Dog</span>(<span class="bu">String</span> dogName) { <span class="kw">super</span>(dogName); } <span class="co">// OK</span></code></pre></div>
<h3 id="quelles-règles-sappliquent-pour-la-redéfinition-de-méthode"><span class="header-section-number">1.22.26</span> Quelles règles s'appliquent pour la redéfinition de méthode ?</h3>
<p>La signature doit être strictement identique.</p>
<p>Le nom doit être identique.</p>
<p>Le type de retour peut-être plus spécialisé (sous classe du type de retour de la méthode qui est redéfinie). On appelle cela pompeusement covariance du type de retour.</p>
<p>La méthode qui redéfinie ne doit pas restreindre la visibilité. Une méthode <code>public</code> ne peut pas être redéfinie comme <code>private</code>, <code>protected</code> ou <code>package-protected</code>.</p>
<h2 id="correction-evaluation-1"><span class="header-section-number">1.23</span> Correction Evaluation 1</h2>
<h3 id="exercice-1-1"><span class="header-section-number">1.23.1</span> Exercice 1</h3>
<h4 id="enoncé"><span class="header-section-number">1.23.1.1</span> Enoncé</h4>
<p>Les permissions de fichier Unix sont encodées en octal (par ex. 0755). En revanche, elles sont affichées à l'utilisateur sous la forme de 3 &quot;rwx&quot;. Par exemple, lister les fichiers donnera :</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="ex">ll</span> /bin/echo
<span class="ex">-rwxr-xr-x</span> 1 thieux 197121 28352 août  28  2015 /bin/echo*</code></pre></div>
<p>Pour extraire :</p>
<ul>
<li>le 4 dans 0754 on calcule le reste de la division entière de 0754 et de 8.</li>
<li>le 5 dans 0754 on calcule le reste de la division entière de 0754/8 et de 8.</li>
<li>le 7 dans 0754 on calcule le reste de la division entière de 0754/8/8 et de 8.</li>
</ul>
<p>Chaque chiffre ainsi extrait peut varier entre 0 et 7. Voici comment on les interprète :</p>
<ul>
<li><code>7</code> = <code>4 + 2 + 1</code> =&gt; 111 =&gt; <code>rwx</code></li>
<li><code>5</code> = <code>4 + 0 + 1</code> =&gt; 101 =&gt; <code>r-x</code></li>
<li><code>4</code> = <code>4 + 0 + 0</code> =&gt; 100 =&gt; <code>r--</code></li>
</ul>
<p>Noter que le reste de la division entière :</p>
<ul>
<li>de 5 et 2 donne 1 ;</li>
<li>de 5/2 et 2 donne 0 ;</li>
<li>de 5/2/2 et 2 donne 1.</li>
</ul>
<p><em>Consignes :</em></p>
<p>Créer une classe <code>UnixPermissions</code> et une méthode <code>public String permissionsFor(int mode)</code> qui suit le contrat suivant :</p>
<ul>
<li><code>permissionsFor(0777).equals(&quot;rwx rwx rwx&quot;);</code></li>
<li><code>permissionsFor(0000).equals(&quot;--- --- ---&quot;);</code></li>
<li><code>permissionsFor(0700).equals(&quot;rwx --- ---&quot;);</code></li>
<li><code>permissionsFor(0770).equals(&quot;rwx rwx ---&quot;);</code></li>
<li><code>permissionsFor(0666).equals(&quot;rw- rw- rw-&quot;);</code></li>
<li><code>permissionsFor(0555).equals(&quot;r-x r-x r-x&quot;);</code></li>
</ul>
<p>On pourra utiliser :</p>
<ul>
<li>la classe <code>ArrayList</code></li>
<li>la méthode <code>Collections.reverse(List&lt;?&gt; list)</code></li>
<li>la méthode <code>String.join(CharSequence delimiter, Iterable&lt;? extends CharSequence&gt; elements)</code></li>
</ul>
<h4 id="correction-4"><span class="header-section-number">1.23.1.2</span> Correction</h4>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> fr.arolla.java8esgi.controle1;</span>

<span class="kw">import</span><span class="im"> java.util.ArrayList;</span>
<span class="kw">import</span><span class="im"> java.util.Collections;</span>

<span class="kw">public</span> <span class="kw">class</span> UnixPermissions {

    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">permissionsFor</span>(<span class="dt">int</span> mode) {
        <span class="kw">if</span> (mode &lt; <span class="dv">0</span> || mode &gt; <span class="dv">0777</span>) {
            <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">IllegalArgumentException</span>(
                    <span class="bu">String</span><span class="fu">.format</span>(<span class="st">&quot;Invalid mode </span><span class="sc">%s%s</span><span class="st">&quot;</span>, <span class="bu">Math</span>.<span class="fu">signum</span>(mode) &gt; <span class="dv">0</span> ? <span class="st">&quot;&quot;</span> : <span class="st">&quot;-&quot;</span>, <span class="bu">Integer</span>.<span class="fu">toOctalString</span>(<span class="bu">Math</span>.<span class="fu">abs</span>(mode))));
        }
        <span class="bu">ArrayList</span>&lt;<span class="bu">String</span>&gt; permissionList = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;&gt;();
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; <span class="dv">3</span>; i++) {
            <span class="dt">int</span> singlePermission = mode % <span class="dv">8</span>;
            <span class="dt">int</span>[] permission = <span class="fu">decodeAsBits</span>(singlePermission);
            <span class="bu">String</span> formattedPermission =
                    ((permission[<span class="dv">0</span>] == <span class="dv">1</span>) ? <span class="st">&quot;r&quot;</span> : <span class="st">&quot;-&quot;</span>) +
                    ((permission[<span class="dv">1</span>] == <span class="dv">1</span>) ? <span class="st">&quot;w&quot;</span> : <span class="st">&quot;-&quot;</span>) +
                    ((permission[<span class="dv">2</span>] == <span class="dv">1</span>) ? <span class="st">&quot;x&quot;</span> : <span class="st">&quot;-&quot;</span>);
            permissionList.<span class="fu">add</span>(formattedPermission);
            mode /= <span class="dv">8</span>;
        }
        <span class="bu">Collections</span>.<span class="fu">reverse</span>(permissionList);
        <span class="kw">return</span> <span class="bu">String</span>.<span class="fu">join</span>(<span class="st">&quot; &quot;</span>, permissionList);
    }

    <span class="kw">private</span> <span class="dt">int</span>[] <span class="fu">decodeAsBits</span>(<span class="dt">int</span> singlePermission) {
        <span class="dt">int</span>[] bits = <span class="kw">new</span> <span class="dt">int</span>[<span class="dv">3</span>];
        <span class="kw">for</span> (<span class="dt">int</span> j = <span class="dv">0</span>; j &lt; <span class="dv">3</span>; j++) {
            <span class="dt">int</span> bit = singlePermission % <span class="dv">2</span>;
            bits[<span class="dv">3</span> - j - <span class="dv">1</span>] = bit;
            singlePermission /= <span class="dv">2</span>;
        }
        <span class="kw">return</span> bits;
    }

}</code></pre></div>
<h3 id="exercice-2-1"><span class="header-section-number">1.23.2</span> Exercice 2</h3>
<h4 id="enoncé-1"><span class="header-section-number">1.23.2.1</span> Enoncé</h4>
<p>Etant donné la suite d'instructions suivante :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">ArrayList</span>&lt;<span class="bu">Shape</span>&gt; shapes = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;&gt;();
shapes.<span class="fu">add</span>(<span class="kw">new</span> <span class="fu">Circle</span>(<span class="dv">0</span>, <span class="dv">10</span>));
shapes.<span class="fu">add</span>(<span class="kw">new</span> <span class="fu">Triangle</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>));
shapes.<span class="fu">add</span>(<span class="kw">new</span> <span class="bu">Rectangle</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">15</span>));

<span class="kw">for</span> (<span class="bu">Shape</span> shape : shapes) {
    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(shape.<span class="fu">dumpContent</span>());
}</code></pre></div>
<p>Et les constructeurs suivants :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="fu">Circle</span>(<span class="dt">double</span> center, <span class="dt">double</span> radius)
<span class="fu">Triangle</span>(<span class="dt">double</span> x1, <span class="dt">double</span> y1, <span class="dt">double</span> x2, <span class="dt">double</span> y2, <span class="dt">double</span> x3, <span class="dt">double</span> y3)
<span class="bu">Rectangle</span>(<span class="dt">double</span> topLeftX, <span class="dt">double</span> topLeftY, <span class="dt">double</span> width, <span class="dt">double</span> height)</code></pre></div>
<p><em>Consignes :</em></p>
<ol style="list-style-type: decimal">
<li>Définir l'interface Shape.</li>
<li>Implémenter les classes Circle, Triangle et Rectangle.</li>
</ol>
<h4 id="correction-5"><span class="header-section-number">1.23.2.2</span> Correction</h4>
<p>Etant donné le programme suivant :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> ShapesDemo {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        <span class="bu">ArrayList</span>&lt;<span class="bu">Shape</span>&gt; shapes = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;&gt;();
        shapes.<span class="fu">add</span>(<span class="kw">new</span> <span class="fu">Circle</span>(<span class="dv">0</span>, <span class="dv">10</span>));
        shapes.<span class="fu">add</span>(<span class="kw">new</span> <span class="fu">Triangle</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>));
        shapes.<span class="fu">add</span>(<span class="kw">new</span> <span class="bu">Rectangle</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">15</span>));

        <span class="kw">for</span> (<span class="bu">Shape</span> shape : shapes) {
            <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(shape.<span class="fu">dumpContent</span>());
        }
    }
}</code></pre></div>
<p>On peut coder les classes Shape, Circle, Triangle et Rectangle comme suit :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">interface</span> <span class="bu">Shape</span> {
    <span class="bu">String</span> <span class="fu">dumpContent</span>();
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Circle <span class="kw">implements</span> <span class="bu">Shape</span> {
        <span class="kw">private</span> <span class="dt">final</span> <span class="dt">double</span> center;
        <span class="kw">private</span> <span class="dt">final</span> <span class="dt">double</span> radius;

        <span class="kw">public</span> <span class="fu">Circle</span>(<span class="dt">double</span> center, <span class="dt">double</span> radius) {
            <span class="kw">this</span>.<span class="fu">center</span> = center;
            <span class="kw">this</span>.<span class="fu">radius</span> = radius;
        }

        <span class="at">@Override</span>
        <span class="kw">public</span> <span class="bu">String</span> <span class="fu">dumpContent</span>() {
            <span class="kw">return</span> <span class="bu">String</span><span class="fu">.format</span>(<span class="st">&quot;center=</span><span class="sc">%s</span><span class="st">; radius=</span><span class="sc">%s</span><span class="st">&quot;</span>, center, radius);
        }
    }</code></pre></div>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Triangle <span class="kw">implements</span> <span class="bu">Shape</span> {
        <span class="kw">private</span> <span class="dt">final</span> <span class="dt">double</span> x1;
        <span class="kw">private</span> <span class="dt">final</span> <span class="dt">double</span> y1;
        <span class="kw">private</span> <span class="dt">final</span> <span class="dt">double</span> x2;
        <span class="kw">private</span> <span class="dt">final</span> <span class="dt">double</span> y2;
        <span class="kw">private</span> <span class="dt">final</span> <span class="dt">double</span> x3;
        <span class="kw">private</span> <span class="dt">final</span> <span class="dt">double</span> y3;

        <span class="kw">public</span> <span class="fu">Triangle</span>(<span class="dt">double</span> x1, <span class="dt">double</span> y1, <span class="dt">double</span> x2, <span class="dt">double</span> y2, <span class="dt">double</span> x3, <span class="dt">double</span> y3) {
            <span class="kw">this</span>.<span class="fu">x1</span> = x1;
            <span class="kw">this</span>.<span class="fu">y1</span> = y1;
            <span class="kw">this</span>.<span class="fu">x2</span> = x2;
            <span class="kw">this</span>.<span class="fu">y2</span> = y2;
            <span class="kw">this</span>.<span class="fu">x3</span> = x3;
            <span class="kw">this</span>.<span class="fu">y3</span> = y3;
        }

        <span class="at">@Override</span>
        <span class="kw">public</span> <span class="bu">String</span> <span class="fu">dumpContent</span>() {
            <span class="kw">return</span> <span class="bu">String</span><span class="fu">.format</span>(<span class="st">&quot;x1=</span><span class="sc">%s</span><span class="st">; y1=</span><span class="sc">%s</span><span class="st">; x2=</span><span class="sc">%s</span><span class="st">; y2=</span><span class="sc">%s</span><span class="st">; x3=</span><span class="sc">%s</span><span class="st">; y3=</span><span class="sc">%s</span><span class="st">&quot;</span>, x1, y1, x2, y2, x3, y3);
        }
    }</code></pre></div>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> <span class="bu">Rectangle</span> <span class="kw">implements</span> <span class="bu">Shape</span> {
        <span class="kw">private</span> <span class="dt">final</span> <span class="dt">double</span> topLeftX;
        <span class="kw">private</span> <span class="dt">final</span> <span class="dt">double</span> topLeftY;
        <span class="kw">private</span> <span class="dt">final</span> <span class="dt">double</span> width;
        <span class="kw">private</span> <span class="dt">final</span> <span class="dt">double</span> height;

        <span class="kw">public</span> <span class="bu">Rectangle</span>(<span class="dt">double</span> topLeftX, <span class="dt">double</span> topLeftY, <span class="dt">double</span> width, <span class="dt">double</span> height) {
            <span class="kw">this</span>.<span class="fu">topLeftX</span> = topLeftX;
            <span class="kw">this</span>.<span class="fu">topLeftY</span> = topLeftY;
            <span class="kw">this</span>.<span class="fu">width</span> = width;
            <span class="kw">this</span>.<span class="fu">height</span> = height;
        }

        <span class="at">@Override</span>
        <span class="kw">public</span> <span class="bu">String</span> <span class="fu">dumpContent</span>() {
            <span class="kw">return</span> <span class="bu">String</span><span class="fu">.format</span>(<span class="st">&quot;topLeftX=</span><span class="sc">%s</span><span class="st">; topLeftY=</span><span class="sc">%s</span><span class="st">; width=</span><span class="sc">%s</span><span class="st">; height=</span><span class="sc">%s</span><span class="st">&quot;</span>, topLeftX, topLeftY, width, height);
        }
    }</code></pre></div>
<h2 id="hashmap"><span class="header-section-number">1.24</span> HashMap</h2>
<p>Une Map est une structure de données qui associe des clés à des valeurs (une clé pour une valeur et vice-versa). Elle n'accepte pas de clé en doublon. Enfin, une clé peut s'associer à <em>au plus une</em> seule valeur.</p>
<p>Cette définition ressemble à celle d'une fonction mathématique en ce qu'un élément de l'ensemble des antécédants associe un et un seul élément de l'ensemble image.</p>
<p>Pour créer une association clé-valeur on peut utiliser <code>Map.put(Object, Object)</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">HashMap</span>&lt;<span class="bu">Object</span>, <span class="bu">Object</span>&gt; map = <span class="kw">new</span> <span class="bu">HashMap</span>&lt;&gt;();
map.<span class="fu">put</span>(<span class="dv">1</span>, <span class="st">&quot;one&quot;</span>);
map.<span class="fu">put</span>(<span class="dv">2</span>, <span class="st">&quot;two&quot;</span>);</code></pre></div>
<p>Pour récupérer une valeur à partir d'une clé on utilise : <code>Map.get(Object)</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">HashMap</span>&lt;<span class="bu">Object</span>, <span class="bu">Object</span>&gt; map = <span class="kw">new</span> <span class="bu">HashMap</span>&lt;&gt;();
map.<span class="fu">put</span>(<span class="dv">1</span>, <span class="st">&quot;one&quot;</span>);
map.<span class="fu">put</span>(<span class="dv">2</span>, <span class="st">&quot;two&quot;</span>);
map.<span class="fu">get</span>(<span class="dv">1</span>); <span class="co">// &quot;one&quot;</span>
map.<span class="fu">get</span>(<span class="dv">2</span>); <span class="co">// &quot;two&quot;</span></code></pre></div>
<p>Le dernier qui applique <code>put</code> a gagné :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">HashMap</span>&lt;<span class="bu">String</span>, <span class="bu">Integer</span>&gt; map = <span class="kw">new</span> <span class="bu">HashMap</span>&lt;&gt;();
map.<span class="fu">put</span>(<span class="st">&quot;I&quot;</span>, <span class="dv">1</span>);
map.<span class="fu">put</span>(<span class="st">&quot;I&quot;</span>, <span class="dv">10</span>);
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(map.<span class="fu">get</span>(<span class="st">&quot;X&quot;</span>)); <span class="co">// 10</span></code></pre></div>
<p>On récupère <code>null</code> lorsque la clé n'existe pas :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">HashMap</span>&lt;<span class="bu">String</span>, <span class="bu">Integer</span>&gt; map = <span class="kw">new</span> <span class="bu">HashMap</span>&lt;&gt;();
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(map.<span class="fu">get</span>(<span class="st">&quot;MISSING_KEY&quot;</span>)); <span class="co">// null</span></code></pre></div>
<p>Mais on peut explicitement stocker des valeurs <code>null</code> dans la map. Ainsi on pourra récupérer <code>null</code> même si la clé existe...</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">HashMap</span>&lt;<span class="bu">String</span>, <span class="bu">Integer</span>&gt; map = <span class="kw">new</span> <span class="bu">HashMap</span>&lt;&gt;();
map.<span class="fu">put</span>(<span class="st">&quot;I&quot;</span>, <span class="kw">null</span>);
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(map.<span class="fu">get</span>(<span class="st">&quot;I&quot;</span>)); <span class="co">// null</span></code></pre></div>
<p>Ainsi récupérer une valeur <code>null</code> n'indique pas qu'une association est absente. Il faut utiliser pour cela la méthode <code>Map.containsKey(Object)</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">HashMap</span>&lt;<span class="bu">String</span>, <span class="bu">Integer</span>&gt; map = <span class="kw">new</span> <span class="bu">HashMap</span>&lt;&gt;();
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(map.<span class="fu">containsKey</span>(<span class="st">&quot;MISSING_KEY&quot;</span>)); <span class="co">// false</span></code></pre></div>
<p>Mais en créant une association :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">HashMap</span>&lt;<span class="bu">String</span>, <span class="bu">Integer</span>&gt; map = <span class="kw">new</span> <span class="bu">HashMap</span>&lt;&gt;();
map.<span class="fu">put</span>(<span class="st">&quot;I&quot;</span>, <span class="kw">null</span>);
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(map.<span class="fu">containsKey</span>(<span class="st">&quot;I&quot;</span>)); <span class="co">// true</span></code></pre></div>
<p>Autre bizzarie de l'implémentation HashMap, on peut utiliser une clé <code>null</code> (à éviter cependant).</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">HashMap</span>&lt;<span class="bu">String</span>, <span class="bu">Integer</span>&gt; map = <span class="kw">new</span> <span class="bu">HashMap</span>&lt;&gt;();
map.<span class="fu">put</span>(<span class="kw">null</span>, <span class="dv">10</span>);
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(map.<span class="fu">get</span>(<span class="kw">null</span>)); <span class="co">// 10</span>
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(map.<span class="fu">containsKey</span>(<span class="kw">null</span>)); <span class="co">// true</span></code></pre></div>
<p>Toute classe utilisée comme clé doit redéfinir <code>hashCode()</code> et <code>equals()</code>. Si on ne le fait pas, on ne retrouvera pas les données dans la Map.</p>
<h3 id="exercice-compter-les-mots"><span class="header-section-number">1.24.1</span> Exercice : compter les mots</h3>
<p>Ecrire une méthode <code>Map&lt;String, Integer&gt; countWords(String text)</code> qui calcule le nombre d'occurence pour chaque mot.</p>
<h3 id="exercice-hashcode-et-equals"><span class="header-section-number">1.24.2</span> Exercice : hashCode et equals</h3>
<p>Etant donné l'extrait de programme suivant :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">import static</span><span class="im"> java.lang.System.out;</span>

<span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
    <span class="bu">HashMap</span>&lt;<span class="bu">Key</span>, <span class="bu">String</span>&gt; map = <span class="kw">new</span> <span class="bu">HashMap</span>&lt;&gt;();
    map.<span class="fu">put</span>(<span class="kw">new</span> <span class="bu">Key</span>(<span class="st">&quot;foo&quot;</span>), <span class="st">&quot;FOO&quot;</span>);
    out.<span class="fu">println</span>(map.<span class="fu">get</span>(<span class="kw">new</span> <span class="bu">Key</span>(<span class="st">&quot;foo&quot;</span>))); <span class="co">// FOO</span>
    out.<span class="fu">println</span>(map.<span class="fu">get</span>(<span class="kw">new</span> <span class="bu">Key</span>(<span class="st">&quot;bar&quot;</span>))); <span class="co">// null</span>
}</code></pre></div>
<ol style="list-style-type: decimal">
<li>Ecrire une classe <code>Key</code> et son constructeur.</li>
<li>Lancer le programme.</li>
<li>Implémenter hashCode et equals</li>
<li>Relancer le programme.</li>
</ol>
<h3 id="exercice-lettre-anonyme"><span class="header-section-number">1.24.3</span> Exercice : lettre anonyme</h3>
<p>Pour écrire une lettre anonyme, on découpe dans le journal des mots. Ces bouts de journaux découpés forment notre dictionnaire. Pour écrire une lettre, tous les mots nécessaires doivent être présent dans le dictionnaire. De plus, si le mot &quot;bonjour&quot; est présent 2 fois dans la lettre, le dictionnaire devra comporter au moins 2 fois le mot &quot;bonjour&quot;.</p>
<ol style="list-style-type: decimal">
<li>Implémenter une méthode <code>canWriteLetter(List&lt;String&gt; wordsInLetter, HashMap&lt;String, Integer&gt; dictionary)</code> qui décide s'il est possible d'écrire une lettre anonyme à l'aide d'un dictionnaire donné.</li>
</ol>
<h3 id="correction-compter-les-mots"><span class="header-section-number">1.24.4</span> Correction : compter les mots</h3>
<p>Voici une première implémentation naïve (elle ne découpe pas très bien les mots et oublie certains mots). Cependant nous concentrons pour le moment sur la logique de comptage des mots.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> fr.arolla.java8esgi.hashmap;</span>

<span class="kw">import</span><span class="im"> java.util.*;</span>

<span class="kw">public</span> <span class="kw">class</span> WordCounter {

    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        WordCounter wordCounter = <span class="kw">new</span> <span class="fu">WordCounter</span>();
        <span class="bu">Map</span>&lt;<span class="bu">String</span>, <span class="bu">Integer</span>&gt; countPerWord = wordCounter.<span class="fu">countWords</span>(TEXT);
        <span class="bu">List</span>&lt;<span class="bu">String</span>&gt; wordsSortedAlphabetically = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;&gt;(countPerWord.<span class="fu">keySet</span>());
        <span class="bu">Collections</span>.<span class="fu">sort</span>(wordsSortedAlphabetically);
        <span class="kw">for</span> (<span class="bu">String</span> word : wordsSortedAlphabetically) {
            <span class="bu">System</span>.<span class="fu">out.printf</span>(<span class="st">&quot;</span><span class="sc">%16s</span><span class="st">: </span><span class="sc">%d%n</span><span class="st">&quot;</span>, word, countPerWord.<span class="fu">get</span>(word));
        }
    }

    <span class="kw">public</span> <span class="bu">Map</span>&lt;<span class="bu">String</span>, <span class="bu">Integer</span>&gt; <span class="fu">countWords</span>(<span class="bu">String</span> text) {
        <span class="bu">List</span>&lt;<span class="bu">String</span>&gt; words = <span class="bu">Arrays</span>.<span class="fu">asList</span>(text.<span class="fu">split</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">s&quot;</span>)); <span class="co">// découpage naïf</span>
        <span class="bu">ArrayList</span>&lt;<span class="bu">String</span>&gt; filteredWords = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;&gt;();
        <span class="kw">for</span> (<span class="bu">String</span> word : words) {
            <span class="kw">if</span> (word.<span class="fu">matches</span>(<span class="st">&quot;[a-zA-Z]+&quot;</span>)) { <span class="co">// filtre naïf</span>
                filteredWords.<span class="fu">add</span>(word);
            }
        }
        <span class="bu">HashMap</span>&lt;<span class="bu">String</span>, <span class="bu">Integer</span>&gt; map = <span class="kw">new</span> <span class="bu">HashMap</span>&lt;&gt;();
        <span class="kw">for</span> (<span class="bu">String</span> word : filteredWords) {
            <span class="bu">Integer</span> count = map.<span class="fu">containsKey</span>(word) ? map.<span class="fu">get</span>(word) : <span class="dv">0</span>;
            map.<span class="fu">put</span>(word, count + <span class="dv">1</span>);
        }
        <span class="kw">return</span> map;
    }

    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">final</span> <span class="bu">String</span> TEXT = <span class="st">&quot;La conscience</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Lorsque avec ses enfants vêtus de peaux de bêtes,</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Echevelé, livide au milieu des tempêtes,</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Caïn se fut enfui de devant Jéhovah,</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Comme le soir tombait, l&#39;homme sombre arriva</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Au bas d&#39;une montagne en une grande plaine ;</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Sa femme fatiguée et ses fils hors d&#39;haleine</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Lui dirent : « Couchons-nous sur la terre, et dormons. »</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Caïn, ne dormant pas, songeait au pied des monts.</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Ayant levé la tête, au fond des cieux funèbres,</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Il vit un oeil, tout grand ouvert dans les ténèbres,</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Et qui le regardait dans l&#39;ombre fixement.</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;« Je suis trop près », dit-il avec un tremblement.</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Il réveilla ses fils dormant, sa femme lasse,</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Et se remit à fuir sinistre dans l&#39;espace.</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Il marcha trente jours, il marcha trente nuits.</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Il allait, muet, pâle et frémissant aux bruits,</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Furtif, sans regarder derrière lui, sans trêve,</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Sans repos, sans sommeil; il atteignit la grève</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Des mers dans le pays qui fut depuis Assur.</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;« Arrêtons-nous, dit-il, car cet asile est sûr.</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Restons-y. Nous avons du monde atteint les bornes. »</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Et, comme il s&#39;asseyait, il vit dans les cieux mornes</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;L&#39;oeil à la même place au fond de l&#39;horizon.</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Alors il tressaillit en proie au noir frisson.</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;« Cachez-moi ! » cria-t-il; et, le doigt sur la bouche,</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Tous ses fils regardaient trembler l&#39;aïeul farouche.</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Caïn dit à Jabel, père de ceux qui vont</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Sous des tentes de poil dans le désert profond :</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;« Etends de ce côté la toile de la tente. »</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Et l&#39;on développa la muraille flottante ;</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Et, quand on l&#39;eut fixée avec des poids de plomb :</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;« Vous ne voyez plus rien ? » dit Tsilla, l&#39;enfant blond,</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;La fille de ses Fils, douce comme l&#39;aurore ;</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Et Caïn répondit : « je vois cet oeil encore ! »</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Jubal, père de ceux qui passent dans les bourgs</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Soufflant dans des clairons et frappant des tambours,</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Cria : « je saurai bien construire une barrière. »</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Il fit un mur de bronze et mit Caïn derrière.</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Et Caïn dit « Cet oeil me regarde toujours! »</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Hénoch dit : « Il faut faire une enceinte de tours</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Si terrible, que rien ne puisse approcher d&#39;elle.</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Bâtissons une ville avec sa citadelle,</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Bâtissons une ville, et nous la fermerons. »</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Alors Tubalcaïn, père des forgerons,</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Construisit une ville énorme et surhumaine.</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Pendant qu&#39;il travaillait, ses frères, dans la plaine,</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Chassaient les fils d&#39;Enos et les enfants de Seth ;</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Et l&#39;on crevait les yeux à quiconque passait ;</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Et, le soir, on lançait des flèches aux étoiles.</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Le granit remplaça la tente aux murs de toiles,</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;On lia chaque bloc avec des noeuds de fer,</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Et la ville semblait une ville d&#39;enfer ;</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;L&#39;ombre des tours faisait la nuit dans les campagnes ;</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Ils donnèrent aux murs l&#39;épaisseur des montagnes ;</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Sur la porte on grava : « Défense à Dieu d&#39;entrer. »</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Quand ils eurent fini de clore et de murer,</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;On mit l&#39;aïeul au centre en une tour de pierre ;</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Et lui restait lugubre et hagard. « Ô mon père !</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;L&#39;oeil a-t-il disparu ? » dit en tremblant Tsilla.</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Et Caïn répondit : </span><span class="sc">\&quot;</span><span class="st"> Non, il est toujours là. »</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Alors il dit: « je veux habiter sous la terre</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Comme dans son sépulcre un homme solitaire ;</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Rien ne me verra plus, je ne verrai plus rien. »</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;On fit donc une fosse, et Caïn dit « C&#39;est bien ! »</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Puis il descendit seul sous cette voûte sombre.</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Quand il se fut assis sur sa chaise dans l&#39;ombre</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;Et qu&#39;on eut sur son front fermé le souterrain,</span><span class="sc">\n</span><span class="st">&quot;</span> +
            <span class="st">&quot;L&#39;oeil était dans la tombe et regardait Caïn.&quot;</span>;

}</code></pre></div>
<p>Le programme affiche :</p>
<pre><code>           Alors: 3
              Au: 1
           Ayant: 1
             Cet: 1
      Chassaient: 1
           Comme: 2
     Construisit: 1
            Cria: 1
             Des: 1
            Dieu: 1
...</code></pre>
<p>Remarquons cependant que le l'expression rationnelle <code>&quot;[a-zA-Z]+&quot;</code> filtre trop de mot. Par exemple, le mot &quot;Arrêtons&quot; n'est pas dans la sortie du programme. Mais laissons cette amélioration à un prochain exercice.</p>
<h3 id="correction-hashcode-et-equals"><span class="header-section-number">1.24.5</span> Correction : hashCode et equals</h3>
<p>Quand on ne redéfinit pas hashCode ou equals on ne retrouve pas les clés précédement stockée dans la map :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> BadKey {

    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        <span class="bu">HashMap</span>&lt;BadKey, <span class="bu">String</span>&gt; map = <span class="kw">new</span> <span class="bu">HashMap</span>&lt;&gt;();
        map.<span class="fu">put</span>(<span class="kw">new</span> <span class="fu">BadKey</span>(<span class="st">&quot;foo&quot;</span>), <span class="st">&quot;FOO&quot;</span>);
        out.<span class="fu">println</span>(map.<span class="fu">get</span>(<span class="kw">new</span> <span class="fu">BadKey</span>(<span class="st">&quot;foo&quot;</span>))); <span class="co">// null, :&#39;(</span>
        out.<span class="fu">println</span>(map.<span class="fu">get</span>(<span class="kw">new</span> <span class="fu">BadKey</span>(<span class="st">&quot;bar&quot;</span>))); <span class="co">// null,</span>
    }
    
    <span class="kw">private</span> <span class="dt">int</span> id;
    <span class="kw">private</span> <span class="bu">String</span> name;

    <span class="fu">BadKey</span>(<span class="bu">String</span> name) {
        <span class="kw">this</span>.<span class="fu">id</span> = id;
        <span class="kw">this</span>.<span class="fu">name</span> = name;
    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span>() {
        <span class="kw">return</span> <span class="st">&quot;BadKey(id=&quot;</span> + id + <span class="st">&quot;, name=&quot;</span> + name + <span class="st">&quot;)&quot;</span>;

    }
}</code></pre></div>
<p>En revanche, en définissant hashCode et equals on retrouvera nos clés :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> GoodKey {

    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        <span class="bu">HashMap</span>&lt;GoodKey, <span class="bu">String</span>&gt; map = <span class="kw">new</span> <span class="bu">HashMap</span>&lt;&gt;();
        map.<span class="fu">put</span>(<span class="kw">new</span> <span class="fu">GoodKey</span>(<span class="st">&quot;foo&quot;</span>), <span class="st">&quot;FOO&quot;</span>);
        out.<span class="fu">println</span>(map.<span class="fu">get</span>(<span class="kw">new</span> <span class="fu">GoodKey</span>(<span class="st">&quot;foo&quot;</span>))); <span class="co">// &quot;FOO&quot; :)</span>
        out.<span class="fu">println</span>(map.<span class="fu">get</span>(<span class="kw">new</span> <span class="fu">GoodKey</span>(<span class="st">&quot;bar&quot;</span>))); <span class="co">// null :)</span>
    }

    <span class="kw">private</span> <span class="dt">int</span> id;
    <span class="kw">private</span> <span class="bu">String</span> name;

    <span class="kw">public</span> <span class="fu">GoodKey</span>(<span class="bu">String</span> name) {
        <span class="kw">this</span>.<span class="fu">id</span> = id;
        <span class="kw">this</span>.<span class="fu">name</span> = name;
    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">hashCode</span>() {
        <span class="kw">return</span> name.<span class="fu">length</span>(); <span class="co">// implémentation peu efficace</span>
    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">equals</span>(<span class="bu">Object</span> obj) {
        <span class="kw">return</span> obj <span class="kw">instanceof</span> GoodKey &amp;&amp; name.<span class="fu">equals</span>(((GoodKey) obj).<span class="fu">name</span>);
    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span>() {
        <span class="kw">return</span> <span class="st">&quot;GoodKey(id=&quot;</span> + id + <span class="st">&quot;, name=&quot;</span> + name + <span class="st">&quot;)&quot;</span>;
    }
}</code></pre></div>
<p>Il faut noter que l'implémentation de <code>hashCode()</code> bien que correcte, donnera des performances désastreuse. En effet, <code>GoodKey</code> donne le même hashCode pour toutes les <code>String</code> de même longueur. Si notre ensemble de clés (ici <code>String</code>) a en moyenne beaucoup de mots de même longueur, l'utilisation de la map sera pas optimale.</p>
<blockquote>
<p>Note that using many keys with the same <code>hashCode()</code> is a sure way to slow down performance of any hash table.</p>
</blockquote>
<p>https://docs.oracle.com/javase/8/docs/api/java/util/HashMap.html</p>
<h3 id="correction-lettre-anonyme"><span class="header-section-number">1.24.6</span> Correction : lettre anonyme</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> fr.arolla.java8esgi.hashmap;</span>

<span class="kw">import</span><span class="im"> java.util.Arrays;</span>
<span class="kw">import</span><span class="im"> java.util.HashMap;</span>
<span class="kw">import</span><span class="im"> java.util.List;</span>

<span class="kw">public</span> <span class="kw">class</span> AnonymousLetter {

    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        <span class="bu">HashMap</span>&lt;<span class="bu">String</span>, <span class="bu">Integer</span>&gt; dictionary = <span class="kw">new</span> <span class="bu">HashMap</span>&lt;&gt;();
        dictionary.<span class="fu">put</span>(<span class="st">&quot;hello&quot;</span>, <span class="dv">1</span>);
        <span class="bu">List</span>&lt;<span class="bu">String</span>&gt; letter = <span class="bu">Arrays</span>.<span class="fu">asList</span>(<span class="st">&quot;hello&quot;</span>, <span class="st">&quot;there&quot;</span>);
        <span class="dt">boolean</span> ok = <span class="kw">new</span> <span class="fu">AnonymousLetter</span>().<span class="fu">canWriteLetter</span>(letter, dictionary);
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(ok);
    }

    <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">canWriteLetter</span>(<span class="bu">List</span>&lt;<span class="bu">String</span>&gt; wordsInLetter, <span class="bu">HashMap</span>&lt;<span class="bu">String</span>, <span class="bu">Integer</span>&gt; dictionary) {
        <span class="kw">for</span> (<span class="bu">String</span> word : wordsInLetter) {
            <span class="dt">int</span> count = dictionary.<span class="fu">getOrDefault</span>(word, <span class="dv">0</span>);
            <span class="kw">if</span> (count &lt; <span class="dv">1</span>) {
                <span class="kw">return</span> <span class="kw">false</span>;
            }
            dictionary.<span class="fu">put</span>(word, count - <span class="dv">1</span>);
        }
        <span class="kw">return</span> <span class="kw">true</span>;
    }

}</code></pre></div>
<p>Dans cette implémentation, on a utilisé la méthode <code>Map.getOrDefault(Object key, V defaultValue)</code> plutôt que de gérer le cas d'une valeur <code>null</code> nous même.</p>
<h2 id="autoboxing"><span class="header-section-number">1.25</span> Autoboxing</h2>
<p>En Java les variable de types primitifs (les principaux étant <code>int</code>, <code>double</code>, <code>boolean</code>, <code>char</code>, etc.) sont stockés sur la pile. Ils sont comparés en valeur contrairement aux type références (les objets).</p>
<p>Chaque type primitif est associé à un type référence (par ex. <code>Integer</code>, <code>Double</code>, <code>Boolean</code>, <code>Character</code>). On les appelle type &quot;wrapper&quot;. Ceci parce que chaque type référence encapsule une valeur immuable d'un type primitif.</p>
<p>Une fois créé, un objet wrapper ne peut plus être modifié :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">Integer</span> n = <span class="kw">new</span> <span class="bu">Integer</span>(<span class="dv">16</span>);
<span class="dt">int</span> i = n.<span class="fu">intValue</span>();
<span class="dt">int</span> diffSign = n.<span class="fu">compareTo</span>(n);
<span class="dt">double</span> d = n.<span class="fu">doubleValue</span>();
<span class="bu">String</span> s = n.<span class="fu">toString</span>();
<span class="co">// etc.</span></code></pre></div>
<p>Il n'existe pas de méthode pour modifier l'objet Integer précédement créé.</p>
<p>Pour modifier l'objet il faut créer un nouvel objet et modifier la référence <code>n</code> (c'est à dire réaffecter un nouvel objet à la même variable).</p>
<pre><code>Integer n = new Integer(16);
n = new Integer(17);
assert n != n;</code></pre>
<p>L'instruction <code>assert</code> vérifie que la condition n != n est vrai. Si ce n'est pas le cas, une <code>java.lang.AssertionError</code> est lancée.</p>
<p>Heureusement à partir de Java 5, le langage supporte l'auto-boxing et l'auto-unboxing.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">Integer</span> n = <span class="kw">new</span> <span class="bu">Integer</span>(<span class="dv">42</span>);
n++; <span class="co">// extrait le int, l&#39;incrémente et l&#39;emballe dans un nouvel Integer</span>
assert n == <span class="dv">43</span>;</code></pre></div>
<p>Voici une démonstration de l'état des références pour ce qui vient de se passer :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">Integer</span> n = <span class="kw">new</span> <span class="bu">Integer</span>(<span class="dv">42</span>);
<span class="bu">Integer</span> before = n;
n++;
<span class="bu">Integer</span> after = n;
assert before != after;</code></pre></div>
<p>Avant Java 5 on devait procéder ainsi :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">Integer</span> n = <span class="kw">new</span> <span class="bu">Integer</span>(<span class="dv">42</span>);
<span class="dt">int</span> i = n.<span class="fu">intValue</span>();
i++;
n = <span class="kw">new</span> <span class="bu">Integer</span>(i);
assert n == <span class="dv">43</span>;</code></pre></div>
<p>Il faut cependant savoir que les objets créés peuvent être les mêmes pour des raisons de performance. C'est le cas des Integer plus petit que 127.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">Integer</span> i1 = <span class="dv">127</span>;
<span class="bu">Integer</span> i2 = <span class="dv">127</span>;

assert i1 == i2;</code></pre></div>
<p>En revanche dès 128, les objets créés sont différents :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">Integer</span> i1 = <span class="dv">128</span>;
<span class="bu">Integer</span> i2 = <span class="dv">128</span>;

assert i1 != i2;</code></pre></div>
<p>Il faut cependant faire très attention au référence null qui sont déballées (unboxing).</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">Integer</span> n = <span class="kw">null</span>;
<span class="dt">int</span> i = n; <span class="co">// java.lang.NullPointerException</span></code></pre></div>
<h1 id="les-collections"><span class="header-section-number">2</span> Les collections</h1>
<p>Nous avons vu jusqu'ici quelques collections concrètes : ArrayList, HashSet et HashMap.</p>
<p>La bibliothèque standard fournit un ensemble riche de collections.</p>
<p>Une collection est un conteneur qui permet de manipuler un ensemble d'objets.</p>
<p>L'API standard définit des interfaces ainsi que des implementations.</p>
<p>Les interfaces principales sont <code>List</code> <code>Set</code>, <code>Map</code>, <code>Queue</code> et <code>Deque</code>.</p>
<p>Set n'a ni de notion d'orde ni de doublon. C'est un type qui se rapproche du concept d'ensemble en mathématique.</p>
<p>List est un conteneur ordonné. On accède aux éléments par leurs index (qui commence à 0 comme les tableaux).</p>
<p>Map est un conteneur associatif. Toute valeur est indexée par une clé.</p>
<p>Queue modélise une file (premier arrivé, premier servi). Et <code>Deque</code> modélise une pile (première assiète empilée, dernière assiette nettoyée).</p>
<p>Les interfaces permettent à des programmes écrits par des équipes différentes d'être interopérables en utilisant un format universel d'échange.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">interface</span> <span class="bu">List</span> <span class="kw">extends</span> <span class="bu">Collection</span> {}
<span class="kw">interface</span> <span class="bu">Set</span> <span class="kw">extends</span> <span class="bu">Collection</span> {}</code></pre></div>
<p>Les implémentations principales de Set sont HashSet et TreeSet. Pour Map : HashMap et TreeMap.</p>
<p>Un hash ou condensat en français est une fonction cryptographique. Les hash sont utilisées en pratique pour vérifier efficacement si deux objets ont de forte chances d'etre égaux (et aussi comme signature cryptographique). Par exemple, MD5 et SHA2 sont deux fonctions de hashage. Un hash est une fonction qui possède la propriété d'être difficilement réversible. Deux plus deux éléments différents de l'ensemble des antécédants peuvent donner le même élément dans l'ensemble image. Lorsque c'est le cas on parle de collision.</p>
<p>Dit plus formellement,</p>
<pre><code>f(x) = f(y) =&gt; x = y</code></pre>
<p>Remplaçons <code>f()</code> par <code>Object.hashCode()</code>. Nous avons le lien entre <code>HashMap</code>, <code>HashSet</code> et <code>Object</code> : tout élément d'une collection de type HashSet devrait redéfinir la méthode <code>hashCode()</code> (ainsi que la méthode <code>equals(Object)</code>).</p>
<p>https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#hashCode()</p>
<p>https://docs.oracle.com/javase/tutorial/collections/intro/index.html</p>
<h2 id="exercice-22"><span class="header-section-number">2.1</span> Exercice</h2>
<p>Écrire une méthode qui calcule la somme des éléments d'une liste.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span> <span class="fu">sum</span>(<span class="bu">ArrayList</span>&lt;<span class="bu">Integer</span>&gt; collection);</code></pre></div>
<h2 id="exercice-23"><span class="header-section-number">2.2</span> Exercice</h2>
<p>Écrire une méthode qui supprime le dernier élément d'une liste non vide.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">void</span> <span class="fu">deleteLast</span>(<span class="bu">ArrayList</span>&lt;<span class="bu">Integer</span>&gt; collection);</code></pre></div>
<h2 id="exercice-24"><span class="header-section-number">2.3</span> Exercice</h2>
<p>Écrire une méthode qui place le produit des deux premiers éléments en troisième position qui place le produit du troisième élément et du quatrième en cinquième place, etc.</p>
<p>Ainsi la liste composé des éléments : {2 3 20 30} =&gt; {2 3 6 20 30 600}.</p>
<p>Pour les cas spécifique par exemple {1} =&gt; {1}.</p>
<p>Pour les cas spécifique par exemple {2 3 10} =&gt; {2 3 6 10}.</p>
<p>Utiliser le prototype suivant :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">void</span> <span class="fu">productInline</span>(<span class="bu">ArrayList</span>&lt;<span class="bu">Integer</span>&gt; collection);</code></pre></div>
<h2 id="exercice-25"><span class="header-section-number">2.4</span> Exercice</h2>
<p>Écrire une méthode qui supprime l'élément de valeur 0 d'une liste d'entiers.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">void</span> <span class="fu">deleteZero</span>(<span class="bu">ArrayList</span>&lt;<span class="bu">Integer</span>&gt; collection);</code></pre></div>
<h2 id="exercice-26"><span class="header-section-number">2.5</span> Exercice</h2>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> Person {
    <span class="kw">private</span> <span class="bu">String</span> name;
    <span class="fu">Person</span>(<span class="bu">String</span> name) {
        <span class="kw">this</span>.<span class="fu">name</span> = name;
    }
}</code></pre></div>
<p>Écrire une méthode qui supprime une personne étant donné son nom.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">void</span> <span class="fu">deleteByName</span>(<span class="bu">ArrayList</span>&lt;Person&gt; persons, <span class="bu">String</span> name);</code></pre></div>
<p>Noter qu'ici l'implémentation de <code>deleteByName()</code> doit appeler la méthode <code>getName()</code>. Cela introduit un couplage entre <code>deleteByName</code> et <code>Person</code>.</p>
<h2 id="exercice-27"><span class="header-section-number">2.6</span> Exercice</h2>
<p>Écrire une méthode qui supprime l'objet personne qui correspond à la référence (c'est à dire l'adresse de l'objet et non pas sa valeur) passée en argument. Ne plus utiliser la fonction <code>getName()</code> dans l'implémentation de <code>delete()</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">void</span> <span class="fu">delete</span>(<span class="bu">ArrayList</span>&lt;Person&gt; persons, Person personToDelete);</code></pre></div>
<p>Note sur les références :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">Object</span> a = <span class="kw">new</span> <span class="bu">Object</span>();
<span class="bu">Object</span> b = <span class="kw">new</span> <span class="bu">Object</span>();
<span class="fu">println</span>(a == b); <span class="co">// false</span>
<span class="fu">println</span>(a.<span class="fu">equals</span>(b)); <span class="co">// false</span>

<span class="bu">String</span> sa = <span class="kw">new</span> <span class="bu">String</span>(<span class="st">&quot;A&quot;</span>);
<span class="bu">String</span> sb = <span class="kw">new</span> <span class="bu">String</span>(<span class="st">&quot;A&quot;</span>);
<span class="fu">println</span>(sa == sb); <span class="co">// false</span>
<span class="fu">println</span>(sa.<span class="fu">equals</span>(sb)); <span class="co">// true</span></code></pre></div>
<p>L'implémentation par défaut de equals (c'est à dire celle définie dans la classe Object) est équivalente à l'opérateur <code>==</code>. De plus, String extends Object et redéfini la méthode equals pour calculer l'égalité en valeur (c'est à dire la suite de caractères de la chaîne).</p>
<p>Exemple d'usage :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">ArrayList</span>&lt;Person&gt; persons = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;&gt;();
Person empty = <span class="kw">new</span> <span class="fu">Person</span>(<span class="st">&quot;&quot;</span>);
persons.<span class="fu">add</span>(<span class="kw">new</span> <span class="fu">Person</span>(<span class="st">&quot;&quot;</span>));
persons.<span class="fu">add</span>(<span class="kw">new</span> <span class="fu">Person</span>(<span class="st">&quot;Mathieu&quot;</span>));
persons.<span class="fu">add</span>(empty);

<span class="fu">delete</span>(persons, empty);
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(persons); <span class="co">// [Person(&quot;&quot;), Person(&quot;Mathieu&quot;)]</span></code></pre></div>
<h2 id="exercice-28"><span class="header-section-number">2.7</span> Exercice</h2>
<p>Modifier la méthode <code>delete()</code> pour faire une selection en valeur.</p>
<p>Exemple d'usage :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">ArrayList</span>&lt;Person&gt; persons = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;&gt;();
persons.<span class="fu">add</span>(<span class="kw">new</span> <span class="fu">Person</span>(<span class="st">&quot;&quot;</span>));
persons.<span class="fu">add</span>(<span class="kw">new</span> <span class="fu">Person</span>(<span class="st">&quot;Mathieu&quot;</span>));
persons.<span class="fu">add</span>(<span class="kw">new</span> <span class="fu">Person</span>(<span class="st">&quot;&quot;</span>));

<span class="fu">delete</span>(persons, <span class="kw">new</span> <span class="fu">Person</span>(<span class="st">&quot;&quot;</span>));
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(persons); <span class="co">// [Person(&quot;Mathieu&quot;)]</span></code></pre></div>
<h2 id="exercice-29"><span class="header-section-number">2.8</span> Exercice</h2>
<p>Écrire une méthode modifie une liste de nombre de tel sorte à remplacer chaque paire de nombre par leur produit puis qui effectue une somme du résultat.</p>
<p>Par exemple, <code>{1 2 10 20}</code> =&gt; <code>{2 200}</code> =&gt; <code>{202}</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">void</span> <span class="fu">sumOfProduct</span>(<span class="bu">ArrayList</span>&lt;<span class="bu">Integer</span>&gt; collection);</code></pre></div>
<h2 id="exercice-30"><span class="header-section-number">2.9</span> Exercice</h2>
<p>Écrire une méthode qui transfère le contenu d'une ArrayList dans une autre. Le contenu de la source doit être ajouté à la fin de la destination. La source doit être vide à la fin de l'opération. Respecter le prototype suivant :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">void</span> <span class="fu">move</span>(<span class="bu">ArrayList</span>&lt;<span class="bu">Integer</span>&gt; source, <span class="bu">ArrayList</span>&lt;<span class="bu">Integer</span>&gt; destination);</code></pre></div>
<p>Utiliser uniquement les méthodes de la classe ArrayList (voir https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/util/ArrayList.html).</p>
<h2 id="exercice-31"><span class="header-section-number">2.10</span> Exercice</h2>
<p>Faire le même traitement sur une LinkedList. Utiliser le prototype suivant :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">void</span> <span class="fu">move</span>(<span class="bu">LinkedList</span>&lt;<span class="bu">Integer</span>&gt; source, <span class="bu">LinkedList</span>&lt;<span class="bu">Integer</span>&gt; destination);</code></pre></div>
<h2 id="exercice-32"><span class="header-section-number">2.11</span> Exercice</h2>
<p>Réécrire une version de move qui généralise le type de ses paramètres. Respecter le prototype suivant :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">void</span> <span class="fu">move</span>(<span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; source, <span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; destination);</code></pre></div>
<h2 id="exercice-33"><span class="header-section-number">2.12</span> Exercice</h2>
<p>Réécrire une version de move qui généralise encore plus le type de ses paramètres. Respecter le prototype suivant :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">void</span> <span class="fu">move</span>(<span class="bu">Collection</span>&lt;<span class="bu">Integer</span>&gt; source, <span class="bu">Collection</span>&lt;<span class="bu">Integer</span>&gt; destination);</code></pre></div>
<p>Essayer de remplacer Collection par Object dans la signature de la méthode. Que se passe-t'il ?</p>
<h2 id="classe-mère"><span class="header-section-number">2.13</span> Classe mère</h2>
<p>Object est la classe mère de toute classe. Ce n'est pas le cas des interfaces.</p>
<h2 id="exercice-34"><span class="header-section-number">2.14</span> Exercice</h2>
<p>Écrire une méthode de recherche qui renvoie l'indice d'un élément dans une liste, -1 sinon.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span> <span class="fu">find</span>(<span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; collection, <span class="dt">int</span> element);</code></pre></div>
<h2 id="exercice-35"><span class="header-section-number">2.15</span> Exercice</h2>
<p>Écrire une méthode de recherche qui renvoie une liste des indices des éléments trouvés dans une liste, la liste vide sinon.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; <span class="fu">find</span>(<span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; collection, <span class="dt">int</span> element);</code></pre></div>
<p>Exemple d'usage,</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; numbers = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;&gt;();
numbers.<span class="fu">add</span>(<span class="dv">1</span>);
numbers.<span class="fu">add</span>(<span class="dv">2</span>);
numbers.<span class="fu">add</span>(<span class="dv">3</span>);
numbers.<span class="fu">add</span>(<span class="dv">2</span>);
<span class="fu">println</span>(<span class="fu">find</span>(numbers, <span class="dv">2</span>)); <span class="co">// [1, 3]</span></code></pre></div>
<h2 id="exercice-36"><span class="header-section-number">2.16</span> Exercice</h2>
<p>Écrire une méthode qui extrait une sous liste à partir d'une liste d'élements et d'une liste d'index.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; <span class="fu">extract</span>(<span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; collection, <span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; indices);</code></pre></div>
<p>Exemple d'usage,</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; numbers = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;&gt;();
numbers.<span class="fu">add</span>(<span class="dv">1</span>);
numbers.<span class="fu">add</span>(<span class="dv">2</span>);
numbers.<span class="fu">add</span>(<span class="dv">3</span>);
numbers.<span class="fu">add</span>(<span class="dv">2</span>);
<span class="fu">println</span>(<span class="fu">extract</span>(numbers, <span class="bu">Arrays</span>.<span class="fu">asList</span>(<span class="dv">1</span>, <span class="dv">2</span>))); <span class="co">// [2, 2]</span></code></pre></div>
<p>Tester que <code>extract(find(list, e))</code> est vide ou bien contient un ou plusieurs élément <code>e</code>.</p>
<h2 id="exercice-37"><span class="header-section-number">2.17</span> Exercice</h2>
<p>Écrire une méthode qui retourne une copie de la liste où seuls les éléments impairs on été conservés.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; <span class="fu">filterOdds</span>(<span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; collection);</code></pre></div>
<h2 id="exercice-38"><span class="header-section-number">2.18</span> Exercice</h2>
<p>Écrire une méthode qui retourne une copie de la liste où seuls les éléments multiple de 3 on été conservés.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; <span class="fu">filterMultipleOf3</span>(<span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; collection);</code></pre></div>
<p>Puis réécrire la méthode avec la signature plus générale :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; <span class="fu">filterMultipleOf</span>(<span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; collection, <span class="dt">int</span> modulo);</code></pre></div>
<h2 id="exercice-39"><span class="header-section-number">2.19</span> Exercice</h2>
<p>Jusqu'ici on a commencé par hardcoder le filtre dans la méthode :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">if</span> (e % <span class="dv">2</span> == <span class="dv">0</span>) {}</code></pre></div>
<p>puis on a paramétré la valeur du modulo :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">if</span> (e % modulo == <span class="dv">0</span>) {}</code></pre></div>
<p>Comment paramétrer non seulement la valeur (ici 2 paramétré en modulo) mais aussi les opérateurs (ici % et ==) ?</p>
<ol style="list-style-type: decimal">
<li>Réimplémenter la méthode filterMultipleOf3 en extrayant une nouvelle méthode <code>boolean accept(int n)</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> IntFilters {
    <span class="dt">static</span> <span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; <span class="fu">filterMultipleOf3</span>(<span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; collection) {
        ...
        <span class="kw">for</span> ...
            <span class="kw">if</span> (<span class="fu">accept</span>(n)) ...
        <span class="kw">return</span> ...
    }
    <span class="kw">private</span> <span class="dt">boolean</span> <span class="fu">accept</span>(<span class="dt">int</span> n) { <span class="co">// nouvelle méthode</span>
        <span class="kw">return</span> n % <span class="dv">3</span> == <span class="dv">0</span>;
    }
}</code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Extraire une classe à partir de la méthode précédament extraite</li>
</ol>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> IntFilters {
    <span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; <span class="fu">filterMultipleOf3</span>(<span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; collection) {
        ...
        <span class="kw">for</span> ...
            <span class="kw">if</span> (<span class="kw">new</span> <span class="fu">MultipleFilter</span>(<span class="dv">3</span>).<span class="fu">accept</span>(n)) ...
        <span class="kw">return</span> ...
    }
}
<span class="kw">class</span> MultipleFilter {
    <span class="kw">private</span> <span class="dt">int</span> modulo;
    <span class="fu">MultipleFilter</span>(<span class="dt">int</span> modulo) {
        <span class="kw">this</span>.<span class="fu">modulo</span> = modulo;
    }
    <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">accept</span>(<span class="dt">int</span> n) {
        <span class="kw">return</span> n % modulo == <span class="dv">0</span>;
    }
}</code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Extraire comme paramètre selon le prototype suivants :</li>
</ol>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> IntFilters {
    <span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; <span class="fu">filterMultipleOf</span>(<span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; collection, MultipleFilter predicate);
}</code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Extraire une interface à partir de la classe MultipleFilter :</li>
</ol>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">interface</span> IntFilter {
    <span class="dt">boolean</span> <span class="fu">accept</span>(<span class="dt">int</span> n);
}
<span class="kw">class</span> MultipleFilter <span class="kw">implements</span> IntFilter {
    ...
}
<span class="kw">class</span> IntFilters {
    <span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; <span class="fu">filter</span>(<span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; collection, IntFilter predicate) {
        ...
    }
}</code></pre></div>
<h3 id="exercice-40"><span class="header-section-number">2.19.1</span> Exercice</h3>
<p>Trier une liste d'entiers en ordre croissant en utilisant une méthode de la classe <code>Collections</code>. Chercher dans la javadoc.</p>
<p>https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Collections.html</p>
<h3 id="exercice-41"><span class="header-section-number">2.19.2</span> Exercice</h3>
<p>Trier une liste de <code>Person</code> par age. Utiliser la surcharge <code>Collections.sort(List&lt;T&gt; list, Comparator&lt;? super T&gt; c)</code>. Utiliser la définition de <code>Person</code> suivante :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> Person {
    <span class="kw">private</span> <span class="dt">int</span> age;
    <span class="fu">Person</span>(<span class="dt">int</span> age) {
        <span class="kw">this</span>.<span class="fu">age</span> = age;
    }
    <span class="dt">int</span> <span class="fu">getAge</span>() {
        <span class="kw">return</span> age;
    }
}</code></pre></div>
<p>Le comparateur est un mécanisme par lequel un développeur peut modifier l'ordre naturel d'une classe. L'ordre naturel d'une classe est défini par implémentation à <code>Comparable</code>. Par exemple, <code>String</code> et <code>Integer</code> implémentent <code>Comparable</code>. Pour les classes qui ne l'implémentent pas ou bien dont l'implémentation n'est pas satisfaisante, on utilisera un comparateur.</p>
<p>https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Comparator.html</p>
<h3 id="exercice-42"><span class="header-section-number">2.19.3</span> Exercice</h3>
<p>Trier une liste de Person par age, pour les personnes du même age trier par nom. Coder la logique d'ordre dans un comparateur.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> Person {
    <span class="kw">private</span> <span class="bu">String</span> name;
    <span class="kw">private</span> <span class="dt">int</span> age;
    <span class="fu">Person</span>(<span class="bu">String</span> name, <span class="dt">int</span> age) {
        <span class="kw">this</span>.<span class="fu">name</span> = name;
        <span class="kw">this</span>.<span class="fu">age</span> = age;
    }
    <span class="bu">String</span> <span class="fu">getName</span>() {
        <span class="kw">return</span> name;
    }
    <span class="dt">int</span> <span class="fu">getAge</span>() {
        <span class="kw">return</span> age;
    }
}</code></pre></div>
<h3 id="exercice-43"><span class="header-section-number">2.19.4</span> Exercice</h3>
<p>Trier par une liste d'employés par nom de service puis par le nom d'employé. Utiliser un comparateur.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> Employee {
    <span class="kw">private</span> <span class="bu">String</span> name;
    <span class="kw">private</span> BusinessUnit businessUnit;

    <span class="fu">Employee</span>(<span class="bu">String</span> name, BusinessUnit businessUnit) {
        <span class="kw">this</span>.<span class="fu">name</span> = name;
        <span class="kw">this</span>.<span class="fu">businessUnit</span> = businessUnit;
    }

    <span class="bu">String</span> <span class="fu">getName</span>() {
        <span class="kw">return</span> name;
    }

    BusinessUnit <span class="fu">getBusinessUnit</span>() {
        <span class="kw">return</span> businessUnit;
    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span>() {
        <span class="kw">return</span> <span class="st">&quot;Employee{&quot;</span> +
                <span class="st">&quot;name=&#39;&quot;</span> + name + <span class="ch">&#39;\&#39;&#39;</span> +
                <span class="st">&quot;, businessUnit=&quot;</span> + businessUnit +
                <span class="ch">&#39;}&#39;</span>;
    }
}

<span class="kw">class</span> BusinessUnit {
    <span class="kw">private</span> <span class="bu">String</span> name;

    <span class="fu">BusinessUnit</span>(<span class="bu">String</span> name) {
        <span class="kw">this</span>.<span class="fu">name</span> = name;
    }

    <span class="bu">String</span> <span class="fu">getName</span>() {
        <span class="kw">return</span> name;
    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span>() {
        <span class="kw">return</span> <span class="st">&quot;BusinessUnit{&quot;</span> +
                <span class="st">&quot;name=&#39;&quot;</span> + name + <span class="ch">&#39;\&#39;&#39;</span> +
                <span class="ch">&#39;}&#39;</span>;
    }
}</code></pre></div>
<h3 id="exercice-44"><span class="header-section-number">2.19.5</span> Exercice</h3>
<p>Trier par une liste d'employés par nom de service puis par le nom d'employé. Ne pas utiliser de comparateur. À la place faire <code>Employee</code> et <code>BusinessUnit</code> implémenter <code>Comparable</code>.</p>
<h2 id="list-les-pièges"><span class="header-section-number">2.20</span> List : les pièges</h2>
<h3 id="surcharges-de-remove"><span class="header-section-number">2.20.1</span> Surcharges de remove</h3>
<p>Ne pas confondre les surcharges <code>List.remove(int)</code> et <code>List.remove(Object)</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; elements = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;&gt;();
...
<span class="bu">Integer</span> i = <span class="dv">0</span>;
elements.<span class="fu">remove</span>(i);</code></pre></div>
<p>Dans l'extrait précédant, le premier élément qui a la valeur 0 sera supprimé et non pas le premier élément de la liste.</p>
<h3 id="modifications-concurrentes"><span class="header-section-number">2.20.2</span> Modifications concurrentes</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; list = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;&gt;();
<span class="kw">for</span> (<span class="bu">Integer</span> element : list) {
    list.<span class="fu">remove</span>(<span class="bu">Integer</span>.<span class="fu">valueOf</span>(<span class="dv">0</span>)); <span class="co">// ConcurrentModificationException</span>
}</code></pre></div>
<p>Une exception est lancée quand on parcours une collection avec une boucle for-each pendant qu'on modifie la collection.</p>
<p>https://docs.oracle.com/javase/8/docs/api/java/util/ConcurrentModificationException.html</p>
<p>En aparté, la syntaxe for-each est un sucre syntaxique. Le compilateur génère une boucle for traditionnelle et fait appel à un <code>Iterator</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">void</span> <span class="fu">printAll</span>(<span class="bu">Collection</span>&lt;Person&gt; c) {
    <span class="kw">for</span> (<span class="bu">Iterator</span>&lt;Person&gt; i = c.<span class="fu">iterator</span>(); i.<span class="fu">hasNext</span>(); ) {
        <span class="fu">println</span>(i.<span class="fu">next</span>());
    }
}</code></pre></div>
<p>https://docs.oracle.com/javase/1.5.0/docs/guide/language/foreach.html</p>
<h2 id="les-séquence-déléments-stream"><span class="header-section-number">2.21</span> Les séquence d'éléments (Stream)</h2>
<p>Les Stream supportent des opérations séquentielle ou parallèle dans un pipeline de transformation.</p>
<p>Cette API est un style de pipe et filtre.</p>
<h1 id="les-flux"><span class="header-section-number">3</span> Les Flux</h1>
<h2 id="flux-de-caractères"><span class="header-section-number">3.1</span> Flux de caractères</h2>
<h3 id="lire-un-caractère-à-partir-dun-fichier"><span class="header-section-number">3.1.1</span> Lire un caractère à partir d'un fichier</h3>
<p>Pour lire un fichier texte, on utilise par commodité la classe <code>FileReader</code>.</p>
<p>Le constructeur ouvre une connexion au fichier (représenté par un descripteur de fichier).</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="co">// nom de fichier : data.txt</span>
<span class="bu">FileReader</span> inputStream = <span class="kw">new</span> <span class="bu">FileReader</span>(<span class="st">&quot;data.txt&quot;</span>);</code></pre></div>
<p>Attention, une <code>java.io.FileNotFoundException</code> est jetée si :</p>
<ul>
<li>le nom de fichier ne correspond aucun fichier ou ;</li>
<li>il représente un répertoire ou ;</li>
<li>pour une autre obscure raison.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span> c = inputStream.<span class="fu">read</span>();</code></pre></div>
<p>Cette méthode bloque jusqu'à ce que :</p>
<ul>
<li>un caractère soit disponible ;</li>
<li>la fin du fichier soit atteinte ;</li>
<li>une erreur d'entrée sortie survienne.</li>
</ul>
<p>La méthode <code>read()</code> :</p>
<ul>
<li>renvoie le caractère lu, comme un entier entre 0 et 65535 (0x00-0xffff) ;</li>
<li>vaut <code>-1</code> si la fin du fichier est atteinte ;</li>
<li>jette une <code>java.io.IOException</code> en cas d'erreur.</li>
</ul>
<h3 id="écrire-un-caractère-dans-un-fichier"><span class="header-section-number">3.1.2</span> Écrire un caractère dans un fichier</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">FileWriter</span> outputStream = <span class="kw">new</span> <span class="bu">FileWriter</span>(<span class="st">&quot;out.txt&quot;</span>);</code></pre></div>
<p>Crée un descripteur de fichier représentant la connexion au fichier. De plus, un fichier &quot;out.txt&quot; est créé sur le disque.</p>
<p>Attention, une <code>java.io.IOException</code> peut-être jetée :</p>
<ul>
<li>si le nom correspond à un répertoire ;</li>
<li>si le fichier ne peut-être créé ou ouvert.</li>
</ul>
<p>Pour écrire un caractère :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span> a = <span class="dv">97</span>;
outputStream.<span class="fu">write</span>(a);</code></pre></div>
<p>Le caractère à écrire doit être contenu dans les 16 bits de poids faible de l'entier passé en paramètre. Les 16 bits de poids forts sont ignorés.</p>
<h3 id="exercice-1-2"><span class="header-section-number">3.1.3</span> Exercice 1</h3>
<p>Écrire un programme de copie de fichier texte.</p>
<ul>
<li>Créer un fichier &quot;input.txt&quot; contenant le texte &quot;hello world&quot;.</li>
<li>Le programme doit créer un fichier &quot;output.txt&quot; contenant le texte &quot;hello world&quot;.</li>
</ul>
<p>Modifiez ce programme de sorte de sorte de faire une mutation dans les bits de poids forts du caractère à écrire :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span> a = (<span class="dv">1</span> &lt;&lt; <span class="dv">16</span>) | c;
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(a);
outputStream.<span class="fu">write</span>(c);</code></pre></div>
<p>Le fichier &quot;output.txt&quot; devrait toujours être la copie exacte du fichier &quot;input.txt&quot;.</p>
<h3 id="exercice-2-2"><span class="header-section-number">3.1.4</span> Exercice 2</h3>
<p>Écrire un programme qui copie un fichier à la fin d'un autre fichier.</p>
<ul>
<li>Éditer le fichier &quot;input.txt&quot; et écrire &quot;bépo&quot;.</li>
<li>Lancer le programme 2 fois : le fichier destination doit contenir &quot;bépobépo&quot;.</li>
</ul>
<h3 id="exercice-3-1"><span class="header-section-number">3.1.5</span> Exercice 3</h3>
<ul>
<li>Éditer le fichier &quot;input.txt&quot; avec IntelliJ.</li>
<li>Modifier l'encodage à ISO-8859-1.</li>
<li>Relancer le programme.</li>
<li>Observer l'erreur dans le fichier destination.</li>
</ul>
<h3 id="corrections"><span class="header-section-number">3.1.6</span> Corrections</h3>
<p>Exercice 1 : voici une première version incomplète :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">FileReader</span> fileReader = <span class="kw">new</span> <span class="bu">FileReader</span>(<span class="st">&quot;input.txt&quot;</span>);
<span class="bu">FileWriter</span> fileWriter = <span class="kw">new</span> <span class="bu">FileWriter</span>(<span class="st">&quot;output.txt&quot;</span>);
fileWriter.<span class="fu">write</span>(fileReader.<span class="fu">read</span>());</code></pre></div>
<p>Avec le fichier input.txt contenant la ligne :</p>
<pre><code>hello world</code></pre>
<p>Le programme crée un fichier <code>output.txt</code> qui a le mauvais goût d'être <em>vide</em>.</p>
<p>Deuxième version en fermant le fichier de sortie :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">FileReader</span> fileReader = <span class="kw">new</span> <span class="bu">FileReader</span>(<span class="st">&quot;input.txt&quot;</span>);
<span class="bu">FileWriter</span> fileWriter = <span class="kw">new</span> <span class="bu">FileWriter</span>(<span class="st">&quot;output.txt&quot;</span>);
fileWriter.<span class="fu">write</span>(fileReader.<span class="fu">read</span>());
fileWriter.<span class="fu">close</span>();</code></pre></div>
<p>Le fichier output.txt contiendra une seule lettre : <code>h</code>.</p>
<p>Dernière version sans gestion d'exception (cf. « Les exceptions ») :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> fr.arolla.java8esgi.basicio.ex1;</span>

<span class="kw">import</span><span class="im"> java.io.FileReader;</span>
<span class="kw">import</span><span class="im"> java.io.FileWriter;</span>
<span class="kw">import</span><span class="im"> java.io.IOException;</span>

<span class="kw">public</span> <span class="kw">class</span> Ex1 {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">IOException</span> {
        <span class="bu">FileReader</span> fileReader = <span class="kw">new</span> <span class="bu">FileReader</span>(<span class="st">&quot;input.txt&quot;</span>);
        <span class="bu">FileWriter</span> fileWriter = <span class="kw">new</span> <span class="bu">FileWriter</span>(<span class="st">&quot;output.txt&quot;</span>);

        <span class="dt">int</span> character;
        <span class="kw">while</span> ((character = fileReader.<span class="fu">read</span>()) != -<span class="dv">1</span>) {
            fileWriter.<span class="fu">write</span>(character);
        }
        fileWriter.<span class="fu">close</span>(); <span class="co">// déclenche l&#39;écriture sur disque</span>
        fileReader.<span class="fu">close</span>(); <span class="co">// rend les ressource à l&#39;OS</span>
    }
}</code></pre></div>
<p>On pourra réécrire ce programme de la manière suivante pour localiser la logique de copie :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">IOException</span> {
    <span class="bu">FileReader</span> reader = <span class="kw">new</span> <span class="bu">FileReader</span>(<span class="st">&quot;input.txt&quot;</span>);
    <span class="bu">FileWriter</span> writer = <span class="kw">new</span> <span class="bu">FileWriter</span>(<span class="st">&quot;output.txt&quot;</span>);

    <span class="fu">copy</span>(reader, writer);

    writer.<span class="fu">close</span>();
    reader.<span class="fu">close</span>();
}

<span class="kw">private</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">copy</span>(<span class="bu">FileReader</span> fileReader, <span class="bu">FileWriter</span> fileWriter) <span class="kw">throws</span> <span class="bu">IOException</span> {
    <span class="dt">int</span> character;
    <span class="kw">while</span> ((character = fileReader.<span class="fu">read</span>()) != -<span class="dv">1</span>) {
        fileWriter.<span class="fu">write</span>(character);
    }
}</code></pre></div>
<p>Exercice 2 : pour écrire à la fin du fichier on activera le mode <code>append</code> :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">IOException</span> {
    <span class="bu">FileReader</span> reader = <span class="kw">new</span> <span class="bu">FileReader</span>(<span class="st">&quot;input.txt&quot;</span>);
    <span class="bu">FileWriter</span> writer = <span class="kw">new</span> <span class="bu">FileWriter</span>(<span class="st">&quot;output.txt&quot;</span>, <span class="kw">true</span>);

    <span class="fu">copy</span>(reader, writer);

    writer.<span class="fu">close</span>();
    reader.<span class="fu">close</span>();
}</code></pre></div>
<p>Exercice 3 : en modifiant l'encodage du fichier input.txt à ISO-8859-1, le fichier output pourra ressembler à :</p>
<pre><code>b?po</code></pre>
<p>On a perdu de l'information. On a un <em>bug</em> !</p>
<h2 id="flux-doctets"><span class="header-section-number">3.2</span> Flux d'octets</h2>
<h3 id="lecture"><span class="header-section-number">3.2.1</span> Lecture</h3>
<p>Pour ouvrir en lecture un flux de bytes bruts (sans décodage) :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">FileInputStream</span> in = <span class="kw">new</span> <span class="bu">FileInputStream</span>(<span class="st">&quot;input.txt&quot;</span>);</code></pre></div>
<h3 id="écriture"><span class="header-section-number">3.2.2</span> Écriture</h3>
<p>Pour ouvrir un flux en écriture de bytes bruts (sans encodage) :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">FileOutputStream</span> out = <span class="kw">new</span> <span class="bu">FileOutputStream</span>(<span class="st">&quot;output.txt&quot;</span>);</code></pre></div>
<h3 id="lecture-et-écriture"><span class="header-section-number">3.2.3</span> Lecture et écriture</h3>
<p>Le protocole <code>c = in.read()</code> et <code>out.write(c)</code> sont identique à <code>FileReader</code> et <code>FileWriter</code>.</p>
<h3 id="exercice-4-1"><span class="header-section-number">3.2.4</span> Exercice 4</h3>
<ul>
<li>Reprendre le fichier ISO-8859-1 de l'exercice 3.</li>
<li>Écrire un programme de copie non sensible à l'encodage par défaut de Java.</li>
</ul>
<h3 id="exercice-5-1"><span class="header-section-number">3.2.5</span> Exercice 5</h3>
<ul>
<li>Reprendre le fichier ISO-8859-1 de l'exercice 4.</li>
<li>Relancer le programme de l'exercice 4 en modifiant le chemin courant (run configurations, working directory).</li>
</ul>
<h3 id="corrections-1"><span class="header-section-number">3.2.6</span> Corrections</h3>
<p>Pour corriger le bug d'encodage on utilisera des flux orientés octets qui n'interprètent pas la séquence d'octets lue.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> fr.arolla.java8esgi.basicio.ex4;</span>

<span class="kw">import</span><span class="im"> java.io.*;</span>

<span class="kw">public</span> <span class="kw">class</span> Ex4 {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">IOException</span> {
        <span class="bu">FileInputStream</span> reader = <span class="kw">new</span> <span class="bu">FileInputStream</span>(<span class="st">&quot;input.txt&quot;</span>);
        <span class="bu">FileOutputStream</span> writer = <span class="kw">new</span> <span class="bu">FileOutputStream</span>(<span class="st">&quot;output.txt&quot;</span>, <span class="kw">true</span>);

        <span class="fu">copy</span>(reader, writer);

        writer.<span class="fu">close</span>();
        reader.<span class="fu">close</span>();
    }

    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">copy</span>(<span class="bu">FileInputStream</span> fileReader, <span class="bu">FileOutputStream</span> fileWriter) 
        <span class="kw">throws</span> <span class="bu">IOException</span> {
        <span class="dt">int</span> character;
        <span class="kw">while</span> ((character = fileReader.<span class="fu">read</span>()) != -<span class="dv">1</span>) {
            fileWriter.<span class="fu">write</span>(character);
        }
    }
}</code></pre></div>
<h3 id="résumé-1"><span class="header-section-number">3.2.7</span> Résumé</h3>
<table>
<thead>
<tr class="header">
<th>Ouvrir</th>
<th>Fermer</th>
<th>Lire</th>
<th>Écrire</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>new</td>
<td>close</td>
<td>read</td>
<td>write</td>
</tr>
</tbody>
</table>
<p>Tout programme se voit attribuer un répertoire courant (CWD). Ce chemin devient la racine de tout les fichiers dénotés par des chemins relatifs.</p>
<p>Tenter d'ouvrir une connexion à un fichier qui n'existe pas lève une exception :</p>
<pre><code>Exception in thread &quot;main&quot; java.io.FileNotFoundException: input.txt (Le fichier spécifié est introuvable)</code></pre>
<p>Écrire dans un fichier avec <code>write(int)</code> ne garanti pas que les données seront effectivement écrites physiquement (par exemple sur disque). Pour garantir que les octets sauvés dans un tampon (par des appels à <code>write</code>) sont effectivement écrit par le système d'exploitation il faut utiliser <code>flush()</code>.</p>
<p>Quand on a terminé d'utiliser la connexion au fichier, il est recommandé de le fermer en utilisant <code>close()</code>. Par ailleurs, avant que la connexion soit fermée, les octets restant dans le tampon sont déchargés avec <code>flush()</code>. L'idiome de programmation est donc d'utiliser <code>close()</code> mais pas <code>flush()</code>.</p>
<p>Attention, une fois la connexion au fichier fermée on ne peut plus écrire dedans. Cela donne le message suivant :</p>
<pre><code>Exception in thread &quot;main&quot; java.io.IOException: Stream closed</code></pre>
<p>Quand un programme effectue des entrées/sorties, il utilise des ressources chères et limitées. La méthode <code>close()</code> les libère.</p>
<p>Les <code>Reader</code> et <code>Writer</code> sont orientés caractères tandis que <code>InputStream</code> et <code>OutputStream</code> sont orientés octets. L'interprétation des octets en caractères par <code>Reader</code> et <code>Writer</code> est faite par ses classes. En revanche, les classes <code>InputStream</code> et <code>OutputStream</code> laissent le développeur décider de la sémantique à donner au flux d'octets.</p>
<h2 id="file-et-path"><span class="header-section-number">3.3</span> File et Path</h2>
<p><code>C:\Users\mathieupauly\AppData\Local\Temp</code> ou <code>/tmp</code> sont des chemins absolus de fichier. Ils représentent tout 2 un répertoire.</p>
<p><code>Temp</code> est un chemin relatif.</p>
<p>En Java, un chemin est représenté par la classe <code>java.nio.file.Path</code>.</p>
<p>Dans le vocabulaire de <code>Path</code>, <code>Temp</code> est le <code>fileName</code>, <code>C:\Users\mathieupauly\AppData\Local\Temp</code> est le <code>parent</code>, et <code>C:\</code> le <code>root</code>.</p>
<h3 id="chemin-constant"><span class="header-section-number">3.3.1</span> Chemin constant</h3>
<p>Représenter un chemin :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Path p = Paths.<span class="fu">get</span>(<span class="st">&quot;/tmp/foo&quot;</span>);</code></pre></div>
<p>Attention, cela ne fait pas d'opération sur le système de fichier.</p>
<p>Pour récupérer le répertoire parent d'un chemin :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Path example = Paths.<span class="fu">get</span>(<span class="st">&quot;example.txt&quot;</span>);

Path parent = example.<span class="fu">getParent</span>(); <span class="co">// null</span>
Path root = path.<span class="fu">getRoot</span>(); <span class="co">// null</span>
Path fileName = path.<span class="fu">getFileName</span>(); <span class="co">// example.txt</span></code></pre></div>
<p>Ici le parent était <code>null</code> car il ne contient que la composante <code>fileName</code>.</p>
<p>En revanche, quand on transforme le premier chemin en chemin absolu :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Path example = Paths.<span class="fu">get</span>(<span class="st">&quot;example.txt&quot;</span>).<span class="fu">toAbsolutePath</span>(); 
<span class="co">// C:\Users\mathieupauly\Documents\java8-esgi\java8-esgi-examples\example.txt</span>

Path parent = example.<span class="fu">getParent</span>();
<span class="co">// C:\Users\mathieupauly\Documents\java8-esgi\java8-esgi-examples</span></code></pre></div>
<p>Pour représenter un chemin avec 2 composantes (un répertoire contenant un fichier) :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Path p = Paths.<span class="fu">get</span>(<span class="st">&quot;examples&quot;</span>, <span class="st">&quot;hello.txt&quot;</span>);</code></pre></div>
<p>Dans ce cas, le <code>root</code> de <code>p</code> sera <code>null</code>, et son <code>parent</code> vaudra <code>examples</code>.</p>
<h3 id="exercice-6-1"><span class="header-section-number">3.3.2</span> Exercice 6</h3>
<p>Écrire un programme qui affiche le chemin absolu du répertoire courant.</p>
<h3 id="composer-et-décomposer-un-chemin"><span class="header-section-number">3.3.3</span> Composer et décomposer un chemin</h3>
<p>Pour concatèner (ou résoudre) 2 composants d'un chemin.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Path p = Paths
    .<span class="fu">get</span>(<span class="st">&quot;auie&quot;</span>)
    .<span class="fu">resolve</span>(<span class="st">&quot;tsrn&quot;</span>); <span class="co">// auie\tsrn</span></code></pre></div>
<p>Attention, si le composant de droite est absolu, le chemin de gauche est ignoré.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Path p = Paths
    .<span class="fu">get</span>(<span class="st">&quot;auie&quot;</span>)
    .<span class="fu">resolve</span>(<span class="st">&quot;C:</span><span class="sc">\\</span><span class="st">tsrn&quot;</span>); <span class="co">// C:\tsrn</span></code></pre></div>
<p>L'opération inverse de décomposition (ou relativisation) consiste à trouver un chemin entre 2 points (eux mêmes représentés par des chemins).</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Path p1 = Paths.<span class="fu">get</span>(<span class="st">&quot;eee&quot;</span>);
Path p2 = Paths.<span class="fu">get</span>(<span class="st">&quot;ttttt&quot;</span>);
Path navigation = p1.<span class="fu">relativize</span>(p2);  <span class="co">// ..\ttttt</span></code></pre></div>
<p>Exemple avec des chemins absolus.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Path p1 = Paths.<span class="fu">get</span>(<span class="st">&quot;C:</span><span class="sc">\\</span><span class="st">Users</span><span class="sc">\\</span><span class="st">mathieupauly&quot;</span>);
Path p2 = Paths.<span class="fu">get</span>(<span class="st">&quot;C:</span><span class="sc">\\</span><span class="st">Program Files (x86)&quot;</span>);
Path navigation = p1.<span class="fu">relativize</span>(p2); <span class="co">// ..\..\Program Files (x86)</span></code></pre></div>
<h3 id="exercice-7-1"><span class="header-section-number">3.3.4</span> Exercice 7</h3>
<p>Écrire un programme qui crée autant de fichier que spécifié en argument.</p>
<ul>
<li>Si on lance le programme avec 10 comme argument, on doit créer 10 fichiers vides nommés 1.txt, 2.txt, etc.</li>
<li>Les fichiers doivent être créés dans le répertoire temporaire <code>System.getProperty(&quot;java.io.tmpdir&quot;)</code>.</li>
</ul>
<h3 id="lister-et-créer-un-répertoire"><span class="header-section-number">3.3.5</span> Lister et créer un répertoire</h3>
<p>Pour lire le contenu d'un dossier :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Path currentDirectory = Paths.<span class="fu">get</span>(<span class="st">&quot;.&quot;</span>);
DirectoryStream&lt;Path&gt; content = Files.<span class="fu">newDirectoryStream</span>(currentDirectory);
<span class="kw">for</span> (Path p : content) {
    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(p);
}
<span class="co">// .\.idea</span>
<span class="co">// .\input.txt</span>
<span class="co">// .\java8-esgi-examples.iml</span>
<span class="co">// .\output.txt</span>
<span class="co">// .\pom.xml</span>
<span class="co">// .\src</span>
<span class="co">// .\target</span></code></pre></div>
<p>Pour créer un dossier :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Files.<span class="fu">createDirectory</span>(Paths.<span class="fu">get</span>(<span class="st">&quot;example&quot;</span>));</code></pre></div>
<p>Si on essaie de créer un dossier qui existe déjà, une exception est levée : <code>java.nio.file.FileAlreadyExistsException: example</code>.</p>
<p>Pour savoir si un chemin dénote un répertoire :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">boolean</span> directory = Files.<span class="fu">isDirectory</span>(Paths.<span class="fu">get</span>(<span class="st">&quot;.&quot;</span>)); <span class="co">// true</span></code></pre></div>
<h3 id="corrections-2"><span class="header-section-number">3.3.6</span> Corrections</h3>
<p>L'exercice 6 : en première approximation on peut calculer le chemin absolu :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(Paths.<span class="fu">get</span>(<span class="st">&quot;.&quot;</span>).<span class="fu">toAbsolutePath</span>());
<span class="co">// C:\Users\mathieupauly\Documents\java8-esgi\java8-esgi-examples\.</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(Paths.<span class="fu">get</span>(<span class="st">&quot;.&quot;</span>).<span class="fu">toAbsolutePath</span>().<span class="fu">normalize</span>());
<span class="co">// C:\Users\mathieupauly\Documents\java8-esgi\java8-esgi-examples</span></code></pre></div>
<p>On pourra plus simplement utiliser :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="bu">System</span>.<span class="fu">getProperty</span>(<span class="st">&quot;user.dir&quot;</span>));</code></pre></div>
<p>Ou également :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="kw">new</span> <span class="bu">File</span>(<span class="st">&quot;.&quot;</span>).<span class="fu">getCanonicalFile</span>());</code></pre></div>
<p>Exercice 7 :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> fr.arolla.java8esgi.basicio;</span>

<span class="kw">import</span><span class="im"> java.io.FileWriter;</span>
<span class="kw">import</span><span class="im"> java.io.IOException;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Files;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Path;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Paths;</span>

<span class="kw">public</span> <span class="kw">class</span> Ex7 {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">IOException</span> {
        <span class="bu">String</span> temporaryDirectory = <span class="bu">System</span>.<span class="fu">getProperty</span>(<span class="st">&quot;java.io.tmpdir&quot;</span>);
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">1</span>; i &lt;= <span class="dv">10</span>; i++) {
            Path path = Paths.<span class="fu">get</span>(temporaryDirectory, i + <span class="st">&quot;.txt&quot;</span>);
            <span class="kw">new</span> <span class="bu">FileWriter</span>(path.<span class="fu">toFile</span>());
        }
    }
}</code></pre></div>
<h2 id="flux-orienté-ligne"><span class="header-section-number">3.4</span> Flux orienté ligne</h2>
<h3 id="bufferedreader"><span class="header-section-number">3.4.1</span> BufferedReader</h3>
<p>Pour lire du texte de manière plus efficace qu'avec <code>FileReader</code> on utilisera <code>BufferedReader</code>. Il faut remarquer que dans &quot;buffered&quot; &quot;reader&quot; il n'y a pas le mot &quot;file&quot;. En effet, un <code>BufferedReader</code> est conçu pour lire dans un flux quelconque (un <code>Reader</code>).</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">BufferedReader</span> bufferedReader = <span class="kw">new</span> <span class="bu">BufferedReader</span>(<span class="kw">new</span> <span class="bu">FileReader</span>(<span class="st">&quot;input.txt&quot;</span>));
<span class="bu">String</span> line = bufferedReader.<span class="fu">readLine</span>();
bufferedReader.<span class="fu">close</span>(); <span class="co">// ferme le flux sous-jacent (ici FileReader)</span></code></pre></div>
<p>Noter que <code>readLine()</code> lit jusqu'à trouver un <code>\n</code> ou <code>\r\n</code> mais n'inclut pas cette fin de ligne dans l'objet retourné.</p>
<h3 id="exercice8"><span class="header-section-number">3.4.2</span> Exercice 8</h3>
<p>Écrire un programme qui lit dans un fichier &quot;doublons.txt&quot; affiche les lignes uniques.</p>
<p>Par exemple &quot;doublons.txt&quot; contiendra :</p>
<pre><code>file
file
input
stream
reader
stream</code></pre>
<p>Le programme doit afficher :</p>
<pre><code>file
input
stream
reader</code></pre>
<h3 id="bufferedwriter"><span class="header-section-number">3.4.3</span> BufferedWriter</h3>
<p>De la même manière, <code>BufferedWriter</code> est conçu pour rendre <code>FileWriter</code> performant et plus simple à utiliser. Un writer bufferisé écrit des lots plus gros de données en une seule fois. Le fait de minimiser le nombre de lectures (opération lente) économise des ressources.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">BufferedWriter</span> bufferedWriter = <span class="kw">new</span> <span class="bu">BufferedWriter</span>(<span class="kw">new</span> <span class="bu">FileWriter</span>(<span class="st">&quot;test.txt&quot;</span>));
bufferedWriter.<span class="fu">write</span>(<span class="st">&quot;hello&quot;</span>);
bufferedWriter.<span class="fu">newLine</span>();
bufferedWriter.<span class="fu">close</span>(); <span class="co">// ferme le flux sous-jacent (ici FileWriter)</span>
<span class="co">// hello\r\n</span></code></pre></div>
<h3 id="exercice-9-1"><span class="header-section-number">3.4.4</span> Exercice 9</h3>
<p>Modifier le programme de l'exercice 8 pour écrire dans un fichier plutôt que d'afficher.</p>
<h3 id="exercice-10-1"><span class="header-section-number">3.4.5</span> Exercice 10</h3>
<p>Écrire un programme qui copie le contenu direct d'un répertoire. Le répertoire à copier sera donné en premier argument du programme. Le répertoire destination sera donné en second argument.</p>
<p>Par exemple si on invoque le programme avec les arguments : <code>&quot;C:\Program Files\Java\jdk1.8.0_60&quot; &quot;C:\Users\mathieupauly\AppData\Local\Temp&quot;</code>, alors le répertoire <code>Temp</code> contiendra entre autres les répertoires <code>bin</code>, <code>jre</code>, <code>lib</code> et entre autres les fichiers <code>COPYRIGHT</code>, <code>LICENSE</code>, etc.</p>
<h3 id="reader-et-writer"><span class="header-section-number">3.4.6</span> Reader et Writer</h3>
<p>Comme vu précédement, <code>BufferedReader</code> n'est pas obligé de lire ses données à partir d'un fichier. Même principe pour <code>BufferedWriter</code> qui peut écrire dans un flux quelconque.</p>
<p>Un flux en lecture seule est représenté par <code>Reader</code>. Un flux en écriture est lui représenté par <code>Writer</code>. Ces 2 classes sont des abstractions car elles ne manipulent pas un flux en particulier.</p>
<p>En revanches elles permettent de composer des flux complexes en permettant de faire varier le média physique en jeu (par ex. en fichier ou en mémoire) ainsi que le paramétrage de lecture/écriture (par ex. utilisation d'un tampon ou non).</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">BufferedReader</span> bufferedReader = <span class="kw">new</span> <span class="bu">BufferedReader</span>(<span class="kw">new</span> <span class="bu">StringReader</span>(<span class="st">&quot;a</span><span class="sc">\n</span><span class="st">b</span><span class="sc">\n</span><span class="st">c&quot;</span>));
<span class="bu">String</span> line = bufferedReader.<span class="fu">readLine</span>(); <span class="co">// &quot;a&quot;</span>
<span class="bu">String</span> character = bufferedReader.<span class="fu">read</span>(); <span class="co">// 98 pour &#39;b&#39;</span></code></pre></div>
<p>Ici on a utilisé un tampon (<code>BufferedReader</code>) pour lire une information en mémoire (<code>&quot;a\nb\nc&quot;</code>).</p>
<p>L'intérêt est que la ligne de code qui utilise <code>read()</code> peut ignorer qu'elle consomme un <code>BufferedReader</code>. Pour elle tout se passe comme si elle consomme l'interface <code>Reader</code>.</p>
<p>Pour résumer : un <code>BufferedReader</code> est construit à partir d'un autre <code>Reader</code> mais implémente lui même <code>Reader</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> <span class="bu">BufferedReader</span> <span class="kw">extends</span> <span class="bu">Reader</span> {
    <span class="kw">public</span> <span class="bu">BufferedReader</span>(<span class="bu">Reader</span> in) {
        <span class="co">// ...</span>
    }
    <span class="co">// ...</span>
}</code></pre></div>
<p>On peut tenir exactement le même raisonnement avec BufferedWriter et Writer.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">StringWriter</span> out = <span class="kw">new</span> <span class="bu">StringWriter</span>();
<span class="bu">BufferedWriter</span> bufferedWriter = <span class="kw">new</span> <span class="bu">BufferedWriter</span>(out);
bufferedWriter.<span class="fu">write</span>(<span class="st">&quot;one&quot;</span>);
bufferedWriter.<span class="fu">newLine</span>();
bufferedWriter.<span class="fu">write</span>(<span class="st">&quot;two&quot;</span>);
bufferedWriter.<span class="fu">close</span>();
<span class="bu">String</span> content = out.<span class="fu">toString</span>(); <span class="co">// one\ntwo</span></code></pre></div>
<p>La ligne de code qui utilise <code>write(String)</code> ne sait pas qu'elle écrit dans un <code>StringBuffer</code> (utilisé par <code>StringWriter</code>). De plus, elle ne sait pas qu'elle écrit dans un tampon.</p>
<p>Pour résumer, <code>BufferedWriter</code> est construit sur un autre <code>Writer</code> et implémente lui même <code>Writer</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> <span class="bu">BufferedWriter</span> <span class="kw">extends</span> <span class="bu">Writer</span> {
    <span class="kw">public</span> <span class="bu">BufferedWriter</span>(<span class="bu">Writer</span> out) {
        <span class="co">// ...</span>
    }
}</code></pre></div>
<p>Ce motif de conception (design pattern) dans lequel une classe expose la même interface qu'elle consomme est nommé «Décorateur» d'après le «Gang of Four» (GOF).</p>
<h3 id="inputstream-et-outputstream"><span class="header-section-number">3.4.7</span> InputStream et OutputStream</h3>
<p>Une abstraction similaire existe du côté des flux orientés octets. Un <code>FileInputStream</code> (resp. <code>FileOutputStream</code>) peut-être bufferisé à l'aide d'un <code>BufferedInputStream</code> (resp. <code>BufferedOutputStream</code>). Remarquons une fois de plus l'absence du mot file dans &quot;buffered&quot; &quot;input&quot; &quot;stream&quot;.</p>
<p>Pour lire de manière plus efficace dans un flux binaire :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">BufferedInputStream</span> bufferedInputStream = <span class="kw">new</span> <span class="bu">BufferedInputStream</span>(<span class="kw">new</span> <span class="bu">FileInputStream</span>(<span class="st">&quot;input.txt&quot;</span>));
<span class="dt">int</span> c = bufferedInputStream.<span class="fu">read</span>();
bufferedInputStream.<span class="fu">close</span>(); <span class="co">// ferme le flux sous-jacent</span></code></pre></div>
<p>Et pour écrire :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">BufferedOutputStream</span> bufferedOutputStream = <span class="kw">new</span> <span class="bu">BufferedOutputStream</span>(<span class="kw">new</span> <span class="bu">FileOutputStream</span>(<span class="st">&quot;out.txt&quot;</span>));
bufferedOutputStream.<span class="fu">write</span>(<span class="dv">97</span>);
bufferedOutputStream.<span class="fu">close</span>(); <span class="co">// ferme le flux sous-jacent</span></code></pre></div>
<p>Un <code>BufferedInputStream</code> (resp. <code>BufferedOutputStream</code>) est construit sur un <code>InputStream</code> (resp. <code>OutputStream</code>) et implémente également l'interface <code>InputStream</code> (resp. <code>OutputStream</code>). C'est à dire que ces flux orientés octets bufferisés ne sont pas forcément construit sur un flux fichier. Les classes <code>InputStream</code> et <code>OutputStream</code> sont des flux d'octets quelconques.</p>
<p>La classe de lecture d'un flux bufferisé est définie ainsi dans le JDK :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> <span class="bu">BufferedOutputStream</span> <span class="kw">extends</span> <span class="bu">FilterOutputStream</span> {
    <span class="kw">protected</span> <span class="bu">OutputStream</span> out;
    <span class="kw">public</span> <span class="bu">FilterOutputStream</span>(<span class="bu">OutputStream</span> out) {
        <span class="kw">this</span>.<span class="fu">out</span> = out;
    }
    <span class="co">// ...</span>
}</code></pre></div>
<p>Avec la définition suivante :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> <span class="bu">FilterOutputStream</span> <span class="kw">extends</span> <span class="bu">OutputStream</span> {
    <span class="co">// ...</span>
}</code></pre></div>
<p>Et la classe d'écriture de flux bufferisé est définie ainsi dans le JDK :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> <span class="bu">BufferedInputStream</span> <span class="kw">extends</span> <span class="bu">FilterInputStream</span> {
    <span class="kw">public</span> <span class="bu">BufferedInputStream</span>(<span class="bu">InputStream</span> in) {
        <span class="co">// ...</span>
    }
}</code></pre></div>
<p>Avec la définition suivante :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> <span class="bu">FilterInputStream</span> <span class="kw">extends</span> <span class="bu">InputStream</span> { 
    <span class="co">// ...</span>
}</code></pre></div>
<p>C'est encore le motif de conception «Décorateur» (GOF) qui est utilisé ici dans lequel une classe expose la même interface qu'elle consomme.</p>
<h3 id="inputstream-outputstream-reader-et-writer"><span class="header-section-number">3.4.8</span> InputStream, OutputStream, Reader et Writer</h3>
<p>De plus, on peut convertir un flux orienté octet en un flux orienté caractère ou ligne grâce à ces abstractions (<code>InputStream</code>, <code>OutputStream</code>, <code>Reader</code> et <code>Writer</code>). En effet, il existe aussi un 2 adaptateurs qui font le pont entre un flux binaire (byte-oriented) et un flux texte : <code>InputStreamReader</code> et <code>OutputStreamWriter</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">BufferedReader</span> bufferedReader = <span class="kw">new</span> <span class="bu">BufferedReader</span>(<span class="kw">new</span> <span class="bu">InputStreamReader</span>(<span class="kw">new</span> <span class="bu">FileInputStream</span>(<span class="st">&quot;in.txt&quot;</span>)));
<span class="bu">BufferedWriter</span> bufferedWriter = <span class="kw">new</span> <span class="bu">BufferedWriter</span>(<span class="kw">new</span> <span class="bu">OutputStreamWriter</span>(<span class="kw">new</span> <span class="bu">FileOutputStream</span>(<span class="st">&quot;out.txt&quot;</span>)));</code></pre></div>
<h3 id="exercice-11-1"><span class="header-section-number">3.4.9</span> Exercice 11</h3>
<p>Cet exercice est une réécriture du programme de l'exercice précédant. C'est à dire que le but est toujours de faire une copie du contenu direct d'un répertoire. En revanche nous allons séparer le programme en 2 programmes : un lecteur et un écrivain. Le lecteur lira le contenu d'un répertoire. L'écrivain écrira la copie.</p>
<ul>
<li>écrire un fichier <code>list.csv</code> contenant le texte suivant :</li>
</ul>
<pre class="csv"><code>bin
lib</code></pre>
<ul>
<li>écrire le programme écrivain qui écrit dans le répertoire donné en argument mais lit dans le <code>list.csv</code> la liste de répertoires à créer (ici <code>bin</code> et <code>lib</code>).</li>
<li>ajouter une colonne au fichier <code>list.csv</code> pour avoir :</li>
</ul>
<pre class="csv"><code>bin;directory
lib;directory
LICENSE;file</code></pre>
<ul>
<li>modifier le programme écrivain de sorte de prendre en compte les fichiers normaux.</li>
<li>écrire un programme lecteur qui lit le répertoire donné en argument (comme l'exercice précédant) mais écrit dans le fichier <code>list.csv</code> (dans lequel chaque ligne à la structure name;type).</li>
</ul>
<p>On lancera donc 2 programmes pour réaliser la copie :</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">java</span> ContentReader <span class="st">&quot;C:\Program Files\Java\jdk1.8.0_60&quot;</span>
<span class="ex">java</span> ContentWriter <span class="st">&quot;C:\Users\mathieupauly\AppData\Local\Temp&quot;</span></code></pre></div>
<h3 id="exercice-12-1"><span class="header-section-number">3.4.10</span> Exercice 12</h3>
<p>Modifier les 2 programmes de sorte que la description précédement écrite dans le fichier <code>list.csv</code> soit écrite par <code>ContentReader</code> sur sa sortie standard et lu par <code>ContentWriter</code> sur son entrée standard. On n'utilisera donc plus le fichier <code>list.csv</code>.</p>
<p>Le programmes devront donc être coordonnés à l'aide d'un «pipe» (<code>|</code>). La sortie du premier programme est redirigé dans l'entrée du second.</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">java</span> ContentReader <span class="st">&quot;C:\Program Files\Java\jdk1.8.0_60&quot;</span> <span class="kw">|</span> <span class="ex">java</span> ContentWriter <span class="st">&quot;C:\Users\mathieupauly\AppData\Local\Temp&quot;</span></code></pre></div>
<h3 id="corrections-3"><span class="header-section-number">3.4.11</span> Corrections</h3>
<p>Exercice 8 : on utilisera un <code>Set</code> pour ne pas conserver les doublons.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> fr.arolla.java8esgi.basicio.ex8;</span>

<span class="kw">import</span><span class="im"> java.io.BufferedReader;</span>
<span class="kw">import</span><span class="im"> java.io.FileReader;</span>
<span class="kw">import</span><span class="im"> java.io.IOException;</span>
<span class="kw">import</span><span class="im"> java.util.HashSet;</span>
<span class="kw">import</span><span class="im"> java.util.Set;</span>

<span class="kw">public</span> <span class="kw">class</span> Ex8 {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">IOException</span> {
        <span class="bu">BufferedReader</span> bufferedReader = <span class="kw">new</span> <span class="bu">BufferedReader</span>(<span class="kw">new</span> <span class="bu">FileReader</span>(<span class="st">&quot;doublons.txt&quot;</span>));
        <span class="bu">Set</span>&lt;<span class="bu">String</span>&gt; uniqueLines = <span class="kw">new</span> <span class="bu">HashSet</span>&lt;&gt;();
        <span class="bu">String</span> line;
        <span class="kw">while</span> ((line = bufferedReader.<span class="fu">readLine</span>()) != <span class="kw">null</span>) {
            <span class="kw">if</span> (!uniqueLines.<span class="fu">contains</span>(line)) {
                <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(line);
            }
            uniqueLines.<span class="fu">add</span>(line);
        }
        bufferedReader.<span class="fu">close</span>();
    }
}</code></pre></div>
<p>Exercice 9 : on conserve le type de l'objet <code>System.out</code> (<code>PrintStream</code>) mais on change l'instance concrète qui sera connectée sur un fichier.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> fr.arolla.java8esgi.basicio.ex9;</span>

<span class="kw">import</span><span class="im"> java.io.BufferedReader;</span>
<span class="kw">import</span><span class="im"> java.io.FileReader;</span>
<span class="kw">import</span><span class="im"> java.io.IOException;</span>
<span class="kw">import</span><span class="im"> java.io.PrintStream;</span>
<span class="kw">import</span><span class="im"> java.util.HashSet;</span>
<span class="kw">import</span><span class="im"> java.util.Set;</span>

<span class="kw">public</span> <span class="kw">class</span> Ex9 {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">IOException</span> {
        <span class="bu">BufferedReader</span> bufferedReader = <span class="kw">new</span> <span class="bu">BufferedReader</span>(<span class="kw">new</span> <span class="bu">FileReader</span>(<span class="st">&quot;doublons.txt&quot;</span>));
        <span class="bu">PrintStream</span> out = <span class="kw">new</span> <span class="bu">PrintStream</span>(<span class="st">&quot;sansDoublon.txt&quot;</span>);
        <span class="bu">Set</span>&lt;<span class="bu">String</span>&gt; uniqueLines = <span class="kw">new</span> <span class="bu">HashSet</span>&lt;&gt;();
        <span class="bu">String</span> line;
        <span class="kw">while</span> ((line = bufferedReader.<span class="fu">readLine</span>()) != <span class="kw">null</span>) {
            <span class="kw">if</span> (!uniqueLines.<span class="fu">contains</span>(line)) {
                out.<span class="fu">println</span>(line);
            }
            uniqueLines.<span class="fu">add</span>(line);
        }
        bufferedReader.<span class="fu">close</span>();
        out.<span class="fu">close</span>();
    }
}</code></pre></div>
<p>Exercice 10 : on parcourt le contenu du répertoire source en se demandant pour chaque chemin à copier s'il référence un répertoire ou un fichier normal (pas un périphérique par ex.).</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> fr.arolla.java8esgi.basicio.ex10;</span>

<span class="kw">import</span><span class="im"> java.io.IOException;</span>
<span class="kw">import</span><span class="im"> java.nio.file.DirectoryStream;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Files;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Path;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Paths;</span>

<span class="kw">public</span> <span class="kw">class</span> Ex10 {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">IOException</span> {
        <span class="bu">String</span> source = args[<span class="dv">0</span>];
        <span class="bu">String</span> destination = args[<span class="dv">1</span>];
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Copy from: &quot;</span> + source + <span class="st">&quot; to: &quot;</span> + destination);
        Path destinationDirectory = Paths.<span class="fu">get</span>(destination);
        DirectoryStream&lt;Path&gt; stream = Files.<span class="fu">newDirectoryStream</span>(Paths.<span class="fu">get</span>(source));
        <span class="kw">for</span> (Path toCopy : stream) {
            Path toCreate = destinationDirectory.<span class="fu">resolve</span>(toCopy.<span class="fu">getFileName</span>());
            <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Create: &quot;</span> + toCreate + <span class="st">&quot;...&quot;</span>);
            <span class="kw">if</span> (Files.<span class="fu">isDirectory</span>(toCopy)) {
                Files.<span class="fu">createDirectory</span>(toCreate);
            } <span class="kw">else</span> <span class="kw">if</span> (Files.<span class="fu">isRegularFile</span>(toCopy)) {
                Files.<span class="fu">createFile</span>(toCreate);
            } <span class="kw">else</span> {
                <span class="bu">System</span>.<span class="fu">err</span>.<span class="fu">println</span>(<span class="st">&quot;Cannot process &quot;</span> + toCopy);
            }
        }
        stream.<span class="fu">close</span>();
        out.<span class="fu">close</span>();
    }
}</code></pre></div>
<pre><code>Copy from: C:\Program Files\Java\jdk1.8.0_60 to: C:\Users\mathieupauly\AppData\Local\Temp
Create: C:\Users\mathieupauly\AppData\Local\Temp\bin...
Create: C:\Users\mathieupauly\AppData\Local\Temp\COPYRIGHT...
Create: C:\Users\mathieupauly\AppData\Local\Temp\db...
Create: C:\Users\mathieupauly\AppData\Local\Temp\include...
Create: C:\Users\mathieupauly\AppData\Local\Temp\javafx-src.zip...
Create: C:\Users\mathieupauly\AppData\Local\Temp\jre...
Create: C:\Users\mathieupauly\AppData\Local\Temp\lib...
Create: C:\Users\mathieupauly\AppData\Local\Temp\LICENSE...
Create: C:\Users\mathieupauly\AppData\Local\Temp\README.html...
Create: C:\Users\mathieupauly\AppData\Local\Temp\release...
Create: C:\Users\mathieupauly\AppData\Local\Temp\src.zip...
Create: C:\Users\mathieupauly\AppData\Local\Temp\THIRDPARTYLICENSEREADME-JAVAFX.txt...
Create: C:\Users\mathieupauly\AppData\Local\Temp\THIRDPARTYLICENSEREADME.txt...</code></pre>
<p>Exercice 11 :</p>
<p>Le programme de lecture du répertoire source pourra être lancé en premier.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> fr.arolla.java8esgi.basicio.ex11;</span>

<span class="kw">import</span><span class="im"> java.io.IOException;</span>
<span class="kw">import</span><span class="im"> java.io.PrintStream;</span>
<span class="kw">import</span><span class="im"> java.nio.file.DirectoryStream;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Files;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Path;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Paths;</span>

<span class="kw">public</span> <span class="kw">class</span> ContentReader {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">IOException</span> {
        <span class="bu">String</span> source = args[<span class="dv">0</span>];
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Copy from: &quot;</span> + source);
        DirectoryStream&lt;Path&gt; stream = Files.<span class="fu">newDirectoryStream</span>(Paths.<span class="fu">get</span>(source));
        <span class="bu">PrintStream</span> out = <span class="kw">new</span> <span class="bu">PrintStream</span>(<span class="st">&quot;list.csv&quot;</span>);
        <span class="kw">for</span> (Path toCopy : stream) {
            Path fileName = toCopy.<span class="fu">getFileName</span>();
            <span class="kw">if</span> (Files.<span class="fu">isDirectory</span>(toCopy)) {
                out.<span class="fu">println</span>(fileName + <span class="st">&quot;;&quot;</span> + <span class="st">&quot;directory&quot;</span>);
            } <span class="kw">else</span> <span class="kw">if</span> (Files.<span class="fu">isRegularFile</span>(toCopy)) {
                out.<span class="fu">println</span>(fileName + <span class="st">&quot;;&quot;</span> + <span class="st">&quot;file&quot;</span>);
            } <span class="kw">else</span> {
                out.<span class="fu">println</span>(fileName + <span class="st">&quot;;&quot;</span> + <span class="st">&quot;unknown&quot;</span>);
            }
        }
        stream.<span class="fu">close</span>();
        out.<span class="fu">close</span>();
    }
}</code></pre></div>
<pre><code>bin;directory
COPYRIGHT;file
db;directory
include;directory
javafx-src.zip;file
jre;directory
lib;directory
LICENSE;file
README.html;file
release;file
src.zip;file
THIRDPARTYLICENSEREADME-JAVAFX.txt;file
THIRDPARTYLICENSEREADME.txt;file</code></pre>
<p>Puis on lancera l'écrivain :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> fr.arolla.java8esgi.basicio.ex11;</span>

<span class="kw">import</span><span class="im"> java.io.BufferedReader;</span>
<span class="kw">import</span><span class="im"> java.io.FileReader;</span>
<span class="kw">import</span><span class="im"> java.io.IOException;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Files;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Path;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Paths;</span>

<span class="kw">public</span> <span class="kw">class</span> ContentWriter {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">IOException</span> {
        <span class="bu">String</span> destination = args[<span class="dv">0</span>];
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Copy to: &quot;</span> + destination);
        Path destinationDirectory = Paths.<span class="fu">get</span>(destination);
        <span class="bu">BufferedReader</span> listing = <span class="kw">new</span> <span class="bu">BufferedReader</span>(<span class="kw">new</span> <span class="bu">FileReader</span>(<span class="st">&quot;list.csv&quot;</span>));
        <span class="bu">String</span> line;
        <span class="kw">while</span> ((line = listing.<span class="fu">readLine</span>()) != <span class="kw">null</span>) {
            <span class="bu">String</span>[] columns = line.<span class="fu">split</span>(<span class="st">&quot;;&quot;</span>);
            <span class="bu">String</span> filename = columns[<span class="dv">0</span>];
            <span class="bu">String</span> type = columns[<span class="dv">1</span>];
            Path toCreate = destinationDirectory.<span class="fu">resolve</span>(filename);
            <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Create: &quot;</span> + toCreate + <span class="st">&quot;...&quot;</span>);
            <span class="kw">switch</span> (type) {
                <span class="kw">case</span> <span class="st">&quot;directory&quot;</span>:
                    Files.<span class="fu">createDirectory</span>(toCreate);
                    <span class="kw">break</span>;
                <span class="kw">case</span> <span class="st">&quot;file&quot;</span>:
                    Files.<span class="fu">createFile</span>(toCreate);
                    <span class="kw">break</span>;
                <span class="kw">default</span>:
                    <span class="bu">System</span>.<span class="fu">err</span>.<span class="fu">println</span>(<span class="st">&quot;Cannot process &quot;</span> + toCreate + <span class="st">&quot; (unknown type)&quot;</span>);
                    <span class="kw">break</span>;
            }
        }
        listing.<span class="fu">close</span>();
    }
}</code></pre></div>
<pre><code>Copy to: C:\Users\mathieupauly\AppData\Local\Temp
Create: C:\Users\mathieupauly\AppData\Local\Temp\bin...
Create: C:\Users\mathieupauly\AppData\Local\Temp\COPYRIGHT...
Create: C:\Users\mathieupauly\AppData\Local\Temp\db...
Create: C:\Users\mathieupauly\AppData\Local\Temp\include...
Create: C:\Users\mathieupauly\AppData\Local\Temp\javafx-src.zip...
Create: C:\Users\mathieupauly\AppData\Local\Temp\jre...
Create: C:\Users\mathieupauly\AppData\Local\Temp\lib...
Create: C:\Users\mathieupauly\AppData\Local\Temp\LICENSE...
Create: C:\Users\mathieupauly\AppData\Local\Temp\README.html...
Create: C:\Users\mathieupauly\AppData\Local\Temp\release...
Create: C:\Users\mathieupauly\AppData\Local\Temp\src.zip...
Create: C:\Users\mathieupauly\AppData\Local\Temp\THIRDPARTYLICENSEREADME-JAVAFX.txt...
Create: C:\Users\mathieupauly\AppData\Local\Temp\THIRDPARTYLICENSEREADME.txt...</code></pre>
<p>Exercice 12 : pour le lecteur, on change <code>new PrintStream(&quot;list.csv&quot;)</code> à <code>System.out</code> ; pour l'écrivain, on substitue <code>new FileReader(&quot;list.csv&quot;)</code> par <code>new InputStreamReader(System.in)</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> fr.arolla.java8esgi.basicio.ex12;</span>

<span class="kw">import</span><span class="im"> java.io.IOException;</span>
<span class="kw">import</span><span class="im"> java.nio.file.DirectoryStream;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Files;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Path;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Paths;</span>

<span class="kw">public</span> <span class="kw">class</span> ContentReader {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">IOException</span> {
        <span class="bu">String</span> source = args[<span class="dv">0</span>];
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Copy from: &quot;</span> + source);
        DirectoryStream&lt;Path&gt; stream = Files.<span class="fu">newDirectoryStream</span>(Paths.<span class="fu">get</span>(source));
        <span class="kw">for</span> (Path toCopy : stream) {
            Path fileName = toCopy.<span class="fu">getFileName</span>();
            <span class="kw">if</span> (Files.<span class="fu">isDirectory</span>(toCopy)) {
                <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(fileName + <span class="st">&quot;;&quot;</span> + <span class="st">&quot;directory&quot;</span>);
            } <span class="kw">else</span> <span class="kw">if</span> (Files.<span class="fu">isRegularFile</span>(toCopy)) {
                <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(fileName + <span class="st">&quot;;&quot;</span> + <span class="st">&quot;file&quot;</span>);
            } <span class="kw">else</span> {
                <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(fileName + <span class="st">&quot;;&quot;</span> + <span class="st">&quot;unknown&quot;</span>);
            }
        }
        stream.<span class="fu">close</span>();
    }
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> fr.arolla.java8esgi.basicio.ex12;</span>

<span class="kw">import</span><span class="im"> java.io.BufferedReader;</span>
<span class="kw">import</span><span class="im"> java.io.IOException;</span>
<span class="kw">import</span><span class="im"> java.io.InputStreamReader;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Files;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Path;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Paths;</span>

<span class="kw">public</span> <span class="kw">class</span> ContentWriter {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">IOException</span> {
        <span class="bu">String</span> destination = args[<span class="dv">0</span>];
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Copy to: &quot;</span> + destination);
        Path destinationDirectory = Paths.<span class="fu">get</span>(destination);
        <span class="bu">BufferedReader</span> listing = <span class="kw">new</span> <span class="bu">BufferedReader</span>(<span class="kw">new</span> <span class="bu">InputStreamReader</span>(<span class="bu">System</span>.<span class="fu">in</span>));
        <span class="bu">String</span> line;
        <span class="kw">while</span> ((line = listing.<span class="fu">readLine</span>()) != <span class="kw">null</span>) {
            <span class="bu">String</span>[] columns = line.<span class="fu">split</span>(<span class="st">&quot;;&quot;</span>);
            <span class="bu">String</span> filename = columns[<span class="dv">0</span>];
            <span class="bu">String</span> type = columns[<span class="dv">1</span>];
            Path toCreate = destinationDirectory.<span class="fu">resolve</span>(filename);
            <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Create: &quot;</span> + toCreate + <span class="st">&quot;...&quot;</span>);
            <span class="kw">switch</span> (type) {
                <span class="kw">case</span> <span class="st">&quot;directory&quot;</span>:
                    Files.<span class="fu">createDirectory</span>(toCreate);
                    <span class="kw">break</span>;
                <span class="kw">case</span> <span class="st">&quot;file&quot;</span>:
                    Files.<span class="fu">createFile</span>(toCreate);
                    <span class="kw">break</span>;
                <span class="kw">default</span>:
                    <span class="bu">System</span>.<span class="fu">err</span>.<span class="fu">println</span>(<span class="st">&quot;Cannot process &quot;</span> + toCreate + <span class="st">&quot; (unknown type)&quot;</span>);
                    <span class="kw">break</span>;
            }
        }
        listing.<span class="fu">close</span>();
    }
}</code></pre></div>
<p>Une erreur courante de programmation consiste à oublier de libérer les ressources (BufferedReader, BufferedOutputStream, DirectoryStream, etc). Dans le pire, des cas cela aboutit à des fuites mémoires.</p>
<h3 id="sources"><span class="header-section-number">3.4.12</span> Sources</h3>
<p>https://docs.oracle.com/javase/tutorial/essential/io/</p>
<h1 id="les-exceptions"><span class="header-section-number">4</span> Les exceptions</h1>
<p>Dans le chapitre d'introduction aux entrées/sorties nous avons utilisé des méthodes pouvant générer des exceptions.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">void</span> <span class="fu">touchLock</span>() {
    <span class="bu">FileOutputStream</span> stream = <span class="kw">new</span> <span class="bu">FileOutputStream</span>(<span class="st">&quot;lock.txt&quot;</span>); <span class="co">// unreported exception java.io.FileNotFoundException;</span>
                                                                <span class="co">// must be caught or declared to be thrown</span>
    stream.<span class="fu">close</span>();
}</code></pre></div>
<p>Ce code ne compile pas.</p>
<p>Le contructeur de <code>FileOutputStream</code> déclare dans la section <code>Throws</code> de sa <a href="https://docs.oracle.com/javase/8/docs/api/java/io/FileOutputStream.html#FileOutputStream-java.lang.String-">Javadoc</a> qu'une <code>FileNotFoundException</code> est levée si le fichier existe mais correspond à un répertoire ou bien quand le fichier n'existe pas et ne peut pas être créé, etc.</p>
<p>Le contructeur est déclaré comme comme cela dans le JDK :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="bu">FileOutputStream</span>(<span class="bu">String</span> name) <span class="kw">throws</span> <span class="bu">FileNotFoundException</span> {
   ...
}</code></pre></div>
<p>Quand on appelle une méthode qui peut lever des exceptions, la méthode appelante doit ou bien :</p>
<ul>
<li>déclarer elle même l'exception (<code>throws</code>);</li>
<li>ou bien la traiter (<code>try</code> et <code>catch</code>).</li>
</ul>
<h2 id="throw-et-throws"><span class="header-section-number">4.1</span> Throw et throws</h2>
<p>Ce code ne compile pas :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
    <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">Exception</span>(); <span class="co">// unreported exception</span>
}</code></pre></div>
<p>On peut corriger en déclarant l'exception.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">Exception</span> {
    <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">Exception</span>();
}</code></pre></div>
<p>Une exception est un objet comme un autre. Ce qui le distingue d'un autre objet classique est qu'il peut être lancé (<code>throw</code>) au contexte appelant sans passer par le flot d'exécution habituel (if, return, etc.). L'expression <code>new Exception()</code> est un <code>Object</code> comme un autre. On pourrait donc écrire :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">Exception</span> {
    <span class="bu">Exception</span> e = <span class="kw">new</span> <span class="bu">Exception</span>();
    <span class="kw">throw</span> e;
}</code></pre></div>
<p>Le code suivant ne compile pas car le 2e <code>println</code> n'est jamais atteignable :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">Exception</span> {
    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;before&quot;</span>);
    <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">Exception</span>();
    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;before&quot;</span>); <span class="co">// unreachable statement</span>
}</code></pre></div>
<p>En effet, l'exception levée entre les 2 lignes de <code>println</code> interrompt la méthode <code>main(String[] args)</code>.</p>
<p>L'erreur de compilation est similaire à l'erreur produite avec un <code>return</code> :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">Exception</span> {
    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;before&quot;</span>);
    <span class="kw">return</span>;
    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;after&quot;</span>); <span class="co">// unreachable statement</span>
}</code></pre></div>
<p>En revanche, pour l'exposer on peut en quelque sorte tromper le compilateur Java pour corriger l'erreur de compilation :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">Exception</span> {
    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;before&quot;</span>);
    <span class="kw">if</span> (<span class="kw">true</span>) {
        <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">Exception</span>();
    }
    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;after&quot;</span>); <span class="co">// OK</span>
}</code></pre></div>
<p>Même si ce code est sémantiquement équivalent (<code>if (true) foo();</code> est équivalent à <code>foo();</code>) le compilateur considère uniquement la forme du <code>if</code> et pas la condition.</p>
<p>Le programme pourra afficher :</p>
<pre><code>before
Exception in thread &quot;main&quot; java.lang.Exception
    at fr.arolla.java8esgi.exceptions.Demo.main(Demo.java:7)</code></pre>
<p>Mais également :</p>
<pre><code>Exception in thread &quot;main&quot; java.lang.Exception
    at fr.arolla.java8esgi.exceptions.Demo.main(Demo.java:7)
before</code></pre>
<p>Note secondaire : on peut se demander pourquoi les messages affichés sur la sortie standard sont comme dilués dans la trace. La raison est que la méthode <code>printStackTrace()</code> affiche sur la sortie erreur qui n'est pas bufferisée (sinon l'erreur risquerait de n'être jamais affichée). Une donnée écrite dans un buffer ne sera effectivement écrite que lorsque nécessaire. L'ordre d'affichage n'est pas garanti entre le flux de sortie standard (<code>out</code>) et le flux d'erreur standard (<code>err</code>).</p>
<p>On réécrit (on dit aussi &quot;refactor&quot;) le programme on faisant une extraction d'une méthode <code>foo</code> :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">Exception</span> {
    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;before&quot;</span>);
    <span class="fu">foo</span>();
    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;after&quot;</span>);
}

<span class="kw">private</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">foo</span>() <span class="kw">throws</span> <span class="bu">Exception</span> {
    <span class="kw">if</span> (<span class="kw">true</span>) {
        <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">Exception</span>();
    }
}</code></pre></div>
<p>La méthode appelante (main) et appelée (foo) ont maintenant la même clause <code>throws</code>. Dans ce cas, la clause <code>throws</code> est virale. Elle a infecté celui qui l'appelait. En choisissant la même tactique (déclaration avec <code>throws</code>), le dernier appelant (<code>main(String[] args)</code>) est aussi en quelque sorte infecté. Si une exception est levé la JVM s'arretera.</p>
<p>Quand une exception est levée, le flot d'exécution normal est interrompu. La JVM dépile la fonction en cours, puis sa fonction appelante et ainsi de suite jusqu'à la méthode <code>main</code>. En bref, le programme est interrompu. Le programme stoppe et la JVM affiche la pile d'exécution ayant causé l'exception.</p>
<p>Une réécriture doit s'appliquer à laisser inchangé le comportement pour l'utilisateur. Mais certains aspect techniques peuvent changer comme la &quot;stack trace&quot; :</p>
<pre><code>before
Exception in thread &quot;main&quot; java.lang.Exception
    at fr.arolla.java8esgi.exceptions.Demo.foo(Demo.java:12)
    at fr.arolla.java8esgi.exceptions.Demo.main(Demo.java:6)</code></pre>
<p>Le programme affiche toujours &quot;before&quot; (comportement inchangé) mais la &quot;stack trace&quot; est maintenant composée de 2 lignes.</p>
<p>Continuons l'expérience :</p>
<pre><code>before
Exception in thread &quot;main&quot; java.lang.Exception
    at fr.arolla.java8esgi.exceptions.Demo.bar(Demo.java:16)
    at fr.arolla.java8esgi.exceptions.Demo.foo(Demo.java:11)
    at fr.arolla.java8esgi.exceptions.Demo.main(Demo.java:6)</code></pre>
<p>Remarquons qu'en première ligne de la &quot;stack trace&quot; est toujours la fonction la plus profonde dans la pile d'exécution (&quot;stack&quot;). Cette ligne correspond toujours à l'endroit qui a levé l'exception.</p>
<p>Analysons la première ligne : <code>fr.arolla.java8esgi.exceptions.Demo.bar(Demo.java:16)</code>.</p>
<table>
<thead>
<tr class="header">
<th>Exemple</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>fr.arolla.java8esgi.exceptions</td>
<td align="center">package</td>
</tr>
<tr class="even">
<td>Demo</td>
<td align="center">class</td>
</tr>
<tr class="odd">
<td>bar</td>
<td align="center">method</td>
</tr>
<tr class="even">
<td>Demo.java</td>
<td align="center">source file</td>
</tr>
<tr class="odd">
<td>16</td>
<td align="center">line number</td>
</tr>
</tbody>
</table>
<h2 id="try-et-catch"><span class="header-section-number">4.2</span> Try et Catch</h2>
<p>Quand dans une fonction on appelle du code qui peut lever une exception (directement avec <code>throw</code> ou bien indirectement en appelant une méthode qui déclare <code>throws</code>) on peut déclarer ou gérer.</p>
<p>On a vu comment déclarer avec throws. On gère avec <code>try</code> et <code>catch</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
    <span class="kw">try</span> {
        <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">Exception</span>(<span class="st">&quot;1&quot;</span>);
        <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">Exception</span>(<span class="st">&quot;2&quot;</span>);
        <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">Exception</span>(<span class="st">&quot;3&quot;</span>);
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;OK&quot;</span>);
    } <span class="kw">catch</span> (<span class="bu">Exception</span> e) {
        e.<span class="fu">printStackTrace</span>();
    }
    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Life continues&quot;</span>);
}</code></pre></div>
<p>Ceci affichera probablement :</p>
<pre><code>java.lang.Exception: 1
    at fr.arolla.java8esgi.exceptions.Demo.main(Demo.java:6)
Life continues</code></pre>
<p>Il faut noter que &quot;OK&quot; n'est pas affiché car le bloc <code>catch</code> a pris la main. Le bloc <code>try</code> a été interrompu définitivement. Mais le message &quot;Life continues&quot; est affiché comme si rien ne s'était passé.</p>
<p>On peut éviter de remonter toute la pile d'appel et d'interrompre le programme. Il est parfois préférable de traiter l'exception localement de sorte que le programme continue quand même. On dira d'un tel programme qu'il fait de son mieux (best-effort).</p>
<p>Pour éviter qu'une exception ne soit propagée, on doit l'intercepter. Le code qui produit l'exception doit être embarqué dans un bloc <code>try {}</code>. Celui-ci doit-être suivi d'un bloc <code>catch {}</code> (ou <code>finally {}</code> mais nous verrons cela après).</p>
<p>Si une exception est levée dans le try, le gestionnaire catch sera exécuté.</p>
<h2 id="bloc-et-portée"><span class="header-section-number">4.3</span> Bloc et portée</h2>
<p>Attention avec la portée des variables. Le code suivant ne compile pas :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
    <span class="kw">try</span> {
        <span class="dt">boolean</span> ok = <span class="kw">false</span>;
        <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">Exception</span>(<span class="st">&quot;1&quot;</span>);
        <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">Exception</span>(<span class="st">&quot;2&quot;</span>);
        <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">Exception</span>(<span class="st">&quot;3&quot;</span>);
    } <span class="kw">catch</span> (<span class="bu">Exception</span> e) {
        e.<span class="fu">printStackTrace</span>();
    }
    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(ok); <span class="co">// cannot find symbol &quot;ok&quot;</span>
}</code></pre></div>
<p>C'est le même phénomène que</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
    {
        <span class="bu">String</span> a = <span class="st">&quot;&quot;</span>;
    }
    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(a); <span class="co">// cannot find symbol &quot;a&quot;</span>
}</code></pre></div>
<p>Les variables définies dans un bloc sont locales à ce bloc et ne peuvent être référencée à l'extérieur. On parle de portée lexicale.</p>
<p>Quand un calcul dépend d'une méthode pouvant lever une exception et qu'il est géré (try), il est recommandé aussi traiter ce calcul dans le bloc <code>try</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
    <span class="kw">try</span> {
        <span class="dt">boolean</span> ok = <span class="fu">getInfo</span>();
        <span class="kw">if</span> (ok) {
            <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;hello&quot;</span>);
        }
    } <span class="kw">catch</span> (<span class="bu">Exception</span> e) {
        e.<span class="fu">printStackTrace</span>();
    }
}

<span class="kw">private</span> <span class="dt">static</span> <span class="dt">boolean</span> <span class="fu">getInfo</span>() <span class="kw">throws</span> <span class="bu">Exception</span> {
    <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">Exception</span>(<span class="st">&quot;1&quot;</span>);
    <span class="kw">return</span> <span class="kw">false</span>;
}</code></pre></div>
<p>et non pas :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
    <span class="dt">boolean</span> ok = <span class="kw">false</span>;
    <span class="kw">try</span> {
        ok = <span class="fu">getInfo</span>();
    } <span class="kw">catch</span> (<span class="bu">Exception</span> e) {
        e.<span class="fu">printStackTrace</span>();
    }
    <span class="kw">if</span> (ok) {
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;hello&quot;</span>);
    }
}

<span class="kw">private</span> <span class="dt">static</span> <span class="dt">boolean</span> <span class="fu">getInfo</span>() <span class="kw">throws</span> <span class="bu">Exception</span> {
    <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">Exception</span>(<span class="st">&quot;1&quot;</span>);
    <span class="kw">return</span> <span class="kw">false</span>;
}</code></pre></div>
<h2 id="exceptions-maisons"><span class="header-section-number">4.4</span> Exceptions maisons</h2>
<p>Il n'est pas recommandé de lever <code>Exception</code> directement car cela est trop générique. On perd la possibilité de filtrer statiquement par type d'exception. On devrait utiliser des exceptions spécifiques.</p>
<p>Mais ce code ne compile pas.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> UserDefinedExceptions {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">CustomerNotFoundException</span>(); <span class="co">// incompatible types:</span>
        <span class="co">// fr.arolla.java8esgi.exceptions.CustomerNotFoundException </span>
        <span class="co">// cannot be converted to java.lang.Throwable</span>
    }
}

<span class="kw">class</span> CustomerNotFoundException {

}</code></pre></div>
<p>C'est une erreur similaire à :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
    <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">Object</span>(); <span class="co">// incompatible types</span>
}</code></pre></div>
<p>La solution consiste à faire hériter notre exception maison de Exception :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> UserDefinedExceptions {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> CustomerNotFoundException {
        <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">CustomerNotFoundException</span>();
    }
}

<span class="kw">class</span> CustomerNotFoundException <span class="kw">extends</span> <span class="bu">Exception</span> {

}</code></pre></div>
<p>Comme CustomerNotFoundException est un sous-type de Exception on peut déclarer que notre main peut lancer une exception plus générique.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> CustomerNotFoundException {
    <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">CustomerNotFoundException</span>();
}</code></pre></div>
<p>On pourra également décider de traiter l'erreur avec un try/catch.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
    <span class="kw">try</span> {
        <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">CustomerNotFoundException</span>();
    } <span class="kw">catch</span> (CustomerNotFoundException e) {
        e.<span class="fu">printStackTrace</span>();
    }
}</code></pre></div>
<p>On pourra attraper plus d'exception :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
    <span class="kw">try</span> {
        <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">CustomerNotFoundException</span>();
    } <span class="kw">catch</span> (<span class="bu">Exception</span> e) {
        e.<span class="fu">printStackTrace</span>();
    }
}</code></pre></div>
<p>Si notre code peut lancer plusieurs types d'exceptions (c'est quand même le but quand on est capable de filtrer).</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> UserDefinedExceptions {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        <span class="kw">try</span> {
            <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">CustomerNotFoundException</span>();
            <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">DuplicateCustomerException</span>();
        } <span class="kw">catch</span> (<span class="bu">Exception</span> e) {
            e.<span class="fu">printStackTrace</span>();
        }
    }
}

<span class="kw">class</span> CustomerNotFoundException <span class="kw">extends</span> <span class="bu">Exception</span> {

}

<span class="kw">class</span> DuplicateCustomerException <span class="kw">extends</span> <span class="bu">Exception</span> {

}</code></pre></div>
<p>Dans ce cas c'est la CustomerNotFoundException qui est lancée et gérée par le bloc catch.</p>
<p>Mais en inversant :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">try</span> {
    <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">DuplicateCustomerException</span>();
    <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">CustomerNotFoundException</span>();
} <span class="kw">catch</span> (<span class="bu">Exception</span> e) {
    e.<span class="fu">printStackTrace</span>();
}</code></pre></div>
<p>Ici c'est DuplicateCustomerException qui est lancée et rattrapée.</p>
<p>Si on ne souhaite pas traiter toute les exceptions on pourra ajouter plusieurs gestionnaire spécifiques plutôt qu'un seul générique.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
    <span class="kw">try</span> {
        <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">DuplicateCustomerException</span>();
        <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">CustomerNotFoundException</span>();
    } <span class="kw">catch</span> (DuplicateCustomerException e) {
        e.<span class="fu">printStackTrace</span>();
    } <span class="kw">catch</span> (CustomerNotFoundException e) {
        e.<span class="fu">printStackTrace</span>();
    }
}</code></pre></div>
<p>Mais attention à l'ordre des gestionnaires. L'exemple suivant ne compile pas car le premier bloc va traiter toute les exceptions laissant le 2e gestionnaire inutile.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
    <span class="kw">try</span> {
        <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">DuplicateCustomerException</span>();
        <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">CustomerNotFoundException</span>();
    } <span class="kw">catch</span> (<span class="bu">Exception</span> e) { 
        <span class="bu">System</span>.<span class="fu">err</span>.<span class="fu">println</span>(<span class="st">&quot;1&quot;</span>);
    } <span class="kw">catch</span> (CustomerNotFoundException e) { <span class="co">// exception CustomerNotFoundException </span>
                                            <span class="co">// has already been caught</span>
        <span class="bu">System</span>.<span class="fu">err</span>.<span class="fu">println</span>(<span class="st">&quot;2&quot;</span>);
    }
}</code></pre></div>
<p>En revanche avoir un catch qui attrape les exceptions des blocs précédents n'est pas un problème :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
    <span class="kw">try</span> {
        <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">DuplicateCustomerException</span>();
        <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">CustomerNotFoundException</span>();
    } <span class="kw">catch</span> (DuplicateCustomerException e) {
        <span class="bu">System</span>.<span class="fu">err</span>.<span class="fu">println</span>(<span class="st">&quot;1&quot;</span>);
    } <span class="kw">catch</span> (<span class="bu">Exception</span> e) {
        <span class="bu">System</span>.<span class="fu">err</span>.<span class="fu">println</span>(<span class="st">&quot;2&quot;</span>);
    }
}</code></pre></div>
<h2 id="multicatch"><span class="header-section-number">4.5</span> Multicatch</h2>
<p>Notons que pour plus de lisibilité, Java 7 a ajouté une syntaxe pour les catch multiples :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
    <span class="kw">try</span> {
        <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">DuplicateCustomerException</span>();
        <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">CustomerNotFoundException</span>();
    } <span class="kw">catch</span> (DuplicateCustomerException | CustomerNotFoundException e) {
        <span class="bu">System</span>.<span class="fu">err</span>.<span class="fu">println</span>(<span class="st">&quot;1&quot;</span>);
    }
}</code></pre></div>
<p>On peut tout à fait relancer une exeption qu'on a attrapée (le code qui suit ne compile pas pour une autre raison).</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
    <span class="kw">try</span> {
        <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">DuplicateCustomerException</span>();
        <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">CustomerNotFoundException</span>();
    } <span class="kw">catch</span> (DuplicateCustomerException | CustomerNotFoundException ex) {
        <span class="kw">throw</span> e; <span class="co">// unreported exception CustomerNotFoundException; </span>
                 <span class="co">// must be caught or declared to be thrown</span>
    }
}</code></pre></div>
<p>À ce stade, une question nous brule tous les lèvres : quel est le type de <code>ex</code> ?</p>
<p>Son type est le dénominateur commun entre <code>DuplicateCustomerException</code> et <code>CustomerNotFoundException</code> : le super type commun le plus proche. Dans notre cas c'est <code>Exception</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">Exception</span> {
    <span class="kw">try</span> {
        <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">DuplicateCustomerException</span>();
        <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">CustomerNotFoundException</span>();
    } <span class="kw">catch</span> (DuplicateCustomerException | CustomerNotFoundException ex) {
        <span class="kw">throw</span> e;
    }
}</code></pre></div>
<p>Pourtant le compilateur arrive aussi à calculer les types spécifique qui pourront être levés :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> DuplicateCustomerException, CustomerNotFoundException {
    <span class="kw">try</span> {
        <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">DuplicateCustomerException</span>();
        <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">CustomerNotFoundException</span>();
    } <span class="kw">catch</span> (DuplicateCustomerException | CustomerNotFoundException e) {
        <span class="kw">throw</span> e;
    }
}</code></pre></div>
<h2 id="chaînage"><span class="header-section-number">4.6</span>  Chaînage</h2>
<p>Il est souvent souhaitable d'encapsuler des exceptions dans d'autre exceptions plus abstraites. L'exception encapsulée est nommée « cause ». Dans la plupart des cas, les exceptions sont chaînées entre elles.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">Exception</span> {
    <span class="kw">try</span> {
        <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">CustomerNotFoundException</span>(); <span class="co">// line 6</span>
    } <span class="kw">catch</span> (CustomerNotFoundException ex) {
        <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">Exception</span>(ex); <span class="co">// line 8</span>
    }
}</code></pre></div>
<p>L'expression <code>new Exception(e)</code> construit une nouvelle exception sur sa cause <code>ex</code>.</p>
<p>Le programme affichera une trace contenant l'exception cause :</p>
<pre><code>Exception in thread &quot;main&quot; java.lang.Exception: fr.arolla.java8esgi.exceptions.demo.CustomerNotFoundException
    at fr.arolla.java8esgi.exceptions.demo.UserDefinedExceptions.main(UserDefinedExceptions.java:8)
Caused by: fr.arolla.java8esgi.exceptions.demo.CustomerNotFoundException
    at fr.arolla.java8esgi.exceptions.demo.UserDefinedExceptions.main(UserDefinedExceptions.java:6)</code></pre>
<p>En revanche, en ne construisant pas une nouvelle exception on perd le contexte de capture :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">Exception</span> {
    <span class="kw">try</span> {
        <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">CustomerNotFoundException</span>(); <span class="co">// line 6</span>
    } <span class="kw">catch</span> (CustomerNotFoundException ex) {
        <span class="kw">throw</span> ex;
    }
}</code></pre></div>
<pre><code>Exception in thread &quot;main&quot; fr.arolla.java8esgi.exceptions.demo.CustomerNotFoundException
    at fr.arolla.java8esgi.exceptions.demo.UserDefinedExceptions.main(UserDefinedExceptions.java:6)</code></pre>
<p>C'est une bonne pratique d'encapsuler une exception attrapée plutôt que de relancer la relancer (&quot;rethrow&quot;).</p>
<p>Pour combiner l'encapsulation et la généricité des exceptions on écrira donc :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> UserDefinedExceptions {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">Exception</span> {
        <span class="kw">try</span> {
            <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">CustomerNotFoundException</span>();
        } <span class="kw">catch</span> (CustomerNotFoundException ex) {
            <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">MainException</span>(ex); <span class="co">// constructor MainException cannot be applied</span>
        }
    }
}

<span class="kw">class</span> MainException <span class="kw">extends</span> <span class="bu">Exception</span> {

}</code></pre></div>
<p>Attention ce code ne compile pas car MainException ne définit aucun contructeur à un argument.</p>
<p>Corrigeons :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> MainException <span class="kw">extends</span> <span class="bu">Exception</span> {
    <span class="kw">public</span> <span class="fu">MainException</span>(<span class="bu">Exception</span> ex) {

    }
}</code></pre></div>
<p>Cependant il manque quelque chose. En effet, la trace n'affiche plus la cause :</p>
<pre><code>Exception in thread &quot;main&quot; fr.arolla.java8esgi.exceptions.demo.MainException
    at fr.arolla.java8esgi.exceptions.demo.UserDefinedExceptions.main(UserDefinedExceptions.java:8)</code></pre>
<p>Il faut appeler explicitement le super constructeur de Exception pour bénéficier du chaînage :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> MainException <span class="kw">extends</span> <span class="bu">Exception</span> {
    <span class="kw">public</span> <span class="fu">MainException</span>(<span class="bu">Exception</span> ex) {
        <span class="kw">super</span>(ex);
    }
}</code></pre></div>
<p>La trace indique maintenant l'exception de plus au niveau ainsi que sa cause :</p>
<pre><code>Exception in thread &quot;main&quot; fr.arolla.java8esgi.exceptions.demo.MainException: fr.arolla.java8esgi.exceptions.demo.CustomerNotFoundException
    at fr.arolla.java8esgi.exceptions.demo.UserDefinedExceptions.main(UserDefinedExceptions.java:8)
Caused by: fr.arolla.java8esgi.exceptions.demo.CustomerNotFoundException
    at fr.arolla.java8esgi.exceptions.demo.UserDefinedExceptions.main(UserDefinedExceptions.java:6)</code></pre>
<p>Bien évidement la chaîne pourra comporter autant d'exception que l'on veut (ici 2) :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">Exception</span> {
    <span class="kw">try</span> {
        <span class="fu">activateCustomer</span>();
    } <span class="kw">catch</span> (CustomerNotFoundException ex) {
        <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">MainException</span>(ex);
    }
}

<span class="kw">private</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">activateCustomer</span>() <span class="kw">throws</span> CustomerNotFoundException {
    <span class="kw">try</span> {
        <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">NoSuchRecordException</span>();
    } <span class="kw">catch</span> (NoSuchRecordException e) {
        <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">CustomerNotFoundException</span>(e);
    }
}</code></pre></div>
<pre><code>Exception in thread &quot;main&quot; fr.arolla.java8esgi.exceptions.demo.MainException: fr.arolla.java8esgi.exceptions.demo.CustomerNotFoundException: fr.arolla.java8esgi.exceptions.demo.NoSuchRecordException
    at fr.arolla.java8esgi.exceptions.demo.UserDefinedExceptions.main(UserDefinedExceptions.java:8)
Caused by: fr.arolla.java8esgi.exceptions.demo.CustomerNotFoundException: fr.arolla.java8esgi.exceptions.demo.NoSuchRecordException
    at fr.arolla.java8esgi.exceptions.demo.UserDefinedExceptions.activateCustomer(UserDefinedExceptions.java:16)
    at fr.arolla.java8esgi.exceptions.demo.UserDefinedExceptions.main(UserDefinedExceptions.java:6)
Caused by: fr.arolla.java8esgi.exceptions.demo.NoSuchRecordException
    at fr.arolla.java8esgi.exceptions.demo.UserDefinedExceptions.activateCustomer(UserDefinedExceptions.java:14)
    ... 1 more</code></pre>
<p>Comme on peut s'y attendre, l'instruction <code>throw</code> entraine les mêmes contraintes (vis-à-vis de l'appelant) que l'appel d'une méthode qui déclare lancer (throws) une exception.</p>
<h2 id="quelques-exceptions-communes"><span class="header-section-number">4.7</span> Quelques exceptions communes</h2>
<h3 id="nullpointerexception"><span class="header-section-number">4.7.1</span> NullPointerException</h3>
<p>C'est l'erreur qui représente probablement au moins 50% des bugs des applications Java.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> fr.arolla.java8esgi.exceptions;</span>

<span class="kw">public</span> <span class="kw">class</span> NullPointerDemo {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        <span class="bu">Object</span> o = <span class="kw">null</span>;
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(o.<span class="fu">hashCode</span>());
    }
}</code></pre></div>
<p>Le programme termine en erreur avec la sortie suivante :</p>
<pre><code>Exception in thread &quot;main&quot; java.lang.NullPointerException
    at fr.arolla.java8esgi.exceptions.NullPointerDemo.main(NullPointerDemo.java:6)</code></pre>
<h3 id="arrayindexoutofboundsexception"><span class="header-section-number">4.7.2</span> ArrayIndexOutOfBoundsException</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> fr.arolla.java8esgi.exceptions;</span>

<span class="kw">public</span> <span class="kw">class</span> ArrayExceptions {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        <span class="dt">int</span>[] values = <span class="kw">new</span> <span class="dt">int</span>[<span class="dv">0</span>];
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(values[<span class="dv">0</span>]);
    }
}</code></pre></div>
<p>Le programme termine en erreur avec cette trace de l'API du JDK :</p>
<pre><code>Exception in thread &quot;main&quot; java.lang.ArrayIndexOutOfBoundsException: 0
    at fr.arolla.java8esgi.exceptions.ArrayExceptions.main(ArrayExceptions.java:6)</code></pre>
<h3 id="illegalargumentexception"><span class="header-section-number">4.7.3</span> IllegalArgumentException</h3>
<p>L'API du JDK lance cette exception lorsque le programmeur invoque une méthode avec un paramètre incorrect. Le développeur d'application est aussi encouragé à lancer cette exception lorsque un paramètre est invalide.</p>
<p>Par exemple, l'instruction <code>Integer.parseInt(&quot;te&quot;);</code> lance une <code>NumberFormatException</code> qui est une spécialisation de <code>IllegalArgumentException</code>.</p>
<h3 id="stackoverflowerror"><span class="header-section-number">4.7.4</span> StackOverflowError</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> fr.arolla.java8esgi.exceptions;</span>

<span class="kw">public</span> <span class="kw">class</span> StackOverflowDemo {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        <span class="fu">foo</span>();
    }

    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">foo</span>() {
        <span class="fu">foo</span>();
    }
}</code></pre></div>
<p>Ce programme terminera aussi en erreur :</p>
<pre><code>Exception in thread &quot;main&quot; java.lang.StackOverflowError
    at fr.arolla.java8esgi.exceptions.StackOverflowDemo.foo(StackOverflowDemo.java:9)
    at fr.arolla.java8esgi.exceptions.StackOverflowDemo.foo(StackOverflowDemo.java:9)
    at fr.arolla.java8esgi.exceptions.StackOverflowDemo.foo(StackOverflowDemo.java:9)
        ...</code></pre>
<h2 id="intérêt-des-exceptions"><span class="header-section-number">4.8</span> Intérêt des exceptions</h2>
<p>Les exceptions résolvent un problème dans l'écriture de programmes : le mélange de la logique principale et de la gestion d'erreurs. Les exceptions sont un moyen de séparer ces 2 considérations.</p>
<p>Imaginons en effet le programme très simple (pas de règle logique =&gt; pas de <code>if</code>), qui exécute en 3 actions en séquence :</p>
<pre><code>action 1
action 2
action 3</code></pre>
<p>Tout programme devrait traiter les cas d'erreurs. Traditionnellement (par ex. en C) on utilise des code erreurs retournés par les fonctions appelées.</p>
<pre><code>essayer l&#39;action 1
if (l&#39;action 1 est succès) {
   essayer l&#39;action 2
   if (l&#39;action 2 est succès) {
      essayer l&#39;action 3
      if (l&#39;action 3 est succès) {
         ...
      } else {
         traiter l&#39;erreur 3
      }
   } else {
     traiter l&#39;erreur 2
   }
} else {
  traiter l&#39;erreur 1
}</code></pre>
<p>Si notre programme était plus complexe qu'une séquence, les <code>if</code> codant le métier et les <code>if</code> traitant des erreurs seraient mélangés et donnerait un code encore plus compliqué que celui-ci.</p>
<p>De plus, le mécanisme de traçage permet de montrer la source d'une erreur. Dans de nombreux langages, trouver la ligne responsable d'une erreur à l'exécution est une tâche ardue.</p>
<h2 id="catégories-dexceptions"><span class="header-section-number">4.9</span> Catégories d'exceptions</h2>
<p>Le compilateur et l'environnement d'exécution distinguent 3 catégories : les <code>Exception</code>, les <code>RuntimeException</code> et les <code>Error</code>. Les <code>Exception</code> (et les classes filles, sauf RuntimeException) que nous avons vu jusqu'ici obligent le programmeur à (1) propager ou à (2) traiter. En revanche, il existe une catégorie spéciale d'exception qui n'obligent pas le programmeur à quoi que ce soit.</p>
<p>Par défaut donc les <code>Exception</code> sont vérifiées (checked). Parmis elles, les <code>RuntimeException</code> sont exemptées de vérification (unchecked).</p>
<p>Ainsi, on pourra compiler le code suivant :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">void</span> <span class="fu">fail</span>() {
    <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">RuntimeException</span>();
}</code></pre></div>
<p>De la même manière, on peut compiler :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">void</span> <span class="fu">checkNotNull</span>(<span class="bu">Object</span> a) {
    <span class="kw">if</span> (a == <span class="kw">null</span>) {
       <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">NullPointerException</span>();
    }
}</code></pre></div>
<p>Car <code>NullPointerException</code> est une classe dérivée de <code>RuntimeException</code>.</p>
<p>Notons que bien qu'exempté de l'obligation, il est légal, <em>mais déconseillé</em> de déclarer et surtout de traiter une exception non vérifiée.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">void</span> <span class="fu">test</span>(<span class="bu">String</span> text) {
    <span class="kw">try</span> {
        <span class="fu">checkNotNull</span>(text);
    } <span class="kw">catch</span> (<span class="bu">NullPointerException</span> e) { <span class="co">// à éviter !</span>
        <span class="co">// ...</span>
    }
}

<span class="dt">void</span> <span class="fu">checkNotNull</span>(<span class="bu">Object</span> a) <span class="kw">throws</span> <span class="bu">NullPointerException</span> {
    <span class="kw">if</span> (a == <span class="kw">null</span>) {
       <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">NullPointerException</span>();
    }
}</code></pre></div>
<p>Dans le cas général, il est déconseillé de traiter des exceptions non vérifiées car se sont des erreurs grave de programmation. Dans la plupart des cas, il est préférable que le programme ou le composant s'arrète plutôt qu'il soit dans un état incontrolable. Le programmeur devrait toujours s'assurer (par ex. à l'aide d'un <code>if</code>) qu'aucune &quot;runtime&quot; ne soit levée.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> A {
    <span class="dt">void</span> <span class="fu">foo</span>(<span class="bu">String</span> text) {
        <span class="kw">if</span> (text != <span class="kw">null</span>) { <span class="co">// on contrôle la situation</span>
            <span class="fu">test</span>(text);
        }
    }
}

<span class="kw">class</span> B {
    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">test</span>(<span class="bu">String</span> text) {
        <span class="fu">checkNotNull</span>(text);
    }

    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">checkNotNull</span>(<span class="bu">Object</span> a) <span class="kw">throws</span> <span class="bu">NullPointerException</span> {
        <span class="kw">if</span> (a == <span class="kw">null</span>) {
           <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">NullPointerException</span>();
        }
    }
}</code></pre></div>
<p>En revanche, les erreurs vérifiées correspondent à des erreurs métiers (par ex. le possesseur d'une carte bleue est en découvert au moment d'un retrait) ou du à l'environnement (fichier inexistant, serveur injoignable, etc).</p>
<p>Les <code>Error</code> pour finir sont lancées par la JVM elle même. Elle ne devraient pas être traitées par le programmeur d'application.</p>
<h2 id="exercice-1-3"><span class="header-section-number">4.10</span> Exercice 1</h2>
<p>Écrire une méthode qui prend en paramètres 2 objets non <code>null</code> et retourne la somme de leur <code>hashCode()</code>. Quelles exceptions devrait-on lancer si un des 2 paramètres est <code>null</code> ?</p>
<h2 id="exercice-2-3"><span class="header-section-number">4.11</span> Exercice 2</h2>
<ol style="list-style-type: decimal">
<li>Écrire un programme qui affiche le titre entier du livre dont un mot-clé de recherche a été passé en argument.</li>
<li>Quand aucun livre n'est trouvé, lancer une <code>BookNotFoundException</code>.</li>
<li>Quand plus d'un livre est trouvé, lancer une <code>AmbiguousBookException</code>.</li>
</ol>
<p>Le fichier books.csv contiendra par exemple :</p>
<pre><code>1984
Le meilleur des mondes
La guerre des mondes</code></pre>
<p>Exemple de session :</p>
<pre class="shell"><code>$ java BookPrice &quot;0000&quot;
Exception in thread &quot;main&quot; BookNotFoundException: no book matches &quot;0000&quot;

$ java BookPrice &quot;84&quot;
1984

$ java BookPrice &quot;Le&quot;
Le meilleur des mondes

$ java BookPrice &quot;mondes&quot;
Exception in thread &quot;main&quot; AmbiguousBookException: 2 books matches &quot;mondes&quot;</code></pre>
<h2 id="exercice-3-2"><span class="header-section-number">4.12</span> Exercice 3</h2>
<p>Modifier le programme précédent de sorte d'afficher le prix du livre quand la recherche est fructueuse.</p>
<p>Le programme se comportera de la façon suivante :</p>
<pre class="shell"><code>$ cat books.csv
1984;59.99 EUR
Le Meilleur des Mondes;49.99 EUR
La Guerre des Mondes;69.99 EUR

$ java BookPrice &quot;84&quot;
59.99 EUR

$ java BookPrice &quot;monde&quot;
Recherche ambigüe : 2 résultats trouvés ! </code></pre>
<h2 id="exercice-4-2"><span class="header-section-number">4.13</span> Exercice 4</h2>
<p>Modifier le programme précédent pour rendre le programme interactif. Le programme ne prend plus d'argument mais lit sur son entrée standard.</p>
<p>De plus, le programme ne doit pas s'arréter quand une recherche donne 0 ou plus de 2 résultats.</p>
<p>Pour terminer le programme on utilisera le pseudo caractère de fin de fichier (EOF) qu'on écrit avec CTRL-D.</p>
<p>Exemple de session :</p>
<pre class="shell"><code>$ java BookPrice
&gt; monde
Recherche ambigüe : 2 résultats trouvés !
&gt; 84 
59.99 EUR
&gt; ^D</code></pre>
<h2 id="exercice-5-2"><span class="header-section-number">4.14</span> Exercice 5</h2>
<p>Ecrire un ensemble de programmes qui simule une gestion naïve de comptes bancaires. Le système doit gérer au moins les 4 fonctions suivantes :</p>
<ul>
<li>dépot de l'argent sur un compte ;</li>
<li>paiement ;</li>
<li>paiement sans contact ;</li>
<li>affichage du solde.</li>
</ul>
<p>Exemple de session :</p>
<pre class="shell"><code>$ java MakeDeposit 200.00 Pauly
Exception in thread &quot;main&quot; AccountNotFoundException: ...

$ java CreateAccount Pauly
OK

$ java PerformContactlessPayment 19.00 Pauly
OK

$ java PerformPayment 100.00 Pauly
OK

$ java PerformPayment 300.00 Pauly
Exception in thread &quot;main&quot; TooLowBalanceException...</code></pre>
<p>Remarques :</p>
<ul>
<li>Le dépot se fait en euros.</li>
<li>Un utilisateur a 0 ou 1 compte courant.</li>
<li>Le montant d'un paiement sans contact est limité à 20 EUR.</li>
<li>Le paiement sans contact jour est limité à 100 EUR.</li>
<li>Le montant par semaine est limité à 400 EUR.</li>
<li>Le solde glissant doit être affiché.</li>
</ul>
<p>Le code Java devra être composé de plusieurs classes (par ex. Bank, Amount, Payment, Deposit, Balance, etc.).</p>
<p>On utilisera la classe <a href="https://docs.oracle.com/javase/8/docs/api/java/time/LocalDateTime.html">LocalDateTime</a> pour vérifier de solde glissant sur un jour/semaine.</p>
<h2 id="finally"><span class="header-section-number">4.15</span> Finally</h2>
<p>Jusqu'ici on a traité les exceptions de manière plutôt naïve. Que se passe t'il quand on ouvre un fichier (sans erreur) mais qu'une exception survient lors de l'écriture ?</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">FileOutputStream</span> fileOutputStream = <span class="kw">null</span>;
<span class="kw">try</span> {
    fileOutputStream = <span class="kw">new</span> <span class="bu">FileOutputStream</span>(<span class="st">&quot;example.txt&quot;</span>);
    <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">IOException</span>(<span class="st">&quot;&quot;</span>); <span class="co">// simule un write en erreur</span>
    <span class="bu">System</span>.<span class="fu">err</span>.<span class="fu">println</span>(<span class="st">&quot;Close&quot;</span>);
    fileOutputStream.<span class="fu">close</span>();
} <span class="kw">catch</span> (<span class="bu">IOException</span> e) {
    e.<span class="fu">printStackTrace</span>();
}
<span class="bu">System</span>.<span class="fu">err</span>.<span class="fu">println</span>(<span class="st">&quot;End&quot;</span>);</code></pre></div>
<pre><code>java.io.IOException: 
    at fr.arolla.java8esgi.exceptions.TryFinally.main(TryFinally.java:11)
End</code></pre>
<p>Dans ce cas <code>close()</code> n'est jamais appelée !</p>
<p>Pour être sûr de libérer les ressources à tous les coups, il faut utiliser un bloc <code>finally</code> :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">FileOutputStream</span> fileOutputStream = <span class="kw">null</span>;
<span class="kw">try</span> {
    fileOutputStream = <span class="kw">new</span> <span class="bu">FileOutputStream</span>(<span class="st">&quot;example.txt&quot;</span>);
    <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">IOException</span>(<span class="st">&quot;&quot;</span>);
} <span class="kw">catch</span> (<span class="bu">IOException</span> e) {
    e.<span class="fu">printStackTrace</span>();
} <span class="kw">finally</span> {
    <span class="bu">System</span>.<span class="fu">err</span>.<span class="fu">println</span>(<span class="st">&quot;Close&quot;</span>);
    <span class="kw">if</span> (fileOutputStream != <span class="kw">null</span>) {
        fileOutputStream.<span class="fu">close</span>();
    }
}
<span class="bu">System</span>.<span class="fu">err</span>.<span class="fu">println</span>(<span class="st">&quot;End&quot;</span>);</code></pre></div>
<pre><code>java.io.IOException: 
    at fr.arolla.java8esgi.exceptions.TryFinally.main(TryFinally.java:11)
Close
End</code></pre>
<p>Le bloc catch est optionnel :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">try</span> {
    
} <span class="kw">finally</span> {
    
}</code></pre></div>
<p>Une fois entré dans le try, le bloc finally est toujours appelé, même en cas de <code>return</code>. Le return sera exécuté mais après que le finally termine. Ainsi,</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
    <span class="dt">int</span> foo = <span class="fu">foo</span>();
    <span class="bu">System</span>.<span class="fu">err</span>.<span class="fu">println</span>(<span class="st">&quot;return &quot;</span> + foo);
}

<span class="kw">private</span> <span class="dt">static</span> <span class="dt">int</span> <span class="fu">foo</span>() {
    <span class="kw">try</span> {
        <span class="bu">System</span>.<span class="fu">err</span>.<span class="fu">println</span>(<span class="st">&quot;try&quot;</span>);
        <span class="kw">return</span> <span class="dv">1</span>;
    } <span class="kw">finally</span> {
        <span class="bu">System</span>.<span class="fu">err</span>.<span class="fu">println</span>(<span class="st">&quot;finally&quot;</span>);
    }
}</code></pre></div>
<p>Affichera :</p>
<pre><code>try
finally
return 1</code></pre>
<p>En revanche, en cas de return dans le finally, celui-ci prendra la main.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
    <span class="dt">int</span> foo = <span class="fu">foo</span>();
    <span class="bu">System</span>.<span class="fu">err</span>.<span class="fu">println</span>(<span class="st">&quot;return &quot;</span> + foo);
}

<span class="kw">private</span> <span class="dt">static</span> <span class="dt">int</span> <span class="fu">foo</span>() {
    <span class="kw">try</span> {
        <span class="bu">System</span>.<span class="fu">err</span>.<span class="fu">println</span>(<span class="st">&quot;try&quot;</span>);
        <span class="kw">return</span> <span class="dv">1</span>;
    } <span class="kw">finally</span> {
        <span class="bu">System</span>.<span class="fu">err</span>.<span class="fu">println</span>(<span class="st">&quot;finally&quot;</span>);
        <span class="kw">return</span> <span class="dv">2</span>;
    }
}</code></pre></div>
<pre><code>try
finally
return 2</code></pre>
<p>Notons que la fermeture du fichier pouvant lever une exception il faut ou bien la déclarer ou bien la gérer.</p>
<p>On peut donc très facilement aboutir à cet idiome de programmation simplement pour ouvrir et fermer un fichier...</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">FileOutputStream</span> fileOutputStream = <span class="kw">null</span>;
<span class="kw">try</span> {
    fileOutputStream = <span class="kw">new</span> <span class="bu">FileOutputStream</span>(<span class="st">&quot;example.txt&quot;</span>);
    <span class="kw">if</span> (<span class="kw">true</span>) <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">IOException</span>(<span class="st">&quot;&quot;</span>);
} <span class="kw">catch</span> (<span class="bu">IOException</span> e) {
    e.<span class="fu">printStackTrace</span>();
} <span class="kw">finally</span> {
    <span class="bu">System</span>.<span class="fu">err</span>.<span class="fu">println</span>(<span class="st">&quot;Close&quot;</span>);
    <span class="kw">if</span> (fileOutputStream != <span class="kw">null</span>) {
        <span class="kw">try</span> {
            fileOutputStream.<span class="fu">close</span>();
        } <span class="kw">catch</span> (<span class="bu">IOException</span> e) {
            e.<span class="fu">printStackTrace</span>();
        }
    }
}
<span class="bu">System</span>.<span class="fu">err</span>.<span class="fu">println</span>(<span class="st">&quot;End&quot;</span>);</code></pre></div>
<h2 id="try-with"><span class="header-section-number">4.16</span> Try with</h2>
<p>Pour gérer les ressources de manière plus simple et sécurisé on utilisera une syntaxe apportée par Java 7 :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">try</span> (<span class="bu">FileOutputStream</span> fileOutputStream = <span class="kw">new</span> <span class="bu">FileOutputStream</span>(<span class="st">&quot;example.txt&quot;</span>)) {
    fileOutputStream.<span class="fu">write</span>(<span class="dv">0</span>);
} <span class="kw">catch</span> (<span class="bu">FileNotFoundException</span> e) {
    e.<span class="fu">printStackTrace</span>();
} <span class="kw">catch</span> (<span class="bu">IOException</span> e) {
    e.<span class="fu">printStackTrace</span>();
}</code></pre></div>
<p>La syntaxe <code>try (...) {}</code> est un bloc try dans lequel on déclare 1 ou plusieurs ressources. Une ressource qui est un objet qui doit être clos dès qu'on a fini de travailler avec. Contrairement à un bloc try classique celui-ci ferme chaque ressource déclarée dans l'entête (entre parenthèses) à la fin du bloc d'instructions. L'entête attend des ressources type <code>java.lang.AutoCloseable</code>.</p>
<p>Notons que l'entête (&quot;try-with-resource&quot;) appelle implicitement <code>close()</code> qui peut déclarer des exceptions.</p>
<p>Dans le cas ou une exception surviendrait dans le bloc try, une exception qui serait levée au <code>close()</code> serait supprimée. On utilisera la méthode <code>Throwable.getSuppressed()</code> sur l'exception rattrapée afin de récupérer celles qui ont été supprimées (pour permettre à celle-ci d'être lancée).</p>
<p>L'ordre d'exécution des close() est l'inverse le l'ordre de leur création.</p>
<h1 id="les-generics"><span class="header-section-number">5</span> Les Generics</h1>
<h2 id="algorithme"><span class="header-section-number">5.1</span> Algorithme</h2>
<h3 id="exercice-1-4"><span class="header-section-number">5.1.1</span> Exercice 1</h3>
<p>Développer une classe qui se comporte comme suit :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">IntegerContainer empty = <span class="kw">new</span> <span class="fu">IntegerContainer</span>();
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(empty); <span class="co">// &quot;&quot;</span>

IntegerContainer b = <span class="kw">new</span> <span class="fu">IntegerContainer</span>(<span class="dv">42</span>);
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(b); <span class="co">// &quot;42&quot;</span>

IntegerContainer z = <span class="kw">new</span> <span class="fu">IntegerContainer</span>(<span class="dv">0</span>);
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(z); <span class="co">// &quot;0&quot;</span>

IntegerContainer n = <span class="kw">new</span> <span class="fu">IntegerContainer</span>(<span class="kw">null</span>); <span class="co">// IllegalArgumentException</span></code></pre></div>
<h3 id="exercice-2-4"><span class="header-section-number">5.1.2</span> Exercice 2</h3>
<p>Ajouter une méthode <code>first()</code> :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">IntegerContainer empty = <span class="kw">new</span> <span class="fu">IntegerContainer</span>();
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(empty.<span class="fu">first</span>()); <span class="co">// IllegalStateException: empty container</span>

IntegerContainer b = <span class="kw">new</span> <span class="fu">IntegerContainer</span>(<span class="dv">42</span>);
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(b.<span class="fu">first</span>()); <span class="co">// 42</span></code></pre></div>
<h3 id="exercice-3-3"><span class="header-section-number">5.1.3</span> Exercice 3</h3>
<p>Modifier la classe <code>IntegerContainer</code> de sorte de prendre un nombre arbitraire d'entiers. Ajouter une méthode <code>countEqual(Integer value)</code> qui compte le nombre d'entiers égaux au paramètre.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">IntegerContainer a = <span class="kw">new</span> <span class="fu">IntegerContainer</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">10</span>);
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(a.<span class="fu">countEqual</span>(<span class="dv">10</span>)); <span class="co">// 2</span>
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(a); <span class="co">// {10, 20, 10}</span></code></pre></div>
<h3 id="exercice-4-3"><span class="header-section-number">5.1.4</span> Exercice 4</h3>
<p>Développer une classe <code>DoubleContainer</code> qui prend un nombre arbitraire de nombres réels. Implémenter la méthode <code>toString()</code>, <code>first()</code> et <code>countEqual(Double value)</code>.</p>
<h3 id="exercice-5-3"><span class="header-section-number">5.1.5</span> Exercice 5</h3>
<p>Mettre en commun le code de <code>IntegerContainer</code> et <code>DoubleContainer</code> en utilisant le type commun (<code>Object</code>).</p>
<h2 id="paramètre-de-valeur"><span class="header-section-number">5.2</span> Paramètre de valeur</h2>
<p>Quand 2 méthodes définissent un code similaire on peut paramétrer la méthode.</p>
<p>Par exemple :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">double</span> <span class="fu">bookDiscount</span>() {
    <span class="kw">return</span> applyDiscount ? <span class="fl">0.8</span> : <span class="dv">1</span>;
}

<span class="dt">double</span> <span class="fu">postcardDiscount</span>() {
    <span class="kw">return</span> applyDiscount ? <span class="fl">0.9</span> : <span class="dv">1</span>;
}</code></pre></div>
<p>Peut se mettre en commun comme suit :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">double</span> <span class="fu">bookDiscount</span>() {
    <span class="kw">return</span> <span class="fu">discount</span>(<span class="fl">0.8</span>);
}

<span class="dt">double</span> <span class="fu">postcardDiscount</span>() {
    <span class="kw">return</span> <span class="fu">discount</span>(<span class="fl">0.9</span>);
}

<span class="dt">double</span> <span class="fu">discount</span>(<span class="dt">double</span> discount) {
    <span class="kw">return</span> applyDiscount ? discount : <span class="dv">1</span>;
}</code></pre></div>
<p>La méthode <code>discount(double)</code> est paramétrée pour mettre en commun le code commun à <code>bookDiscount()</code> et <code>postcardDiscount()</code>.</p>
<p>Pour mettre en commun une constante (ou une variable),</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">void</span> <span class="fu">foo</span>() {
    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="dv">42</span>);
}</code></pre></div>
<p>on introduit un paramètre :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">void</span> <span class="fu">foo</span>(<span class="dt">int</span> value) {
    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(value);
}</code></pre></div>
<h2 id="paramètre-de-type"><span class="header-section-number">5.3</span> Paramètre de type</h2>
<p>De manière similaire quand on veut mettre en commun non pas une valeur mais un type, on utilise un paramètre de type.</p>
<p>On transforme les deux classes :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> IntegerContainer {
    ...
    <span class="bu">Integer</span> <span class="fu">first</span>() {
        <span class="kw">return</span> values[<span class="dv">0</span>];
    }
}

<span class="kw">class</span> DoubleContainer {
    ...
    <span class="bu">Double</span> <span class="fu">first</span>() {
        <span class="kw">return</span> values[<span class="dv">0</span>];
    }
}</code></pre></div>
<p>En une seule classe paramétrée :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> GenericContainer&lt;T&gt; {
    ...
    T <span class="fu">first</span>() {
        <span class="kw">return</span> values[<span class="dv">0</span>];
    }
}</code></pre></div>
<p>Pour utiliser cette classe paramétrée :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">GenericContainer&lt;<span class="bu">Integer</span>&gt; ic = <span class="kw">new</span> GenericContainer&lt;<span class="bu">Integer</span>&gt;();
GenericContainer&lt;<span class="bu">Double</span>&gt; dc = <span class="kw">new</span> GenericContainer&lt;<span class="bu">Double</span>&gt;();</code></pre></div>
<p>On peut également déclarer un paramètre de type sur une méthode :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> Foo {
    &lt;T&gt; T <span class="fu">get</span>(T value) {
        <span class="kw">return</span> <span class="kw">null</span>;
    }
}</code></pre></div>
<p>Pour appeler la méthode on doit fournir un argument (ici <code>Integer</code>) :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Foo foo = <span class="kw">new</span> <span class="fu">Foo</span>();
<span class="bu">Integer</span> x = foo.&lt;<span class="bu">Integer</span>&gt;<span class="fu">get</span>(<span class="kw">new</span> <span class="bu">Integer</span>(<span class="dv">42</span>));</code></pre></div>
<p>La syntaxe dans sa forme générale est particulièrement verbeuse. En revanche, grâce à l'inférence de type améliorée on pourra écrire en pratique :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">Integer</span> x = foo.<span class="fu">get</span>(<span class="kw">new</span> <span class="bu">Integer</span>(<span class="dv">42</span>));</code></pre></div>
<p>Le compilateur a déduit que l'argument de type devait forcément être <code>Integer</code> puisqu'il est spécifié en paramètre.</p>
<h2 id="exercice-6-2"><span class="header-section-number">5.4</span> Exercice 6</h2>
<p>Définir la méthode <code>&lt;T&gt; T failIfNull(T object)</code> qui lance une <code>IllegalArgumentException</code> si l'argument est <code>null</code> ou bien retourne l'argument sinon.</p>
<h2 id="exercice-7-2"><span class="header-section-number">5.5</span> Exercice 7</h2>
<p>Définir une classe <code>CheckedBox</code> qui peut stocker un objet dont le type est paramétré. Le constructeur vide sera utilisé pour créer une boîte vide. Ajouter une méthode <code>get()</code> qui renvoie ledit objet et qui lance une <code>IllegalStateException</code> si la boîte est vide.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">CheckedBox&lt;<span class="bu">Integer</span>&gt; integerBox = <span class="kw">new</span> CheckedBox&lt;&gt;(<span class="dv">42</span>); <span class="co">// &lt;=&gt; new CheckedBox&lt;Integer&gt;(42) grâce à l&#39;inférence de type</span>
<span class="bu">Integer</span> boxContent = integerBox.<span class="fu">get</span>();
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(boxContent);</code></pre></div>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">CheckedBox&lt;<span class="bu">String</span>&gt; stringBox = <span class="kw">new</span> CheckedBox&lt;&gt;(<span class="st">&quot;hello&quot;</span>);
<span class="bu">String</span> stringContent = stringBox.<span class="fu">get</span>();
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(stringContent);</code></pre></div>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">CheckedBox&lt;?&gt; emptyBox = <span class="kw">new</span> CheckedBox&lt;&gt;();
<span class="bu">Object</span> emptyBoxContent = emptyBox.<span class="fu">get</span>(); <span class="co">// IllegalStateException: null</span></code></pre></div>
<h2 id="exercice-8-1"><span class="header-section-number">5.6</span> Exercice 8</h2>
<p>Créer une classe <code>Pair&lt;T&gt;</code> générique. Elle doit stocker 2 éléments de même type. Redéfinir la méthode <code>toString()</code> et définir la méthode <code>reverse()</code> qui crée une nouvelle paire dont les éléments sont inversés.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Pair&lt;<span class="bu">String</span>&gt; pair = <span class="kw">new</span> Pair&lt;&gt;(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>);
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(pair); <span class="co">// (a, b)</span>

Pair&lt;<span class="bu">String</span>&gt; reversedPair = pair.<span class="fu">reverse</span>();
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(reversedPair); <span class="co">// (b, a)</span></code></pre></div>
<h2 id="exercice-9-2"><span class="header-section-number">5.7</span> Exercice 9</h2>
<p>Écrire une classe générique qui stocke 2 objets dont les types sont paramétrés et peuvent être différents.</p>
<p>La syntaxe pour définir 2 paramètres de type <code>T</code> et <code>U</code> sur une classe est :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> Foo&lt;T, U&gt; {
    
}</code></pre></div>
<p>Voici un exemple d'usage de la classe :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Tuple2&lt;<span class="bu">Integer</span>, <span class="bu">String</span>&gt; ok = <span class="kw">new</span> Tuple2&lt;&gt;(<span class="dv">200</span>, <span class="st">&quot;OK&quot;</span>);
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(ok); <span class="co">// (200, OK)</span>

Tuple2&lt;<span class="bu">String</span>, <span class="bu">Integer</span>&gt; reversedOk = ok.<span class="fu">reverse</span>();
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(reversedOk); <span class="co">// (OK, 200)</span>

Tuple2&lt;Tuple2&lt;<span class="bu">Integer</span>, <span class="bu">String</span>&gt;, Tuple2&lt;<span class="bu">Integer</span>, <span class="bu">String</span>&gt;&gt; forbiddenError =
        <span class="kw">new</span> Tuple2&lt;&gt;(<span class="kw">new</span> Tuple2&lt;&gt;(<span class="dv">403</span>, <span class="st">&quot;Forbidden&quot;</span>), <span class="kw">new</span> Tuple2&lt;&gt;(<span class="dv">500</span>, <span class="st">&quot;Internal Server Error&quot;</span>));
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(forbiddenError); <span class="co">// ((403, Forbidden), (500, Internal Server Error))</span>

Tuple2&lt;Tuple2&lt;<span class="bu">Integer</span>, <span class="bu">String</span>&gt;, Tuple2&lt;<span class="bu">Integer</span>, <span class="bu">String</span>&gt;&gt; errorForbidden =
        forbiddenError.<span class="fu">reverse</span>();
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(errorForbidden); <span class="co">// ((500, Internal Server Error), (403, Forbidden))</span></code></pre></div>
<h2 id="exercice-10-2"><span class="header-section-number">5.8</span> Exercice 10</h2>
<p>Ajouter une 2 getters <code>getA()</code> et <code>getB()</code> à la classe <code>Tuple2&lt;T, U&gt;</code>. Puis réécrire la classe <code>Pair</code> à l'aide de la classe <code>Tuple2</code>.</p>
<h2 id="exercice-11-2"><span class="header-section-number">5.9</span> Exercice 11</h2>
<p>Écrire la classe <code>GenericContainer&lt;T&gt;</code> : la version générique de <code>ObjectContainer</code>.</p>
<p>Elle doit implémenter les méthodes <code>String toString()</code>, <code>Object first()</code> et <code>int countEqual(Object element)</code>.</p>
<p>Puis, ajouter une méthode <code>GenericContainer&lt;T&gt; repeat(int count)</code> qui a le comportement suivant :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">GenericContainer&lt;<span class="bu">Integer</span>&gt; a = <span class="kw">new</span> GenericContainer&lt;&gt;();
GenericContainer&lt;<span class="bu">Integer</span>&gt; ad = a.<span class="fu">repeat</span>(<span class="dv">2</span>);
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(ad); <span class="co">// &quot;{}&quot;</span>

GenericContainer&lt;<span class="bu">Integer</span>&gt; b = <span class="kw">new</span> GenericContainer&lt;&gt;(<span class="dv">42</span>);
GenericContainer&lt;<span class="bu">Integer</span>&gt; bd = b.<span class="fu">repeat</span>(<span class="dv">2</span>);
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(bd); <span class="co">// &quot;{42, 42}&quot;</span>

GenericContainer&lt;<span class="bu">Integer</span>&gt; c = <span class="kw">new</span> GenericContainer&lt;&gt;(<span class="dv">42</span>);
GenericContainer&lt;<span class="bu">Integer</span>&gt; cd = c.<span class="fu">repeat</span>(<span class="dv">3</span>);
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(cd); <span class="co">// &quot;{42, 42, 42}&quot;</span>

GenericContainer&lt;<span class="bu">Integer</span>&gt; d = <span class="kw">new</span> GenericContainer&lt;&gt;(<span class="dv">42</span>, <span class="dv">100</span>);
GenericContainer&lt;<span class="bu">Integer</span>&gt; dd = d.<span class="fu">repeat</span>(<span class="dv">3</span>);
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(dd); <span class="co">// &quot;{42, 42, 42, 100, 100, 100}&quot;</span>

GenericContainer&lt;<span class="bu">Integer</span>&gt; e = <span class="kw">new</span> GenericContainer&lt;&gt;(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>);
GenericContainer&lt;<span class="bu">Integer</span>&gt; ed = e.<span class="fu">repeat</span>(<span class="dv">1</span>);
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(ed); <span class="co">// &quot;{10, 20, 30}&quot;</span>

GenericContainer&lt;<span class="bu">Integer</span>&gt; f = <span class="kw">new</span> GenericContainer&lt;&gt;(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>);
GenericContainer&lt;<span class="bu">Integer</span>&gt; fd = f.<span class="fu">repeat</span>(<span class="dv">0</span>);
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(fd); <span class="co">// &quot;{}&quot;</span></code></pre></div>
<h2 id="exercice-12-2"><span class="header-section-number">5.10</span> Exercice 12</h2>
<p>Ajouter une méthode de fabrique <code>static</code> à la classe <code>Pair&lt;T&gt;</code> qui crée une paire d'éléments identiques.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Pair&lt;<span class="bu">Integer</span>&gt; pair = Pair.&lt;<span class="bu">Integer</span>&gt;<span class="fu">duplicate</span>(<span class="dv">1</span>);
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(pair); <span class="co">// (1, 1)</span></code></pre></div>
<h2 id="tableaux"><span class="header-section-number">5.11</span> Tableaux</h2>
<p>Les tableaux sont typés :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span>[] intArray = <span class="kw">new</span> <span class="dt">int</span>[] {<span class="dv">10</span>, <span class="dv">20</span>};
<span class="dt">double</span>[] doubleArray = <span class="kw">new</span> <span class="dt">double</span>[] {10_000d, 20_000d};
<span class="bu">Object</span>[] objectArray = <span class="kw">new</span> <span class="bu">Object</span>[] {<span class="kw">new</span> <span class="bu">Object</span>(), <span class="kw">new</span> <span class="bu">Integer</span>(<span class="dv">10</span>), <span class="st">&quot;hello&quot;</span>};
Person[] personArray = <span class="kw">new</span> Person[] {<span class="kw">new</span> <span class="fu">Person</span>(), <span class="kw">new</span> <span class="fu">Employee</span>(), <span class="kw">null</span>};</code></pre></div>
<p>Ils peuvent contenir des valeurs (types primitifs) et des références (types classes).</p>
<p>Les tableaux (&quot;array&quot;) sont relativement sécurisés : on ne peut pas ajouter par exemple un <code>Integer</code> dans un tableau de <code>String</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">String</span>[] stringArray = <span class="kw">new</span> <span class="bu">String</span>[] { <span class="kw">new</span> <span class="bu">Integer</span>(<span class="dv">10</span>) }; <span class="co">// incompatible types</span></code></pre></div>
<p>De la même manière :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">String</span>[] stringArray = <span class="kw">new</span> <span class="bu">String</span>[<span class="dv">1</span>];
stringArray[<span class="dv">0</span>] = <span class="kw">new</span> <span class="bu">Integer</span>(<span class="dv">10</span>); <span class="co">// incompatible types: </span>
                                  <span class="co">// Integer cannot be converted to String</span></code></pre></div>
<p>Sans surprise, on ne peut affecter un élément d'un tableau de <code>String</code> dans un <code>Integer</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">String</span>[] stringArray = <span class="kw">new</span> <span class="bu">String</span>[<span class="dv">1</span>];
<span class="bu">Integer</span> i = stringArray[<span class="dv">0</span>]; <span class="co">// incompatible types:</span>
                            <span class="co">// String cannot be converted to Integer</span></code></pre></div>
<p>En revanche, rien n'empêche de placer dans un tableau de <code>Person</code> un objet <code>Employee</code> :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Person[] personArray = <span class="kw">new</span> Person[<span class="dv">1</span>];
personArray[<span class="dv">0</span>] = <span class="kw">new</span> <span class="fu">Person</span>();
person[<span class="dv">0</span>] = <span class="kw">new</span> <span class="fu">Employee</span>();</code></pre></div>
<p>Avec :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> Person {
}

<span class="kw">class</span> Employee <span class="kw">extends</span> Person {
}</code></pre></div>
<p>Ou d'affecter un élément dans une référence de type plus général :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">Object</span> object = personArray[<span class="dv">0</span>];</code></pre></div>
<p>Cette situation se rapproche de la notion usuelle d'héritage :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Person person = <span class="kw">new</span> <span class="fu">Person</span>();
person = <span class="kw">new</span> <span class="fu">Employee</span>();
<span class="bu">Object</span> object = person;</code></pre></div>
<p>Rien n'empêche non plus de créer un alias (c-à-d. une créer une 2ème référence pointant sur le même objet) :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Person[] personArray2 = personArray;</code></pre></div>
<p>On pourra également créer un alias (c-à-d. une affectation) de tableau avec un type plus général :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">Object</span>[] objectArray = personArray;</code></pre></div>
<p>De ce dernier exemple, on peut tirer la conclusion qu'en Java un tableau de personnes est un tableau d'objets. Ceci parait naturel puisqu'une <code>Person</code> est un <code>Object</code>.</p>
<p>On pourra donc écrire aussi :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Employee[] employeeArray = <span class="kw">new</span> Employee[<span class="dv">1</span>];
Person[] personArray = employeeArray;</code></pre></div>
<p>Un <code>Employee</code> étant un sous type de <code>Person</code>, le compilateur Java en déduit qu'un tableau d'<code>Employee</code> sera alors une sorte de sous-type de tableau de <code>Person</code>.</p>
<p>Cette déduction, qu'une relation entre 2 classes (ici <code>extends</code>) se généralise au tableau, s'appelle la « covariance ».</p>
<p>Ainsi, et plus généralement : <code>A extends B</code> implique <code>A[] extends B[]</code>. Bien que le programmeur n'ait pas explicitement écrit <code>A[] extends B[]</code> tout se passe comme si c'était le cas :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="fu">println</span>(employeeArray <span class="kw">instanceof</span> Person[]); <span class="co">// true</span></code></pre></div>
<p>Quand on disait que les tableaux étaient relativement sécurisés, tout est dans le « relativement ». En effet, le typage des tableaux a une faille (de taille).</p>
<p>Revenons à notre exemple d'alias :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Person[] personArray = <span class="kw">new</span> Person[<span class="dv">1</span>];
<span class="bu">Object</span>[] objectArray = personArray;

objectArray[<span class="dv">0</span>] = <span class="st">&quot;booom!&quot;</span>; <span class="co">// ArrayStoreException: java.lang.String</span></code></pre></div>
<p>Donc le compilateur nous autorise à créer un alias de notre tableau de personnes. Il est donc naturel de pouvoir caser un <code>String</code> dans un tableau d'objets (un <code>String</code> étant un <code>Object</code>). Or ici, le tableau créé est un tableau de personnes. La machine virtuelle connaît (à l'exécution du programme) le type du tableau. Celui-ci est fixé à sa création (<code>new</code>) et n'est pas simplement le dénominateur commun de tous ses éléments.</p>
<p>Par exemple :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">Object</span>[] objectArray = <span class="kw">new</span> <span class="bu">Object</span>[] {<span class="kw">new</span> <span class="fu">Cat</span>(), <span class="kw">new</span> <span class="fu">Dog</span>()};</code></pre></div>
<p>Le type dynamique du tableau est bien <code>Object</code> en non pas <code>Animal</code>.</p>
<p>Ainsi la propriété de covariance pose problème dans certains cas. Mais dans d'autres situations elle peut-être utile :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Person[] personArray = <span class="kw">new</span> Person[<span class="dv">1</span>];
personArray[<span class="dv">0</span>] = <span class="kw">new</span> <span class="fu">Person</span>();
<span class="bu">Object</span>[] objectArray = personArray;
<span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; objectArray.<span class="fu">length</span>; i++) {
    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(objectArray[i]);
}</code></pre></div>
<p>En extrayant une méthode responsable de l'affichage :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Person[] personArray = <span class="kw">new</span> Person[<span class="dv">1</span>];
personArray[<span class="dv">0</span>] = <span class="kw">new</span> <span class="fu">Person</span>();
<span class="fu">printObjects</span>(personArray);</code></pre></div>
<p>avec</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">void</span> <span class="fu">printObjects</span>(<span class="bu">Object</span>[] objectArray) {
    <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; objectArray.<span class="fu">length</span>; i++) {
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(objectArray[i]);
    }
}</code></pre></div>
<p>On a découplé l'affichage de la façon de créer et d'écrire dans le tableau. La fonction <code>printObjects(Object[])</code> est maintenant indépendante et pourra être réutilisée dans de nombreuses situations. En effet, cette méthode expose en paramètre seulement <code>Object[]</code> ce qui est très général. Pour rendre notre code réutilisable on cherche toujours à être le plus général possible.</p>
<p>Pour preuve, on pourra sans problème réutiliser cette méthode comme ceci :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">BigDecimal</span>[] amounts = <span class="kw">new</span> <span class="bu">BigDecimal</span>[] {<span class="bu">BigDecimal</span>.<span class="fu">ZERO</span>, <span class="bu">BigDecimal</span>.<span class="fu">ONE</span>};
<span class="fu">printObjects</span>(amounts);
<span class="co">// 0</span>
<span class="co">// 1</span></code></pre></div>
<h2 id="generics-java-5"><span class="header-section-number">5.12</span> Generics Java 5</h2>
<p>Avant Java 5, le typage des collections n'était pas statiquement vérifié (dynamiquement seulement en castant ce qu'on a récupéré de la collection). On écrivait donc :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">ArrayList</span> numbers = <span class="kw">new</span> <span class="bu">ArrayList</span>();</code></pre></div>
<p>Ou bien en profitant du polymorphisme de <code>List</code> :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">List</span> numbers = <span class="kw">new</span> <span class="bu">ArrayList</span>();</code></pre></div>
<p>On pouvait ajouter n'importe quoi dans la collection :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">numbers.<span class="fu">add</span>(<span class="dv">1</span>);
numbers.<span class="fu">add</span>(<span class="st">&quot;hello&quot;</span>);</code></pre></div>
<p>Au moment de récupérer un élément, on n'avait qu'une seule garantie : que l'élément est un objet.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">Object</span> object = numbers.<span class="fu">get</span>(<span class="dv">0</span>);</code></pre></div>
<p>Quand on savait que la collection contenait des <code>Integer</code> il fallait caster :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">Integer</span> number = (<span class="bu">Integer</span>) numbers.<span class="fu">get</span>(<span class="dv">0</span>);
<span class="bu">Integer</span> number1 = (<span class="bu">Integer</span>) numbers.<span class="fu">get</span>(<span class="dv">1</span>); <span class="co">// ClassCastException</span></code></pre></div>
<p>Depuis la version 5 du langage, on peut spécifier le type des éléments (grâce aux nouveau mécanisme de paramètre de types) :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; numbers = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;<span class="bu">Integer</span>&gt;();</code></pre></div>
<p>Pour récupérer un élément, nul besoin de cast, le type est garanti :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">Integer</span> number = numbers.<span class="fu">get</span>(<span class="dv">0</span>);</code></pre></div>
<p>Maintenant, le compilateur interdit d'ajouter un élément du mauvais type :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">numbers.<span class="fu">add</span>(<span class="st">&quot;fail&quot;</span>); <span class="co">// no suitable method found for add(String)</span>
<span class="co">// method java.util.Collection.add(java.lang.Integer) is not applicable</span>
<span class="co">// (argument mismatch; java.lang.String cannot be converted to java.lang.Integer)</span></code></pre></div>
<p>On peut donc comme avec les tableaux ajouter et récupérer des éléments.</p>
<p>En revanche le mécanisme de création d'alias polymorphe n'est plus permis :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; list = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;<span class="bu">Integer</span>&gt;();
<span class="bu">List</span>&lt;<span class="bu">Object</span>&gt; objects = list; <span class="co">// incompatible types: </span>
<span class="co">// List&lt;Integer&gt; cannot be converted to List&lt;Object&gt;</span></code></pre></div>
<p>Les collections génériques ne sont plus covariantes. Une collection de personnes n'est pas considérée comme étant un sous-type d'une collection d'objets.</p>
<h2 id="bornes"><span class="header-section-number">5.13</span> Bornes</h2>
<p>On peut attribuer une borne supérieure au type des éléments. Ainsi dans l'exemple qui suit il est autorisé d'effectuer une affectation car <code>Integer extends Object</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; integerList = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;<span class="bu">Integer</span>&gt;();
<span class="bu">List</span>&lt;? <span class="kw">extends</span> <span class="bu">Object</span>&gt; extendsObjects = integerList;</code></pre></div>
<p>On pourra comme d'habitude ajouter des éléments via la référence <code>integerList</code> :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">integerList.<span class="fu">add</span>(<span class="dv">1</span>);
integerList.<span class="fu">add</span>(<span class="dv">2</span>);</code></pre></div>
<p>En revanche, on ne pourra pas appeler la méthode <code>add</code> sur la liste possédant <code>Object</code> comme borne supérieure :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">extendsObjects.<span class="fu">add</span>(<span class="kw">new</span> <span class="bu">Object</span>()); <span class="co">// no suitable method found for add(Object)</span>
extendsObjects.<span class="fu">add</span>(<span class="kw">new</span> <span class="bu">Integer</span>(<span class="dv">1</span>)); <span class="co">//  no suitable method found for add(Integer)</span></code></pre></div>
<p>Quand la borne supérieure est <code>Object</code> on peut lire mais on ne peut pas écrire.</p>
<p>Prenons un exemple avec une borne supérieure mais positionnée à <code>Person</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">List</span>&lt;Employee&gt; employeeList = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;Employee&gt;();
<span class="bu">List</span>&lt;? <span class="kw">extends</span> Person&gt; personList = employeeList;</code></pre></div>
<p>On pourra bien évidement écrire via la 1ère référence.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">employeeList.<span class="fu">add</span>(<span class="kw">new</span> <span class="fu">Employee</span>());</code></pre></div>
<p>En revanche, il est toujours impossible d'écrire via la 2ème référence.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">personList.<span class="fu">add</span>(<span class="kw">new</span> <span class="fu">Person</span>()); <span class="co">// no suitable method found for add(Person)</span></code></pre></div>
<p>Mais il est toujours possible de lire une <code>Person</code> :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Person person0 = personList.<span class="fu">get</span>(<span class="dv">0</span>)</code></pre></div>
<h2 id="wildcard"><span class="header-section-number">5.14</span> Wildcard</h2>
<p>Faisons une petite expérience de pensée. Attention le pseudo-code qui suit n'est pas du Java valide, il permet simplement de mieux se représenter les choses.</p>
<pre><code>Object object = new Object()
Person person = new Person()
Employee employee = new Employee()

object = person
object = employee

person = object // fail
person = employee

employee = object // fail
employee = person // fail</code></pre>
<p>Corsons un peu les choses (toujours en pseudo-code) :</p>
<pre><code>class Foo&lt;T&gt; {
    void foo(T x) {}
}
Foo&lt;Integer&gt; a = new Foo&lt;Integer&gt;();
Foo&lt;?&gt; b = new Foo&lt;Integer&gt;();</code></pre>
<pre><code>Object object = new Object()
? jokerObject

jokerObject = new Object() // fail
Object object = jokerObject // OK</code></pre>
<pre><code>&lt;? extends Object&gt; extendsObject
&lt;? extends Person&gt; extendsPerson
&lt;? extends Employee&gt; extendsEmployee

extendsObject = object // fail
extendsPerson = person // fail
extendsEmployee = employee // fail</code></pre>
<p>On a pas le droit d'écrire (c-à-d. d'affecter) dans une référence typée avec une borne supérieure.</p>
<p>La raison est que le type <code>? extends Person</code> (où &quot;?&quot; est le type joker) peut-être par exemple un <code>Person</code>, un <code>Employee</code>, ou n'importe quelle autre classe qui étend <code>Person</code>. Comme on peut sous-classer indéfiniment, le type inconnu <code>?</code> pourra être aussi bas que possible dans la hiérarchie des types.</p>
<p>Pour que <code>extendsObject = object</code> soit possible, il faudrait que toutes les substitution possible du joker (<code>?</code>) soient valides. Ici cela donnerait :</p>
<pre><code>Object o = object
Person p = object
Employee e = object</code></pre>
<h2 id="exercice-13-1"><span class="header-section-number">5.15</span> Exercice 13</h2>
<p>Ajouter à la classe Pair<T> une méthode static <code>sort()</code> qui place toujours à gauche l'élément le plus petit.</p>
<p>Pour cela il va falloir définir une borne au type qui paramètre <code>Pair</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Pair&lt;<span class="bu">Integer</span>&gt; sorted = Pair.<span class="fu">sort</span>(<span class="kw">new</span> Pair&lt;&gt;(<span class="dv">2</span>, <span class="dv">1</span>));
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(sorted); <span class="co">// (1, 2)</span>

Pair&lt;<span class="bu">Integer</span>&gt; sorted2 = Pair.<span class="fu">sort</span>(<span class="kw">new</span> Pair&lt;&gt;(<span class="dv">10</span>, <span class="dv">20</span>));
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(sorted2); <span class="co">// (10, 20)</span></code></pre></div>
<h2 id="exercice-14-1"><span class="header-section-number">5.16</span> Exercice 14</h2>
<p>Appeler la méthode <code>Pair.sort()</code> avec <code>new Pair&lt;Long&gt;(1_000_000_000, 2_000_000_000)</code>, <code>new Pair&lt;Double&gt;(1_000d, 2_000d)</code>. Essayer avec <code>new Pair&lt;String&gt;(&quot;abc&quot;, &quot;def&quot;)</code>.</p>
<h2 id="exercice-15-1"><span class="header-section-number">5.17</span> Exercice 15</h2>
<p>On utilise un wildcard quand on a pas besoin d'utiliser le paramètre de type.</p>
<p>Écrire une méthode static <code>void printSum(Pair&lt;? extends Number&gt; pair)</code> qui affiche la somme les 2 éléments de la paire.</p>
<p>Écrire une méthode static <code>CharSequence concatenate(Pair&lt;? extends CharSequence&gt; pair)</code> affiche la concaténation des 2 éléments.</p>
<h2 id="exercice-16-1"><span class="header-section-number">5.18</span>  Exercice 16</h2>
<p>Écrire une méthode static <code>&lt;U&gt; Pair&lt;U&gt; fromList(List&lt;? extends U&gt; input)</code> :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Pair&lt;<span class="bu">Integer</span>&gt; pair = Pair.<span class="fu">fromList</span>(<span class="bu">Arrays</span>.<span class="fu">asList</span>(<span class="dv">1</span>, <span class="dv">2</span>)); <span class="co">// (1, 2)</span>
Pair&lt;<span class="bu">String</span>&gt; pair = Pair.<span class="fu">fromList</span>(<span class="bu">Arrays</span>.<span class="fu">asList</span>(<span class="st">&quot;abc&quot;</span>, <span class="st">&quot;def&quot;</span>)); <span class="co">// (&quot;abc&quot;, &quot;def&quot;)</span></code></pre></div>
<h2 id="exercice-17-1"><span class="header-section-number">5.19</span> Exercice 17</h2>
<p>Écrire une méthode <code>void writeToList(List&lt;? super T&gt; output)</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">List</span>&lt;<span class="bu">Object</span>&gt; output = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;&gt;();
<span class="kw">new</span> Pair&lt;&gt;(<span class="st">&quot;hello&quot;</span>, <span class="st">&quot;world&quot;</span>).<span class="fu">writeToList</span>(output);
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(output); <span class="co">// (&quot;hello&quot;, &quot;world&quot;)</span></code></pre></div>
<p>Créer la hiérarchie de classe suivante : LiveBeing, Animal extends LiveBeing, Cat extends Animal.</p>
<p>Créer une paire de Animal.</p>
<p>Essayer d'appeler <code>writeToList()</code> avec une <code>List&lt;LiveBeing&gt;</code> puis avec une <code>List&lt;Cat&gt;</code>.</p>
<h2 id="correction-exercices"><span class="header-section-number">5.20</span> Correction exercices</h2>
<h3 id="exercice1"><span class="header-section-number">5.20.1</span> Exercice 1</h3>
<p>On écrit le programme de l'exercice 1 :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Main {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        IntegerContainer empty = <span class="kw">new</span> <span class="fu">IntegerContainer</span>();
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(empty); <span class="co">// &quot;&quot;</span>

        IntegerContainer b = <span class="kw">new</span> <span class="fu">IntegerContainer</span>(<span class="dv">42</span>);
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(b); <span class="co">// &quot;42&quot;</span>

        IntegerContainer z = <span class="kw">new</span> <span class="fu">IntegerContainer</span>(<span class="dv">0</span>);
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(z); <span class="co">// &quot;0&quot;</span>

        IntegerContainer n = <span class="kw">new</span> <span class="fu">IntegerContainer</span>(<span class="kw">null</span>); <span class="co">// IllegalArgumentException</span>
    }
}</code></pre></div>
<p>On crée la classe <code>IntegerContainer</code> et les 2 constructeurs pour pouvoir compiler (mais le comportement à l'exécution est encore à travailler) :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> IntegerContainer {

    <span class="kw">public</span> <span class="fu">IntegerContainer</span>(<span class="bu">Integer</span> value) {

    }

    <span class="kw">public</span> <span class="fu">IntegerContainer</span>() {

    }
}</code></pre></div>
<p>On implémente la méthode <code>toString()</code> pour que le <code>println()</code> affiche ce que l'on veut.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> IntegerContainer {

    <span class="kw">private</span> <span class="bu">Integer</span> value;

    <span class="kw">public</span> <span class="fu">IntegerContainer</span>(<span class="bu">Integer</span> value) {
        <span class="kw">this</span>.<span class="fu">value</span> = value;
    }

    <span class="kw">public</span> <span class="fu">IntegerContainer</span>() {

    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span>() {
        <span class="kw">return</span> <span class="bu">String</span>.<span class="fu">valueOf</span>(value);
    }
}</code></pre></div>
<h3 id="exercice2"><span class="header-section-number">5.20.2</span> Exercice 2</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> IntegerContainer {

    <span class="kw">private</span> <span class="bu">Integer</span> value;

    <span class="kw">public</span> <span class="fu">IntegerContainer</span>(<span class="bu">Integer</span> value) {
        <span class="kw">this</span>.<span class="fu">value</span> = value;
    }

    <span class="kw">public</span> <span class="fu">IntegerContainer</span>() {

    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span>() {
        <span class="kw">return</span> <span class="bu">String</span>.<span class="fu">valueOf</span>(value);
    }

    <span class="kw">public</span> <span class="bu">Integer</span> <span class="fu">first</span>() {
        <span class="kw">if</span> (value == <span class="kw">null</span>) {
            <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">IllegalArgumentException</span>(<span class="st">&quot;Empty container&quot;</span>);
        }
        <span class="kw">return</span> value;
    }
}</code></pre></div>
<h3 id="exercice-3-4"><span class="header-section-number">5.20.3</span> Exercice 3</h3>
<p>On écrit le programme dans une classe dédiée :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Main {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        IntegerContainer a = <span class="kw">new</span> <span class="fu">IntegerContainer</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">10</span>);
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(a.<span class="fu">countEqual</span>(<span class="dv">10</span>)); <span class="co">// 2</span>
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(a); <span class="co">// {10, 20, 10}</span>
    }
}</code></pre></div>
<p>Puis on corrige toutes les erreurs de compilations sans s'occuper pour le moment du comportement à l'exécution :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> IntegerContainer {

    <span class="kw">private</span> <span class="bu">Integer</span> value;

    <span class="kw">public</span> <span class="fu">IntegerContainer</span>(<span class="bu">Integer</span> value) {
        <span class="kw">this</span>.<span class="fu">value</span> = value;
    }

    <span class="kw">public</span> <span class="fu">IntegerContainer</span>() {

    }

    <span class="kw">public</span> <span class="fu">IntegerContainer</span>(<span class="bu">Integer</span> i, <span class="bu">Integer</span>  i1, <span class="bu">Integer</span> i2) {

    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span>() {
        <span class="kw">return</span> <span class="bu">String</span>.<span class="fu">valueOf</span>(value);
    }

    <span class="kw">public</span> <span class="bu">Integer</span> <span class="fu">first</span>() {
        <span class="kw">if</span> (value == <span class="kw">null</span>) {
            <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">IllegalArgumentException</span>(<span class="st">&quot;Empty container&quot;</span>);
        }
        <span class="kw">return</span> value;
    }

    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">countEqual</span>(<span class="bu">Integer</span> element) {
        <span class="kw">return</span> <span class="dv">0</span>;
    }
}</code></pre></div>
<p>Remarquer le nouveau constructeur à 3 paramètres : <code>IntegerContainer(Integer i, Integer i1, Integer i2)</code>. Du point du vue de celui qui l'appelle, on doit fournir 3 arguments (par ex. <code>new IntegerContainer(10, 20, 10)</code>). Le point de vue du constructeur appelé (qui manipule les paramètres) est le même : 3 paramètres <code>i</code>, <code>i1</code> et <code>i2</code>.</p>
<p>On va introduire un constructeur prenant un nombre variable de paramètres (on parle d'arité variable). On écrira : <code>IntegerContainer(Integer... values)</code>. Le point de vue du constructeur est changé. Il manipule maintenant un tableau de <code>Integer</code> : tout ce passe pour le constructeur comme s'il avait définit <code>IntegerContainer(Integer[] values)</code>.</p>
<p>En revanche, du point de vue de l'appelant tout se passe comme si le constructeur était défini avec autant de paramètres que l'on souhaite. Il pourra donc appeler le constructeur comme suit :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">new</span> <span class="fu">IntegerContainer</span>();
<span class="kw">new</span> <span class="fu">IntegerContainer</span>(<span class="dv">1</span>);
<span class="kw">new</span> <span class="fu">IntegerContainer</span>(<span class="dv">1</span>, <span class="dv">2</span>);
<span class="kw">new</span> <span class="fu">IntegerContainer</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>);
<span class="kw">new</span> <span class="fu">IntegerContainer</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>);
<span class="co">// ...</span></code></pre></div>
<p>Utiliser la forme « varargs » est donc une politesse pour l'appelant qui n'aura pas besoin de mettre ses arguments dans un tableau.</p>
<p>Sans « varargs » l'appelant est obligé de créer un tableau pour appeler le constructeur :</p>
<pre><code>new IntegerContainer(new Integer[] {1, 2, 3});</code></pre>
<p>On peut créer aussi des méthodes à arité variable (pas seulement les constructeurs).</p>
<p>Sortons de cette digression pour terminer l'exercice 3 :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> IntegerContainer {

    <span class="kw">private</span> <span class="bu">Integer</span>[] values;

    <span class="kw">public</span> <span class="fu">IntegerContainer</span>(<span class="bu">Integer</span><span class="kw">... </span>values) {
        <span class="kw">this</span>.<span class="fu">values</span> = values;
    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span>() {
        <span class="bu">CharSequence</span>[] stringValues = <span class="kw">new</span> <span class="bu">CharSequence</span>[values.<span class="fu">length</span>];
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; values.<span class="fu">length</span>; i++) {
            stringValues[i] = <span class="bu">String</span>.<span class="fu">valueOf</span>(values[i]);
        }
        <span class="kw">return</span> <span class="st">&quot;{&quot;</span> + <span class="bu">String</span>.<span class="fu">join</span>(<span class="st">&quot;, &quot;</span>, stringValues) + <span class="st">&quot;}&quot;</span>;
    }

    <span class="kw">public</span> <span class="bu">Integer</span> <span class="fu">first</span>() {
        <span class="kw">if</span> (values.<span class="fu">length</span> == <span class="dv">0</span>) {
            <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">IllegalArgumentException</span>(<span class="st">&quot;Empty container&quot;</span>);
        }
        <span class="kw">return</span> values[<span class="dv">0</span>];
    }

    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">countEqual</span>(<span class="bu">Integer</span> element) {
        <span class="dt">int</span> count = <span class="dv">0</span>;
        <span class="kw">for</span> (<span class="bu">Integer</span> value : values) {
            <span class="kw">if</span> (value.<span class="fu">equals</span>(element)) {
                count++;
            }
        }
        <span class="kw">return</span> count;
    }
}</code></pre></div>
<h3 id="exercice4"><span class="header-section-number">5.20.4</span> Exercice 4</h3>
<p>Comme d'habitude, on écrit un <code>Main</code> pour voir comment on utilisera notre classe. La classe <code>DoubleContainer</code> prend un nombre arbitraire de nombres réels et doit implémenter la méthode <code>toString()</code>, <code>first()</code> et <code>countEqual(Double value)</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Main {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        DoubleContainer a = <span class="kw">new</span> <span class="fu">DoubleContainer</span>(<span class="fl">10.0</span>, <span class="fl">20.0</span>, <span class="fl">10.0</span>);
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(a); <span class="co">// {10.0, 20.0, 10.0}</span>
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(a.<span class="fu">countEqual</span>(<span class="fl">10.0</span>)); <span class="co">// 2</span>
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(a.<span class="fu">first</span>()); <span class="co">// 10.0</span>

        DoubleContainer empty = <span class="kw">new</span> <span class="fu">DoubleContainer</span>();
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(empty); <span class="co">// {}</span>
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(empty.<span class="fu">countEqual</span>(<span class="fl">10.0</span>)); <span class="co">// 0</span>
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(empty.<span class="fu">first</span>()); <span class="co">// IllegalArgumentException: Empty container</span>
    }
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> DoubleContainer {

    <span class="kw">private</span> <span class="bu">Double</span>[] values;

    <span class="kw">public</span> <span class="fu">DoubleContainer</span>(<span class="bu">Double</span><span class="kw">... </span>values) {
        <span class="kw">this</span>.<span class="fu">values</span> = values;
    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span>() {
        <span class="bu">CharSequence</span>[] stringValues = <span class="kw">new</span> <span class="bu">CharSequence</span>[values.<span class="fu">length</span>];
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; values.<span class="fu">length</span>; i++) {
            stringValues[i] = <span class="bu">String</span>.<span class="fu">valueOf</span>(values[i]);
        }
        <span class="kw">return</span> <span class="st">&quot;{&quot;</span> + <span class="bu">String</span>.<span class="fu">join</span>(<span class="st">&quot;, &quot;</span>, stringValues) + <span class="st">&quot;}&quot;</span>;
    }

    <span class="kw">public</span> <span class="bu">Double</span> <span class="fu">first</span>() {
        <span class="kw">if</span> (values.<span class="fu">length</span> == <span class="dv">0</span>) {
            <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">IllegalStateException</span>(<span class="st">&quot;Empty container&quot;</span>);
        }
        <span class="kw">return</span> values[<span class="dv">0</span>];
    }

    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">countEqual</span>(<span class="bu">Double</span> element) {
        <span class="dt">int</span> count = <span class="dv">0</span>;
        <span class="kw">for</span> (<span class="bu">Double</span> value : values) {
            <span class="kw">if</span> (value.<span class="fu">equals</span>(element)) {
                count++;
            }
        }
        <span class="kw">return</span> count;
    }
}</code></pre></div>
<h3 id="exercice-5-4"><span class="header-section-number">5.20.5</span> Exercice 5</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Main {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        ObjectContainer doubleContainer = <span class="kw">new</span> <span class="fu">ObjectContainer</span>(<span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>);

        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(doubleContainer); <span class="co">// {0.1, 0.2, 0.3}</span>
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(doubleContainer.<span class="fu">countEqual</span>(<span class="fl">0.0</span>)); <span class="co">// 0</span>
        <span class="bu">Object</span> firstOfDouble = doubleContainer.<span class="fu">first</span>();
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(firstOfDouble); <span class="co">// 0.1</span>

        ObjectContainer integerContainer = <span class="kw">new</span> <span class="fu">ObjectContainer</span>(<span class="dv">500</span>, <span class="dv">300</span>, <span class="dv">500</span>, <span class="dv">500</span>);

        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(integerContainer); <span class="co">// {500, 300, 500, 500}</span>
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(integerContainer.<span class="fu">countEqual</span>(<span class="dv">500</span>)); <span class="co">// 3</span>
        <span class="bu">Object</span> firstOfIntegers = integerContainer.<span class="fu">first</span>();
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(firstOfIntegers); <span class="co">// 500</span>
    }
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> ObjectContainer {

    <span class="kw">private</span> <span class="bu">Object</span>[] values;

    <span class="kw">public</span> <span class="fu">ObjectContainer</span>(<span class="bu">Object</span><span class="kw">... </span>values) {
        <span class="kw">this</span>.<span class="fu">values</span> = values;
    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span>() {
        <span class="bu">CharSequence</span>[] stringValues = <span class="kw">new</span> <span class="bu">CharSequence</span>[values.<span class="fu">length</span>];
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; values.<span class="fu">length</span>; i++) {
            stringValues[i] = <span class="bu">String</span>.<span class="fu">valueOf</span>(values[i]);
        }
        <span class="kw">return</span> <span class="st">&quot;{&quot;</span> + <span class="bu">String</span>.<span class="fu">join</span>(<span class="st">&quot;, &quot;</span>, stringValues) + <span class="st">&quot;}&quot;</span>;
    }

    <span class="kw">public</span> <span class="bu">Object</span> <span class="fu">first</span>() {
        <span class="kw">if</span> (values.<span class="fu">length</span> == <span class="dv">0</span>) {
            <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">IllegalStateException</span>(<span class="st">&quot;Empty container&quot;</span>);
        }
        <span class="kw">return</span> values[<span class="dv">0</span>];
    }

    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">countEqual</span>(<span class="bu">Object</span> element) {
        <span class="dt">int</span> count = <span class="dv">0</span>;
        <span class="kw">for</span> (<span class="bu">Object</span> value : values) {
            <span class="kw">if</span> (value.<span class="fu">equals</span>(element)) {
                count++;
            }
        }
        <span class="kw">return</span> count;
    }
}</code></pre></div>
<h3 id="exercice-6-3"><span class="header-section-number">5.20.6</span> Exercice 6</h3>
<p>Une première version non générique pourrait être celle-ci :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">
<span class="kw">public</span> <span class="kw">class</span> Main {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        <span class="fu">printStringSafely</span>(<span class="st">&quot;hello&quot;</span>);
        <span class="co">//printStringSafely(null);</span>

        <span class="fu">printIfPositiveIntegerSafely</span>(<span class="dv">5</span>);
        <span class="co">//printIfPositiveIntegerSafely(null);</span>
    }

    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">printStringSafely</span>(<span class="bu">String</span> name) {
        <span class="bu">String</span> checkedName = (<span class="bu">String</span>) Checks.<span class="fu">failIfNull</span>(name);
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(checkedName);
    }
    
    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">printIfPositiveIntegerSafely</span>(<span class="bu">Integer</span> value) {
        <span class="bu">Integer</span> checkedValue = (<span class="bu">Integer</span>) Checks.<span class="fu">failIfNull</span>(value);
        <span class="kw">if</span> (checkedValue &gt;= <span class="dv">0</span>) {
            <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(checkedValue);
        }
    }
}</code></pre></div>
<p>Avec</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Checks {
    <span class="kw">public</span> <span class="dt">static</span> <span class="bu">Object</span> <span class="fu">failIfNull</span>(<span class="bu">Object</span> object) {
        <span class="kw">if</span> (object == <span class="kw">null</span>) {
            <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">IllegalArgumentException</span>(<span class="st">&quot;null&quot;</span>);
        }
        <span class="kw">return</span> object;
    }
}</code></pre></div>
<p>Le problème de cette implémentation de <code>failIfNull()</code> est qu'en passant un <code>String</code> en argument on récupère tout de même un <code>Object</code>. Donc on a perdu de l'information. D'où la nécessité du cast.</p>
<p>On aimerait donc éliminer le cast :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">void</span> <span class="fu">printIfPositiveIntegerSafely</span>(<span class="bu">Integer</span> value) {
    <span class="bu">Integer</span> checkedValue = Checks.<span class="fu">failIfNull</span>(value);
    <span class="kw">if</span> (checkedValue &gt;= <span class="dv">0</span>) {
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(checkedValue);
    }
}

<span class="dt">void</span> <span class="fu">printStringSafely</span>(<span class="bu">String</span> name) {
    <span class="bu">String</span> checkedName = Checks.<span class="fu">failIfNull</span>(name);
    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(checkedName);
}</code></pre></div>
<p>On extrait un paramètre de type nommé <code>T</code> :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Checks {
    <span class="kw">public</span> <span class="dt">static</span> &lt;T&gt; T <span class="fu">failIfNull</span>(T object) {
        <span class="kw">if</span> (object == <span class="kw">null</span>) {
            <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">IllegalArgumentException</span>(<span class="st">&quot;null&quot;</span>);
        }
        <span class="kw">return</span> object;
    }
}</code></pre></div>
<h3 id="exercice-7-3"><span class="header-section-number">5.20.7</span> Exercice 7</h3>
<p>Dans l'exercice on a définit un paramètre de type sur une méthode. Ici, on définit un paramètre de type (<code>T</code>) sur une classe.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> CheckedBox&lt;T&gt; {
    <span class="kw">private</span> T object;

    <span class="kw">public</span> <span class="fu">CheckedBox</span>() {
    }

    <span class="kw">public</span> <span class="fu">CheckedBox</span>(T object) {
        <span class="kw">this</span>.<span class="fu">object</span> = object;
    }

    <span class="kw">public</span> T <span class="fu">get</span>() {
        <span class="kw">if</span> (object == <span class="kw">null</span>) {
            <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">IllegalStateException</span>(<span class="st">&quot;null&quot;</span>);
        }
        <span class="kw">return</span> object;
    }
}</code></pre></div>
<h3 id="exercice-8-2"><span class="header-section-number">5.20.8</span> Exercice 8</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Pair&lt;T&gt; {
    <span class="kw">private</span> <span class="dt">final</span> T left;
    <span class="kw">private</span> <span class="dt">final</span> T right;

    <span class="kw">public</span> <span class="fu">Pair</span>(T left, T right) {
        <span class="kw">this</span>.<span class="fu">left</span> = left;
        <span class="kw">this</span>.<span class="fu">right</span> = right;
    }

    <span class="kw">public</span> Pair&lt;T&gt; <span class="fu">reverse</span>() {
        <span class="kw">return</span> <span class="kw">new</span> Pair&lt;&gt;(right, left);
    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span>() {
        <span class="kw">return</span> <span class="st">&quot;(&quot;</span> + left + <span class="st">&quot;, &quot;</span> + right + <span class="st">&quot;)&quot;</span>;
    }
}</code></pre></div>
<h3 id="exercice-9-3"><span class="header-section-number">5.20.9</span> Exercice 9</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Tuple2&lt;T, U&gt; {

    <span class="kw">private</span> <span class="dt">final</span> T a;
    <span class="kw">private</span> <span class="dt">final</span> U b;

    <span class="kw">public</span> <span class="fu">Tuple2</span>(T a, U b) {
        <span class="kw">this</span>.<span class="fu">a</span> = a;
        <span class="kw">this</span>.<span class="fu">b</span> = b;
    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span>() {
        <span class="kw">return</span> <span class="st">&quot;(&quot;</span> + a + <span class="st">&quot;, &quot;</span> + b + <span class="st">&quot;)&quot;</span>;
    }

    <span class="kw">public</span> Tuple2&lt;U, T&gt; <span class="fu">reverse</span>() {
        <span class="kw">return</span> <span class="kw">new</span> Tuple2&lt;&gt;(b, a);
    }
}</code></pre></div>
<h3 id="exercice-10-3"><span class="header-section-number">5.20.10</span> Exercice 10</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Tuple2&lt;T, U&gt; {

    <span class="kw">private</span> <span class="dt">final</span> T a;
    <span class="kw">private</span> <span class="dt">final</span> U b;

    <span class="kw">public</span> <span class="fu">Tuple2</span>(T a, U b) {
        <span class="kw">this</span>.<span class="fu">a</span> = a;
        <span class="kw">this</span>.<span class="fu">b</span> = b;
    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span>() {
        <span class="kw">return</span> <span class="st">&quot;(&quot;</span> + a + <span class="st">&quot;, &quot;</span> + b + <span class="st">&quot;)&quot;</span>;
    }

    <span class="kw">public</span> Tuple2&lt;U, T&gt; <span class="fu">reverse</span>() {
        <span class="kw">return</span> <span class="kw">new</span> Tuple2&lt;&gt;(b, a);
    }

    <span class="kw">public</span> T <span class="fu">getA</span>() {
        <span class="kw">return</span> a;
    }

    <span class="kw">public</span> U <span class="fu">getB</span>() {
        <span class="kw">return</span> b;
    }
}</code></pre></div>
<p>Et :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Pair&lt;T&gt; {
    <span class="kw">private</span> <span class="dt">final</span> Tuple2&lt;T, T&gt; tuple2;

    <span class="kw">public</span> <span class="fu">Pair</span>(T left, T right) {
        tuple2 = <span class="kw">new</span> Tuple2&lt;&gt;(left, right);
    }

    <span class="kw">public</span> Pair&lt;T&gt; <span class="fu">reverse</span>() {
        Tuple2&lt;T, T&gt; reversed = tuple2.<span class="fu">reverse</span>();

        <span class="kw">return</span> <span class="kw">new</span> Pair&lt;&gt;(reversed.<span class="fu">getA</span>(), reversed.<span class="fu">getB</span>());
    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span>() {
        <span class="kw">return</span> tuple2.<span class="fu">toString</span>();
    }
}</code></pre></div>
<h3 id="exercice-11-3"><span class="header-section-number">5.20.11</span> Exercice 11</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> GenericContainer&lt;T&gt; {

    <span class="kw">private</span> T[] values;

    <span class="kw">public</span> <span class="fu">GenericContainer</span>(T<span class="kw">... </span>values) {
        <span class="kw">this</span>.<span class="fu">values</span> = values;
    }
    
    <span class="kw">public</span> T <span class="fu">first</span>() {
        <span class="kw">if</span> (values.<span class="fu">length</span> == <span class="dv">0</span>) {
            <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">IllegalStateException</span>(<span class="st">&quot;Empty container&quot;</span>);
        }
        <span class="kw">return</span> values[<span class="dv">0</span>];
    }

    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">countEqual</span>(T element) {
        <span class="dt">int</span> count = <span class="dv">0</span>;
        <span class="kw">for</span> (T value : values) {
            <span class="kw">if</span> (value.<span class="fu">equals</span>(element)) {
                count++;
            }
        }
        <span class="kw">return</span> count;
    }
    
    <span class="kw">public</span> GenericContainer&lt;T&gt; <span class="fu">repeat</span>(<span class="dt">int</span> count) {
        <span class="at">@SuppressWarnings</span>(<span class="st">&quot;unchecked&quot;</span>)
        T[] newValues = (T[]) <span class="kw">new</span> <span class="bu">Object</span>[count * <span class="kw">this</span>.<span class="fu">values</span>.<span class="fu">length</span>];

        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; values.<span class="fu">length</span>; i++) {
            <span class="kw">for</span> (<span class="dt">int</span> j = <span class="dv">0</span>; j &lt; count; j++) {
                newValues[(i * count) + j] = values[i];
            }
        }
        <span class="kw">return</span> <span class="kw">new</span> GenericContainer&lt;&gt;(newValues);
    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span>() {
        <span class="bu">CharSequence</span>[] stringValues = <span class="kw">new</span> <span class="bu">CharSequence</span>[values.<span class="fu">length</span>];
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; values.<span class="fu">length</span>; i++) {
            stringValues[i] = <span class="bu">String</span>.<span class="fu">valueOf</span>(values[i]);
        }
        <span class="kw">return</span> <span class="st">&quot;{&quot;</span> + <span class="bu">String</span>.<span class="fu">join</span>(<span class="st">&quot;, &quot;</span>, stringValues) + <span class="st">&quot;}&quot;</span>;
    }
}</code></pre></div>
<p>La ligne <code>T[] newValues = (T[]) new Object[count * this.values.length];</code> mérite une petite explication.</p>
<p>Les tableaux de Java ne peuvent pas être créés génériquement. C'est à dire qu'on ne peut écrire :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">T[] x = <span class="kw">new</span> T[<span class="dv">0</span>]; <span class="co">// Error: generic array creation</span></code></pre></div>
<p>Ceci vient du fait que les types paramétrés ne sont pas connus à l'exécution du programme. On parle de « type erasure ». Ici à l'exécution le type <code>T</code> est effacé pour devenir <code>Object</code>. C'est pour cela qu'on crée un tableau d'objets (<code>new Object[count * this.values.length]</code>). Pour compiler, on est obligé de caster de tableau d'objets en tableau de <code>T</code>.</p>
<h3 id="exercice-12-3"><span class="header-section-number">5.20.12</span> Exercice 12</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Pair&lt;T&gt; {
    <span class="kw">private</span> <span class="dt">final</span> T left;
    <span class="kw">private</span> <span class="dt">final</span> T right;

    <span class="kw">public</span> <span class="fu">Pair</span>(T left, T right) {
        <span class="kw">this</span>.<span class="fu">left</span> = left;
        <span class="kw">this</span>.<span class="fu">right</span> = right;
    }
    
    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span>() {
        <span class="kw">return</span> <span class="st">&quot;(&quot;</span> + left + <span class="st">&quot;, &quot;</span> + right + <span class="st">&quot;)&quot;</span>;
    }

    <span class="kw">public</span> <span class="dt">static</span> &lt;U&gt; Pair&lt;U&gt; <span class="fu">duplicate</span>(U element) {
        <span class="kw">return</span> <span class="kw">new</span> Pair&lt;&gt;(element, element);
    }
}</code></pre></div>
<h3 id="exercice-13-2"><span class="header-section-number">5.20.13</span> Exercice 13</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Pair&lt;T&gt; {
    <span class="kw">private</span> <span class="dt">final</span> T left;
    <span class="kw">private</span> <span class="dt">final</span> T right;

    <span class="kw">public</span> <span class="fu">Pair</span>(T left, T right) {
        <span class="kw">this</span>.<span class="fu">left</span> = left;
        <span class="kw">this</span>.<span class="fu">right</span> = right;
    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span>() {
        <span class="kw">return</span> <span class="st">&quot;(&quot;</span> + left + <span class="st">&quot;, &quot;</span> + right + <span class="st">&quot;)&quot;</span>;
    }

    <span class="kw">public</span> <span class="dt">static</span> &lt;U <span class="kw">extends</span> <span class="bu">Number</span>&gt; Pair&lt;U&gt; <span class="fu">sort</span>(Pair&lt;U&gt; pair) {
        <span class="kw">if</span> (pair.<span class="fu">left</span>.<span class="fu">doubleValue</span>() &gt; pair.<span class="fu">right</span>.<span class="fu">doubleValue</span>()) {
            <span class="kw">return</span> <span class="kw">new</span> Pair&lt;&gt;(pair.<span class="fu">right</span>, pair.<span class="fu">left</span>);
        }
        <span class="kw">return</span> <span class="kw">new</span> Pair&lt;&gt;(pair.<span class="fu">left</span>, pair.<span class="fu">right</span>);
    }
}</code></pre></div>
<h2 id="exercice-15-2"><span class="header-section-number">5.21</span> Exercice 15</h2>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">printSum</span>(Pair&lt;? <span class="kw">extends</span> <span class="bu">Number</span>&gt; pair) {
    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(pair.<span class="fu">left</span>.<span class="fu">doubleValue</span>() + pair.<span class="fu">right</span>.<span class="fu">doubleValue</span>());
}</code></pre></div>
<h2 id="exercice-16-2"><span class="header-section-number">5.22</span> Exercice 16</h2>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> &lt;U&gt; Pair&lt;U&gt; <span class="fu">fromList</span>(<span class="bu">List</span>&lt;? <span class="kw">extends</span> U&gt; input) {
    <span class="kw">return</span> <span class="kw">new</span> Pair&lt;&gt;(input.<span class="fu">get</span>(<span class="dv">0</span>), input.<span class="fu">get</span>(<span class="dv">1</span>));
}</code></pre></div>
<p>Il faut retenir qu'on utilise une borne supérieure parce que <code>input</code> produit des données (dont le type est la borne, ici <code>U</code>). Ici on a appelé uniquement la méthode <code>U get(int)</code> qui <em>retourne</em> un objet.</p>
<h2 id="exercice-17-2"><span class="header-section-number">5.23</span> Exercice 17</h2>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">void</span> <span class="fu">writeToList</span>(<span class="bu">List</span>&lt;? <span class="kw">super</span> T&gt; output) {
    output.<span class="fu">add</span>(left);
    output.<span class="fu">add</span>(right);
}</code></pre></div>
<p>Il faut retenir qu'on utilise une borne inférieure parce que <code>output</code> <em>consomme</em> des données (dont le type est la borne, ici <code>T</code>). Ici on a appelé uniquement la méthode <code>void add(T)</code> qui prend en paramètre un objet.</p>
<h1 id="les-fils-dexécutions"><span class="header-section-number">6</span> Les fils d'exécutions</h1>
<p>En Java, les d'instructions d'un bloc sont exécutées en séquence.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span> x = <span class="dv">10</span>; <span class="co">// 1</span>
<span class="dt">int</span> y = <span class="dv">20</span>; <span class="co">// 2</span>
<span class="dt">int</span> z = x + y; <span class="co">// 3</span></code></pre></div>
<p>La dernière instruction est toujours exécutée en dernier.</p>
<p>Toute instruction est exécutée dans un fil d'exécution qu'on appelle &quot;thread&quot;.</p>
<pre><code>Instruction * -- 1 Thread</code></pre>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="bu">Thread</span>.<span class="fu">currentThread</span>()); <span class="co">// Thread[main,5,main]</span>
}</code></pre></div>
<p>Dans certains cas de figure on préfère que deux instructions soient exécutées en parallèle plutôt qu'en série.</p>
<p>Ça pourrait être le cas dans :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span> x = <span class="fu">readFromInput1</span>();
<span class="dt">int</span> y = <span class="fu">readFromInput2</span>();
<span class="dt">int</span> z = x + y;</code></pre></div>
<p>Comme les 2 premières lignes sont indépendantes. Nul besoin d'attendre que la 1ère soit terminée pour commencer la 2e. En revanche, la 3e ligne a besoin de x et y. Elle doit donc attendre que les deux premières instructions soient terminées.</p>
<p>Ici on a traitement en Y :</p>
<pre><code>x     y
 \   /
  \ /
   z</code></pre>
<p>Pour pouvoir exécuter 2 traitements en parallèle on devra avoir 2 threads disponibles.</p>
<p>Ici, on aura un thread qui calculera x, un thread qui calculera y. Le thread qui calcule z pourra réutiliser un des 2 threads précédant étant donné que son code devra être exécuté après x et y.</p>
<p>Si le thread qui calcule z est le même que celui qui calcule x, celui ci devra attendre explicitement le thread qui calcule y. Inversement, si z est calculé dans le thread de y, ce thread devra attendre explicitement que le thread qui calcule x finisse. Enfin, si le thread calculant z est un 3e thread, il devra explicitement attendre les deux premiers.</p>
<p>Commençons par la manière naïve et systématique.</p>
<p>On va créer 3 <code>Thread</code> que l'on va démarrer.</p>
<p>Par défaut, on a déja vu que <code>main()</code> tourne déjà dans un thread.</p>
<p>Pour en créer un nouveau on instancie un objet <code>Thread</code>. On doit spécifier à la construction de l'objet le code que le thread exécutera une fois lancé.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="bu">Thread</span>.<span class="fu">currentThread</span>());
    <span class="bu">Thread</span> thread = <span class="kw">new</span> <span class="bu">Thread</span>(<span class="kw">new</span> <span class="bu">Runnable</span>() {
        <span class="at">@Override</span>
        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span>() {
            <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="bu">Thread</span>.<span class="fu">currentThread</span>());
        }
    });
    thread.<span class="fu">start</span>();
}</code></pre></div>
<p>Si on appelle pas <code>thread.start()</code>, le fil d'exécution n'est pas lancé. On aura juste un objet Java instancié pour rien.</p>
<p>Le programme précédant affichera :</p>
<pre><code>Thread[main,5,main]
Thread[Thread-0,5,main]</code></pre>
<p>En revanche inverser :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
    <span class="bu">Thread</span> thread = <span class="kw">new</span> <span class="bu">Thread</span>(<span class="kw">new</span> <span class="bu">Runnable</span>() {
        <span class="at">@Override</span>
        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span>() {
            <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="bu">Thread</span>.<span class="fu">currentThread</span>());
        }
    });
    thread.<span class="fu">start</span>();
    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="bu">Thread</span>.<span class="fu">currentThread</span>());
}</code></pre></div>
<p>Pourra afficher :</p>
<pre><code>Thread[main,5,main]
Thread[Thread-0,5,main]</code></pre>
<p>que (lignes inversées) :</p>
<pre><code>Thread[Thread-0,5,main]
Thread[main,5,main]</code></pre>
<p>Ceci car la méthode <code>start()</code> n'est pas blocante. Elle indique simplement que le code spécifié dans le constructeur pourra être appelé à n'importe quel moment par le scheduler de la JVM.</p>
<h2 id="classe-anonyme"><span class="header-section-number">6.1</span> Classe anonyme</h2>
<p>La construction suivante mérite une petite explication :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">Thread</span> thread = <span class="kw">new</span> <span class="bu">Thread</span>(<span class="kw">new</span> <span class="bu">Runnable</span>() {
    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span>() {
        <span class="at">@Override</span>
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="bu">Thread</span>.<span class="fu">currentThread</span>());
    }
});</code></pre></div>
<p>Étudions plus précisément l'expression :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">new</span> <span class="bu">Runnable</span>() {
    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span>() {
        <span class="co">// ...</span>
    }
}</code></pre></div>
<p>Elle définit une classe sans nom qui implémente <code>Runnable</code>. C'est comme si on avait écrit :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">new</span> <span class="fu">Anonymous</span>();</code></pre></div>
<p>avec la classe imbriquée suivante :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> Anonymous <span class="kw">implements</span> <span class="bu">Runnable</span> {
    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span>() {
        <span class="co">// ...</span>
    }
}</code></pre></div>
<p>Il y a en fait toute une famille de classes imbriquées (nested) : classes internes (inner), classes locales (dont fait partie les classes anonymes). Pour aller plus loin : https://docs.oracle.com/javase/tutorial/java/javaOO/nested.html</p>
<h2 id="exercice-1-5"><span class="header-section-number">6.2</span> Exercice 1</h2>
<p>On veut générer 10 millions (10M) de nombres entiers aléatoires.</p>
<ol style="list-style-type: decimal">
<li>Écrire un programme qui sauvegarde séquentiellement ces nombres dans un fichier texte.</li>
</ol>
<h2 id="correction-1-1"><span class="header-section-number">6.3</span> Correction 1</h2>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">FileNotFoundException</span> {
    <span class="bu">PrintStream</span> printStream = <span class="kw">new</span> <span class="bu">PrintStream</span>(<span class="st">&quot;random.csv&quot;</span>);
    <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; 10_000_<span class="dv">000</span>; i++) {
        <span class="kw">if</span> (i % 1_000_<span class="dv">000</span> == <span class="dv">0</span>) {
            <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;1M&quot;</span>);
        }
        <span class="dt">int</span> random = (<span class="dt">int</span>) (<span class="bu">Math</span>.<span class="fu">random</span>() * <span class="dv">100</span>); <span class="co">// [0 - 99]</span>
        printStream.<span class="fu">println</span>(random);
    }

    printStream.<span class="fu">close</span>();
}</code></pre></div>
<p>Temps d'exécution :</p>
<pre><code>337571ms</code></pre>
<p>Moyenne = 30s</p>
<h2 id="exercice-2-5"><span class="header-section-number">6.4</span> Exercice 2</h2>
<p>Si l'on juge (selon le contexte) que 30s est un temps inacceptable, alors il on pourra essayer de diminuer ce temps en parallélisant les traitements coûteux.</p>
<ol style="list-style-type: decimal">
<li>Configurer l'instance de PrintStream avec un tampon (buffer).</li>
<li>Trouver le code long à exécuter.</li>
</ol>
<h2 id="correction2"><span class="header-section-number">6.5</span> Correction 2</h2>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> thread.exercice;</span>

<span class="kw">import</span><span class="im"> java.io.BufferedOutputStream;</span>
<span class="kw">import</span><span class="im"> java.io.FileNotFoundException;</span>
<span class="kw">import</span><span class="im"> java.io.FileOutputStream;</span>
<span class="kw">import</span><span class="im"> java.io.PrintStream;</span>
<span class="kw">import</span><span class="im"> java.util.ArrayList;</span>
<span class="kw">import</span><span class="im"> java.util.List;</span>

<span class="kw">public</span> <span class="kw">class</span> Ex2 {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">FileNotFoundException</span> {
        <span class="dt">long</span> start = <span class="bu">System</span>.<span class="fu">currentTimeMillis</span>();
        <span class="bu">PrintStream</span> printStream = <span class="kw">new</span> <span class="bu">PrintStream</span>(
            <span class="kw">new</span> <span class="bu">BufferedOutputStream</span>(<span class="kw">new</span> <span class="bu">FileOutputStream</span>(<span class="st">&quot;random.csv&quot;</span>)));
        <span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; list = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;&gt;();

        <span class="dt">long</span> startRandom = <span class="bu">System</span>.<span class="fu">currentTimeMillis</span>();
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; 10_000_<span class="dv">000</span>; i++) {
            <span class="dt">int</span> random = (<span class="dt">int</span>) (<span class="bu">Math</span>.<span class="fu">random</span>() * <span class="dv">100</span>);
            list.<span class="fu">add</span>(random);
        }
        <span class="dt">long</span> endRandom = <span class="bu">System</span>.<span class="fu">currentTimeMillis</span>();
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; list.<span class="fu">size</span>(); i++) {
            <span class="kw">if</span> (i % 1_000_<span class="dv">000</span> == <span class="dv">0</span>) {
                <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;1M&quot;</span>);
            }
            <span class="bu">Integer</span> random = list.<span class="fu">get</span>(i);
            printStream.<span class="fu">println</span>(random);
        }
        <span class="dt">long</span> endPrint = <span class="bu">System</span>.<span class="fu">currentTimeMillis</span>();

        printStream.<span class="fu">close</span>();
        <span class="dt">long</span> end = <span class="bu">System</span>.<span class="fu">currentTimeMillis</span>();
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Total: &quot;</span> + (end - start) + <span class="st">&quot;ms&quot;</span>);
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Random: &quot;</span> + (endRandom - startRandom) + <span class="st">&quot;ms&quot;</span>);
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Print: &quot;</span> + (endPrint - endRandom) + <span class="st">&quot;ms&quot;</span>);
    }
}</code></pre></div>
<p>Rien qu'en passant à un flux bufferisé, on a divisé par 2 le temps de traitement.</p>
<pre><code>Total: 16109ms
Random: 1264ms
Print: 14812ms</code></pre>
<p>On voit de plus que le temps passé dans les entrées/sorties domine largement le temps passé dans la génération des nombres aléatoires.</p>
<h2 id="exercice3"><span class="header-section-number">6.6</span> Exercice 3</h2>
<p>Optimiser la sauvegarde sur fichier des nombres aléatoires. On pourra pour cela essayer d'écrire dans deux fichiers plutôt qu'un.</p>
<h2 id="correction-3-1"><span class="header-section-number">6.7</span> Correction 3</h2>
<p>Pour optimiser la sauvegarde nous avons déjà besoin de séparer les traitements de génération de nombre de leur sauvegarde, de sorte de paralléliser uniquement le code d'écriture fichier.</p>
<p>On sépare la liste de 10M en 2 listes de 5M. Et on écrit dans le même fichier de manière séquentielle.</p>
<p>Enfin on traite l'écriture des 2 listes en parallèle.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> thread.exercice;</span>

<span class="kw">import</span><span class="im"> java.io.BufferedOutputStream;</span>
<span class="kw">import</span><span class="im"> java.io.FileNotFoundException;</span>
<span class="kw">import</span><span class="im"> java.io.FileOutputStream;</span>
<span class="kw">import</span><span class="im"> java.io.PrintStream;</span>
<span class="kw">import</span><span class="im"> java.util.ArrayList;</span>
<span class="kw">import</span><span class="im"> java.util.List;</span>

<span class="kw">public</span> <span class="kw">class</span> Ex3 {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">InterruptedException</span> {
        <span class="dt">long</span> start = <span class="bu">System</span>.<span class="fu">currentTimeMillis</span>();
        <span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; list = <span class="fu">generateRandom</span>();
        <span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; a = list.<span class="fu">subList</span>(<span class="dv">0</span>, list.<span class="fu">size</span>() / <span class="dv">2</span>);
        <span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; b = list.<span class="fu">subList</span>(list.<span class="fu">size</span>() / <span class="dv">2</span>, list.<span class="fu">size</span>());
        assert a.<span class="fu">size</span>() + b.<span class="fu">size</span>() == list.<span class="fu">size</span>();
        <span class="bu">Thread</span> thread1 = <span class="kw">new</span> <span class="bu">Thread</span>(<span class="kw">new</span> <span class="bu">Runnable</span>() {
            <span class="at">@Override</span>
            <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span>() {
                <span class="kw">try</span> {
                    <span class="fu">print</span>(a, <span class="st">&quot;random1.csv&quot;</span>);
                } <span class="kw">catch</span> (<span class="bu">FileNotFoundException</span> e) {
                    e.<span class="fu">printStackTrace</span>();
                }
            }
        });
        <span class="bu">Thread</span> thread2 = <span class="kw">new</span> <span class="bu">Thread</span>(<span class="kw">new</span> <span class="bu">Runnable</span>() {
            <span class="at">@Override</span>
            <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span>() {
                <span class="kw">try</span> {
                    <span class="fu">print</span>(b, <span class="st">&quot;random2.csv&quot;</span>);
                } <span class="kw">catch</span> (<span class="bu">FileNotFoundException</span> e) {
                    e.<span class="fu">printStackTrace</span>();
                }
            }
        });
        thread1.<span class="fu">start</span>();
        thread2.<span class="fu">start</span>();
        <span class="bu">Thread</span>.<span class="fu">yield</span>();
        thread1.<span class="fu">join</span>();
        thread2.<span class="fu">join</span>();
        <span class="dt">long</span> end = <span class="bu">System</span>.<span class="fu">currentTimeMillis</span>();
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>((end - start) + <span class="st">&quot;ms&quot;</span>);
    }

    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">print</span>(<span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; a, <span class="bu">String</span> fileName) <span class="kw">throws</span> <span class="bu">FileNotFoundException</span> {
        <span class="bu">PrintStream</span> printStream1 = <span class="kw">new</span> <span class="bu">PrintStream</span>(<span class="kw">new</span> <span class="bu">BufferedOutputStream</span>(<span class="kw">new</span> <span class="bu">FileOutputStream</span>(fileName)));
        <span class="dt">int</span> i = <span class="dv">0</span>;
        <span class="kw">for</span> (<span class="bu">Integer</span> random : a) {
            <span class="kw">if</span> (i % 1_000_<span class="dv">000</span> == <span class="dv">0</span>) {
                <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;1M&quot;</span>);
            }
            printStream1.<span class="fu">println</span>(random);
            i++;
        }
        printStream1.<span class="fu">close</span>();
    }

    <span class="kw">private</span> <span class="dt">static</span> <span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; <span class="fu">generateRandom</span>() {
        <span class="bu">List</span>&lt;<span class="bu">Integer</span>&gt; list = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;&gt;();
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; 10_000_<span class="dv">000</span>; i++) {
            <span class="dt">int</span> random = (<span class="dt">int</span>) (<span class="bu">Math</span>.<span class="fu">random</span>() * <span class="dv">100</span>);
            list.<span class="fu">add</span>(random);
        }
        <span class="kw">return</span> list;
    }
}</code></pre></div>
<p>Sur ma machine, le programme s'exécute en 10s en moyenne.</p>
<p>On a gagnés 1/3 sur le temps d'écriture total.</p>
<h2 id="exercice-4-4"><span class="header-section-number">6.8</span> Exercice 4</h2>
<p>Écrire un programme qui affiche la somme et le nombre d'éléments du fichier de 10M nombre : random.csv.</p>
<p>Par exemple si random.csv contient :</p>
<pre><code>10
20</code></pre>
<p>alors on devra afficher :</p>
<pre><code>30 2</code></pre>
<h2 id="correction-4-1"><span class="header-section-number">6.9</span> Correction 4</h2>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> thread.exercice;</span>

<span class="kw">import</span><span class="im"> java.io.IOException;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Files;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Paths;</span>
<span class="kw">import</span><span class="im"> java.util.List;</span>

<span class="kw">public</span> <span class="kw">class</span> Ex4 {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">IOException</span> {
        <span class="bu">List</span>&lt;<span class="bu">String</span>&gt; strings = Files.<span class="fu">readAllLines</span>(Paths.<span class="fu">get</span>(<span class="st">&quot;random.csv&quot;</span>));
        <span class="dt">int</span> sum = <span class="dv">0</span>;
        <span class="dt">int</span> count = <span class="dv">0</span>;
        <span class="kw">for</span> (<span class="bu">String</span> string : strings) {
            <span class="dt">int</span> n = <span class="bu">Integer</span>.<span class="fu">parseInt</span>(string);
            sum += n;
            count += <span class="dv">1</span>;
        }
        <span class="bu">System</span>.<span class="fu">out.printf</span>(<span class="st">&quot;</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d%n</span><span class="st">&quot;</span>, sum, count);
    }
}</code></pre></div>
<h2 id="exercice-5-5"><span class="header-section-number">6.10</span> Exercice 5</h2>
<p>Transformer le programme 4 pour afficher la également la somme et le compte les 2 fichiers random1.csv et random2.csv.</p>
<p>Par exemple si random1.csv contient :</p>
<pre><code>10
20</code></pre>
<p>et random2.csv contient :</p>
<pre><code>30
40</code></pre>
<p>Alors le programme devra afficher :</p>
<pre><code>100 4</code></pre>
<h2 id="correction-5-1"><span class="header-section-number">6.11</span> Correction 5</h2>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> thread.exercice;</span>

<span class="kw">import</span><span class="im"> java.io.IOException;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Files;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Paths;</span>
<span class="kw">import</span><span class="im"> java.util.List;</span>

<span class="kw">public</span> <span class="kw">class</span> Ex5 {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">IOException</span> {
        Average average1 = <span class="fu">computeAverage</span>(<span class="st">&quot;random1.csv&quot;</span>);
        Average average2 = <span class="fu">computeAverage</span>(<span class="st">&quot;random2.csv&quot;</span>);

        <span class="bu">System</span>.<span class="fu">out.printf</span>(<span class="st">&quot;</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d%n</span><span class="st">&quot;</span>, 
            average1.<span class="fu">getSum</span>() + average2.<span class="fu">getSum</span>(), 
            average1.<span class="fu">getCount</span>() + average2.<span class="fu">getCount</span>());
    }

    <span class="kw">private</span> <span class="dt">static</span> Average <span class="fu">computeAverage</span>(<span class="bu">String</span> filename) <span class="kw">throws</span> <span class="bu">IOException</span> {
        <span class="bu">List</span>&lt;<span class="bu">String</span>&gt; strings = Files.<span class="fu">readAllLines</span>(Paths.<span class="fu">get</span>(filename));
        <span class="dt">int</span> sum = <span class="dv">0</span>;
        <span class="dt">int</span> count = <span class="dv">0</span>;
        <span class="kw">for</span> (<span class="bu">String</span> string : strings) {
            <span class="dt">int</span> n = <span class="bu">Integer</span>.<span class="fu">parseInt</span>(string);
            sum += n;
            count += <span class="dv">1</span>;
        }
        <span class="kw">return</span> <span class="kw">new</span> <span class="fu">Average</span>(sum, count);
    }

}

<span class="kw">class</span> Average {
    <span class="kw">private</span> <span class="dt">final</span> <span class="dt">int</span> sum;
    <span class="kw">private</span> <span class="dt">final</span> <span class="dt">int</span> count;

    <span class="fu">Average</span>(<span class="dt">int</span> sum, <span class="dt">int</span> count) {
        <span class="kw">this</span>.<span class="fu">sum</span> = sum;
        <span class="kw">this</span>.<span class="fu">count</span> = count;
    }

    <span class="dt">int</span> <span class="fu">getSum</span>() {
        <span class="kw">return</span> sum;
    }

    <span class="dt">int</span> <span class="fu">getCount</span>() {
        <span class="kw">return</span> count;
    }
}</code></pre></div>
<p>Les expressions <code>average1.getSum() + average2.getSum()</code> et <code>average1.getCount() + average2.getCount()</code> permettent de définir la moyenne d'une somme. Elle n'est pas la somme des moyennes.</p>
<p>On pourra réécrire :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> thread.exercice;</span>

<span class="kw">import</span><span class="im"> java.io.IOException;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Files;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Paths;</span>
<span class="kw">import</span><span class="im"> java.util.List;</span>

<span class="kw">public</span> <span class="kw">class</span> Ex5 {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">IOException</span> {
        Average average1 = <span class="fu">computeAverage</span>(<span class="st">&quot;random1.csv&quot;</span>);
        Average average2 = <span class="fu">computeAverage</span>(<span class="st">&quot;random2.csv&quot;</span>);

        <span class="fu">print</span>(Average.<span class="fu">sum</span>(average1, average2));
    }

    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">print</span>(Average average) {
        <span class="bu">System</span>.<span class="fu">out.printf</span>(<span class="st">&quot;</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d%n</span><span class="st">&quot;</span>, average.<span class="fu">getSum</span>(), average.<span class="fu">getCount</span>());
    }

    <span class="kw">private</span> <span class="dt">static</span> Average <span class="fu">computeAverage</span>(<span class="bu">String</span> filename) 
        <span class="kw">throws</span> <span class="bu">IOException</span> {
        <span class="bu">List</span>&lt;<span class="bu">String</span>&gt; strings = Files.<span class="fu">readAllLines</span>(Paths.<span class="fu">get</span>(filename));
        <span class="dt">int</span> sum = <span class="dv">0</span>;
        <span class="dt">int</span> count = <span class="dv">0</span>;
        <span class="kw">for</span> (<span class="bu">String</span> string : strings) {
            <span class="dt">int</span> n = <span class="bu">Integer</span>.<span class="fu">parseInt</span>(string);
            sum += n;
            count += <span class="dv">1</span>;
        }
        <span class="kw">return</span> <span class="kw">new</span> <span class="fu">Average</span>(sum, count);
    }

}

<span class="kw">class</span> Average {
    <span class="kw">private</span> <span class="dt">final</span> <span class="dt">int</span> sum;
    <span class="kw">private</span> <span class="dt">final</span> <span class="dt">int</span> count;

    <span class="fu">Average</span>(<span class="dt">int</span> sum, <span class="dt">int</span> count) {
        <span class="kw">this</span>.<span class="fu">sum</span> = sum;
        <span class="kw">this</span>.<span class="fu">count</span> = count;
    }

    <span class="dt">static</span> Average <span class="fu">sum</span>(Average average1, Average average2) {
        <span class="kw">return</span> <span class="kw">new</span> <span class="fu">Average</span>(average1.<span class="fu">getSum</span>() + average2.<span class="fu">getSum</span>(), 
            average1.<span class="fu">getCount</span>() + average2.<span class="fu">getCount</span>());
    }

    <span class="dt">int</span> <span class="fu">getSum</span>() {
        <span class="kw">return</span> sum;
    }

    <span class="dt">int</span> <span class="fu">getCount</span>() {
        <span class="kw">return</span> count;
    }
}</code></pre></div>
<p>Ce programme tourne en 5s en moyenne.</p>
<h2 id="exercice-6-4"><span class="header-section-number">6.12</span> Exercice 6</h2>
<p>Paralléliser la lecture des deux fichiers.</p>
<h2 id="correction-6"><span class="header-section-number">6.13</span> Correction 6</h2>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> thread.exercice;</span>

<span class="kw">import</span><span class="im"> java.io.IOException;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Files;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Paths;</span>
<span class="kw">import</span><span class="im"> java.util.List;</span>

<span class="kw">public</span> <span class="kw">class</span> Ex6 {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">InterruptedException</span> {
        <span class="dt">final</span> Average[] average1 = <span class="kw">new</span> Average[<span class="dv">1</span>];
        <span class="bu">Thread</span> thread1 = <span class="kw">new</span> <span class="bu">Thread</span>(<span class="kw">new</span> <span class="bu">Runnable</span>() {
            <span class="at">@Override</span>
            <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span>() {
                <span class="kw">try</span> {
                    average1[<span class="dv">0</span>] = <span class="fu">computeAverage</span>(<span class="st">&quot;random1.csv&quot;</span>);
                } <span class="kw">catch</span> (<span class="bu">IOException</span> e) {
                    e.<span class="fu">printStackTrace</span>();
                }
            }
        });
        <span class="dt">final</span> Average[] average2 = <span class="kw">new</span> Average[<span class="dv">1</span>];
        <span class="bu">Thread</span> thread2 = <span class="kw">new</span> <span class="bu">Thread</span>(<span class="kw">new</span> <span class="bu">Runnable</span>() {
            <span class="at">@Override</span>
            <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span>() {
                <span class="kw">try</span> {
                    average2[<span class="dv">0</span>] = <span class="fu">computeAverage</span>(<span class="st">&quot;random2.csv&quot;</span>);
                } <span class="kw">catch</span> (<span class="bu">IOException</span> e) {
                    e.<span class="fu">printStackTrace</span>();
                }
            }
        });
        thread1.<span class="fu">start</span>();
        thread2.<span class="fu">start</span>();
        <span class="bu">Thread</span>.<span class="fu">yield</span>();
        thread1.<span class="fu">join</span>();
        thread2.<span class="fu">join</span>();

        <span class="fu">print</span>(Average.<span class="fu">sum</span>(average1[<span class="dv">0</span>], average2[<span class="dv">0</span>]));
    }

    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">print</span>(Average average) {
        <span class="bu">System</span>.<span class="fu">out.printf</span>(<span class="st">&quot;</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d%n</span><span class="st">&quot;</span>, average.<span class="fu">getSum</span>(), 
            average.<span class="fu">getCount</span>());
    }

    <span class="kw">private</span> <span class="dt">static</span> Average <span class="fu">computeAverage</span>(<span class="bu">String</span> filename) 
        <span class="kw">throws</span> <span class="bu">IOException</span> {
        <span class="bu">List</span>&lt;<span class="bu">String</span>&gt; strings = Files.<span class="fu">readAllLines</span>(Paths.<span class="fu">get</span>(filename));
        <span class="dt">int</span> sum = <span class="dv">0</span>;
        <span class="dt">int</span> count = <span class="dv">0</span>;
        <span class="kw">for</span> (<span class="bu">String</span> string : strings) {
            <span class="dt">int</span> n = <span class="bu">Integer</span>.<span class="fu">parseInt</span>(string);
            sum += n;
            count += <span class="dv">1</span>;
        }
        <span class="kw">return</span> <span class="kw">new</span> <span class="fu">Average</span>(sum, count);
    }

    <span class="dt">static</span> <span class="kw">class</span> Average {
        <span class="kw">private</span> <span class="dt">final</span> <span class="dt">int</span> sum;
        <span class="kw">private</span> <span class="dt">final</span> <span class="dt">int</span> count;

        <span class="fu">Average</span>(<span class="dt">int</span> sum, <span class="dt">int</span> count) {
            <span class="kw">this</span>.<span class="fu">sum</span> = sum;
            <span class="kw">this</span>.<span class="fu">count</span> = count;
        }

        <span class="dt">static</span> Average <span class="fu">sum</span>(Average average1, Average average2) {
            <span class="kw">return</span> <span class="kw">new</span> <span class="fu">Average</span>(average1.<span class="fu">getSum</span>() + average2.<span class="fu">getSum</span>(), 
                average1.<span class="fu">getCount</span>() + average2.<span class="fu">getCount</span>());
        }

        <span class="dt">int</span> <span class="fu">getSum</span>() {
            <span class="kw">return</span> sum;
        }

        <span class="dt">int</span> <span class="fu">getCount</span>() {
            <span class="kw">return</span> count;
        }
    }
}</code></pre></div>
<pre><code>495150079 10000000</code></pre>
<p>Sur ma machine, le programme se termine en 9543ms 4615ms 6533ms...</p>
<h2 id="exercice-7-4"><span class="header-section-number">6.14</span> Exercice 7</h2>
<p>Afficher la moyenne arithmétique des nombres plutôt que leur somme et leur compte.</p>
<pre><code>moyenne = somme / compte</code></pre>
<h2 id="exercice-8-3"><span class="header-section-number">6.15</span> Exercice 8</h2>
<p>Lancer le programme de calcul de la moyenne précédant en ayant préalablement supprimé le fichier random1.csv.</p>
<ol style="list-style-type: decimal">
<li>Qu'observe t'on ?</li>
</ol>
<p>On souhaite conditionner l'affichage de la moyenne à la réussite des 2 fils d'exécutions.</p>
<ol style="list-style-type: decimal">
<li>Comment transmettre l'information de succès entre Thread ?</li>
</ol>
<h2 id="correction-8"><span class="header-section-number">6.16</span>  Correction 8</h2>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">InterruptedException</span> {
    <span class="dt">long</span> start = <span class="bu">System</span>.<span class="fu">currentTimeMillis</span>();
    <span class="dt">final</span> Average[] average1 = <span class="kw">new</span> Average[<span class="dv">1</span>];
    <span class="dt">final</span> <span class="bu">Exception</span>[] exception1 = <span class="kw">new</span> <span class="bu">Exception</span>[<span class="dv">1</span>];
    <span class="bu">Thread</span> thread1 = <span class="kw">new</span> <span class="bu">Thread</span>(<span class="kw">new</span> <span class="bu">Runnable</span>() {
        <span class="at">@Override</span>
        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span>() {
            <span class="kw">try</span> {
                average1[<span class="dv">0</span>] = <span class="fu">computeAverage</span>(<span class="st">&quot;random1.csv&quot;</span>);
            } <span class="kw">catch</span> (<span class="bu">IOException</span> e) {
                exception1[<span class="dv">0</span>] = e;
            }
        }
    });
    <span class="dt">final</span> Average[] average2 = <span class="kw">new</span> Average[<span class="dv">1</span>];
    <span class="dt">final</span> <span class="bu">Exception</span>[] exception1 = <span class="kw">new</span> <span class="bu">Exception</span>[<span class="dv">1</span>];
    <span class="bu">Thread</span> thread2 = <span class="kw">new</span> <span class="bu">Thread</span>(<span class="kw">new</span> <span class="bu">Runnable</span>() {
        <span class="at">@Override</span>
        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span>() {
            <span class="kw">try</span> {
                average2[<span class="dv">0</span>] = <span class="fu">computeAverage</span>(<span class="st">&quot;random2.csv&quot;</span>);
            } <span class="kw">catch</span> (<span class="bu">IOException</span> e) {
                exception2[<span class="dv">0</span>] = e;
            }
        }
    });
    thread1.<span class="fu">start</span>();
    thread2.<span class="fu">start</span>();
    <span class="bu">Thread</span>.<span class="fu">yield</span>();
    thread1.<span class="fu">join</span>();
    thread2.<span class="fu">join</span>();
    <span class="dt">long</span> end = <span class="bu">System</span>.<span class="fu">currentTimeMillis</span>();
    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(end - start + <span class="st">&quot;ms&quot;</span>);
    
    <span class="kw">if</span> (exception1[<span class="dv">0</span>] == <span class="kw">null</span>) {
        <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">Exception</span>(exception1[<span class="dv">0</span>]);
    }
    <span class="kw">if</span> (exception2[<span class="dv">0</span>] == <span class="kw">null</span>) {
        <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">Exception</span>(exception2[<span class="dv">0</span>]);
    }
    
    <span class="fu">print</span>(Average.<span class="fu">sum</span>(average1[<span class="dv">0</span>], average2[<span class="dv">0</span>]));
}</code></pre></div>
<h2 id="exercice-9-4"><span class="header-section-number">6.17</span> Exercice 9</h2>
<p>Réécrire le programme précédant en utilisant cette fois la méthode <code>Thread.setUncaughtExceptionHandler()</code> pour conditionner l'affichage de la moyenne au succès des deux threads.</p>
<h2 id="correction-9"><span class="header-section-number">6.18</span> Correction 9</h2>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">InterruptedException</span> {
    <span class="dt">long</span> start = <span class="bu">System</span>.<span class="fu">currentTimeMillis</span>();
    <span class="dt">final</span> Average[] average1 = <span class="kw">new</span> Average[<span class="dv">1</span>];
    <span class="dt">final</span> <span class="bu">Exception</span>[] exception1 = <span class="kw">new</span> <span class="bu">Exception</span>[<span class="dv">1</span>];
    <span class="bu">Thread</span> thread1 = <span class="kw">new</span> <span class="bu">Thread</span>(<span class="kw">new</span> <span class="bu">Runnable</span>() {
        <span class="at">@Override</span>
        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span>() {
            <span class="kw">try</span> {
                average1[<span class="dv">0</span>] = <span class="fu">computeAverage</span>(<span class="st">&quot;random1.csv&quot;</span>);
            } <span class="kw">catch</span> (<span class="bu">IOException</span> e) {
                <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">RuntimeException</span>(e);
            }
        }
    });
    <span class="dt">final</span> Average[] average2 = <span class="kw">new</span> Average[<span class="dv">1</span>];
    <span class="dt">final</span> <span class="bu">Exception</span>[] exception2 = <span class="kw">new</span> <span class="bu">Exception</span>[<span class="dv">1</span>];
    <span class="bu">Thread</span> thread2 = <span class="kw">new</span> <span class="bu">Thread</span>(<span class="kw">new</span> <span class="bu">Runnable</span>() {
        <span class="at">@Override</span>
        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span>() {
            <span class="kw">try</span> {
                average2[<span class="dv">0</span>] = <span class="fu">computeAverage</span>(<span class="st">&quot;random2.csv&quot;</span>);
            } <span class="kw">catch</span> (<span class="bu">IOException</span> e) {
                <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">RuntimeException</span>(e);
            }
        }
    });
    
    thread1.<span class="fu">setUncaughtExceptionHandler</span>(<span class="kw">new</span> <span class="bu">Thread</span>.<span class="fu">UncaughtExceptionHandler</span>() {
        <span class="at">@Override</span>
        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">uncaughtException</span>(<span class="bu">Thread</span> t, <span class="bu">Throwable</span> e) {
            exception1[<span class="dv">0</span>] = e;
        }
    });
    
    thread2.<span class="fu">setUncaughtExceptionHandler</span>(<span class="kw">new</span> <span class="bu">Thread</span>.<span class="fu">UncaughtExceptionHandler</span>() {
        <span class="at">@Override</span>
        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">uncaughtException</span>(<span class="bu">Thread</span> t, <span class="bu">Throwable</span> e) {
            exception2[<span class="dv">0</span>] = e;
        }
    });
    
    thread1.<span class="fu">start</span>();
    thread2.<span class="fu">start</span>();
    <span class="bu">Thread</span>.<span class="fu">yield</span>();
    thread1.<span class="fu">join</span>();
    thread2.<span class="fu">join</span>();
    <span class="dt">long</span> end = <span class="bu">System</span>.<span class="fu">currentTimeMillis</span>();
    <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(end - start + <span class="st">&quot;ms&quot;</span>);
    
    <span class="kw">if</span> (exception1[<span class="dv">0</span>] == <span class="kw">null</span>) {
        <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">Exception</span>(exception1[<span class="dv">0</span>]);
    }
    <span class="kw">if</span> (exception2[<span class="dv">0</span>] == <span class="kw">null</span>) {
        <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">Exception</span>(exception2[<span class="dv">0</span>]);
    }
    
    <span class="fu">print</span>(Average.<span class="fu">sum</span>(average1[<span class="dv">0</span>], average2[<span class="dv">0</span>]));
}</code></pre></div>
<h2 id="exercice-10-4"><span class="header-section-number">6.19</span> Exercice 10</h2>
<p>Écrire une classe Counter et une fonction qui incrémente 100 000 fois le compteur.</p>
<h2 id="correction-10"><span class="header-section-number">6.20</span> Correction 10</h2>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> thread.exercice;</span>

<span class="kw">public</span> <span class="kw">class</span> Counter {

    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        Counter counter = <span class="kw">new</span> <span class="fu">Counter</span>();
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; 100_<span class="dv">000</span>; i++) {
            counter.<span class="fu">increment</span>();
        }
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(counter);
    }

    <span class="kw">private</span> <span class="dt">int</span> i;

    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">increment</span>() {
        i++;
    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span>() {
        <span class="kw">return</span> <span class="bu">String</span>.<span class="fu">valueOf</span>(i);
    }
}</code></pre></div>
<h2 id="exercice-11-4"><span class="header-section-number">6.21</span> Exercice 11</h2>
<p>Partager le travail d'incrémentation entre 2 fils d'exécuctions concurrents. 50 000 fois chacun. Observer le résultat.</p>
<h2 id="correction-12"><span class="header-section-number">6.22</span> Correction 12</h2>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> thread.exercice;</span>

<span class="kw">public</span> <span class="kw">class</span> Counter {

    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> <span class="dt">int</span> TIMES = 50_<span class="dv">000</span>;

    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">InterruptedException</span> {
        Counter counter = <span class="kw">new</span> <span class="fu">Counter</span>();
        <span class="bu">Thread</span> thread = <span class="kw">new</span> <span class="bu">Thread</span>(<span class="kw">new</span> <span class="bu">Runnable</span>() {
            <span class="at">@Override</span>
            <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span>() {
                <span class="fu">incrementUntil</span>(counter, TIMES);
            }
        });
        thread.<span class="fu">start</span>();
        <span class="bu">Thread</span>.<span class="fu">yield</span>();
        <span class="fu">incrementUntil</span>(counter, TIMES);
        thread.<span class="fu">join</span>();
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(counter);
    }

    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">incrementUntil</span>(Counter counter, <span class="dt">int</span> times) {
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; times; i++) {
            counter.<span class="fu">increment</span>();
        }
    }

    <span class="kw">private</span> <span class="dt">int</span> i;

    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">increment</span>() {
        i++;
    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span>() {
        <span class="kw">return</span> <span class="bu">String</span>.<span class="fu">valueOf</span>(i);
    }
}</code></pre></div>
<p>On observe les résultats suivant :</p>
<pre><code>96810 
100000 
53682 
100000 
75031 
52817 
100000
100000
98012</code></pre>
<p>On s'attendait à avoir 100% de 100000. Soit moins de 50% de bons résultats.</p>
<h2 id="synchronisation"><span class="header-section-number">6.23</span> Synchronisation</h2>
<p>Quand plusieurs <code>Thread</code> partagent un objet, tout se gatte. Effectuer des lectures ou écritures en concurrence nécessite beaucoup de rigueur. En effet, l'exemple précédant montre une &quot;race condition&quot;. L'opération <code>i++</code> effectuée en concurrence n'est pas atomique comme on pourrait le penser.</p>
<p>Une opération est atomique quand tous les threads peuvent dire si l'opération est exécutée ou non. Si un thread peut observer l'état intermédiaire et interne d'une opération alors elle n'est pas atomique.</p>
<p>L'instruction <code>i++</code> consiste en 3 étapes :</p>
<ol style="list-style-type: decimal">
<li>lecture de la variable i ;</li>
<li>incrémentation ;</li>
<li>écriture de la nouvelle valeur.</li>
</ol>
<p>Il est donc tout à fait possible que le thread 1 lise <code>i</code> (i = 0), qu'au même moment le thread 2 lise aussi <code>i</code> (i = 0). Le deuxième thread travaille donc avec des données déjà obsolète. Le résultat dans ce cas est que deux opérations concurrentes donnent le même résultat qu'une seule.</p>
<p>Le premier mécanisme fournit par le langage Java permet de vérouiller l'accès à un objet partagé pendant une opération que l'on souhaite atomique.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">private</span> <span class="kw">synchronized</span> <span class="dt">void</span> <span class="fu">increment</span>() {
    i++;
}</code></pre></div>
<p>Cette syntaxe indique qu'un seul thread pourra accéder à cet objet à la fois. Plus précisément, un seul thread peut appeler les méthodes <code>synchronized</code> de l'objet. Il est donc possible qu'un premier thread accède à l'objet <code>counter</code> en appelant <code>increment()</code>, et qu'un deuxième y accède aussi en même temps à via <code>toString()</code> qui n'est pas <code>synchronized</code>.</p>
<p>En revanche, si on définit la méthode :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">private</span> <span class="kw">synchronized</span> <span class="dt">int</span> <span class="fu">get</span>() {
    <span class="kw">return</span> i;
}</code></pre></div>
<p>Alors, il ne pourra pas y avoir le thread 1 appelant <code>increment()</code> en même temps que thread 2 qui appelle <code>get()</code>.</p>
<p>Tous les objets Java ont un verrou intrinsec qui est ouvert et fermé par le thread qui appelle la méthode <code>synchronized</code>. On dit que le thread acquiert le verrou au début de la méthode et le relâche la fin.</p>
<p>Une syntaxe alternative plus souple et verbeuse met ce verrou intrinsec en lumière (this) :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">private</span> <span class="kw">synchronized</span> <span class="dt">void</span> <span class="fu">increment</span>() {
    <span class="kw">synchronized</span> (<span class="kw">this</span>) {
        i++;
    }
}</code></pre></div>
<h2 id="dîner-des-philosophes-13"><span class="header-section-number">6.24</span> Dîner des philosophes (13)</h2>
<p>Cinq philosophes dînent le soir. Chacun partage sa fourchette droite avec la fourchette gauche de son voisin de droite. Il y a donc cinq fourchettes (représentées par <code>|</code>). Chaque philosophe réfléchit un moment puis mange pendant un certain temps.</p>
<pre><code>... 1 | 2 | 3 | 4 | 5 | 1...</code></pre>
<p>Pour manger, le philosophe commence par prendre sa fourchette gauche puis la droite puis mange puis repose la fourchette droite puis la gauche.</p>
<p>Précision : les philosophes ne se parlent pas. Écrire un programme qui simule un repas entre ces 5 philosophes.</p>
<h2 id="correction-13"><span class="header-section-number">6.25</span> Correction (13)</h2>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> thread.exercice;</span>

<span class="kw">import</span><span class="im"> java.util.ArrayList;</span>
<span class="kw">import</span><span class="im"> java.util.List;</span>

<span class="kw">public</span> <span class="kw">class</span> DinerPhilosophe {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">InterruptedException</span> {
        <span class="bu">List</span>&lt;<span class="bu">Object</span>&gt; fourchettes = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;&gt;();
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; <span class="dv">5</span>; i++) {
            <span class="bu">Object</span> fourchette = i;
            fourchettes.<span class="fu">add</span>(fourchette);
        }
        <span class="bu">List</span>&lt;Philosophe&gt; philosophes = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;&gt;();
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; <span class="dv">5</span>; i++) {
            philosophes.<span class="fu">add</span>(<span class="kw">new</span> <span class="fu">Philosophe</span>(fourchettes.<span class="fu">get</span>(i), fourchettes.<span class="fu">get</span>((i + <span class="dv">1</span>) % <span class="dv">5</span>), <span class="bu">String</span>.<span class="fu">valueOf</span>(i)));
        }
        <span class="bu">List</span>&lt;<span class="bu">Thread</span>&gt; threads = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;&gt;();
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; <span class="dv">5</span>; i++) {
            <span class="dt">int</span> finalI = i;
            <span class="bu">Runnable</span> target = <span class="kw">new</span> <span class="bu">Runnable</span>() {
                <span class="at">@Override</span>
                <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span>() {
                    Philosophe philosophe = philosophes.<span class="fu">get</span>(finalI);
                    <span class="kw">for</span> (<span class="dt">int</span> j = <span class="dv">0</span>; j &lt; 10_<span class="dv">000</span>; j++) {
                        philosophe.<span class="fu">manger</span>();
                    }
                }
            };
            threads.<span class="fu">add</span>(<span class="kw">new</span> <span class="bu">Thread</span>(target));
        }
        <span class="kw">for</span> (<span class="bu">Thread</span> thread : threads) {
            thread.<span class="fu">start</span>();
        }
        <span class="bu">Thread</span>.<span class="fu">yield</span>();
        <span class="kw">for</span> (<span class="bu">Thread</span> thread : threads) {
            thread.<span class="fu">join</span>();
        }
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Fin du dîner&quot;</span>);
    }

    <span class="kw">private</span> <span class="dt">static</span> <span class="kw">class</span> Philosophe {
        <span class="kw">private</span> <span class="dt">final</span> <span class="bu">Object</span> fourchetteGauche;
        <span class="kw">private</span> <span class="dt">final</span> <span class="bu">Object</span> fourchetteDroite;
        <span class="kw">private</span> <span class="dt">final</span> <span class="bu">String</span> nom;

        <span class="fu">Philosophe</span>(<span class="bu">Object</span> fourchetteGauche, <span class="bu">Object</span> fourchetteDroite, <span class="bu">String</span> nom) {
            <span class="kw">this</span>.<span class="fu">fourchetteGauche</span> = fourchetteGauche;
            <span class="kw">this</span>.<span class="fu">fourchetteDroite</span> = fourchetteDroite;
            <span class="kw">this</span>.<span class="fu">nom</span> = nom;
        }

        <span class="dt">void</span> <span class="fu">manger</span>() {
            <span class="bu">System</span>.<span class="fu">out.printf</span>(<span class="st">&quot;</span><span class="sc">%s</span><span class="st"> attend la fourchette gauche </span><span class="sc">%s%n</span><span class="st">&quot;</span>, nom, fourchetteGauche);
            <span class="kw">synchronized</span> (fourchetteGauche) {
                <span class="bu">System</span>.<span class="fu">out.printf</span>(<span class="st">&quot;</span><span class="sc">%s</span><span class="st"> attend la fourchette droite </span><span class="sc">%s%n</span><span class="st">&quot;</span>, nom, fourchetteDroite);
                <span class="kw">synchronized</span> (fourchetteDroite) {
                    <span class="bu">System</span>.<span class="fu">out.printf</span>(<span class="st">&quot;</span><span class="sc">%s</span><span class="st"> mange</span><span class="sc">%n</span><span class="st">&quot;</span>, nom);
                    <span class="kw">try</span> {
                        <span class="bu">Thread</span>.<span class="fu">sleep</span>(((<span class="dt">long</span>) (<span class="bu">Math</span>.<span class="fu">random</span>() * <span class="dv">500</span>)));
                    } <span class="kw">catch</span> (<span class="bu">InterruptedException</span> e) {
                        e.<span class="fu">printStackTrace</span>();
                    }
                }
            }
        }
    }
}</code></pre></div>
<p>En lancant ce programme j'obtiens un blocage mutuel (aussi appelé &quot;deadlock&quot;) :</p>
<pre><code>0 attend la fourchette gauche 0
0 prend la fourchette gauche 0
0 attend la fourchette droite 1
0 prend la fourchette droite 1
0 mange
3 attend la fourchette gauche 3
3 prend la fourchette gauche 3
3 attend la fourchette droite 4
3 prend la fourchette droite 4
3 mange
4 attend la fourchette gauche 4
1 attend la fourchette gauche 1
2 attend la fourchette gauche 2
2 prend la fourchette gauche 2
2 attend la fourchette droite 3
0 repose la fourchette droite 1
1 prend la fourchette gauche 1
1 attend la fourchette droite 2
0 repose la fourchette gauche 0
0 attend la fourchette gauche 0
0 prend la fourchette gauche 0
0 attend la fourchette droite 1
3 repose la fourchette droite 4
4 prend la fourchette gauche 4
4 attend la fourchette droite 0
3 repose la fourchette gauche 3
3 attend la fourchette gauche 3
3 prend la fourchette gauche 3
3 attend la fourchette droite 4</code></pre>
<p>Ici le philosophe 3 attend la fourchette droite 4. Or la fourchette droite 4 est toujours entre les mains du philosophe 4. Mais le philosophe 4 attend aussi sa fourchette droite 0. Et ainsi de suite jusqu'à avoir un inter-blocage (comme dans certaines intersections routières).</p>
<h2 id="exercice-14-2"><span class="header-section-number">6.26</span> Exercice 14</h2>
<p>Pour éviter cet interblocage, une méthode consiste à toujours vérrouiller les fourchettes dans le même ordre global. On peut ordonner les fourchette facilement de façon croissante : chaque philosophe doit prendre la fourchette qui a un numéro plus petit en premier.</p>
<p>Par exemple, si le philosophe 0 a la fourchette 0 et 1 alors il devra prendre la 0 en premier. Si le philosophe 4 a la fourchette 4 et 0 il devra prendre la 0 en premier. Ainsi les attentes mutuelles ne sont plus possibles.</p>
<ol style="list-style-type: decimal">
<li>Corriger le programme de simulation du dîner en imposant un ordre global.</li>
</ol>
<h2 id="correction-14"><span class="header-section-number">6.27</span> Correction 14</h2>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">if</span> (fourchetteGauche.<span class="fu">ordre</span> &gt; fourchetteDroite.<span class="fu">ordre</span>) {
    <span class="kw">this</span>.<span class="fu">fourchetteGauche</span> = fourchetteDroite;
    <span class="kw">this</span>.<span class="fu">fourchetteDroite</span> = fourchetteGauche;
} <span class="kw">else</span> {
    <span class="kw">this</span>.<span class="fu">fourchetteGauche</span> = fourchetteGauche;
    <span class="kw">this</span>.<span class="fu">fourchetteDroite</span> = fourchetteDroite;
}
assert <span class="kw">this</span>.<span class="fu">fourchetteGauche</span>.<span class="fu">ordre</span> &lt; <span class="kw">this</span>.<span class="fu">fourchetteDroite</span>.<span class="fu">ordre</span>;</code></pre></div>
<p>Le programme entier :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> thread.exercice;</span>

<span class="kw">import</span><span class="im"> java.util.ArrayList;</span>
<span class="kw">import</span><span class="im"> java.util.List;</span>

<span class="kw">public</span> <span class="kw">class</span> OrdreDinerPhilosophe {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">InterruptedException</span> {
        <span class="bu">List</span>&lt;Fourchette&gt; fourchettes = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;&gt;();
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; <span class="dv">5</span>; i++) {
            fourchettes.<span class="fu">add</span>(<span class="kw">new</span> <span class="fu">Fourchette</span>(i));
        }
        <span class="bu">List</span>&lt;Philosophe&gt; philosophes = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;&gt;();
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; <span class="dv">5</span>; i++) {
            philosophes.<span class="fu">add</span>(<span class="kw">new</span> <span class="fu">Philosophe</span>(fourchettes.<span class="fu">get</span>(i), fourchettes.<span class="fu">get</span>((i + <span class="dv">1</span>) % <span class="dv">5</span>), <span class="bu">String</span>.<span class="fu">valueOf</span>(i)));
        }
        <span class="bu">List</span>&lt;<span class="bu">Thread</span>&gt; threads = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;&gt;();
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; <span class="dv">5</span>; i++) {
            <span class="dt">int</span> finalI = i;
            <span class="bu">Runnable</span> target = <span class="kw">new</span> <span class="bu">Runnable</span>() {
                <span class="at">@Override</span>
                <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span>() {
                    Philosophe philosophe = philosophes.<span class="fu">get</span>(finalI);
                    <span class="kw">for</span> (<span class="dt">int</span> j = <span class="dv">0</span>; j &lt; <span class="dv">1000</span>; j++) {
                        philosophe.<span class="fu">manger</span>();
                    }
                }
            };
            threads.<span class="fu">add</span>(<span class="kw">new</span> <span class="bu">Thread</span>(target));
        }

        <span class="kw">for</span> (<span class="bu">Thread</span> thread : threads) {
            thread.<span class="fu">start</span>();
        }
        <span class="kw">for</span> (<span class="bu">Thread</span> thread : threads) {
            thread.<span class="fu">join</span>();
        }
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Fin du dîner&quot;</span>);
    }

    <span class="kw">private</span> <span class="dt">static</span> <span class="kw">class</span> Philosophe {
        <span class="kw">private</span> <span class="dt">final</span> Fourchette fourchetteGauche;
        <span class="kw">private</span> <span class="dt">final</span> Fourchette fourchetteDroite;
        <span class="kw">private</span> <span class="dt">final</span> <span class="bu">String</span> nom;

        <span class="fu">Philosophe</span>(Fourchette fourchetteGauche, Fourchette fourchetteDroite, <span class="bu">String</span> nom) {
            <span class="kw">if</span> (fourchetteGauche.<span class="fu">ordre</span> &gt; fourchetteDroite.<span class="fu">ordre</span>) {
                <span class="kw">this</span>.<span class="fu">fourchetteGauche</span> = fourchetteDroite;
                <span class="kw">this</span>.<span class="fu">fourchetteDroite</span> = fourchetteGauche;
            } <span class="kw">else</span> {
                <span class="kw">this</span>.<span class="fu">fourchetteGauche</span> = fourchetteGauche;
                <span class="kw">this</span>.<span class="fu">fourchetteDroite</span> = fourchetteDroite;
            }
            assert <span class="kw">this</span>.<span class="fu">fourchetteGauche</span>.<span class="fu">ordre</span> &lt; <span class="kw">this</span>.<span class="fu">fourchetteDroite</span>.<span class="fu">ordre</span>;
            <span class="kw">this</span>.<span class="fu">nom</span> = nom;
        }

        <span class="dt">void</span> <span class="fu">manger</span>() {
            <span class="bu">System</span>.<span class="fu">out.printf</span>(<span class="st">&quot;</span><span class="sc">%s</span><span class="st"> attend la fourchette gauche </span><span class="sc">%s%n</span><span class="st">&quot;</span>, nom, fourchetteGauche);
            <span class="kw">synchronized</span> (fourchetteGauche) {
                <span class="bu">System</span>.<span class="fu">out.printf</span>(<span class="st">&quot;</span><span class="sc">%s</span><span class="st"> prend la fourchette gauche </span><span class="sc">%s%n</span><span class="st">&quot;</span>, nom, fourchetteGauche);
                <span class="bu">System</span>.<span class="fu">out.printf</span>(<span class="st">&quot;</span><span class="sc">%s</span><span class="st"> attend la fourchette droite </span><span class="sc">%s%n</span><span class="st">&quot;</span>, nom, fourchetteDroite);
                <span class="kw">synchronized</span> (fourchetteDroite) {
                    <span class="bu">System</span>.<span class="fu">out.printf</span>(<span class="st">&quot;</span><span class="sc">%s</span><span class="st"> prend la fourchette droite </span><span class="sc">%s%n</span><span class="st">&quot;</span>, nom, fourchetteDroite);
                    <span class="bu">System</span>.<span class="fu">out.printf</span>(<span class="st">&quot;</span><span class="sc">%s</span><span class="st"> mange</span><span class="sc">%n</span><span class="st">&quot;</span>, nom);
                    <span class="kw">try</span> {
                        <span class="bu">Thread</span>.<span class="fu">sleep</span>(((<span class="dt">long</span>) (<span class="bu">Math</span>.<span class="fu">random</span>() * <span class="dv">500</span>)));
                    } <span class="kw">catch</span> (<span class="bu">InterruptedException</span> e) {
                        e.<span class="fu">printStackTrace</span>();
                    }
                }
                <span class="bu">System</span>.<span class="fu">out.printf</span>(<span class="st">&quot;</span><span class="sc">%s</span><span class="st"> repose la fourchette droite </span><span class="sc">%s%n</span><span class="st">&quot;</span>, nom, fourchetteDroite);
            }
            <span class="bu">System</span>.<span class="fu">out.printf</span>(<span class="st">&quot;</span><span class="sc">%s</span><span class="st"> repose la fourchette gauche </span><span class="sc">%s%n</span><span class="st">&quot;</span>, nom, fourchetteGauche);
        }
    }

    <span class="kw">private</span> <span class="dt">static</span> <span class="kw">class</span> Fourchette {
        <span class="kw">private</span> <span class="dt">int</span> ordre;

        <span class="fu">Fourchette</span>(<span class="dt">int</span> ordre) {
            <span class="kw">this</span>.<span class="fu">ordre</span> = ordre;
        }
    }
}</code></pre></div>
<p>Maintenant, le programme ne s'arrête plus.</p>
<h2 id="plus-de-verrous"><span class="header-section-number">6.28</span>  Plus de verrous</h2>
<p>Le mécanisme de verrou intrisec est limité : on ne doit forcément relacher un verrou dans la même méthode qu'on l'a acquis.</p>
<p>Pour pouvoir programmer de manière plus libre on pourra utiliser <code>ReentrantLock</code></p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> X {
    <span class="kw">private</span> <span class="dt">final</span> <span class="bu">ReentrantLock</span> lock = <span class="kw">new</span> <span class="bu">ReentrantLock</span>();

    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">m</span>() {
        lock.<span class="fu">lock</span>();  <span class="co">// block until condition holds</span>
        <span class="kw">try</span> {
            <span class="co">// ...</span>
        } <span class="kw">finally</span> {
            lock.<span class="fu">unlock</span>()
        }
    }
    
    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">fermer</span>() {
        lock.<span class="fu">lock</span>();
    }
    
    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">ouvrir</span>() {
        <span class="kw">try</span> {
            <span class="co">// ...</span>
        } <span class="kw">finally</span> {
            lock.<span class="fu">unlock</span>()
        }
    }
}</code></pre></div>
<h2 id="exercice-15-3"><span class="header-section-number">6.29</span> Exercice 15</h2>
<p>Réécrire le simulateur de diné de philosophe avec des verrous réentrants.</p>
<h2 id="correction-15"><span class="header-section-number">6.30</span> Correction 15</h2>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> thread.exercice;</span>

<span class="kw">import</span><span class="im"> java.util.ArrayList;</span>
<span class="kw">import</span><span class="im"> java.util.List;</span>
<span class="kw">import</span><span class="im"> java.util.concurrent.locks.ReentrantLock;</span>

<span class="kw">public</span> <span class="kw">class</span> ReentrantDinerPhilosophe {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">InterruptedException</span> {
        <span class="bu">List</span>&lt;Fourchette&gt; fourchettes = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;&gt;();
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; <span class="dv">5</span>; i++) {
            fourchettes.<span class="fu">add</span>(<span class="kw">new</span> <span class="fu">Fourchette</span>(i));
        }

        <span class="bu">List</span>&lt;Philosophe&gt; list = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;&gt;();
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; <span class="dv">5</span>; i++) {
            list.<span class="fu">add</span>(<span class="kw">new</span> <span class="fu">Philosophe</span>(fourchettes.<span class="fu">get</span>(i), fourchettes.<span class="fu">get</span>((i + <span class="dv">1</span>) % <span class="dv">5</span>), <span class="bu">String</span>.<span class="fu">valueOf</span>(i)));
        }
        <span class="bu">List</span>&lt;<span class="bu">Thread</span>&gt; threads = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;&gt;();
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; <span class="dv">5</span>; i++) {
            <span class="dt">int</span> finalI = i;
            <span class="bu">Runnable</span> target = <span class="kw">new</span> <span class="bu">Runnable</span>() {
                <span class="at">@Override</span>
                <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span>() {
                    Philosophe philosophe = list.<span class="fu">get</span>(finalI);
                    <span class="kw">for</span> (<span class="dt">int</span> j = <span class="dv">0</span>; j &lt; <span class="dv">1000</span>; j++) {
                        philosophe.<span class="fu">manger</span>();
                    }
                }
            };
            threads.<span class="fu">add</span>(<span class="kw">new</span> <span class="bu">Thread</span>(target));
        }

        <span class="kw">for</span> (<span class="bu">Thread</span> thread : threads) {
            thread.<span class="fu">start</span>();
        }
        <span class="kw">for</span> (<span class="bu">Thread</span> thread : threads) {
            thread.<span class="fu">join</span>();
        }
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Fin du dîner&quot;</span>);
    }

    <span class="kw">private</span> <span class="dt">static</span> <span class="kw">class</span> Philosophe {
        <span class="kw">private</span> <span class="dt">final</span> Fourchette fourchetteGauche;
        <span class="kw">private</span> <span class="dt">final</span> Fourchette fourchetteDroite;
        <span class="kw">private</span> <span class="dt">final</span> <span class="bu">String</span> nom;

        <span class="fu">Philosophe</span>(Fourchette fourchetteGauche, Fourchette fourchetteDroite, <span class="bu">String</span> nom) {
            <span class="kw">if</span> (fourchetteGauche.<span class="fu">ordre</span> &gt; fourchetteDroite.<span class="fu">ordre</span>) {
                <span class="kw">this</span>.<span class="fu">fourchetteGauche</span> = fourchetteDroite;
                <span class="kw">this</span>.<span class="fu">fourchetteDroite</span> = fourchetteGauche;
            } <span class="kw">else</span> {
                <span class="kw">this</span>.<span class="fu">fourchetteGauche</span> = fourchetteGauche;
                <span class="kw">this</span>.<span class="fu">fourchetteDroite</span> = fourchetteDroite;
            }
            assert <span class="kw">this</span>.<span class="fu">fourchetteGauche</span>.<span class="fu">ordre</span> &lt; <span class="kw">this</span>.<span class="fu">fourchetteDroite</span>.<span class="fu">ordre</span>;
            <span class="kw">this</span>.<span class="fu">nom</span> = nom;
        }

        <span class="dt">void</span> <span class="fu">manger</span>() {
            <span class="bu">System</span>.<span class="fu">out.printf</span>(<span class="st">&quot;</span><span class="sc">%s</span><span class="st"> attend la fourchette gauche </span><span class="sc">%s%n</span><span class="st">&quot;</span>, nom, fourchetteGauche);
            fourchetteGauche.<span class="fu">prendre</span>();
            <span class="kw">try</span> {
                <span class="bu">System</span>.<span class="fu">out.printf</span>(<span class="st">&quot;</span><span class="sc">%s</span><span class="st"> prend la fourchette gauche </span><span class="sc">%s%n</span><span class="st">&quot;</span>, nom, fourchetteGauche);
                <span class="bu">System</span>.<span class="fu">out.printf</span>(<span class="st">&quot;</span><span class="sc">%s</span><span class="st"> attend la fourchette droite </span><span class="sc">%s%n</span><span class="st">&quot;</span>, nom, fourchetteDroite);
                fourchetteDroite.<span class="fu">prendre</span>();
                <span class="kw">try</span> {
                    <span class="bu">System</span>.<span class="fu">out.printf</span>(<span class="st">&quot;</span><span class="sc">%s</span><span class="st"> prend la fourchette droite </span><span class="sc">%s%n</span><span class="st">&quot;</span>, nom, fourchetteDroite);
                    <span class="bu">System</span>.<span class="fu">out.printf</span>(<span class="st">&quot;</span><span class="sc">%s</span><span class="st"> mange</span><span class="sc">%n</span><span class="st">&quot;</span>, nom);
                    <span class="kw">try</span> {
                        <span class="bu">Thread</span>.<span class="fu">sleep</span>(((<span class="dt">long</span>) (<span class="bu">Math</span>.<span class="fu">random</span>() * <span class="dv">500</span>)));
                    } <span class="kw">catch</span> (<span class="bu">InterruptedException</span> e) {
                        e.<span class="fu">printStackTrace</span>();
                    }
                } <span class="kw">finally</span> {
                    fourchetteDroite.<span class="fu">relacher</span>();
                    <span class="bu">System</span>.<span class="fu">out.printf</span>(<span class="st">&quot;</span><span class="sc">%s</span><span class="st"> repose la fourchette droite </span><span class="sc">%s%n</span><span class="st">&quot;</span>, nom, fourchetteDroite);
                }
            } <span class="kw">finally</span> {
                fourchetteGauche.<span class="fu">relacher</span>();
                <span class="bu">System</span>.<span class="fu">out.printf</span>(<span class="st">&quot;</span><span class="sc">%s</span><span class="st"> repose la fourchette gauche </span><span class="sc">%s%n</span><span class="st">&quot;</span>, nom, fourchetteGauche);
            }
        }
    }

    <span class="kw">private</span> <span class="dt">static</span> <span class="kw">class</span> Fourchette {
        <span class="kw">private</span> <span class="bu">ReentrantLock</span> lock = <span class="kw">new</span> <span class="bu">ReentrantLock</span>();
        <span class="kw">private</span> <span class="dt">int</span> ordre;

        <span class="fu">Fourchette</span>(<span class="dt">int</span> ordre) {
            <span class="kw">this</span>.<span class="fu">ordre</span> = ordre;
        }

        <span class="dt">void</span> <span class="fu">prendre</span>() {
            lock.<span class="fu">lock</span>();
        }

        <span class="dt">void</span> <span class="fu">relacher</span>() {
            lock.<span class="fu">unlock</span>();
        }

        <span class="at">@Override</span>
        <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span>() {
            <span class="kw">return</span> <span class="bu">String</span>.<span class="fu">valueOf</span>(ordre);
        }
    }
}</code></pre></div>
<h2 id="concurrence-et-parallèlisme"><span class="header-section-number">6.31</span> Concurrence et parallèlisme</h2>
<p>Jusqu'ici on a présenté la programmation multithread comme une technique d'optimisation : on parallélise pour gagner du temps.</p>
<p>La concurrence est plus que cela, c'est un paradigme de programmation dans lequel on peut modéliser des problèmes de manière élégante (c'est à dire simple et efficace).</p>
<h1 id="programation-modulaire"><span class="header-section-number">7</span> Programation modulaire</h1>
<p>On peut arguer que le niveau d'abstraction le plus simple est la fonction : en Java la méthode. Le niveau d'abstraction supérieur est la classe. Une classe pouvant être vue comme une collection de méthodes.</p>
<p>On peut également regrouper les classes entre elles dans des packages. Mais un package est une structure est assez pauvre. En effet, elle crée un espace de nommage pour les types (classes, interfaces, enumérations, annotations...) et un espace de contrôle.</p>
<h2 id="espace-de-nommage"><span class="header-section-number">7.1</span> Espace de nommage</h2>
<p>Deux classes qui ont le même nom pourront être distinguées grace à leur nom qualifié (nom du package + nom de la classe). Par exemple :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">com.<span class="fu">example</span>.<span class="fu">a</span>.<span class="fu">Foo</span> x;
com.<span class="fu">example</span>.<span class="fu">b</span>.<span class="fu">Foo</span> y;</code></pre></div>
<p>Dans ce cas x et y sont de classes différentes. Car leur nom qualifié est unique.</p>
<h2 id="espace-de-contrôle"><span class="header-section-number">7.2</span> Espace de contrôle</h2>
<p>On pourra encapsuler des classes dans un package les rendant package-private.</p>
<h2 id="archive-java-jar"><span class="header-section-number">7.3</span> Archive Java (JAR)</h2>
<p>Quand on démmare une machine virtuelle Java, on déclare un classpath dans lequel les .class sont physiquement situés.</p>
<p>Par exemple :</p>
<p>java -classpath lib/aaa/classes/ com.example.a.Foo</p>
<p>Si lib/aaa/classes/com/example/a/Foo.class existe, la classe Foo sera chargée à partir de ce fichier .class.</p>
<p>Le classpath comme le PATH est une liste de chemins. On peut ainsi définir plusieurs dossiers où chercher les classes compilées :</p>
<p>java -classpath lib/aaa/classes/:lib/bbb/classes/ com.example.a.Foo</p>
<p>Si une classe de même nom qualifié existe à plusieurs endroits dans le classpath. Que se passe t'il ?</p>
<pre><code>$ ls -R lib
aaa/classes/com/example/a/Foo.class
bbb/classes/com/example/a/Foo.class</code></pre>
<p>Plusieurs choses pourraient se passer :</p>
<ul>
<li>la JVM pourrait s'arrêter en erreur ;</li>
<li>elle pourrait prendre la première classe trouvée dans le classpath ;</li>
<li>elle pourrait prendre la dernière classe trouvée ;</li>
<li>elle pourrait prendre une classe aléatoire.</li>
</ul>
<p>Il se trouve que la spécification indique qu'elle prend la première classe trouvée.</p>
<p>Donc on peut avoir deux définitions différente pour le même nom de classe</p>
<p>Examinons le cas où deux classes du même package sont stockées physiquement dans 2 dossiers séparés :</p>
<pre><code>lib/aaa/classes/com/example/a/Foo.class
lib/aaa/classes/com/example/a/Bar.class</code></pre>
<p>Cette considération physique est totalement transparente pour le programme Java. Il considérera que Foo et Bar appartiennent bien au même package.</p>
<p>Un package est donc une abstraction logique et le classpath (collection de chemins) une abstraction physique.</p>
<p>En pratique les dossier qui regroupent les fichiers .class sont nombreux et sont téléchargés (réseau) et déplacés (système de fichiers). On regroupe donc tous ces fichiers dans une archive Java nommé JAR.</p>
<p>On nomme par convention : <code>aaa.jar</code>.</p>
<h2 id="chargeur-de-classe"><span class="header-section-number">7.4</span> Chargeur de classe</h2>
<p>On pourra pallier au problème des classes dupliquées en utilisant un class loader.</p>
<p>Chaque classe loader choisit comment charger une classe.</p>
<p>On pourra donc implémenter un mécanisme de protection d'accès entre unité arbitraire (module).</p>
<h2 id="exercice-45"><span class="header-section-number">7.5</span> Exercice</h2>
<p>Développer un CopyPasta qui copie un fichier texte dans un autre fichier.</p>
<h2 id="correction-7"><span class="header-section-number">7.6</span> Correction</h2>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> com.mathieupauly.copypasta;</span>

<span class="kw">import</span><span class="im"> java.io.BufferedWriter;</span>
<span class="kw">import</span><span class="im"> java.io.IOException;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Files;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Path;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Paths;</span>
<span class="kw">import</span><span class="im"> java.util.List;</span>

<span class="kw">public</span> <span class="kw">class</span> CopyPasta {

    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">IOException</span> {
        <span class="kw">if</span> (args.<span class="fu">length</span> != <span class="dv">2</span>) {
            <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Arguments requis : &quot;</span> +
                    <span class="st">&quot;&lt;entrée&gt; &lt;sortie&gt;&quot;</span>);
            <span class="bu">System</span>.<span class="fu">exit</span>(<span class="dv">1</span>);
        }
        Path in = Paths.<span class="fu">get</span>(args[<span class="dv">0</span>]);
        <span class="bu">List</span>&lt;<span class="bu">String</span>&gt; lines = Files.<span class="fu">readAllLines</span>(in);
        Path out = Paths.<span class="fu">get</span>(args[<span class="dv">1</span>]);
        <span class="bu">BufferedWriter</span> bufferedWriter = Files.<span class="fu">newBufferedWriter</span>(out);
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Copie de &quot;</span> + in + <span class="st">&quot; vers &quot;</span> + out);
        <span class="kw">for</span> (<span class="bu">String</span> line : lines) {
            bufferedWriter.<span class="fu">write</span>(line);
            bufferedWriter.<span class="fu">newLine</span>();
        }
        bufferedWriter.<span class="fu">close</span>();
    }

}</code></pre></div>
<h2 id="exercice-46"><span class="header-section-number">7.7</span> Exercice</h2>
<p>Modifier le programme de sorte à proposer à l'utilisateur une sorte de &quot;grep&quot; (filtrage de ligne) à la place de &quot;cp&quot; (copie ligne à ligne).</p>
<h2 id="correction-11"><span class="header-section-number">7.8</span> Correction</h2>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> com.mathieupauly.copypasta;</span>

<span class="kw">import</span><span class="im"> java.io.BufferedReader;</span>
<span class="kw">import</span><span class="im"> java.io.BufferedWriter;</span>
<span class="kw">import</span><span class="im"> java.io.IOException;</span>
<span class="kw">import</span><span class="im"> java.io.InputStreamReader;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Files;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Path;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Paths;</span>
<span class="kw">import</span><span class="im"> java.util.List;</span>

<span class="kw">public</span> <span class="kw">class</span> CopyPasta {

    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">IOException</span> {
        <span class="kw">if</span> (args.<span class="fu">length</span> != <span class="dv">2</span>) {
            <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Arguments requis : &quot;</span> +
                    <span class="st">&quot;&lt;entrée&gt; &lt;sortie&gt;&quot;</span>);
            <span class="bu">System</span>.<span class="fu">exit</span>(<span class="dv">1</span>);
        }
        Path in = Paths.<span class="fu">get</span>(args[<span class="dv">0</span>]);
        <span class="bu">List</span>&lt;<span class="bu">String</span>&gt; lines = Files.<span class="fu">readAllLines</span>(in);
        Path out = Paths.<span class="fu">get</span>(args[<span class="dv">1</span>]);
        <span class="bu">BufferedWriter</span> bufferedWriter = Files.<span class="fu">newBufferedWriter</span>(out);
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Copie de &quot;</span> + in + <span class="st">&quot; vers &quot;</span> + out);

        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Liste des plugins :&quot;</span>);
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;[0] cp&quot;</span>);
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;[1] grep&quot;</span>);
        <span class="bu">BufferedReader</span> stdin = <span class="kw">new</span> <span class="bu">BufferedReader</span>(<span class="kw">new</span> <span class="bu">InputStreamReader</span>(<span class="bu">System</span>.<span class="fu">in</span>));
        <span class="bu">String</span> selectedPluginIndex = stdin.<span class="fu">readLine</span>();

        <span class="kw">switch</span> (selectedPluginIndex) {
            <span class="kw">case</span> <span class="st">&quot;0&quot;</span>:
                <span class="kw">for</span> (<span class="bu">String</span> line : lines) {
                    bufferedWriter.<span class="fu">write</span>(line);
                    bufferedWriter.<span class="fu">newLine</span>();
                }
                <span class="kw">break</span>;
            <span class="kw">case</span> <span class="st">&quot;1&quot;</span>:
                <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Motif ?&quot;</span>);
                <span class="bu">String</span> motif = stdin.<span class="fu">readLine</span>();

                <span class="kw">for</span> (<span class="bu">String</span> line : lines) {
                    <span class="kw">if</span> (line.<span class="fu">matches</span>(motif)) {
                        bufferedWriter.<span class="fu">write</span>(line);
                        bufferedWriter.<span class="fu">newLine</span>();
                    }
                }
                <span class="kw">break</span>;
        }

        bufferedWriter.<span class="fu">close</span>();
    }

}</code></pre></div>
<h2 id="exercice-47"><span class="header-section-number">7.9</span> Exercice</h2>
<p>Réécrire le programme pour rendre similaire le traitement de &quot;cp&quot; et &quot;grep&quot;.</p>
<h2 id="correction-16"><span class="header-section-number">7.10</span> Correction</h2>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> com.mathieupauly.copypasta;</span>

<span class="kw">import</span><span class="im"> java.io.BufferedReader;</span>
<span class="kw">import</span><span class="im"> java.io.BufferedWriter;</span>
<span class="kw">import</span><span class="im"> java.io.IOException;</span>
<span class="kw">import</span><span class="im"> java.io.InputStreamReader;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Files;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Path;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Paths;</span>
<span class="kw">import</span><span class="im"> java.util.List;</span>

<span class="kw">public</span> <span class="kw">class</span> CopyPasta {

    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">IOException</span> {
        <span class="kw">if</span> (args.<span class="fu">length</span> != <span class="dv">2</span>) {
            <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Arguments requis : &quot;</span> +
                    <span class="st">&quot;&lt;entrée&gt; &lt;sortie&gt;&quot;</span>);
            <span class="bu">System</span>.<span class="fu">exit</span>(<span class="dv">1</span>);
        }
        Path in = Paths.<span class="fu">get</span>(args[<span class="dv">0</span>]);
        <span class="bu">List</span>&lt;<span class="bu">String</span>&gt; lines = Files.<span class="fu">readAllLines</span>(in);
        Path out = Paths.<span class="fu">get</span>(args[<span class="dv">1</span>]);
        <span class="bu">BufferedWriter</span> bufferedWriter = Files.<span class="fu">newBufferedWriter</span>(out);
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Copie de &quot;</span> + in + <span class="st">&quot; vers &quot;</span> + out);

        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Liste des plugins :&quot;</span>);
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;[0] cp&quot;</span>);
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;[1] grep&quot;</span>);
        <span class="bu">BufferedReader</span> stdin = <span class="kw">new</span> <span class="bu">BufferedReader</span>(<span class="kw">new</span> <span class="bu">InputStreamReader</span>(<span class="bu">System</span>.<span class="fu">in</span>));
        <span class="bu">String</span> selectedPluginIndex = stdin.<span class="fu">readLine</span>();

        <span class="kw">switch</span> (selectedPluginIndex) {
            <span class="kw">case</span> <span class="st">&quot;0&quot;</span>:
                <span class="bu">String</span>[] motif = <span class="fu">cpReadArguments</span>(stdin);

                <span class="kw">for</span> (<span class="bu">String</span> line : lines) {
                    <span class="fu">cpProcessInput</span>(bufferedWriter, line, motif);
                }
                <span class="kw">break</span>;
            <span class="kw">case</span> <span class="st">&quot;1&quot;</span>:
                <span class="bu">String</span>[] motifs = <span class="fu">grepReadArguments</span>(stdin);

                <span class="kw">for</span> (<span class="bu">String</span> line : lines) {
                    <span class="fu">grepProcessInput</span>(bufferedWriter, line, motifs);
                }
                <span class="kw">break</span>;
        }

        bufferedWriter.<span class="fu">close</span>();
    }

    <span class="kw">private</span> <span class="dt">static</span> <span class="bu">String</span>[] <span class="fu">cpReadArguments</span>(<span class="bu">BufferedReader</span> stdin) <span class="kw">throws</span> <span class="bu">IOException</span> {
        <span class="kw">return</span> <span class="kw">new</span> <span class="bu">String</span>[]{};
    }

    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">cpProcessInput</span>(<span class="bu">BufferedWriter</span> bufferedWriter, <span class="bu">String</span> line, <span class="bu">String</span>[] parameters) <span class="kw">throws</span> <span class="bu">IOException</span> {
        bufferedWriter.<span class="fu">write</span>(line);
        bufferedWriter.<span class="fu">newLine</span>();
    }

    <span class="kw">private</span> <span class="dt">static</span> <span class="bu">String</span>[] <span class="fu">grepReadArguments</span>(<span class="bu">BufferedReader</span> stdin) <span class="kw">throws</span> <span class="bu">IOException</span> {
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Motif ?&quot;</span>);
        <span class="kw">return</span> <span class="kw">new</span> <span class="bu">String</span>[]{stdin.<span class="fu">readLine</span>()};
    }

    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">grepProcessInput</span>(<span class="bu">BufferedWriter</span> bufferedWriter, <span class="bu">String</span> line, <span class="bu">String</span>[] parameters) <span class="kw">throws</span> <span class="bu">IOException</span> {
        <span class="bu">String</span> motif = parameters[<span class="dv">0</span>];
        <span class="kw">if</span> (line.<span class="fu">matches</span>(motif)) {
            bufferedWriter.<span class="fu">write</span>(line);
            bufferedWriter.<span class="fu">newLine</span>();
        }
    }

}</code></pre></div>
<h2 id="exercice-48"><span class="header-section-number">7.11</span> Exercice</h2>
<p>Remplace le switch par du polymorphisme.</p>
<p>Bouger les méthodes cpReadArguments et cpProcessInput (resp. grepReadArguments et grepProcessInput) dans une classe séparer CpPlugin (resp. GrepPlugin).</p>
<p>En extraire une interface commune (Plugin contenant readArguments et processInput).</p>
<h2 id="correction-17"><span class="header-section-number">7.12</span> Correction</h2>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> com.mathieupauly.copypasta;</span>

<span class="kw">import</span><span class="im"> java.io.BufferedReader;</span>
<span class="kw">import</span><span class="im"> java.io.BufferedWriter;</span>
<span class="kw">import</span><span class="im"> java.io.IOException;</span>
<span class="kw">import</span><span class="im"> java.io.InputStreamReader;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Files;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Path;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Paths;</span>
<span class="kw">import</span><span class="im"> java.util.List;</span>

<span class="kw">public</span> <span class="kw">class</span> CopyPasta {

    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">IOException</span> {
        <span class="kw">if</span> (args.<span class="fu">length</span> != <span class="dv">2</span>) {
            <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Arguments requis : &quot;</span> +
                    <span class="st">&quot;&lt;entrée&gt; &lt;sortie&gt;&quot;</span>);
            <span class="bu">System</span>.<span class="fu">exit</span>(<span class="dv">1</span>);
        }
        Path in = Paths.<span class="fu">get</span>(args[<span class="dv">0</span>]);
        <span class="bu">List</span>&lt;<span class="bu">String</span>&gt; lines = Files.<span class="fu">readAllLines</span>(in);
        Path out = Paths.<span class="fu">get</span>(args[<span class="dv">1</span>]);
        <span class="bu">BufferedWriter</span> bufferedWriter = Files.<span class="fu">newBufferedWriter</span>(out);
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Copie de &quot;</span> + in + <span class="st">&quot; vers &quot;</span> + out);

        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Liste des plugins :&quot;</span>);
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;[0] cp&quot;</span>);
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;[1] grep&quot;</span>);
        <span class="bu">BufferedReader</span> stdin = <span class="kw">new</span> <span class="bu">BufferedReader</span>(<span class="kw">new</span> <span class="bu">InputStreamReader</span>(<span class="bu">System</span>.<span class="fu">in</span>));
        <span class="bu">String</span> selectedPluginIndex = stdin.<span class="fu">readLine</span>();

        Plugin plugin = <span class="kw">null</span>;
        <span class="kw">switch</span> (selectedPluginIndex) {
            <span class="kw">case</span> <span class="st">&quot;0&quot;</span>:
                plugin = <span class="kw">new</span> <span class="fu">CpPlugin</span>();
                <span class="kw">break</span>;
            <span class="kw">case</span> <span class="st">&quot;1&quot;</span>:
                plugin = <span class="kw">new</span> <span class="fu">GrepPlugin</span>();
                <span class="kw">break</span>;
        }
        <span class="kw">if</span> (plugin != <span class="kw">null</span>) {
            <span class="bu">String</span>[] motif = plugin.<span class="fu">readArguments</span>(stdin);

            <span class="kw">for</span> (<span class="bu">String</span> line : lines) {
                plugin.<span class="fu">processInput</span>(bufferedWriter, line, motif);
            }
        }

        bufferedWriter.<span class="fu">close</span>();
    }

}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> com.mathieupauly.copypasta;</span>

<span class="kw">import</span><span class="im"> java.io.BufferedReader;</span>
<span class="kw">import</span><span class="im"> java.io.BufferedWriter;</span>
<span class="kw">import</span><span class="im"> java.io.IOException;</span>

<span class="kw">public</span> <span class="kw">interface</span> Plugin {
    <span class="bu">String</span>[] <span class="fu">readArguments</span>(<span class="bu">BufferedReader</span> stdin) <span class="kw">throws</span> <span class="bu">IOException</span>;

    <span class="dt">void</span> <span class="fu">processInput</span>(<span class="bu">BufferedWriter</span> bufferedWriter, <span class="bu">String</span> line, <span class="bu">String</span>[] parameters) <span class="kw">throws</span> <span class="bu">IOException</span>;
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> com.mathieupauly.copypasta;</span>

<span class="kw">import</span><span class="im"> java.io.BufferedReader;</span>
<span class="kw">import</span><span class="im"> java.io.BufferedWriter;</span>
<span class="kw">import</span><span class="im"> java.io.IOException;</span>

<span class="kw">public</span> <span class="kw">class</span> CpPlugin <span class="kw">implements</span> Plugin {
    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="bu">String</span>[] <span class="fu">readArguments</span>(<span class="bu">BufferedReader</span> stdin) <span class="kw">throws</span> <span class="bu">IOException</span> {
        <span class="kw">return</span> <span class="kw">new</span> <span class="bu">String</span>[]{};
    }

    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">processInput</span>(<span class="bu">BufferedWriter</span> bufferedWriter, <span class="bu">String</span> line, <span class="bu">String</span>[] parameters) <span class="kw">throws</span> <span class="bu">IOException</span> {
        bufferedWriter.<span class="fu">write</span>(line);
        bufferedWriter.<span class="fu">newLine</span>();
    }
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> com.mathieupauly.copypasta;</span>

<span class="kw">import</span><span class="im"> java.io.BufferedReader;</span>
<span class="kw">import</span><span class="im"> java.io.BufferedWriter;</span>
<span class="kw">import</span><span class="im"> java.io.IOException;</span>

<span class="kw">public</span> <span class="kw">class</span> GrepPlugin <span class="kw">implements</span> Plugin {
    <span class="kw">public</span> <span class="bu">String</span>[] <span class="fu">readArguments</span>(<span class="bu">BufferedReader</span> stdin) <span class="kw">throws</span> <span class="bu">IOException</span> {
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Motif ?&quot;</span>);
        <span class="kw">return</span> <span class="kw">new</span> <span class="bu">String</span>[]{stdin.<span class="fu">readLine</span>()};
    }

    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">processInput</span>(<span class="bu">BufferedWriter</span> bufferedWriter, <span class="bu">String</span> line, <span class="bu">String</span>[] parameters) <span class="kw">throws</span> <span class="bu">IOException</span> {
        <span class="bu">String</span> motif = parameters[<span class="dv">0</span>];
        <span class="kw">if</span> (line.<span class="fu">matches</span>(motif)) {
            bufferedWriter.<span class="fu">write</span>(line);
            bufferedWriter.<span class="fu">newLine</span>();
        }
    }
}</code></pre></div>
<h2 id="exercice-49"><span class="header-section-number">7.13</span> Exercice</h2>
<p>Charger les classes <code>CpPlugin</code> et <code>GrepPlugin</code> de manière dynamique. Utiliser <code>Class.forName(String className)</code>.</p>
<h2 id="correction-18"><span class="header-section-number">7.14</span> Correction</h2>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> com.mathieupauly.copypasta2;</span>

<span class="kw">import</span><span class="im"> java.io.BufferedReader;</span>
<span class="kw">import</span><span class="im"> java.io.BufferedWriter;</span>
<span class="kw">import</span><span class="im"> java.io.IOException;</span>
<span class="kw">import</span><span class="im"> java.io.InputStreamReader;</span>
<span class="kw">import</span><span class="im"> java.lang.reflect.InvocationTargetException;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Files;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Path;</span>
<span class="kw">import</span><span class="im"> java.nio.file.Paths;</span>
<span class="kw">import</span><span class="im"> java.util.ArrayList;</span>
<span class="kw">import</span><span class="im"> java.util.List;</span>

<span class="kw">public</span> <span class="kw">class</span> CopyPasta {

    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) <span class="kw">throws</span> <span class="bu">IOException</span>, <span class="bu">ClassNotFoundException</span>, <span class="bu">NoSuchMethodException</span>, <span class="bu">IllegalAccessException</span>, <span class="bu">InvocationTargetException</span>, <span class="bu">InstantiationException</span> {
        <span class="kw">if</span> (args.<span class="fu">length</span> != <span class="dv">2</span>) {
            <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Arguments requis : &quot;</span> +
                    <span class="st">&quot;&lt;entrée&gt; &lt;sortie&gt;&quot;</span>);
            <span class="bu">System</span>.<span class="fu">exit</span>(<span class="dv">1</span>);
        }
        <span class="bu">List</span>&lt;Plugin&gt; plugins = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;&gt;();
        plugins.<span class="fu">add</span>((Plugin) <span class="bu">Class</span>.<span class="fu">forName</span>(<span class="st">&quot;com.mathieupauly.copypasta2.CpPlugin&quot;</span>).<span class="fu">getDeclaredConstructor</span>().<span class="fu">newInstance</span>());
        plugins.<span class="fu">add</span>((Plugin) <span class="bu">Class</span>.<span class="fu">forName</span>(<span class="st">&quot;com.mathieupauly.copypasta2.GrepPlugin&quot;</span>).<span class="fu">getDeclaredConstructor</span>().<span class="fu">newInstance</span>());
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; plugins.<span class="fu">size</span>(); i++) {
            Plugin plugin = plugins.<span class="fu">get</span>(i);
            <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;[&quot;</span> + i + <span class="st">&quot;] &quot;</span> + plugin.<span class="fu">getName</span>());
        }
        <span class="bu">BufferedReader</span> bufferedReader = <span class="kw">new</span> <span class="bu">BufferedReader</span>(<span class="kw">new</span> <span class="bu">InputStreamReader</span>(<span class="bu">System</span>.<span class="fu">in</span>));
        <span class="bu">String</span> input = bufferedReader.<span class="fu">readLine</span>();
        <span class="dt">int</span> selectedPluginIndex = <span class="bu">Integer</span>.<span class="fu">parseInt</span>(input);
        Plugin selectedPlugin = plugins.<span class="fu">get</span>(selectedPluginIndex);
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Plugin choisi : &quot;</span> + selectedPlugin.<span class="fu">getName</span>());
        selectedPlugin.<span class="fu">readArguments</span>();
        Path in = Paths.<span class="fu">get</span>(args[<span class="dv">0</span>]);
        <span class="bu">List</span>&lt;<span class="bu">String</span>&gt; lines = Files.<span class="fu">readAllLines</span>(in);
        Path out = Paths.<span class="fu">get</span>(args[<span class="dv">1</span>]);
        <span class="bu">BufferedWriter</span> bufferedWriter = Files.<span class="fu">newBufferedWriter</span>(out);
        selectedPlugin.<span class="fu">setWriter</span>(bufferedWriter);
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Traitement de &quot;</span> + in + <span class="st">&quot; vers &quot;</span> + out);
        <span class="kw">for</span> (<span class="bu">String</span> line : lines) {
            selectedPlugin.<span class="fu">processInput</span>(line);
        }
        bufferedWriter.<span class="fu">close</span>();
    }

}</code></pre></div>
<h2 id="exercice-50"><span class="header-section-number">7.15</span> Exercice</h2>
<p>Spécifier le nom de la classe dans une property en ligne de commande.</p>
<h2 id="correction-19"><span class="header-section-number">7.16</span>  Correction</h2>
<p>Dans le programme Java on utilisera <code>System.getProperty()</code>.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">String</span> grepPluginClassName = <span class="bu">System</span>.<span class="fu">getProperty</span>(<span class="st">&quot;grepPluginClassName&quot;</span>);
plugins.<span class="fu">add</span>((Plugin) <span class="bu">Class</span>.<span class="fu">forName</span>(grepPluginClassName).<span class="fu">getDeclaredConstructor</span>().<span class="fu">newInstance</span>());</code></pre></div>
<p>Et en lançant le programme on injectera les properties comme la JVM nous l'impose :</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">java</span> -DcpPluginClassName=com.mathieupauly.copypasta2.CpPlugin -DgrepPluginClassName=com.mathieupauly.copypasta2.GrepPlugin com.mathieupauly.copypasta2.CopyPasta a.txt b.txt</code></pre></div>
<h2 id="exercice-51"><span class="header-section-number">7.17</span> Exercice</h2>
<p>Sortir la classe compilée du classpath</p>
<h2 id="correction-20"><span class="header-section-number">7.18</span> Correction</h2>
<p>Quand on compile avec Maven, par défaut les classes sont générées dans le dossier target/classes. Pour indexer les classes, chacune est stockée dans un répertoire lié à son package.</p>
<pre><code>+ target
    + classes
        + com
            + mathieupauly
                + copypasta2
                    - CopyPasta.class
                    - CpPlugin.class
                    - GrepPlugin.class
                    - Plugin.class</code></pre>
<p>Si on ne spécifie pas de classpath, il vaut le répertoire courant (CWD).</p>
<p>On peut exclure GrepPlugin du classpath en déplacant le fichier dans un autre répertoire. Cette opération est purement pédagogique. Le but est de comprendre ce qu'est le classpath. On ne cherche jamais dans un travail de développement d'application à procéder de la sorte.</p>
<p>Je déplace GrepPlugin.class de sorte d'avoir les deux arborescence suivantes :</p>
<pre><code>+ target
    + classes
        + com
            + mathieupauly
                + copypasta2
                    - CopyPasta.class
                    - CpPlugin.class
                    - GrepPlugin.class
                    - Plugin.class
+ target2
    + classes
        + com
            + mathieupauly
                + copypasta2
                    - GrepPlugin.class</code></pre>
<p>En relançant le programme (à partir de target/classes), j'obtiens maintenant une exception :</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">java</span> -DcpPluginClassName=com.mathieupauly.copypasta2.CpPlugin -DgrepPluginClassName=com.mathieupauly.copypasta2.GrepPlugin com.mathieupauly.copypasta2.CopyPasta a.txt b.txt
<span class="ex">Exception</span> in thread <span class="st">&quot;main&quot;</span> java.lang.ClassNotFoundException: com.mathieupauly.copypasta2.GrepPlugin
        <span class="ex">at</span> java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(Unknown Source)
        <span class="ex">at</span> java.base/jdk.internal.loader.ClassLoaders<span class="va">$AppClassLoader</span>.loadClass(Unknown Source)
        <span class="ex">at</span> java.base/java.lang.ClassLoader.loadClass(Unknown Source)
        <span class="ex">at</span> java.base/java.lang.Class.forName0(Native Method)
        <span class="ex">at</span> java.base/java.lang.Class.forName(Unknown Source)
        <span class="ex">at</span> com.mathieupauly.copypasta2.CopyPasta.main(CopyPasta.java:26)</code></pre></div>
<p>Quand on se place cette fois non pas dans le répertoire target/classes mais plus classiquement dans le répertoire du projet (qui contient target) on doit spécifier l'option -classpath target/classes/.</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash">$ <span class="ex">java</span> -classpath target/classes/ -DcpPluginClassName=com.mathieupauly.copypasta2.CpPlugin -DgrepPluginClassName=com.mathieupauly.copypasta2.GrepPlugin com.mathieupauly.copypasta2.CopyPasta a.txt b.txt</code></pre></div>
<p>On obtient la même erreur qu'avant.</p>
<h2 id="exercice-52"><span class="header-section-number">7.19</span> Exercice</h2>
<p>Réinclure explicitement la classe avec l'option -classpath.</p>
<h2 id="correction-21"><span class="header-section-number">7.20</span> Correction</h2>
<p>Premier essai :</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash">$ <span class="ex">java</span> -classpath target/classes/ -classpath target2/classes/ -DcpPluginClassName=com.mathieupauly.copypasta2.CpPlugin -DgrepPluginClassName=com.mathieupauly.copypasta2.GrepPlugin com.
<span class="ex">mathieupauly.copypasta2.CopyPasta</span> a.txt b.txt
<span class="ex">Erreur</span> : impossible de trouver ou de charger la classe principale com.mathieupauly.copypasta2.CopyPasta
<span class="ex">Caus</span>é par : java.lang.ClassNotFoundException: com.mathieupauly.copypasta2.CopyPasta</code></pre></div>
<p>J'ai essayé de spécifier deux classpath. Apparement seul le dernier est pris en compte puisque la CopyPasta.class n'est pas trouvé et qu'elle appartient à target/classes.</p>
<p>Il faut spécifier le classpath sous forme d'une liste de chemins séparé par des <code>;</code> sous Windows et par des <code>:</code> sous Linux.</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash">$ <span class="ex">java</span> -classpath <span class="st">&#39;target/classes/;target2/classes/&#39;</span> -DcpPluginClassName=com.mathieupauly.copypasta2.CpPlugin -DgrepPluginClassName=com.mathieupauly.copypasta2.GrepPlugin com.mathieupa
<span class="ex">uly.copypasta2.CopyPasta</span> a.txt b.txt
[<span class="ex">0</span>] cp
[<span class="ex">1</span>] grep
<span class="ex">1</span>
<span class="ex">Plugin</span> choisi : grep
<span class="ex">Motif</span> ?
<span class="ex">b</span>épo
<span class="ex">Traitement</span> de a.txt vers b.txt</code></pre></div>
<p>Créer un JAR pour le plugin GrepPlugin.</p>
<p>Créer un nouveau WcPlugin (compte les lignes)</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> com.example.foo;</span>

<span class="kw">class</span> X {} <span class="co">// privé</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">package</span><span class="im"> com.example.bar;</span>

<span class="kw">class</span> Y {
    com.<span class="fu">example</span>.<span class="fu">foo</span>.<span class="fu">X</span> x; <span class="co">// Error:(4, 21) java: cannot find symbol</span>
                         <span class="co">// symbol:   class X</span>
                         <span class="co">// location: package com.example</span>
}</code></pre></div>
<h1 id="annexes-et-précis"><span class="header-section-number">8</span> Annexes et précis</h1>
<h2 id="florilège-à-ne-pas-écrire"><span class="header-section-number">8.1</span> Florilège à ne pas écrire</h2>
<h3 id="pas-de-méthode-statique-abstraite-dans-une-interface"><span class="header-section-number">8.1.1</span> Pas de méthode statique abstraite dans une interface</h3>
<pre><code>interface Foo {
    static void bar(); // Error: missing method body, or declare abstract
}

class BarFoo implements Foo {
    @Override // oops
    public static Object get() {
        return null;
    }
}</code></pre>
<p>Les interfaces sont destinées à contenir des méthodes abstraites et publiques (bien qu'on omette les modificateurs <code>public</code> et <code>abstract</code>).</p>
<p>En effet :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">interface</span> Foo {
    <span class="dt">void</span> <span class="fu">bar</span>();
}</code></pre></div>
<p>Est équivalent à :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">interface</span> Foo {
    <span class="kw">public</span> <span class="kw">abstract</span> <span class="dt">void</span> <span class="fu">bar</span>();
}</code></pre></div>
<p>On ne peut pas hériter d'une méthode statique.</p>
<p>Bien qu'il soit possible de placer un main dans une interface. Ce n'est pas recommandé :</p>
<pre><code>public interface MainInInterface {
    static void main(String[] args) { // bizzarerie
        System.out.println(&quot;hello&quot;);
    }
}</code></pre>
<h3 id="pas-de-function"><span class="header-section-number">8.1.2</span> Pas de function</h3>
<p>De plus, la syntaxe suivante n'est pas du Java. Elle ressemble à ce qu'on pourrait avoir en JavaScript.</p>
<pre><code>interface Foo {
    function bar();
}</code></pre>
<h3 id="pas-de-return-avec-parenthèses"><span class="header-section-number">8.1.3</span> Pas de return avec parenthèses</h3>
<p>Éviter les parenthèses inutiles :</p>
<pre><code>return (x);</code></pre>
<p>Préférer :</p>
<pre><code>return x;</code></pre>
<p>L'opérateur <code>return</code> n'est pas une fonction (comme println par ex.). On écrira donc <code>println(x);</code> mais <code>return x;</code></p>
<h3 id="pas-de-switch-sans-parenthèses"><span class="header-section-number">8.1.4</span> Pas de switch sans parenthèses</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">switch</span> (x) {
}</code></pre></div>
<p>et non pas comme en Swift :</p>
<pre><code>switch x {
}</code></pre>
<h3 id="pas-de-duplication"><span class="header-section-number">8.1.5</span> Pas de duplication</h3>
<p>Éviter :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; digitLength; i++) {
    <span class="dt">int</span> digit = n % <span class="dv">16</span>;
    <span class="kw">switch</span> (digit) {
        <span class="kw">case</span> <span class="dv">0</span>:
            out.<span class="fu">append</span>(<span class="st">&quot;0&quot;</span>);
            <span class="kw">break</span>;
        <span class="kw">case</span> <span class="dv">1</span>:
            out.<span class="fu">append</span>(<span class="st">&quot;1&quot;</span>);
            <span class="kw">break</span>;
        <span class="kw">case</span> <span class="dv">2</span>:
            out.<span class="fu">append</span>(<span class="st">&quot;2&quot;</span>);
            <span class="kw">break</span>;
        ...
        <span class="kw">case</span> <span class="dv">15</span>:
            out.<span class="fu">append</span>(<span class="st">&quot;F&quot;</span>);
            <span class="kw">break</span>;
    }
    n /= <span class="dv">16</span>;
}</code></pre></div>
<p>Préférer :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">String</span>[] printedDigits = {<span class="st">&quot;0&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, ..., <span class="st">&quot;F&quot;</span>};
<span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; digitLength; i++) {
    <span class="dt">int</span> digit = n % <span class="dv">16</span>;
    out.<span class="fu">append</span>(printedDigits[digit]);
    n /= <span class="dv">16</span>;
}</code></pre></div>
<p>Un switch qui contient du code qui se ressemble est une indication que le code est plus complexe qu'il ne devrait.</p>
<h3 id="pas-de-cast-entre-type-primitif-et-référence"><span class="header-section-number">8.1.6</span> Pas de cast entre type primitif et référence</h3>
<p>Attention le type <code>int</code> n'est pas castable en <code>String</code>. De manière générale, un type primitif n'est jamais castable en type référence. On pourrait le croire dans le cas de <code>Integer n = 10;</code>. Mais c'est un autre mécanisme que le cast qui est en jeu ici : l'auto-boxing.</p>
<p>Ainsi :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span> n = <span class="dv">10</span>;
<span class="bu">String</span> s = (<span class="bu">String</span>) n; <span class="co">// Error: incompatible types: int cannot be converted to java.lang.String</span></code></pre></div>
<p>Pour avoir la représentation décimale du nombre <code>n</code> on pourra utiliser :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span> address = <span class="bn">0xA</span>;

<span class="bu">String</span>.<span class="fu">valueOf</span>(address); <span class="co">// 10</span>
<span class="bu">Integer</span>.<span class="fu">toString</span>(address); <span class="co">// 10</span></code></pre></div>
<h3 id="pas-de-méthode-dans-une-méthode"><span class="header-section-number">8.1.7</span> Pas de méthode dans une méthode</h3>
<p>En Java on ne peut pas définir une méthode dans le corps d'une une méthode.</p>
<pre><code>class MethodInMethod {
    void foo() {
        void bar() { // Error illegal start of expression
                     // Error &#39;;&#39; expected

        }
    }
}</code></pre>
<p>On observe le même principe pour <code>0 == false</code>.</p>
<h3 id="faute-de-frappe-et-confusion"><span class="header-section-number">8.1.8</span> Faute de frappe et confusion</h3>
<p>On écrit le type chaîne <code>String</code> et non pas <code>string</code>. La classe <code>String</code> en Java prend une capitale. C'est l'équivalent C# qui peut s'écrire : <code>string</code>.</p>
<p>On n'écrit pas <code>Class Foo {}</code> en majuscule, mais <code>class Foo {}</code>. Tous les mots-clés du langage sont en minuscule.</p>
<p>On écrit <code>@Override</code> et non pas <code>@Overide</code>. C'est l'annotation qui indique une méthode est héritée.</p>
<p>On écrit <code>length</code> et non pas <code>lenght</code>. C'est le champ de classe pour qui stocke la taille d'un tableau.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span>[] array = {};
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(array.<span class="fu">length</span>);</code></pre></div>
<h2 id="valeur-par-défaut"><span class="header-section-number">8.2</span> Valeur par défaut</h2>
<p>La valeur par défaut d'un type primitif est un élément neutre (pour la somme ou la disjonction logique <code>||</code>) : une sorte de zéro.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> ValeurType {
    <span class="dt">int</span> a;
    <span class="dt">double</span> x;
    <span class="dt">boolean</span> ok;
    <span class="bu">Object</span> o;
    <span class="bu">String</span> s;
    
    <span class="dt">void</span> <span class="fu">print</span>() {
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(a); <span class="co">// 0</span>
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(x); <span class="co">// 0.0</span>
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(ok); <span class="co">// false</span>
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(o); <span class="co">// null</span>
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(s); <span class="co">// null</span>
    }
}</code></pre></div>
<p>Pour les types référence c'est <code>null</code>. Cette référence spéciale qui est affectable à n'importe quelle type est assimilable à un zéro mais n'est pas neutre (cas de la <code>NullPointerException</code>).</p>
<p>Attention : <code>String</code> est un type référence. La valeur par défaut d'une <code>String</code> n'est pas la chaîne vide : <code>&quot;&quot;</code>. C'est <code>null</code>. Contrairement à JavaScript il n'y a pas de conversion implicite de <code>null</code> à <code>&quot;&quot;</code>.</p>
<p>La valeur par défaut <em>n'est pas</em> une valeur aléatoire qui dépend de l'état du système comme en C.</p>
<p>En revanche, une valeur par défaut est uniquement affectée pour les champs de classe mais pas pour les variables locales.</p>
<p>Ainsi, utiliser une variable locale qui peut être non initialisée est une erreur de compilation.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> ValeurDefaut {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        <span class="dt">int</span> a;
        
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(a); <span class="co">// Error: variable a might not have been initialized</span>
    }
}</code></pre></div>
<h3 id="opérateur"><span class="header-section-number">8.2.1</span> Opérateur ==</h3>
<p>L'opérateur <code>==</code> vérifie à la compilation que les deux opérandes sont de types comparables (c-à-d. cast possible). Et il vérifie l'égalité des valeurs à l'exécution.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="dv">0</span> == <span class="dv">1</span>);
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="dv">0</span> == <span class="fl">0.0</span>);
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="kw">null</span> == <span class="dv">0</span>); <span class="co">// Error: incomparable types: &lt;nulltype&gt; and int</span>
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(<span class="dv">0</span> == <span class="kw">false</span>); <span class="co">// Error: incomparable types: int and boolean</span></code></pre></div>
<p>L'expression <code>null == 0</code> ne compile pas. L'erreur est comparable à une erreur de cast :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span> i = (<span class="dt">int</span>) <span class="kw">null</span>; <span class="co">// Error: incompatible types: &lt;nulltype&gt; cannot be converted to int</span></code></pre></div>
<h3 id="types-primitifs"><span class="header-section-number">8.2.2</span> Types primitifs</h3>
<table>
<thead>
<tr class="header">
<th align="right">Type</th>
<th>Valeur par défaut</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">byte</td>
<td>0</td>
</tr>
<tr class="even">
<td align="right">short</td>
<td>0</td>
</tr>
<tr class="odd">
<td align="right">int</td>
<td>0</td>
</tr>
<tr class="even">
<td align="right">long</td>
<td>0L</td>
</tr>
<tr class="odd">
<td align="right">float</td>
<td>0.0f</td>
</tr>
<tr class="even">
<td align="right">double</td>
<td>0.0d</td>
</tr>
<tr class="odd">
<td align="right">char</td>
<td>'000'</td>
</tr>
<tr class="even">
<td align="right">Object</td>
<td>null</td>
</tr>
<tr class="odd">
<td align="right">boolean</td>
<td>false</td>
</tr>
</tbody>
</table>
<p>https://docs.oracle.com/javase/tutorial/java/nutsandbolts/datatypes.html</p>
<p>Il n'existe pas de type qui soit la combinaison de types primitifs comme en C. Ainsi, ni <code>long long</code> ni <code>long double</code> par exemple n'existent en Java. En C, la taille d'un long dépend de l'implémentation. Ainsi on ne sait de <code>long long</code> qu'il n'est pas plus petit que <code>long</code> (c'est tout). En Java, la taille est normalisée dans la spécification (32 bits pour int).</p>
<p>https://en.wikipedia.org/wiki/C_data_types</p>
<h3 id="décalage-de-bits"><span class="header-section-number">8.2.3</span> Décalage de bits</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> DecalageBits {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {
        <span class="dt">int</span> a = <span class="dv">1</span>;
        <span class="dt">int</span> b = a &lt;&lt; <span class="dv">8</span>;

        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(a); <span class="co">// 1</span>
        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(b); <span class="co">// 256</span>

        b = b &gt;&gt; <span class="dv">8</span>;

        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(b); <span class="co">// 1</span>
    }
}</code></pre></div>
<p>L'expression <code>a &lt;&lt; 8</code> ne modifie pas <code>a</code>. Elle vaut <code>a</code> dont les bits ont été décalés de 8 places vers la gauche. Ansi, décaler un nombre d'un bit vers la gauche revient à le multiplier par 2. Décaler de deux bits multiplie par 4. Décaler de <code>n</code> bits multiplie par 2 puissance <code>n</code>.</p>
<p>L'opérande de droite indique le nombre de bits à décaler :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span> source = <span class="bn">0x1</span>;
<span class="dt">int</span> decalage = <span class="dv">3</span>;

<span class="fu">println</span>(source &lt;&lt; decalage); <span class="co">// 8</span>
<span class="fu">println</span>(source &gt;&gt; decalage); <span class="co">// 0</span></code></pre></div>
<p>Donc l'opérateur binaire <code>&lt;&lt;</code> (resp. <code>&gt;&gt;</code>) n'est pas commutatif comme l'opérateur <code>+</code> peut l'être.</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span> mi = <span class="dv">2</span>;
<span class="dt">int</span> sina = <span class="dv">3</span>;
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(mi &lt;&lt; sina); <span class="co">// 16</span>
<span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(sina &lt;&lt; mi); <span class="co">// 12</span></code></pre></div>
<p>Enfin l'opérateur <code>&gt;&gt;</code> qui est l'inverse de <code>&lt;&lt;</code> décale vers la droite. Ainsi : <code>2 &gt;&gt; 1</code> vaut <code>1</code>.</p>
<p>Les opérateur <code>&lt;&lt;</code> et <code>&gt;&gt;</code> sont associatifs. Ainsi l'expression :</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dv">1</span> &lt;&lt; <span class="dv">2</span> &gt;&gt; <span class="dv">2</span> &lt;&lt; <span class="dv">3</span> &gt;&gt; <span class="dv">3</span> <span class="co">// 1</span></code></pre></div>
<p>S'associe de gauche à droite (comme tous les opérateurs binaires sauf l'affectation <code>=</code>).</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">(((<span class="dv">1</span> &lt;&lt; <span class="dv">2</span>) &gt;&gt; <span class="dv">2</span>) &lt;&lt; <span class="dv">3</span>) &gt;&gt; <span class="dv">3</span> <span class="co">// 1</span></code></pre></div>
<h2 id="références"><span class="header-section-number">8.3</span> Références</h2>
<p>https://docs.oracle.com/javase/tutorial/</p>
<p>https://docs.oracle.com/javase/specs/</p>
</body>
</html>
